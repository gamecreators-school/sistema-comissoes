<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Creators Pro V2 - Sistema Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            --warning-gradient: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            --danger-gradient: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            --info-gradient: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            --dark-gradient: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            
            --bg-primary: #f7fafc;
            --bg-secondary: #edf2f7;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --shadow-sm: 0 4px 15px rgba(0,0,0,0.1);
            --shadow-lg: 0 20px 60px rgba(0,0,0,0.3);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --text-primary: #f7fafc;
            --text-secondary: #cbd5e0;
            --border-color: #4a5568;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            padding: 10px;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-card h1 {
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 14px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            transition: var(--transition);
            background: white;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input.valid {
            border-color: #38a169;
            background-color: #f0fff4;
        }

        .form-group input.invalid {
            border-color: #e53e3e;
            background-color: #fed7d7;
        }

        .search-box {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 14px;
            width: 100%;
            max-width: 300px;
            transition: var(--transition);
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: var(--success-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(56, 161, 105, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(56, 161, 105, 0.4);
        }

        .btn-danger {
            background: var(--danger-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3);
        }

        .btn-warning {
            background: var(--warning-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(237, 137, 54, 0.3);
        }

        .btn-info {
            background: var(--info-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(49, 130, 206, 0.3);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
            margin: 2px;
        }

        .quick-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .forgot-password {
            margin-top: 15px;
            font-size: 12px;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
        }

        .debug-buttons {
            margin-top: 20px;
            display: none;
        }

        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin: 0 auto;
            max-width: 100%;
            display: none;
            backdrop-filter: blur(20px);
        }

        .page-header {
            background: var(--dark-gradient);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><radialGradient id="a" cx="50%" cy="0%" r="100%"><stop offset="0%" stop-color="rgba(255,255,255,0.1)"/><stop offset="100%" stop-color="rgba(255,255,255,0)"/></radialGradient></defs><rect width="100" height="20" fill="url(%23a)"/></svg>');
            pointer-events: none;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .theme-toggle, .notification-bell {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: var(--transition);
        }

        .theme-toggle:hover, .notification-bell:hover {
            background: rgba(255,255,255,0.25);
        }

        .notification-bell {
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e53e3e;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--success-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .user-details h3 {
            font-size: 18px;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .user-level, .unit-badge, .sync-status {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 2px;
        }

        .unit-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 4px;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
        }

        .logout-btn {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }

        /* Filtro de unidade */
        .unit-filter {
            background: var(--bg-primary);
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .unit-selector {
            display: inline-block;
            margin: 0 10px;
            padding: 10px 20px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .unit-selector.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .nav-tabs {
            background: var(--bg-primary);
            padding: 0;
            display: flex;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
            overflow-x: auto;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 18px 24px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-size: 14px;
            white-space: nowrap;
            position: relative;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .tab-button:hover {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            color: #38a169;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            padding: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow-sm);
            border-left: 5px solid #38a169;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, rgba(56,161,105,0.08), rgba(104,211,145,0.08));
            border-radius: 50%;
            transform: translate(40px, -40px);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .stat-icon {
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .conversion-card {
            border-left-color: #ed8936;
        }

        .conversion-rate {
            font-size: 28px;
            font-weight: 800;
            color: #ed8936;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-gradient);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .notification {
            padding: 16px 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: 600;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 420px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.success {
            background: linear-gradient(135deg, rgba(199, 246, 213, 0.95), rgba(240, 253, 244, 0.95));
            color: #22543d;
            border-left: 4px solid #38a169;
        }

        .notification.error {
            background: linear-gradient(135deg, rgba(254, 215, 215, 0.95), rgba(255, 245, 245, 0.95));
            color: #742a2a;
            border-left: 4px solid #e53e3e;
        }

        .notification.warning {
            background: linear-gradient(135deg, rgba(254, 245, 231, 0.95), rgba(255, 251, 235, 0.95));
            color: #744210;
            border-left: 4px solid #ed8936;
        }

        .notification.info {
            background: linear-gradient(135deg, rgba(190, 227, 248, 0.95), rgba(235, 248, 255, 0.95));
            color: #2c5282;
            border-left: 4px solid #3182ce;
        }

        .hidden {
            display: none !important;
        }

        /* Tabelas */
        .data-table {
            width: 100%;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin-top: 20px;
        }

        .data-table th {
            background: var(--dark-gradient);
            color: white;
            padding: 20px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .data-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .data-table tr:hover {
            background: var(--bg-primary);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Chart container */
        .chart-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            margin: 20px 0;
        }

        .chart-canvas {
            width: 100%;
            height: 300px;
            background: var(--bg-primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Calendar */
        .calendar-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            margin: 20px 0;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
        }

        .calendar-day {
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .calendar-day:hover {
            background: var(--bg-primary);
        }

        .calendar-day.today {
            background: var(--primary-gradient);
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-events {
            background: rgba(56, 161, 105, 0.1);
            border: 2px solid #38a169;
        }

        /* Activity feed */
        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px 0;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .activity-item:hover {
            background: var(--bg-primary);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .activity-description {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .activity-time {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        /* Modal para notifica√ß√µes */
        .notification-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-lg);
            z-index: 9998;
            display: none;
            overflow: hidden;
        }

        .notification-panel-header {
            background: var(--dark-gradient);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-panel-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-item:hover {
            background: var(--bg-primary);
        }

        .notification-item.unread {
            background: rgba(102, 126, 234, 0.05);
            border-left: 4px solid #667eea;
        }

        /* Ranking espec√≠fico */
        .rank-1 { 
            background: linear-gradient(135deg, #ffd700, #ffed4e); 
            color: #2d3748; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .rank-2 { 
            background: linear-gradient(135deg, #c0c0c0, #e2e8f0); 
            color: #2d3748; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .rank-3 { 
            background: linear-gradient(135deg, #cd7f32, #dd6b20); 
            color: white; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .rank-other { 
            background: linear-gradient(135deg, #4a5568, #2d3748); 
            color: white; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Badges para roles */
        .role-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .role-vendedor {
            background: rgba(56, 161, 105, 0.1);
            color: #38a169;
        }
        
        .role-gerente {
            background: rgba(237, 137, 54, 0.1);
            color: #ed8936;
        }
        
        .role-assistente {
            background: rgba(49, 130, 206, 0.1);
            color: #3182ce;
        }
        
        .role-admin {
            background: rgba(229, 62, 62, 0.1);
            color: #e53e3e;
        }

        /* Gamifica√ß√£o */
        .mission-card {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            border: 2px solid #38a169;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            transition: var(--transition);
        }

        .mission-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(56, 161, 105, 0.2);
        }

        .mission-completed {
            background: linear-gradient(135deg, #c6f6d5, #e6fffa);
            border-color: #2f855a;
        }

        .mission-failed {
            background: linear-gradient(135deg, #fed7d7, #fef5e7);
            border-color: #e53e3e;
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .mission-title {
            font-weight: bold;
            color: var(--text-primary);
            font-size: 16px;
        }

        .mission-reward {
            background: #38a169;
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
        }

        .mission-progress {
            margin: 12px 0;
        }

        .achievement-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
            margin: 4px;
            transition: var(--transition);
            cursor: pointer;
        }

        .achievement-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .xp-badge {
            background: var(--primary-gradient);
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Se√ß√µes especiais */
        .team-overview {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            border: 2px solid #38a169;
            border-radius: 15px;
            padding: 25px;
            margin: 25px;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .team-member-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            text-align: center;
            transition: var(--transition);
        }

        .team-member-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .member-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: white;
            margin: 0 auto 15px;
        }

        .member-name {
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 16px;
        }

        .member-role {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .member-stats {
            font-size: 12px;
            color: #38a169;
            font-weight: 600;
        }

        .visits-section {
            background: linear-gradient(135deg, #fef5e7, #fed7c2);
            border: 2px solid #ed8936;
            border-radius: 15px;
            padding: 25px;
            margin: 25px;
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            min-width: 300px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Bot√µes de a√ß√£o */
        .action-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .close-modal {
            background: var(--danger-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
        }

        /* Export buttons */
        .export-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transition: var(--transition);
            z-index: 1000;
        }

        .floating-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 20px;
            }
            
            .nav-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .tab-button {
                min-width: 140px;
                padding: 16px 20px;
            }

            .user-info {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .page-header {
                padding: 20px;
                flex-direction: column;
                gap: 20px;
            }

            .stat-card {
                padding: 25px;
            }

            .notification {
                max-width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }

            .notification-panel {
                width: calc(100vw - 40px);
                right: 20px;
            }

            .team-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                flex-direction: column;
            }

            .action-buttons {
                flex-direction: column;
            }

            .floating-action-btn {
                bottom: 20px;
                right: 20px;
            }

            .login-card {
                padding: 30px 25px;
                margin: 20px;
            }

            .debug-buttons {
                flex-direction: column;
            }

            .btn {
                padding: 12px 20px;
                font-size: 13px;
            }

            .quick-actions .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .form-group {
                margin-bottom: 15px;
            }

            .dashboard-grid {
                padding: 15px;
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-value {
                font-size: 28px;
            }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .print-area, .print-area * {
                visibility: visible;
            }
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .btn, .action-buttons, .floating-action-btn {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <h1>üéÆ Game Creators</h1>
            <p class="login-subtitle">Sistema Avan√ßado de Comiss√µes e Gamifica√ß√£o V2 ULTIMATE</p>
            <div class="form-group">
                <label>üë§ Usu√°rio:</label>
                <input type="text" id="loginUsername" placeholder="Digite seu usu√°rio" autocomplete="username">
            </div>
            <div class="form-group">
                <label>üîí Senha:</label>
                <input type="password" id="loginPassword" placeholder="Digite sua senha" autocomplete="current-password">
            </div>
            <button class="btn btn-primary" onclick="login()" style="width: 100%; margin-top: 25px;">
                üöÄ Entrar no Sistema
            </button>
            <div class="forgot-password" onclick="showForgotPassword()">
                Esqueceu sua senha?
            </div>
            <div id="debugButtons" class="debug-buttons">
                <div style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; margin-top: 15px;">
                    <button class="btn btn-info btn-sm" onclick="diagnosticoCompleto()">üîç Diagn√≥stico</button>
                    <button class="btn btn-success btn-sm" onclick="criarUsuarioTeste()">üß™ Criar Teste</button>
                    <button class="btn btn-warning btn-sm" onclick="repararSistema()">üîß Reparar</button>
                    <button class="btn btn-primary btn-sm" onclick="loginAutomatico('admin@gamecreatorsadm.com')">üëë Admin</button>
                    <button class="btn btn-danger btn-sm" onclick="resetTotal()">üóëÔ∏è Reset</button>
                </div>
            </div>
            <div id="loginError" class="notification error hidden" style="position: relative; margin-top: 20px;">
                Usu√°rio ou senha incorretos!
            </div>
        </div>
    </div>

    <!-- Sistema Principal -->
    <div id="mainSystem" class="main-container">
        <!-- Header com Info do Usu√°rio -->
        <div class="page-header">
            <div class="header-content">
                <h1 id="headerTitle">üéÆ Game Creators Pro V2 ULTIMATE</h1>
                <p style="font-size: 14px; opacity: 0.8; margin-top: 4px;">Sistema Completo de Gest√£o e Gamifica√ß√£o</p>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()">üåô Modo Escuro</button>
                <div class="notification-bell" onclick="toggleNotificationPanel()">
                    üîî Notifica√ß√µes
                    <span class="notification-badge" id="notificationBadge">0</span>
                </div>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <h3 id="userName">Usu√°rio</h3>
                    <div class="user-level" id="userLevel">N√≠vel 1 - Iniciante</div>
                    <div class="unit-badge" id="userUnit">Shopping Conjunto Nacional</div>
                    <div class="sync-status" id="syncStatus">
                        <span id="syncIcon">üü¢</span>
                        <span id="syncText">Online</span>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">üö™ Sair</button>
            </div>
        </div>

        <!-- Painel de Notifica√ß√µes -->
        <div id="notificationPanel" class="notification-panel">
            <div class="notification-panel-header">
                üîî Notifica√ß√µes
                <button style="background: none; border: none; color: white; cursor: pointer;" onclick="toggleNotificationPanel()">√ó</button>
            </div>
            <div class="notification-panel-content" id="notificationPanelContent">
                <!-- Preenchido dinamicamente -->
            </div>
        </div>

        <!-- Filtro de Unidade (apenas para admins) -->
        <div id="unitFilter" class="unit-filter hidden">
            <strong>üè¢ Filtrar por Unidade:</strong>
            <div id="unitSelectors" style="margin-top: 15px;">
                <!-- Preenchido dinamicamente -->
            </div>
        </div>

        <!-- Navega√ß√£o -->
        <div class="nav-tabs" id="navTabs">
            <!-- Preenchido dinamicamente -->
        </div>

        <!-- Dashboard Principal -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid" id="dashboardGrid">
                <!-- Preenchido dinamicamente -->
            </div>

            <!-- Gr√°ficos de Performance -->
            <div style="padding: 30px;">
                <div class="chart-container">
                    <h3>üìà Performance Mensal</h3>
                    <div class="chart-canvas" id="performanceChart">
                        Gr√°fico de performance ser√° exibido aqui
                    </div>
                </div>

                <div class="chart-container">
                    <h3>üìä Convers√£o por Per√≠odo</h3>
                    <div class="chart-canvas" id="conversionChart">
                        Gr√°fico de convers√£o ser√° exibido aqui
                    </div>
                </div>
            </div>

            <!-- Atividades Recentes -->
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üìã Atividades Recentes</h3>
                    <div class="activity-feed" id="activityFeed">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Calend√°rio -->
        <div id="calendario" class="tab-content">
            <div style="padding: 30px;">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="changeMonth(-1)">‚óÄ Anterior</button>
                        <h3 id="calendarTitle">Janeiro 2024</h3>
                        <button class="calendar-nav" onclick="changeMonth(1)">Pr√≥ximo ‚ñ∂</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Eventos do Dia -->
                <div class="stat-card">
                    <h3>üìÖ Eventos de <span id="selectedDate">Hoje</span></h3>
                    <div id="dayEvents">
                        <p style="text-align: center; color: #666; padding: 20px;">Selecione um dia no calend√°rio para ver os eventos</p>
                    </div>
                </div>

                <!-- Adicionar Evento -->
                <div class="stat-card">
                    <h3>‚ûï Adicionar Evento/Lembrete</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>T√≠tulo:</label>
                            <input type="text" id="eventTitle" placeholder="Ex: Reuni√£o de equipe">
                        </div>
                        <div class="form-group">
                            <label>Data:</label>
                            <input type="date" id="eventDate">
                        </div>
                        <div class="form-group">
                            <label>Hora:</label>
                            <input type="time" id="eventTime">
                        </div>
                        <div class="form-group">
                            <label>Tipo:</label>
                            <select id="eventType">
                                <option value="reuniao">üìã Reuni√£o</option>
                                <option value="meta">üéØ Meta</option>
                                <option value="lembrete">üîî Lembrete</option>
                                <option value="evento">üéâ Evento</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o:</label>
                        <textarea id="eventDescription" rows="3" placeholder="Detalhes do evento..."></textarea>
                    </div>
                    <button class="btn btn-success" onclick="addEvent()">üìÖ Adicionar Evento</button>
                </div>
            </div>
        </div>

        <!-- Gamifica√ß√£o -->
        <div id="gamificacao" class="tab-content">
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üéÆ Meu Progresso Gamer</h3>
                    <div id="userProgress">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üéØ Miss√µes Ativas</h3>
                    <div id="activeMissions">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üèÜ Hall da Fama</h3>
                    <div id="userAchievements">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Loja de Recompensas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üõí Loja de Recompensas</h3>
                    <div id="rewardsStore">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div style="border: 2px solid #38a169; border-radius: 12px; padding: 20px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üéÅ</div>
                                <h4>Vale Presente R$ 50</h4>
                                <p style="color: #666; font-size: 12px; margin: 10px 0;">Troque por vale presente</p>
                                <div style="font-weight: bold; color: #38a169; margin-bottom: 15px;">1000 XP</div>
                                <button class="btn btn-success btn-sm" onclick="redeemReward('gift50', 1000)">üõí Resgatar</button>
                            </div>
                            <div style="border: 2px solid #ed8936; border-radius: 12px; padding: 20px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üèñÔ∏è</div>
                                <h4>Dia de Folga Extra</h4>
                                <p style="color: #666; font-size: 12px; margin: 10px 0;">Um dia de descanso merecido</p>
                                <div style="font-weight: bold; color: #ed8936; margin-bottom: 15px;">2000 XP</div>
                                <button class="btn btn-warning btn-sm" onclick="redeemReward('dayoff', 2000)">üõí Resgatar</button>
                            </div>
                            <div style="border: 2px solid #667eea; border-radius: 12px; padding: 20px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üéñÔ∏è</div>
                                <h4>Certificado Destaque</h4>
                                <p style="color: #666; font-size: 12px; margin: 10px 0;">Reconhecimento oficial</p>
                                <div style="font-weight: bold; color: #667eea; margin-bottom: 15px;">1500 XP</div>
                                <button class="btn btn-primary btn-sm" onclick="redeemReward('certificate', 1500)">üõí Resgatar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Criar Miss√£o (Admin/Gerente) -->
                <div id="createMissionSection" class="stat-card hidden" style="margin-top: 25px;">
                    <h3>‚ûï Criar Nova Miss√£o</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>T√≠tulo da Miss√£o:</label>
                            <input type="text" id="missionTitle" placeholder="Ex: Vender 5 matr√≠culas esta semana">
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o:</label>
                            <textarea id="missionDescription" rows="3" placeholder="Descri√ß√£o detalhada da miss√£o..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Tipo:</label>
                            <select id="missionType">
                                <option value="vendas">üìä Meta de Vendas</option>
                                <option value="visitas">üë• Meta de Visitas</option>
                                <option value="conversao">üìà Meta de Convers√£o</option>
                                <option value="especial">‚≠ê Miss√£o Especial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Meta (n√∫mero):</label>
                            <input type="number" id="missionTarget" min="1" placeholder="Ex: 5">
                        </div>
                        <div class="form-group">
                            <label>Recompensa (XP):</label>
                            <input type="number" id="missionReward" min="10" placeholder="Ex: 100">
                        </div>
                        <div class="form-group">
                            <label>Prazo:</label>
                            <input type="date" id="missionDeadline">
                        </div>
                        <div class="form-group">
                            <label>Para quem:</label>
                            <select id="missionTarget_user">
                                <option value="all">Todos da unidade</option>
                                <option value="vendedores">Apenas vendedores</option>
                                <option value="assistentes">Apenas assistentes</option>
                                <option value="specific">Pessoa espec√≠fica</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="createMission()" style="margin-top: 15px;">üéØ Criar Miss√£o</button>
                </div>
            </div>
        </div>

        <!-- Visitas e Convers√£o -->
        <div id="visitas" class="tab-content">
            <div class="visits-section">
                <h3>üë• Central de Visitas - <span id="visitsUnitName">Shopping Conjunto Nacional</span></h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="form-group">
                        <label>üìÖ Data da Visita:</label>
                        <input type="date" id="visitDate" required>
                    </div>
                    <div class="form-group">
                        <label>üë§ Nome do Visitante:</label>
                        <input type="text" id="visitName" placeholder="Nome completo" required>
                    </div>
                    <div class="form-group">
                        <label>üì± Telefone:</label>
                        <input type="tel" id="visitPhone" placeholder="(11) 99999-9999" required>
                    </div>
                    <div class="form-group">
                        <label>üéì Curso de Interesse:</label>
                        <select id="visitCourse" required>
                            <option value="">Selecione...</option>
                            <option value="Creators 2D">Creators 2D</option>
                            <option value="Creators 3D">Creators 3D</option>
                            <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                            <option value="Creators Dev">Creators Dev</option>
                            <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üë®‚Äçüíº Atendido por:</label>
                        <select id="visitAttendant" required>
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üìù Observa√ß√µes:</label>
                        <input type="text" id="visitNotes" placeholder="Ex: Muito interessado, vai decidir em 3 dias...">
                    </div>
                </div>
                
                <div class="quick-actions">
                    <button class="btn btn-success" onclick="addVisit()">‚ú® Registrar Visita</button>
                    <button class="btn btn-warning" onclick="convertVisitToMatricula()">üéØ Converter em Matr√≠cula</button>
                </div>
            </div>
            
            <div style="padding: 30px;">
                <!-- Filtros de Visitas -->
                <div class="stat-card">
                    <h3>üîç Filtros de Visitas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>üóìÔ∏è Per√≠odo:</label>
                            <select id="visitPeriodFilter" onchange="filterVisits()">
                                <option value="today">Hoje</option>
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este M√™s</option>
                                <option value="all">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üë§ Atendente:</label>
                            <select id="visitAttendantFilter" onchange="filterVisits()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìä Status:</label>
                            <select id="visitStatusFilter" onchange="filterVisits()">
                                <option value="">Todos</option>
                                <option value="pending">Pendentes</option>
                                <option value="converted">Convertidos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üîç Buscar:</label>
                            <input type="text" class="search-box" id="visitSearchBox" placeholder="Nome ou telefone..." onkeyup="filterVisits()">
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <h3>üìä Dashboard de Convers√£o - <span id="conversionMonthYear">Dezembro 2024</span></h3>
                    <div id="conversionMetrics">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
                
                <div class="stat-card" style="margin-top: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>üìã Hist√≥rico de Visitas</h3>
                        <div class="export-buttons">
                            <button class="btn btn-info btn-sm" onclick="exportVisits('csv')">üìÑ CSV</button>
                            <button class="btn btn-warning btn-sm" onclick="exportVisits('excel')">üìä Excel</button>
                        </div>
                    </div>
                    <div id="recentVisits" style="max-height: 450px; overflow-y: auto;">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Equipe (apenas para gerentes) -->
        <div id="equipe" class="tab-content">
            <div class="team-overview">
                <h3>üë• Minha Equipe - <span id="teamUnitName">Shopping Conjunto Nacional</span></h3>
                <div class="team-grid" id="teamGrid">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>
            
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üìä Performance da Equipe - <span id="teamMonthYear">Dezembro 2024</span></h3>
                    <div id="teamPerformance">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Comunica√ß√£o da Equipe -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üí¨ Comunica√ß√£o da Equipe</h3>
                    <div class="form-group">
                        <label>üì¢ Enviar Mensagem para a Equipe:</label>
                        <textarea id="teamMessage" rows="3" placeholder="Digite sua mensagem para toda a equipe..."></textarea>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="sendTeamMessage()">üì§ Enviar Mensagem</button>
                        <button class="btn btn-success" onclick="scheduleTeamMeeting()">üìÖ Agendar Reuni√£o</button>
                    </div>
                </div>

                <!-- Metas Individuais -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üéØ Definir Metas Individuais</h3>
                    <div id="individualGoals">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Ranking -->
        <div id="ranking" class="tab-content">
            <div style="padding: 30px;">
                <!-- Filtros do Ranking -->
                <div class="stat-card">
                    <h3>üîç Filtros do Ranking</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>üìÖ Per√≠odo:</label>
                            <select id="rankingPeriod" onchange="updateRanking()">
                                <option value="month" selected>Este M√™s</option>
                                <option value="quarter">Trimestre</option>
                                <option value="year">Este Ano</option>
                                <option value="all">Todos os Tempos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìä Crit√©rio:</label>
                            <select id="rankingCriteria" onchange="updateRanking()">
                                <option value="matriculas" selected>Matr√≠culas</option>
                                <option value="conversao">Taxa de Convers√£o</option>
                                <option value="visitas">Visitas</option>
                                <option value="xp">Experi√™ncia (XP)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üè¢ Unidade:</label>
                            <select id="rankingUnit" onchange="updateRanking()">
                                <option value="">Todas</option>
                            </select>
                        </div>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üèÜ Ranking</th>
                            <th>üë§ Nome</th>
                            <th>üè¢ Unidade</th>
                            <th>üíº Cargo</th>
                            <th>üë• Visitas</th>
                            <th>üìä Matr√≠culas</th>
                            <th>üìà Convers√£o</th>
                            <th>üí∞ Comiss√£o</th>
                            <th>‚≠ê Experi√™ncia</th>
                        </tr>
                    </thead>
                    <tbody id="rankingBody">
                        <!-- Preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Painel Admin -->
        <div id="admin" class="tab-content">
            <div style="padding: 30px;">
                <h2>üë®‚Äçüíº Painel Administrativo</h2>
                
                <!-- Analytics Avan√ßado -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>üìà Analytics Avan√ßado</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                            <div style="font-size: 28px; font-weight: bold; color: #38a169;" id="totalRevenue">R$ 0</div>
                            <div style="font-size: 14px; color: #666;">Faturamento Total</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                            <div style="font-size: 28px; font-weight: bold; color: #667eea;" id="avgTicket">R$ 0</div>
                            <div style="font-size: 14px; color: #666;">Ticket M√©dio</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                            <div style="font-size: 28px; font-weight: bold; color: #ed8936;" id="growthRate">0%</div>
                            <div style="font-size: 14px; color: #666;">Crescimento Mensal</div>
                        </div>
                    </div>
                </div>

                <!-- Backup e Restore -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>üíæ Backup e Restore</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="createBackup()">üì¶ Criar Backup</button>
                        <button class="btn btn-warning" onclick="downloadBackup()">‚¨áÔ∏è Download Backup</button>
                        <input type="file" id="backupFile" accept=".json" style="display: none;" onchange="restoreBackup()">
                        <button class="btn btn-info" onclick="document.getElementById('backupFile').click()">‚¨ÜÔ∏è Restaurar Backup</button>
                        <button class="btn btn-danger" onclick="resetSystem()">üóëÔ∏è Reset Sistema</button>
                    </div>
                    <div id="backupStatus" style="margin-top: 15px; font-size: 12px; color: #666;"></div>
                </div>

                <!-- Configura√ß√µes do Sistema -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>‚öôÔ∏è Configura√ß√µes do Sistema</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div class="form-group">
                            <label>üîÑ Sincroniza√ß√£o Autom√°tica:</label>
                            <select id="autoSyncInterval">
                                <option value="0">Desabilitada</option>
                                <option value="300000">5 minutos</option>
                                <option value="600000" selected>10 minutos</option>
                                <option value="1800000">30 minutos</option>
                                <option value="3600000">1 hora</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìß Email Administrativo:</label>
                            <input type="email" id="adminEmail" placeholder="admin@gamecreatorsadm.com">
                        </div>
                        <div class="form-group">
                            <label>üåê URL da Empresa:</label>
                            <input type="url" id="companyUrl" placeholder="https://gamecreatorsadm.com">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="saveSystemConfig()">üíæ Salvar Configura√ß√µes</button>
                </div>

                <!-- Gerenciar Unidades -->
                <div class="stat-card" style="max-width: 600px; margin: 20px 0;">
                    <h3>üè¢ Gerenciar Unidades</h3>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: end;">
                        <div class="form-group">
                            <label>Nome da Nova Unidade:</label>
                            <input type="text" id="newUnitName" placeholder="Ex: Shopping Iguatemi">
                        </div>
                        <button class="btn btn-success" onclick="addNewUnit()">‚ûï Adicionar Unidade</button>
                    </div>
                    <div id="currentUnits" style="margin-top: 15px;">
                        <h4>Unidades Ativas:</h4>
                        <div id="unitsList">
                            <!-- Preenchido dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√£o de Metas -->
                <div class="stat-card" style="max-width: 800px; margin: 20px 0;">
                    <h3>üéØ Configura√ß√£o de Metas Mensais</h3>
                    <div id="metasConfig">
                        <!-- Preenchido dinamicamente baseado nas unidades existentes -->
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="salvarMetas()">üíæ Salvar Metas</button>
                        <button class="btn btn-primary" onclick="carregarMetas()">üîÑ Recarregar Metas</button>
                    </div>
                    <div id="metasStatus" style="margin-top: 10px;"></div>
                </div>

                <!-- Adicionar Usu√°rio -->
                <div class="stat-card" style="max-width: 500px; margin: 20px 0;">
                    <h3>‚ûï Adicionar Novo Usu√°rio</h3>
                    <div class="form-group">
                        <label>Nome:</label>
                        <input type="text" id="newUserName" placeholder="Nome completo">
                    </div>
                    <div class="form-group">
                        <label>Usu√°rio:</label>
                        <input type="text" id="newUserUsername" placeholder="nome.usuario@gamecreatorsadm.com">
                    </div>
                    <div class="form-group">
                        <label>Senha:</label>
                        <input type="password" id="newUserPassword" placeholder="senha123">
                    </div>
                    <div class="form-group">
                        <label>Tipo:</label>
                        <select id="newUserRole">
                            <option value="vendedor">üë®‚Äçüíº Vendedor</option>
                            <option value="gerente">üëî Gerente</option>
                            <option value="assistente">üë©‚Äçüíª Assistente</option>
                            <option value="admin">üîß Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Unidade:</label>
                        <select id="newUserUnit">
                            <!-- Preenchido dinamicamente -->
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="addUser()">‚ûï Adicionar Usu√°rio</button>
                </div>

                <!-- Lista de Usu√°rios -->
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üë§ Nome</th>
                            <th>üîë Usu√°rio</th>
                            <th>üè¢ Unidade</th>
                            <th>üíº Tipo</th>
                            <th>üìä Matr√≠culas</th>
                            <th>üë• Visitas</th>
                            <th>‚≠ê XP</th>
                            <th>üîß A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="userManagementBody">
                        <!-- Preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Matr√≠culas -->
        <div id="matriculas" class="tab-content">
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>‚ûï Adicionar Nova Matr√≠cula</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Data:</label>
                            <input type="date" id="newData" required>
                        </div>
                        <div class="form-group">
                            <label>Nome do Aluno:</label>
                            <input type="text" id="newNome" placeholder="Nome completo" required>
                        </div>
                        <div class="form-group">
                            <label>Telefone:</label>
                            <input type="tel" id="newTelefone" placeholder="(11) 99999-9999">
                        </div>
                        <div class="form-group">
                            <label>Curso:</label>
                            <select id="newCurso" required>
                                <option value="">Selecione...</option>
                                <option value="Creators 2D">Creators 2D</option>
                                <option value="Creators 3D">Creators 3D</option>
                                <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                                <option value="Creators Dev">Creators Dev</option>
                                <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Valor Total do Curso (R$):</label>
                            <input type="number" id="newValorTotal" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Valor de Entrada (R$):</label>
                            <input type="number" id="newValorEntrada" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Tipo de Venda:</label>
                            <select id="newTipo" required>
                                <option value="Convencional">Convencional (√Ä vista ou parcelado normal)</option>
                                <option value="Blackin">Blackin (6x no cart√£o)</option>
                                <option value="Black">Black (10x+ no cart√£o)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Parcelas (se aplic√°vel):</label>
                            <input type="number" id="newParcelas" min="1" max="24" placeholder="Ex: 6, 10, 12...">
                        </div>
                        <div class="form-group">
                            <label>Vendedor:</label>
                            <select id="newVendedor" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Gerente:</label>
                            <select id="newGerente" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Assistente:</label>
                            <select id="newAssistente" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Origem do Cliente:</label>
                            <select id="newFromVisit" onchange="toggleCustomOrigin()">
                                <option value="">Cliente Direto</option>
                                <option value="porta">Cliente Porta</option>
                                <option value="street">Street Marketing</option>
                                <option value="agendamento">Agendamento</option>
                                <option value="evento">Evento</option>
                                <option value="custom">Outra (especificar)</option>
                            </select>
                        </div>
                        <div class="form-group" id="customOriginGroup" style="display: none;">
                            <label>Especificar Origem:</label>
                            <input type="text" id="customOriginText" placeholder="Digite a origem personalizada">
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="addMatricula()" style="margin-top: 15px;">‚ûï Adicionar Matr√≠cula</button>
                </div>

                <!-- Filtros de Matr√≠culas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üîç Filtros de Matr√≠culas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>üìÖ Per√≠odo:</label>
                            <select id="matriculaPeriodFilter" onchange="filterMatriculas()">
                                <option value="today">Hoje</option>
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este M√™s</option>
                                <option value="all">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üë§ Vendedor:</label>
                            <select id="matriculaVendedorFilter" onchange="filterMatriculas()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üéì Curso:</label>
                            <select id="matriculaCursoFilter" onchange="filterMatriculas()">
                                <option value="">Todos</option>
                                <option value="Creators 2D">Creators 2D</option>
                                <option value="Creators 3D">Creators 3D</option>
                                <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                                <option value="Creators Dev">Creators Dev</option>
                                <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üîç Buscar:</label>
                            <input type="text" class="search-box" id="matriculaSearchBox" placeholder="Nome do aluno..." onkeyup="filterMatriculas()">
                        </div>
                    </div>
                </div>

                <!-- Lista de Matr√≠culas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>üìä Matr√≠culas Recentes</h3>
                        <div class="export-buttons">
                            <button class="btn btn-info btn-sm" onclick="exportMatriculas('csv')">üìÑ CSV</button>
                            <button class="btn btn-warning btn-sm" onclick="exportMatriculas('excel')">üìä Excel</button>
                        </div>
                    </div>
                    <div id="matriculasList" style="max-height: 400px; overflow-y: auto;">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Relat√≥rios -->
        <div id="relatorios" class="tab-content">
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üìä Relat√≥rios de Performance</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>M√™s/Ano:</label>
                            <input type="month" id="relatorioMes">
                        </div>
                        <div class="form-group">
                            <label>Unidade:</label>
                            <select id="relatorioUnidade">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Colaborador:</label>
                            <select id="relatorioColaborador">
                                <option value="">Todos</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="gerarRelatorioComissoes()">üí∞ Relat√≥rio Comiss√µes</button>
                        <button class="btn btn-success" onclick="gerarRelatorioConversao()">üìà Relat√≥rio Convers√£o</button>
                        <button class="btn btn-warning" onclick="gerarRelatorioUnidade()">üè¢ Relat√≥rio por Unidade</button>
                        <button class="btn btn-info" onclick="gerarRelatorioMetas()">üéØ Relat√≥rio Metas vs Realizado</button>
                        <button class="btn btn-primary" onclick="gerarRelatorioTendencias()">üìà An√°lise de Tend√™ncias</button>
                        <button class="btn btn-success" onclick="gerarRelatorioPrevisao()">üîÆ Previs√£o de Vendas</button>
                    </div>
                </div>

                <div id="relatorioResultado" class="print-area">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>
        </div>

        <!-- Chat/Mensagens -->
        <div id="chat" class="tab-content">
            <div style="padding: 30px;">
                <!-- Salas de Chat -->
                <div class="stat-card">
                    <h3>üí¨ Salas de Conversa</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div style="border: 2px solid #38a169; border-radius: 12px; padding: 20px; cursor: pointer;" onclick="openChatRoom('geral')">
                            <h4>üåê Chat Geral</h4>
                            <p style="color: #666; font-size: 12px;">Conversa aberta para todos</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="font-size: 12px; color: #38a169;">Online: 5</span>
                                <span style="font-size: 12px; color: #666;">3 mensagens n√£o lidas</span>
                            </div>
                        </div>
                        <div style="border: 2px solid #ed8936; border-radius: 12px; padding: 20px; cursor: pointer;" onclick="openChatRoom('vendas')">
                            <h4>üìä Chat Vendas</h4>
                            <p style="color: #666; font-size: 12px;">Para discuss√µes sobre vendas</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="font-size: 12px; color: #ed8936;">Online: 3</span>
                                <span style="font-size: 12px; color: #666;">1 mensagem n√£o lida</span>
                            </div>
                        </div>
                        <div style="border: 2px solid #667eea; border-radius: 12px; padding: 20px; cursor: pointer;" onclick="openChatRoom('suporte')">
                            <h4>üÜò Chat Suporte</h4>
                            <p style="color: #666; font-size: 12px;">Ajuda e suporte t√©cnico</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="font-size: 12px; color: #667eea;">Online: 2</span>
                                <span style="font-size: 12px; color: #666;">0 mensagens n√£o lidas</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- √Årea de Chat -->
                <div class="stat-card" style="margin-top: 25px;">
                    <div id="chatHeader" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 id="chatRoomTitle">üí¨ Selecione uma sala de chat</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary btn-sm" onclick="refreshChat()">üîÑ Atualizar</button>
                            <button class="btn btn-success btn-sm" onclick="toggleChatNotifications()">üîî Notifica√ß√µes</button>
                        </div>
                    </div>
                    
                    <div id="chatMessages" style="height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; background: var(--bg-primary); margin-bottom: 15px;">
                        <p style="text-align: center; color: #666;">Selecione uma sala de chat para come√ßar a conversar</p>
                    </div>

                    <div id="chatInputArea" style="display: none;">
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="chatMessage" placeholder="Digite sua mensagem..." style="flex: 1; padding: 12px; border: 2px solid var(--border-color); border-radius: 25px;" onkeypress="handleChatKeyPress(event)">
                            <button class="btn btn-primary" onclick="sendChatMessage()">üì§ Enviar</button>
                        </div>
                    </div>
                </div>

                <!-- Mensagens Privadas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üíå Mensagens Privadas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Para:</label>
                            <select id="privateMessageTo">
                                <option value="">Selecione um usu√°rio...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Assunto:</label>
                            <input type="text" id="privateMessageSubject" placeholder="Assunto da mensagem">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Mensagem:</label>
                        <textarea id="privateMessageContent" rows="4" placeholder="Digite sua mensagem privada..."></textarea>
                    </div>
                    <button class="btn btn-success" onclick="sendPrivateMessage()">üì© Enviar Mensagem Privada</button>

                    <!-- Lista de Mensagens Privadas -->
                    <div style="margin-top: 25px;">
                        <h4>üì® Suas Mensagens</h4>
                        <div id="privateMessagesList" style="max-height: 300px; overflow-y: auto;">
                            <!-- Preenchido dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot√£o Flutuante -->
    <button class="floating-action-btn" onclick="quickAddMatricula()" title="Adicionar Matr√≠cula R√°pida">
        ‚ûï
    </button>

    <!-- Modal para Adicionar Matr√≠cula R√°pida -->
    <div id="quickMatriculaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ö° Matr√≠cula R√°pida</h3>
                <button class="close-modal" onclick="closeQuickMatriculaModal()">√ó</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="quickNome" placeholder="Nome do aluno">
                </div>
                <div class="form-group">
                    <label>Curso:</label>
                    <select id="quickCurso">
                        <option value="Creators 2D">Creators 2D</option>
                        <option value="Creators 3D">Creators 3D</option>
                        <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                        <option value="Creators Dev">Creators Dev</option>
                        <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor (R$):</label>
                    <input type="number" id="quickValor" placeholder="2000" step="0.01">
                </div>
                <div class="form-group">
                    <label>Vendedor:</label>
                    <select id="quickVendedor">
                        <!-- Preenchido dinamicamente -->
                    </select>
                </div>
            </div>
            <button class="btn btn-success" onclick="addQuickMatricula()" style="margin-top: 15px; width: 100%;">‚ö° Adicionar Matr√≠cula R√°pida</button>
        </div>
    </div>

    <script>
        // Estado global da aplica√ß√£o
        let currentUser = null;
        let currentUnit = null;
        let currentTheme = 'light';
        let autoSyncInterval = null;
        let currentChatRoom = null;
        let notifications = [];
        let systemConfig = {};

        // Estrutura de dados
        let gameData = {
            users: {},
            matriculas: [],
            visitas: [],
            comissoes: [],
            units: ['Shopping Conjunto Nacional', 'Shopping Eldorado', 'Shopping Morumbi'],
            events: [],
            missions: [],
            achievements: [],
            chatMessages: {},
            privateMessages: [],
            metas: {}
        };

        // Fun√ß√£o principal de inicializa√ß√£o
        function initializeSystem() {
            loadGameData();
            initializeDefaultData();
            setupEventListeners();
            updateCurrentDateTime();
            checkAutoLogin();
            showDebugButtons();
        }

        // Carregamento e salvamento de dados
        function loadGameData() {
            try {
                const saved = JSON.parse(localStorage.getItem('gameCreatorsData') || '{}');
                gameData = { ...gameData, ...saved };
                console.log('‚úÖ Dados carregados com sucesso');
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                showNotification('Erro ao carregar dados salvos', 'error');
            }
        }

        function saveGameData() {
            try {
                localStorage.setItem('gameCreatorsData', JSON.stringify(gameData));
                updateSyncStatus('success');
            } catch (error) {
                console.error('‚ùå Erro ao salvar dados:', error);
                updateSyncStatus('error');
                showNotification('Erro ao salvar dados', 'error');
            }
        }

        // Inicializa√ß√£o de dados padr√£o
        function initializeDefaultData() {
            if (!gameData.users || Object.keys(gameData.users).length === 0) {
                createDefaultUsers();
            }
            if (!gameData.metas || Object.keys(gameData.metas).length === 0) {
                initializeDefaultMetas();
            }
            if (!gameData.chatMessages) {
                gameData.chatMessages = {
                    geral: [],
                    vendas: [],
                    suporte: []
                };
            }
        }

        function createDefaultUsers() {
            const defaultUsers = [
                {
                    username: 'admin@gamecreatorsadm.com',
                    password: 'admin123',
                    name: 'Administrador',
                    role: 'admin',
                    unit: 'Shopping Conjunto Nacional',
                    xp: 5000,
                    level: 10,
                    achievements: ['first_sale', 'super_seller', 'team_leader']
                },
                {
                    username: 'gerente@gamecreatorsadm.com',
                    password: 'gerente123',
                    name: 'Carlos Manager',
                    role: 'gerente',
                    unit: 'Shopping Conjunto Nacional',
                    xp: 3500,
                    level: 7,
                    achievements: ['first_sale', 'team_leader']
                },
                {
                    username: 'vendedor@gamecreatorsadm.com',
                    password: 'vendedor123',
                    name: 'Ana Silva',
                    role: 'vendedor',
                    unit: 'Shopping Conjunto Nacional',
                    xp: 2100,
                    level: 5,
                    achievements: ['first_sale', 'super_seller']
                },
                {
                    username: 'assistente@gamecreatorsadm.com',
                    password: 'assistente123',
                    name: 'Jo√£o Santos',
                    role: 'assistente',
                    unit: 'Shopping Conjunto Nacional',
                    xp: 1200,
                    level: 3,
                    achievements: ['first_sale']
                }
            ];

            defaultUsers.forEach(user => {
                gameData.users[user.username] = {
                    ...user,
                    id: generateId(),
                    createdAt: new Date().toISOString(),
                    stats: {
                        matriculas: Math.floor(Math.random() * 20),
                        visitas: Math.floor(Math.random() * 50),
                        conversao: Math.random() * 0.5,
                        comissao: Math.random() * 5000
                    }
                };
            });

            console.log('‚úÖ Usu√°rios padr√£o criados');
        }

        function initializeDefaultMetas() {
            gameData.units.forEach(unit => {
                gameData.metas[unit] = {
                    vendedores: 15,
                    gerentes: 20,
                    assistentes: 10,
                    unidade: 50
                };
            });
        }

        // Sistema de login
        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!username || !password) {
                showNotification('Por favor, preencha todos os campos', 'warning');
                return;
            }

            const user = gameData.users[username];
            
            if (user && user.password === password) {
                currentUser = user;
                currentUnit = user.unit;
                
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                showNotification(`Bem-vindo, ${user.name}! üéâ`, 'success');
                
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainSystem').style.display = 'block';
                
                initializeUserInterface();
                addActivity('login', `${user.name} fez login no sistema`);
                
                console.log('‚úÖ Login realizado com sucesso');
            } else {
                document.getElementById('loginError').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('loginError').classList.add('hidden');
                }, 3000);
                console.log('‚ùå Credenciais inv√°lidas');
            }
        }

        function logout() {
            if (currentUser) {
                addActivity('logout', `${currentUser.name} saiu do sistema`);
            }
            
            currentUser = null;
            currentUnit = null;
            
            localStorage.removeItem('currentUser');
            
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainSystem').style.display = 'none';
            
            clearInterval(autoSyncInterval);
            
            showNotification('Logout realizado com sucesso! üëã', 'info');
            console.log('‚úÖ Logout realizado');
        }

        function checkAutoLogin() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    currentUnit = currentUser.unit;
                    
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainSystem').style.display = 'block';
                    
                    initializeUserInterface();
                    showNotification(`Bem-vindo de volta, ${currentUser.name}! üéâ`, 'success');
                } catch (error) {
                    console.error('‚ùå Erro no auto-login:', error);
                    localStorage.removeItem('currentUser');
                }
            }
        }

        // Interface do usu√°rio
        function initializeUserInterface() {
            updateUserInfo();
            createNavigation();
            updateDashboard();
            setupUnitFilter();
            populateSelects();
            loadNotifications();
            startAutoSync();
            updateCalendar();
        }

        function updateUserInfo() {
            if (!currentUser) return;

            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userLevel').textContent = `N√≠vel ${currentUser.level} - ${getLevelName(currentUser.level)}`;
            document.getElementById('userUnit').textContent = currentUser.unit;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            
            // Atualizar cores do avatar baseado no n√≠vel
            const avatar = document.getElementById('userAvatar');
            const level = currentUser.level;
            if (level >= 10) avatar.style.background = 'linear-gradient(135deg, #ffd700, #ffed4e)';
            else if (level >= 7) avatar.style.background = 'linear-gradient(135deg, #c0c0c0, #e2e8f0)';
            else if (level >= 5) avatar.style.background = 'linear-gradient(135deg, #cd7f32, #dd6b20)';
        }

        function createNavigation() {
            const navTabs = document.getElementById('navTabs');
            const tabs = [
                { id: 'dashboard', name: 'üìä Dashboard', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'calendario', name: 'üìÖ Calend√°rio', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'gamificacao', name: 'üéÆ Gamifica√ß√£o', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'visitas', name: 'üë• Visitas', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'matriculas', name: 'üìö Matr√≠culas', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'equipe', name: 'üë• Equipe', roles: ['admin', 'gerente'] },
                { id: 'ranking', name: 'üèÜ Ranking', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'relatorios', name: 'üìä Relat√≥rios', roles: ['admin', 'gerente'] },
                { id: 'chat', name: 'üí¨ Chat', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'admin', name: '‚öôÔ∏è Admin', roles: ['admin'] }
            ];

            navTabs.innerHTML = tabs
                .filter(tab => tab.roles.includes(currentUser.role))
                .map(tab => `
                    <button class="tab-button ${tab.id === 'dashboard' ? 'active' : ''}" 
                            onclick="switchTab('${tab.id}')">
                        ${tab.name}
                    </button>
                `).join('');
        }

        function switchTab(tabId) {
            // Remover active de todas as tabs
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Ativar tab selecionada
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            // Carregar conte√∫do espec√≠fico da tab
            switch(tabId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'gamificacao':
                    updateGamification();
                    break;
                case 'visitas':
                    updateVisitasTab();
                    break;
                case 'equipe':
                    updateTeamTab();
                    break;
                case 'ranking':
                    updateRanking();
                    break;
                case 'admin':
                    updateAdminTab();
                    break;
                case 'matriculas':
                    updateMatriculasTab();
                    break;
                case 'relatorios':
                    updateRelatoriosTab();
                    break;
                case 'chat':
                    updateChatTab();
                    break;
                case 'calendario':
                    updateCalendar();
                    break;
            }
        }

        // Dashboard
        function updateDashboard() {
            const grid = document.getElementById('dashboardGrid');
            const userStats = calculateUserStats();
            const unitStats = calculateUnitStats();

            const cards = [
                {
                    title: 'Matr√≠culas do M√™s',
                    value: userStats.matriculas,
                    icon: 'üìö',
                    color: '#38a169',
                    progress: (userStats.matriculas / (gameData.metas[currentUnit]?.[currentUser.role] || 10)) * 100
                },
                {
                    title: 'Visitas Registradas',
                    value: userStats.visitas,
                    icon: 'üë•',
                    color: '#3182ce',
                    progress: (userStats.visitas / 50) * 100
                },
                {
                    title: 'Taxa de Convers√£o',
                    value: `${(userStats.conversao * 100).toFixed(1)}%`,
                    icon: 'üìà',
                    color: '#ed8936',
                    progress: userStats.conversao * 100
                },
                {
                    title: 'Comiss√£o do M√™s',
                    value: `R$ ${userStats.comissao.toFixed(2)}`,
                    icon: 'üí∞',
                    color: '#38a169',
                    progress: (userStats.comissao / 5000) * 100
                },
                {
                    title: 'Experi√™ncia (XP)',
                    value: currentUser.xp || 0,
                    icon: '‚≠ê',
                    color: '#667eea',
                    progress: ((currentUser.xp || 0) % 1000) / 10
                },
                {
                    title: 'N√≠vel Atual',
                    value: currentUser.level || 1,
                    icon: 'üéÆ',
                    color: '#ed8936',
                    progress: 100
                }
            ];

            grid.innerHTML = cards.map(card => `
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">${card.icon}</div>
                        <div style="font-size: 14px; font-weight: 600; color: ${card.color};">${card.title}</div>
                    </div>
                    <div class="stat-value" style="color: ${card.color};">${card.value}</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(card.progress, 100)}%; background: linear-gradient(135deg, ${card.color}, ${card.color}90);"></div>
                    </div>
                    <div class="progress-text">${Math.min(card.progress, 100).toFixed(0)}% da meta</div>
                </div>
            `).join('');

            updateActivityFeed();
        }

        function calculateUserStats() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const matriculas = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                return date.getMonth() === currentMonth && 
                       date.getFullYear() === currentYear &&
                       (m.vendedor === currentUser.name || m.gerente === currentUser.name || m.assistente === currentUser.name);
            });

            const visitas = gameData.visitas.filter(v => {
                const date = new Date(v.data);
                return date.getMonth() === currentMonth && 
                       date.getFullYear() === currentYear &&
                       v.atendente === currentUser.name;
            });

            const comissao = matriculas.reduce((sum, m) => sum + (m.comissaoVendedor || 0) + (m.comissaoGerente || 0) + (m.comissaoAssistente || 0), 0);
            const conversao = visitas.length > 0 ? matriculas.length / visitas.length : 0;

            return {
                matriculas: matriculas.length,
                visitas: visitas.length,
                conversao: conversao,
                comissao: comissao
            };
        }

        function calculateUnitStats() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const unitMatriculas = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                return date.getMonth() === currentMonth && 
                       date.getFullYear() === currentYear;
            });

            const unitVisitas = gameData.visitas.filter(v => {
                const date = new Date(v.data);
                return date.getMonth() === currentMonth && 
                       date.getFullYear() === currentYear;
            });

            return {
                matriculas: unitMatriculas.length,
                visitas: unitVisitas.length,
                conversao: unitVisitas.length > 0 ? unitMatriculas.length / unitVisitas.length : 0
            };
        }

        // Sistema de gamifica√ß√£o
        function updateGamification() {
            updateUserProgress();
            updateActiveMissions();
            updateUserAchievements();
            
            if (currentUser.role === 'admin' || currentUser.role === 'gerente') {
                document.getElementById('createMissionSection').classList.remove('hidden');
            }
        }

        function updateUserProgress() {
            const progressDiv = document.getElementById('userProgress');
            const xp = currentUser.xp || 0;
            const level = currentUser.level || 1;
            const nextLevelXP = level * 1000;
            const currentLevelXP = (level - 1) * 1000;
            const progressXP = xp - currentLevelXP;
            const neededXP = nextLevelXP - currentLevelXP;

            progressDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 25px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 15px;">
                        <div style="font-size: 32px; margin-bottom: 10px;">üéÆ</div>
                        <div style="font-size: 28px; font-weight: bold; margin-bottom: 8px;">N√≠vel ${level}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${getLevelName(level)}</div>
                        <div class="xp-badge" style="margin-top: 15px;">${xp} XP Total</div>
                    </div>
                    <div style="padding: 25px;">
                        <h4 style="margin-bottom: 15px;">üìà Progresso para o Pr√≥ximo N√≠vel</h4>
                        <div class="progress-bar" style="height: 15px; margin-bottom: 10px;">
                            <div class="progress-fill" style="width: ${(progressXP / neededXP) * 100}%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
                            <span>${progressXP} XP</span>
                            <span>${neededXP - progressXP} XP restantes</span>
                        </div>
                    </div>
                    <div style="padding: 25px;">
                        <h4 style="margin-bottom: 15px;">üèÜ Conquistas</h4>
                        <div>
                            ${(currentUser.achievements || []).map(achievement => 
                                `<span class="achievement-badge">${getAchievementName(achievement)}</span>`
                            ).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function getLevelName(level) {
            if (level >= 10) return 'Lenda';
            if (level >= 8) return 'Especialista';
            if (level >= 6) return 'Veterano';
            if (level >= 4) return 'Experiente';
            if (level >= 2) return 'Aprendiz';
            return 'Iniciante';
        }

        function getAchievementName(achievement) {
            const achievements = {
                'first_sale': 'üéØ Primeira Venda',
                'super_seller': '‚≠ê Super Vendedor',
                'team_leader': 'üëë L√≠der de Equipe',
                'month_champion': 'üèÜ Campe√£o do M√™s',
                'conversion_master': 'üìà Mestre da Convers√£o'
            };
            return achievements[achievement] || achievement;
        }

        function updateActiveMissions() {
            const missionsDiv = document.getElementById('activeMissions');
            
            // Criar miss√µes de exemplo se n√£o existirem
            if (!gameData.missions || gameData.missions.length === 0) {
                gameData.missions = [
                    {
                        id: generateId(),
                        title: 'Meta Mensal de Vendas',
                        description: 'Alcance sua meta de vendas do m√™s',
                        type: 'vendas',
                        target: gameData.metas[currentUnit]?.[currentUser.role] || 10,
                        current: calculateUserStats().matriculas,
                        reward: 500,
                        deadline: getEndOfMonth(),
                        status: 'active'
                    },
                    {
                        id: generateId(),
                        title: 'Conquistador de Leads',
                        description: 'Registre 30 visitas este m√™s',
                        type: 'visitas',
                        target: 30,
                        current: calculateUserStats().visitas,
                        reward: 300,
                        deadline: getEndOfMonth(),
                        status: 'active'
                    },
                    {
                        id: generateId(),
                        title: 'Mestre da Convers√£o',
                        description: 'Mantenha taxa de convers√£o acima de 25%',
                        type: 'conversao',
                        target: 0.25,
                        current: calculateUserStats().conversao,
                        reward: 400,
                        deadline: getEndOfMonth(),
                        status: 'active'
                    }
                ];
            }

            missionsDiv.innerHTML = gameData.missions.map(mission => {
                const progress = mission.type === 'conversao' ? 
                    (mission.current * 100) : 
                    (mission.current / mission.target) * 100;
                
                const isCompleted = mission.current >= mission.target;
                const cardClass = isCompleted ? 'mission-completed' : 'mission-card';

                return `
                    <div class="${cardClass}">
                        <div class="mission-header">
                            <div class="mission-title">${mission.title}</div>
                            <div class="mission-reward">${mission.reward} XP</div>
                        </div>
                        <p style="color: #666; margin-bottom: 15px;">${mission.description}</p>
                        <div class="mission-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(progress, 100)}%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 12px; margin-top: 5px;">
                                <span>${mission.type === 'conversao' ? 
                                    `${(mission.current * 100).toFixed(1)}%` : 
                                    `${mission.current} de ${mission.target}`}</span>
                                <span>Prazo: ${new Date(mission.deadline).toLocaleDateString()}</span>
                            </div>
                        </div>
                        ${isCompleted ? 
                            '<div style="text-align: center; margin-top: 15px; color: #38a169; font-weight: bold;">‚úÖ Miss√£o Completa!</div>' : 
                            '<div style="text-align: center; margin-top: 15px; color: #666; font-size: 12px;">Continue trabalhando para completar esta miss√£o</div>'
                        }
                    </div>
                `;
            }).join('');
        }

        function updateUserAchievements() {
            const achievementsDiv = document.getElementById('userAchievements');
            const allAchievements = [
                { id: 'first_sale', name: 'üéØ Primeira Venda', description: 'Fa√ßa sua primeira venda' },
                { id: 'super_seller', name: '‚≠ê Super Vendedor', description: 'Venda 10 matr√≠culas em um m√™s' },
                { id: 'team_leader', name: 'üëë L√≠der de Equipe', description: 'Lidere uma equipe de vendas' },
                { id: 'month_champion', name: 'üèÜ Campe√£o do M√™s', description: 'Seja o #1 do m√™s' },
                { id: 'conversion_master', name: 'üìà Mestre da Convers√£o', description: 'Mantenha 30%+ de convers√£o' }
            ];

            const userAchievements = currentUser.achievements || [];

            achievementsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    ${allAchievements.map(achievement => `
                        <div style="border: 2px solid ${userAchievements.includes(achievement.id) ? '#38a169' : '#e2e8f0'}; 
                                    border-radius: 12px; padding: 20px; text-align: center;
                                    background: ${userAchievements.includes(achievement.id) ? 'linear-gradient(135deg, #e6fffa, #f0fff4)' : '#f8f9fa'};">
                            <div style="font-size: 32px; margin-bottom: 10px;">${achievement.name.split(' ')[0]}</div>
                            <h4 style="color: ${userAchievements.includes(achievement.id) ? '#38a169' : '#666'};">
                                ${achievement.name.substring(2)}
                            </h4>
                            <p style="color: #666; font-size: 12px; margin: 10px 0;">${achievement.description}</p>
                            ${userAchievements.includes(achievement.id) ? 
                                '<div style="color: #38a169; font-weight: bold; font-size: 12px;">‚úÖ Conquistado!</div>' : 
                                '<div style="color: #999; font-size: 12px;">üîí Bloqueado</div>'
                            }
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Sistema de visitas
        function updateVisitasTab() {
            document.getElementById('visitsUnitName').textContent = currentUnit;
            document.getElementById('visitDate').value = new Date().toISOString().split('T')[0];
            populateVisitSelects();
            updateConversionMetrics();
            updateVisitsList();
        }

        function populateVisitSelects() {
            const attendantSelect = document.getElementById('visitAttendant');
            const attendantFilter = document.getElementById('visitAttendantFilter');
            
            const unitUsers = Object.values(gameData.users).filter(user => 
                user.unit === currentUnit && ['vendedor', 'gerente', 'assistente'].includes(user.role)
            );

            const options = unitUsers.map(user => 
                `<option value="${user.name}">${user.name} (${user.role})</option>`
            ).join('');

            attendantSelect.innerHTML = '<option value="">Selecione...</option>' + options;
            attendantFilter.innerHTML = '<option value="">Todos</option>' + options;
        }

        function addVisit() {
            const visitData = {
                id: generateId(),
                data: document.getElementById('visitDate').value,
                nome: document.getElementById('visitName').value,
                telefone: document.getElementById('visitPhone').value,
                curso: document.getElementById('visitCourse').value,
                atendente: document.getElementById('visitAttendant').value,
                observacoes: document.getElementById('visitNotes').value,
                unidade: currentUnit,
                status: 'pending',
                createdAt: new Date().toISOString(),
                createdBy: currentUser.name
            };

            if (!visitData.data || !visitData.nome || !visitData.telefone || !visitData.curso || !visitData.atendente) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'warning');
                return;
            }

            gameData.visitas.push(visitData);
            saveGameData();

            // Adicionar XP
            addXP(20, 'Visita registrada');
            
            showNotification('Visita registrada com sucesso! +20 XP', 'success');
            addActivity('visit_added', `${currentUser.name} registrou uma visita de ${visitData.nome}`);

            // Limpar formul√°rio
            document.getElementById('visitName').value = '';
            document.getElementById('visitPhone').value = '';
            document.getElementById('visitCourse').value = '';
            document.getElementById('visitAttendant').value = '';
            document.getElementById('visitNotes').value = '';

            updateVisitsList();
            updateConversionMetrics();
        }

        function updateConversionMetrics() {
            const metricsDiv = document.getElementById('conversionMetrics');
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const monthVisitas = gameData.visitas.filter(v => {
                const date = new Date(v.data);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });

            const monthMatriculas = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });

            const conversionRate = monthVisitas.length > 0 ? (monthMatriculas.length / monthVisitas.length) * 100 : 0;

            metricsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: #3182ce;">${monthVisitas.length}</div>
                        <div style="font-size: 14px; color: #666;">Visitas do M√™s</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: #38a169;">${monthMatriculas.length}</div>
                        <div style="font-size: 14px; color: #666;">Matr√≠culas do M√™s</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: #ed8936;">${conversionRate.toFixed(1)}%</div>
                        <div style="font-size: 14px; color: #666;">Taxa de Convers√£o</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: #667eea;">${monthVisitas.filter(v => v.status === 'pending').length}</div>
                        <div style="font-size: 14px; color: #666;">Visitas Pendentes</div>
                    </div>
                </div>
            `;
        }

        function updateVisitsList() {
            const visitsDiv = document.getElementById('recentVisits');
            let filteredVisits = [...gameData.visitas].reverse();

            // Aplicar filtros
            const periodFilter = document.getElementById('visitPeriodFilter')?.value || 'month';
            const attendantFilter = document.getElementById('visitAttendantFilter')?.value || '';
            const statusFilter = document.getElementById('visitStatusFilter')?.value || '';
            const searchBox = document.getElementById('visitSearchBox')?.value || '';

            // Filtro por per√≠odo
            const now = new Date();
            filteredVisits = filteredVisits.filter(visit => {
                const visitDate = new Date(visit.data);
                switch(periodFilter) {
                    case 'today':
                        return visitDate.toDateString() === now.toDateString();
                    case 'week':
                        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        return visitDate >= weekAgo;
                    case 'month':
                        return visitDate.getMonth() === now.getMonth() && visitDate.getFullYear() === now.getFullYear();
                    default:
                        return true;
                }
            });

            // Outros filtros
            if (attendantFilter) {
                filteredVisits = filteredVisits.filter(visit => visit.atendente === attendantFilter);
            }
            if (statusFilter) {
                filteredVisits = filteredVisits.filter(visit => visit.status === statusFilter);
            }
            if (searchBox) {
                filteredVisits = filteredVisits.filter(visit => 
                    visit.nome.toLowerCase().includes(searchBox.toLowerCase()) ||
                    visit.telefone.includes(searchBox)
                );
            }

            if (filteredVisits.length === 0) {
                visitsDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Nenhuma visita encontrada</p>';
                return;
            }

            visitsDiv.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üìÖ Data</th>
                            <th>üë§ Nome</th>
                            <th>üì± Telefone</th>
                            <th>üéì Curso</th>
                            <th>üë®‚Äçüíº Atendente</th>
                            <th>üìä Status</th>
                            <th>üîß A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredVisits.map(visit => `
                            <tr>
                                <td>${new Date(visit.data).toLocaleDateString()}</td>
                                <td>${visit.nome}</td>
                                <td>${visit.telefone}</td>
                                <td>${visit.curso}</td>
                                <td>${visit.atendente}</td>
                                <td>
                                    <span class="role-badge ${visit.status === 'converted' ? 'role-admin' : 'role-assistente'}">
                                        ${visit.status === 'converted' ? '‚úÖ Convertido' : '‚è≥ Pendente'}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        ${visit.status === 'pending' ? 
                                            `<button class="btn btn-success btn-sm" onclick="convertVisit('${visit.id}')">üéØ Converter</button>` :
                                            `<button class="btn btn-info btn-sm" onclick="viewVisitDetails('${visit.id}')">üëÅÔ∏è Ver</button>`
                                        }
                                        <button class="btn btn-danger btn-sm" onclick="deleteVisit('${visit.id}')">üóëÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function filterVisits() {
            updateVisitsList();
        }

        // Sistema de matr√≠culas
        function updateMatriculasTab() {
            document.getElementById('newData').value = new Date().toISOString().split('T')[0];
            populateMatriculaSelects();
            updateMatriculasList();
        }

        function populateMatriculaSelects() {
            const vendedorSelect = document.getElementById('newVendedor');
            const gerenteSelect = document.getElementById('newGerente');
            const assistenteSelect = document.getElementById('newAssistente');
            const filterVendedor = document.getElementById('matriculaVendedorFilter');

            const unitUsers = Object.values(gameData.users).filter(user => user.unit === currentUnit);
            
            const vendedores = unitUsers.filter(user => user.role === 'vendedor');
            const gerentes = unitUsers.filter(user => user.role === 'gerente');
            const assistentes = unitUsers.filter(user => user.role === 'assistente');

            vendedorSelect.innerHTML = '<option value="">Selecione...</option>' + 
                vendedores.map(user => `<option value="${user.name}">${user.name}</option>`).join('');
            
            gerenteSelect.innerHTML = '<option value="">Selecione...</option>' + 
                gerentes.map(user => `<option value="${user.name}">${user.name}</option>`).join('');
            
            assistenteSelect.innerHTML = '<option value="">Selecione...</option>' + 
                assistentes.map(user => `<option value="${user.name}">${user.name}</option>`).join('');

            filterVendedor.innerHTML = '<option value="">Todos</option>' + 
                vendedores.map(user => `<option value="${user.name}">${user.name}</option>`).join('');
        }

        function addMatricula() {
            const matriculaData = {
                id: generateId(),
                data: document.getElementById('newData').value,
                nome: document.getElementById('newNome').value,
                telefone: document.getElementById('newTelefone').value,
                curso: document.getElementById('newCurso').value,
                valorTotal: parseFloat(document.getElementById('newValorTotal').value),
                valorEntrada: parseFloat(document.getElementById('newValorEntrada').value),
                tipo: document.getElementById('newTipo').value,
                parcelas: parseInt(document.getElementById('newParcelas').value) || 1,
                vendedor: document.getElementById('newVendedor').value,
                gerente: document.getElementById('newGerente').value,
                assistente: document.getElementById('newAssistente').value,
                origem: document.getElementById('newFromVisit').value,
                origemCustom: document.getElementById('customOriginText').value,
                unidade: currentUnit,
                createdAt: new Date().toISOString(),
                createdBy: currentUser.name
            };

            // Valida√ß√µes
            if (!matriculaData.data || !matriculaData.nome || !matriculaData.curso || 
                !matriculaData.valorTotal || !matriculaData.valorEntrada ||
                !matriculaData.vendedor || !matriculaData.gerente || !matriculaData.assistente) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'warning');
                return;
            }

            if (matriculaData.valorEntrada > matriculaData.valorTotal) {
                showNotification('Valor de entrada n√£o pode ser maior que o valor total', 'error');
                return;
            }

            // Calcular comiss√µes
            const comissoes = calculateCommissions(matriculaData);
            matriculaData.comissaoVendedor = comissoes.vendedor;
            matriculaData.comissaoGerente = comissoes.gerente;
            matriculaData.comissaoAssistente = comissoes.assistente;

            gameData.matriculas.push(matriculaData);
            
            // Marcar visita como convertida se houver origem
            if (matriculaData.origem && matriculaData.origem !== 'custom') {
                const relatedVisit = gameData.visitas.find(v => 
                    v.nome.toLowerCase().includes(matriculaData.nome.toLowerCase()) ||
                    v.telefone === matriculaData.telefone
                );
                if (relatedVisit) {
                    relatedVisit.status = 'converted';
                    relatedVisit.convertedAt = new Date().toISOString();
                    relatedVisit.matriculaId = matriculaData.id;
                }
            }

            saveGameData();

            // Adicionar XP para todos os envolvidos
            const xpGain = 100;
            addXPToUser(matriculaData.vendedor, xpGain, 'Matr√≠cula realizada');
            addXPToUser(matriculaData.gerente, xpGain * 0.5, 'Supervis√£o de matr√≠cula');
            addXPToUser(matriculaData.assistente, xpGain * 0.3, 'Apoio em matr√≠cula');

            showNotification('Matr√≠cula adicionada com sucesso! +100 XP', 'success');
            addActivity('matricula_added', `${currentUser.name} adicionou matr√≠cula de ${matriculaData.nome}`);

            // Verificar conquistas
            checkAchievements();

            // Limpar formul√°rio
            clearMatriculaForm();
            updateMatriculasList();
            updateDashboard();
        }

        function calculateCommissions(matricula) {
            const baseCommission = matricula.valorEntrada * 0.1; // 10% base

            let multiplier = 1;
            switch(matricula.tipo) {
                case 'Blackin':
                    multiplier = 1.2;
                    break;
                case 'Black':
                    multiplier = 1.5;
                    break;
                default:
                    multiplier = 1;
            }

            const totalCommission = baseCommission * multiplier;

            return {
                vendedor: totalCommission * 0.6,  // 60% para vendedor
                gerente: totalCommission * 0.25,  // 25% para gerente
                assistente: totalCommission * 0.15 // 15% para assistente
            };
        }

        function clearMatriculaForm() {
            document.getElementById('newNome').value = '';
            document.getElementById('newTelefone').value = '';
            document.getElementById('newCurso').value = '';
            document.getElementById('newValorTotal').value = '';
            document.getElementById('newValorEntrada').value = '';
            document.getElementById('newTipo').value = '';
            document.getElementById('newParcelas').value = '';
            document.getElementById('newVendedor').value = '';
            document.getElementById('newGerente').value = '';
            document.getElementById('newAssistente').value = '';
            document.getElementById('newFromVisit').value = '';
            document.getElementById('customOriginText').value = '';
            document.getElementById('customOriginGroup').style.display = 'none';
        }

        function toggleCustomOrigin() {
            const select = document.getElementById('newFromVisit');
            const customGroup = document.getElementById('customOriginGroup');
            
            if (select.value === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
            }
        }

        function updateMatriculasList() {
            const listDiv = document.getElementById('matriculasList');
            let filteredMatriculas = [...gameData.matriculas].reverse();

            // Aplicar filtros
            const periodFilter = document.getElementById('matriculaPeriodFilter')?.value || 'month';
            const vendedorFilter = document.getElementById('matriculaVendedorFilter')?.value || '';
            const cursoFilter = document.getElementById('matriculaCursoFilter')?.value || '';
            const searchBox = document.getElementById('matriculaSearchBox')?.value || '';

            // Filtro por per√≠odo
            const now = new Date();
            filteredMatriculas = filteredMatriculas.filter(matricula => {
                const matriculaDate = new Date(matricula.data);
                switch(periodFilter) {
                    case 'today':
                        return matriculaDate.toDateString() === now.toDateString();
                    case 'week':
                        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        return matriculaDate >= weekAgo;
                    case 'month':
                        return matriculaDate.getMonth() === now.getMonth() && matriculaDate.getFullYear() === now.getFullYear();
                    default:
                        return true;
                }
            });

            // Outros filtros
            if (vendedorFilter) {
                filteredMatriculas = filteredMatriculas.filter(matricula => matricula.vendedor === vendedorFilter);
            }
            if (cursoFilter) {
                filteredMatriculas = filteredMatriculas.filter(matricula => matricula.curso === cursoFilter);
            }
            if (searchBox) {
                filteredMatriculas = filteredMatriculas.filter(matricula => 
                    matricula.nome.toLowerCase().includes(searchBox.toLowerCase())
                );
            }

            if (filteredMatriculas.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Nenhuma matr√≠cula encontrada</p>';
                return;
            }

            listDiv.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üìÖ Data</th>
                            <th>üë§ Aluno</th>
                            <th>üì± Telefone</th>
                            <th>üéì Curso</th>
                            <th>üí∞ Valor</th>
                            <th>üë®‚Äçüíº Vendedor</th>
                            <th>üìä Tipo</th>
                            <th>üîß A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredMatriculas.map(matricula => `
                            <tr>
                                <td>${new Date(matricula.data).toLocaleDateString()}</td>
                                <td>${matricula.nome}</td>
                                <td>${matricula.telefone}</td>
                                <td>${matricula.curso}</td>
                                <td>R$ ${matricula.valorTotal.toFixed(2)}</td>
                                <td>${matricula.vendedor}</td>
                                <td>
                                    <span class="role-badge ${matricula.tipo === 'Black' ? 'role-admin' : 
                                        matricula.tipo === 'Blackin' ? 'role-gerente' : 'role-vendedor'}">
                                        ${matricula.tipo}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-info btn-sm" onclick="viewMatriculaDetails('${matricula.id}')">üëÅÔ∏è Ver</button>
                                        <button class="btn btn-warning btn-sm" onclick="editMatricula('${matricula.id}')">‚úèÔ∏è Editar</button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteMatricula('${matricula.id}')">üóëÔ∏è Excluir</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function filterMatriculas() {
            updateMatriculasList();
        }

        // Sistema de XP e n√≠veis
        function addXP(amount, reason) {
            if (!currentUser) return;

            const oldLevel = currentUser.level || 1;
            currentUser.xp = (currentUser.xp || 0) + amount;
            currentUser.level = Math.floor(currentUser.xp / 1000) + 1;

            // Atualizar no gameData
            gameData.users[currentUser.username] = currentUser;
            
            if (currentUser.level > oldLevel) {
                showNotification(`üéâ Parab√©ns! Voc√™ subiu para o n√≠vel ${currentUser.level}!`, 'success');
                addActivity('level_up', `${currentUser.name} subiu para o n√≠vel ${currentUser.level}`);
            }

            saveGameData();
            updateUserInfo();

            console.log(`‚úÖ +${amount} XP adicionado por: ${reason}`);
        }

        function addXPToUser(userName, amount, reason) {
            const userEntry = Object.entries(gameData.users).find(([key, user]) => user.name === userName);
            if (!userEntry) return;

            const [userKey, user] = userEntry;
            const oldLevel = user.level || 1;
            user.xp = (user.xp || 0) + amount;
            user.level = Math.floor(user.xp / 1000) + 1;

            if (user.level > oldLevel) {
                addActivity('level_up', `${user.name} subiu para o n√≠vel ${user.level}`);
            }

            saveGameData();
        }

        // Sistema de conquistas
        function checkAchievements() {
            if (!currentUser.achievements) {
                currentUser.achievements = [];
            }

            const stats = calculateUserStats();

            // Primeira venda
            if (!currentUser.achievements.includes('first_sale') && stats.matriculas > 0) {
                currentUser.achievements.push('first_sale');
                showNotification('üéØ Conquista desbloqueada: Primeira Venda!', 'success');
                addXP(200, 'Conquista: Primeira Venda');
            }

            // Super vendedor
            if (!currentUser.achievements.includes('super_seller') && stats.matriculas >= 10) {
                currentUser.achievements.push('super_seller');
                showNotification('‚≠ê Conquista desbloqueada: Super Vendedor!', 'success');
                addXP(500, 'Conquista: Super Vendedor');
            }

            // Mestre da convers√£o
            if (!currentUser.achievements.includes('conversion_master') && stats.conversao >= 0.3) {
                currentUser.achievements.push('conversion_master');
                showNotification('üìà Conquista desbloqueada: Mestre da Convers√£o!', 'success');
                addXP(400, 'Conquista: Mestre da Convers√£o');
            }

            gameData.users[currentUser.username] = currentUser;
            saveGameData();
        }

        // Sistema de ranking
        function updateRanking() {
            const rankingBody = document.getElementById('rankingBody');
            const period = document.getElementById('rankingPeriod')?.value || 'month';
            const criteria = document.getElementById('rankingCriteria')?.value || 'matriculas';
            const unit = document.getElementById('rankingUnit')?.value || '';

            let users = Object.values(gameData.users);
            
            // Filtrar por unidade se especificado
            if (unit) {
                users = users.filter(user => user.unit === unit);
            }

            // Calcular estat√≠sticas para cada usu√°rio
            users = users.map(user => {
                const userStats = calculateUserStatsForUser(user, period);
                return {
                    ...user,
                    stats: userStats
                };
            });

            // Ordenar por crit√©rio
            users.sort((a, b) => {
                switch(criteria) {
                    case 'matriculas':
                        return b.stats.matriculas - a.stats.matriculas;
                    case 'conversao':
                        return b.stats.conversao - a.stats.conversao;
                    case 'visitas':
                        return b.stats.visitas - a.stats.visitas;
                    case 'xp':
                        return (b.xp || 0) - (a.xp || 0);
                    default:
                        return b.stats.matriculas - a.stats.matriculas;
                }
            });

            rankingBody.innerHTML = users.map((user, index) => {
                const position = index + 1;
                const rankClass = position === 1 ? 'rank-1' : 
                                 position === 2 ? 'rank-2' : 
                                 position === 3 ? 'rank-3' : 'rank-other';

                return `
                    <tr>
                        <td>
                            <div class="${rankClass}">${position}</div>
                        </td>
                        <td>${user.name}</td>
                        <td>${user.unit}</td>
                        <td>
                            <span class="role-badge role-${user.role}">${user.role}</span>
                        </td>
                        <td>${user.stats.visitas}</td>
                        <td>${user.stats.matriculas}</td>
                        <td>${(user.stats.conversao * 100).toFixed(1)}%</td>
                        <td>R$ ${user.stats.comissao.toFixed(2)}</td>
                        <td>
                            <span class="xp-badge">${user.xp || 0} XP</span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function calculateUserStatsForUser(user, period) {
            const now = new Date();
            let startDate;

            switch(period) {
                case 'quarter':
                    startDate = new Date(now.getFullYear(), Math.floor(now.getMonth() / 3) * 3, 1);
                    break;
                case 'year':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    break;
                case 'all':
                    startDate = new Date(2020, 0, 1);
                    break;
                default: // month
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
            }

            const matriculas = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                return date >= startDate && 
                       (m.vendedor === user.name || m.gerente === user.name || m.assistente === user.name);
            });

            const visitas = gameData.visitas.filter(v => {
                const date = new Date(v.data);
                return date >= startDate && v.atendente === user.name;
            });

            const comissao = matriculas.reduce((sum, m) => {
                let userCommission = 0;
                if (m.vendedor === user.name) userCommission += m.comissaoVendedor || 0;
                if (m.gerente === user.name) userCommission += m.comissaoGerente || 0;
                if (m.assistente === user.name) userCommission += m.comissaoAssistente || 0;
                return sum + userCommission;
            }, 0);

            const conversao = visitas.length > 0 ? matriculas.length / visitas.length : 0;

            return {
                matriculas: matriculas.length,
                visitas: visitas.length,
                conversao: conversao,
                comissao: comissao
            };
        }

        // Sistema de calend√°rio
        let currentCalendarDate = new Date();

        function updateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            calendarTitle.textContent = `${getMonthName(month)} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const days = [];
            const today = new Date();
            
            // Cabe√ßalho dos dias da semana
            const weekDays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            weekDays.forEach(day => {
                days.push(`<div style="font-weight: bold; padding: 10px; text-align: center; background: var(--bg-secondary);">${day}</div>`);
            });
            
            // Dias do calend√°rio
            for (let i = 0; i < 42; i++) {
                const currentDay = new Date(startDate);
                currentDay.setDate(startDate.getDate() + i);
                
                const isCurrentMonth = currentDay.getMonth() === month;
                const isToday = currentDay.toDateString() === today.toDateString();
                const hasEvents = gameData.events?.some(event => 
                    new Date(event.date).toDateString() === currentDay.toDateString()
                );
                
                const dayClass = `calendar-day ${isToday ? 'today' : ''} ${hasEvents ? 'has-events' : ''}`;
                const dayStyle = isCurrentMonth ? '' : 'opacity: 0.3;';
                
                days.push(`
                    <div class="${dayClass}" style="${dayStyle}" onclick="selectCalendarDay('${currentDay.toISOString()}')">
                        ${currentDay.getDate()}
                    </div>
                `);
            }
            
            calendarGrid.innerHTML = days.join('');
        }

        function changeMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            updateCalendar();
        }

        function selectCalendarDay(dateString) {
            const selectedDate = new Date(dateString);
            document.getElementById('selectedDate').textContent = selectedDate.toLocaleDateString();
            
            const dayEvents = gameData.events?.filter(event => 
                new Date(event.date).toDateString() === selectedDate.toDateString()
            ) || [];
            
            const eventsDiv = document.getElementById('dayEvents');
            
            if (dayEvents.length === 0) {
                eventsDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Nenhum evento neste dia</p>';
            } else {
                eventsDiv.innerHTML = dayEvents.map(event => `
                    <div style="border-left: 4px solid #38a169; padding: 15px; margin: 10px 0; background: var(--bg-primary); border-radius: 8px;">
                        <div style="font-weight: bold; margin-bottom: 5px;">${event.title}</div>
                        <div style="color: #666; font-size: 12px; margin-bottom: 5px;">
                            ${event.time} - ${event.type}
                        </div>
                        <div style="color: #666; font-size: 14px;">${event.description}</div>
                    </div>
                `).join('');
            }
        }

        function addEvent() {
            const eventData = {
                id: generateId(),
                title: document.getElementById('eventTitle').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                type: document.getElementById('eventType').value,
                description: document.getElementById('eventDescription').value,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };

            if (!eventData.title || !eventData.date) {
                showNotification('Preencha pelo menos o t√≠tulo e a data', 'warning');
                return;
            }

            if (!gameData.events) gameData.events = [];
            gameData.events.push(eventData);
            saveGameData();

            showNotification('Evento adicionado com sucesso!', 'success');
            addActivity('event_added', `${currentUser.name} adicionou evento: ${eventData.title}`);

            // Limpar formul√°rio
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';

            updateCalendar();
        }

        function getMonthName(month) {
            const months = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            return months[month];
        }

        // Sistema de atividades
        function addActivity(type, description) {
            if (!gameData.activities) gameData.activities = [];
            
            gameData.activities.unshift({
                id: generateId(),
                type: type,
                description: description,
                timestamp: new Date().toISOString(),
                user: currentUser?.name || 'Sistema'
            });

            // Manter apenas os √∫ltimos 100 registros
            if (gameData.activities.length > 100) {
                gameData.activities = gameData.activities.slice(0, 100);
            }

            saveGameData();
        }

        function updateActivityFeed() {
            const feedDiv = document.getElementById('activityFeed');
            const activities = gameData.activities?.slice(0, 10) || [];

            if (activities.length === 0) {
                feedDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Nenhuma atividade recente</p>';
                return;
            }

            feedDiv.innerHTML = activities.map(activity => {
                const timeAgo = getTimeAgo(activity.timestamp);
                const icon = getActivityIcon(activity.type);

                return `
                    <div class="activity-item">
                        <div class="activity-icon">${icon}</div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.description}</div>
                            <div class="activity-description">Por ${activity.user}</div>
                        </div>
                        <div class="activity-time">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }

        function getActivityIcon(type) {
            const icons = {
                'login': 'üîë',
                'logout': 'üö™',
                'matricula_added': 'üìö',
                'visit_added': 'üë•',
                'level_up': '‚¨ÜÔ∏è',
                'achievement': 'üèÜ',
                'event_added': 'üìÖ',
                'mission_completed': 'üéØ',
                'message_sent': 'üí¨'
            };
            return icons[type] || 'üìã';
        }

        function getTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffInMinutes = Math.floor((now - time) / (1000 * 60));

            if (diffInMinutes < 1) return 'Agora';
            if (diffInMinutes < 60) return `${diffInMinutes}min`;
            if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h`;
            return `${Math.floor(diffInMinutes / 1440)}d`;
        }

        // Sistema de notifica√ß√µes
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Adicionar √†s notifica√ß√µes do usu√°rio
            addUserNotification(message, type);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function addUserNotification(message, type) {
            if (!gameData.userNotifications) gameData.userNotifications = {};
            if (!gameData.userNotifications[currentUser.username]) gameData.userNotifications[currentUser.username] = [];
            
            gameData.userNotifications[currentUser.username].unshift({
                id: generateId(),
                message: message,
                type: type,
                timestamp: new Date().toISOString(),
                read: false
            });

            // Manter apenas as √∫ltimas 50 notifica√ß√µes
            if (gameData.userNotifications[currentUser.username].length > 50) {
                gameData.userNotifications[currentUser.username] = gameData.userNotifications[currentUser.username].slice(0, 50);
            }

            updateNotificationBadge();
            saveGameData();
        }

        function loadNotifications() {
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            const userNotifications = gameData.userNotifications?.[currentUser.username] || [];
            const unreadCount = userNotifications.filter(n => !n.read).length;
            
            badge.textContent = unreadCount;
            badge.style.display = unreadCount > 0 ? 'flex' : 'none';
        }

        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            const isVisible = panel.style.display === 'block';
            
            panel.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                updateNotificationPanel();
            }
        }

        function updateNotificationPanel() {
            const content = document.getElementById('notificationPanelContent');
            const userNotifications = gameData.userNotifications?.[currentUser.username] || [];
            
            if (userNotifications.length === 0) {
                content.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Nenhuma notifica√ß√£o</div>';
                return;
            }

            content.innerHTML = userNotifications.map(notification => {
                const timeAgo = getTimeAgo(notification.timestamp);
                
                return `
                    <div class="notification-item ${!notification.read ? 'unread' : ''}" onclick="markNotificationAsRead('${notification.id}')">
                        <div style="font-weight: ${!notification.read ? 'bold' : 'normal'}; margin-bottom: 5px;">
                            ${notification.message}
                        </div>
                        <div style="font-size: 11px; color: #666;">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }

        function markNotificationAsRead(notificationId) {
            const userNotifications = gameData.userNotifications?.[currentUser.username] || [];
            const notification = userNotifications.find(n => n.id === notificationId);
            
            if (notification) {
                notification.read = true;
                saveGameData();
                updateNotificationBadge();
                updateNotificationPanel();
            }
        }

        // Fun√ß√µes auxiliares
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function getEndOfMonth() {
            const now = new Date();
            return new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString().split('T')[0];
        }

        function updateCurrentDateTime() {
            setInterval(() => {
                const now = new Date();
                document.getElementById('syncText').textContent = `Atualizado ${now.toLocaleTimeString()}`;
            }, 60000);
        }

        function updateSyncStatus(status) {
            const syncIcon = document.getElementById('syncIcon');
            const syncText = document.getElementById('syncText');
            
            switch(status) {
                case 'success':
                    syncIcon.textContent = 'üü¢';
                    syncText.textContent = 'Sincronizado';
                    break;
                case 'error':
                    syncIcon.textContent = 'üî¥';
                    syncText.textContent = 'Erro de sincroniza√ß√£o';
                    break;
                case 'syncing':
                    syncIcon.textContent = 'üü°';
                    syncText.textContent = 'Sincronizando...';
                    break;
            }
        }

        function startAutoSync() {
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
            }
            
            const interval = parseInt(document.getElementById('autoSyncInterval')?.value) || 600000;
            if (interval > 0) {
                autoSyncInterval = setInterval(() => {
                    updateSyncStatus('syncing');
                    saveGameData();
                    setTimeout(() => updateSyncStatus('success'), 1000);
                }, interval);
            }
        }

        // Fun√ß√µes de debug e teste
        function showDebugButtons() {
            // Mostrar bot√µes de debug apenas em desenvolvimento
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                document.getElementById('debugButtons').style.display = 'block';
            }
        }

        function diagnosticoCompleto() {
            console.log('üîç DIAGN√ìSTICO COMPLETO DO SISTEMA');
            console.log('Estado atual dos dados:', gameData);
            console.log('Usu√°rio atual:', currentUser);
            console.log('Unidade atual:', currentUnit);
            console.log('Dados salvos no localStorage:', localStorage.getItem('gameCreatorsData'));
            
            showNotification('Diagn√≥stico executado - veja o console', 'info');
        }

        function criarUsuarioTeste() {
            const testUser = {
                username: 'teste@gamecreatorsadm.com',
                password: 'teste123',
                name: 'Usuario Teste',
                role: 'vendedor',
                unit: 'Shopping Conjunto Nacional',
                xp: 500,
                level: 1,
                achievements: [],
                id: generateId(),
                createdAt: new Date().toISOString(),
                stats: {
                    matriculas: 0,
                    visitas: 0,
                    conversao: 0,
                    comissao: 0
                }
            };

            gameData.users[testUser.username] = testUser;
            saveGameData();
            showNotification('Usu√°rio de teste criado: teste@gamecreatorsadm.com / teste123', 'success');
        }

        function repararSistema() {
            // Verificar e reparar estruturas de dados
            if (!gameData.users) gameData.users = {};
            if (!gameData.matriculas) gameData.matriculas = [];
            if (!gameData.visitas) gameData.visitas = [];
            if (!gameData.events) gameData.events = [];
            if (!gameData.missions) gameData.missions = [];
            if (!gameData.activities) gameData.activities = [];
            if (!gameData.chatMessages) gameData.chatMessages = { geral: [], vendas: [], suporte: [] };
            if (!gameData.metas) gameData.metas = {};

            // Reparar usu√°rios sem estat√≠sticas
            Object.values(gameData.users).forEach(user => {
                if (!user.stats) {
                    user.stats = {
                        matriculas: 0,
                        visitas: 0,
                        conversao: 0,
                        comissao: 0
                    };
                }
                if (!user.xp) user.xp = 0;
                if (!user.level) user.level = 1;
                if (!user.achievements) user.achievements = [];
            });

            saveGameData();
            showNotification('Sistema reparado com sucesso!', 'success');
        }

        function loginAutomatico(username) {
            document.getElementById('loginUsername').value = username;
            document.getElementById('loginPassword').value = username === 'admin@gamecreatorsadm.com' ? 'admin123' : 'vendedor123';
            login();
        }

        function resetTotal() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso apagar√° TODOS os dados do sistema. Tem certeza?')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Inicializa√ß√£o ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
        });

        // Event listeners adicionais
        function setupEventListeners() {
            // Enter para login
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });

            // Escape para fechar modais
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.getElementById('notificationPanel').style.display = 'none';
                }
            });
        }

        // Adicionar fun√ß√µes que estavam faltando
        function populateSelects() {
            // Implementar quando necess√°rio
        }

        function setupUnitFilter() {
            // Implementar filtro de unidade para admins
            if (currentUser?.role === 'admin') {
                document.getElementById('unitFilter').classList.remove('hidden');
                // Adicionar seletores de unidade
            }
        }

        function updateTeamTab() {
            // Implementar aba de equipe
        }

        function updateAdminTab() {
            // Implementar aba administrativa
        }

        function updateRelatoriosTab() {
            // Implementar aba de relat√≥rios
        }

        function updateChatTab() {
            // Implementar sistema de chat
        }

        function toggleTheme() {
            // Implementar tema escuro
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme);
            localStorage.setItem('theme', currentTheme);
        }

        function showForgotPassword() {
            showNotification('Entre em contato com o administrador para recuperar sua senha', 'info');
        }

        function quickAddMatricula() {
            document.getElementById('quickMatriculaModal').style.display = 'flex';
        }

        function closeQuickMatriculaModal() {
            document.getElementById('quickMatriculaModal').style.display = 'none';
        }

        function addQuickMatricula() {
            // Implementar adi√ß√£o r√°pida de matr√≠cula
            showNotification('Fun√ß√£o em desenvolvimento', 'info');
            closeQuickMatriculaModal();
        }

    </script>
</body>
</html>
