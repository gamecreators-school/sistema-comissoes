<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Comiss√µes - Game Creators Pro V2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            --warning-gradient: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            --danger-gradient: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            --info-gradient: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            --dark-gradient: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            
            --bg-primary: #f7fafc;
            --bg-secondary: #edf2f7;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --shadow-sm: 0 4px 15px rgba(0,0,0,0.1);
            --shadow-lg: 0 20px 60px rgba(0,0,0,0.3);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --text-primary: #f7fafc;
            --text-secondary: #cbd5e0;
            --border-color: #4a5568;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            padding: 10px;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-card h1 {
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 14px;
            font-weight: 500;
        }

        .forgot-password {
            margin-top: 15px;
            font-size: 12px;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
        }

        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin: 0 auto;
            max-width: 100%;
            display: none;
            backdrop-filter: blur(20px);
        }

        .page-header {
            background: var(--dark-gradient);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><radialGradient id="a" cx="50%" cy="0%" r="100%"><stop offset="0%" stop-color="rgba(255,255,255,0.1)"/><stop offset="100%" stop-color="rgba(255,255,255,0)"/></radialGradient></defs><rect width="100" height="20" fill="url(%23a)"/></svg>');
            pointer-events: none;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.25);
        }

        .notification-bell {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            position: relative;
            transition: var(--transition);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e53e3e;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--success-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .user-details h3 {
            font-size: 18px;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .user-level, .unit-badge, .sync-status {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 2px;
        }

        .unit-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 4px;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
        }

        .logout-btn {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }

        .nav-tabs {
            background: var(--bg-primary);
            padding: 0;
            display: flex;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
            overflow-x: auto;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 18px 24px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-size: 14px;
            white-space: nowrap;
            position: relative;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .tab-button:hover {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            color: #38a169;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            padding: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow-sm);
            border-left: 5px solid #38a169;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, rgba(56,161,105,0.08), rgba(104,211,145,0.08));
            border-radius: 50%;
            transform: translate(40px, -40px);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .stat-icon {
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .conversion-card {
            border-left-color: #ed8936;
        }

        .conversion-rate {
            font-size: 28px;
            font-weight: 800;
            color: #ed8936;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-gradient);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            transition: var(--transition);
            background: white;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-box {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 14px;
            width: 100%;
            max-width: 300px;
            transition: var(--transition);
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: var(--success-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(56, 161, 105, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(56, 161, 105, 0.4);
        }

        .btn-danger {
            background: var(--danger-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3);
        }

        .btn-warning {
            background: var(--warning-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(237, 137, 54, 0.3);
        }

        .btn-info {
            background: var(--info-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(49, 130, 206, 0.3);
        }

        .quick-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .notification {
            padding: 16px 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: 600;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 420px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.success {
            background: linear-gradient(135deg, rgba(199, 246, 213, 0.95), rgba(240, 253, 244, 0.95));
            color: #22543d;
            border-left: 4px solid #38a169;
        }

        .notification.error {
            background: linear-gradient(135deg, rgba(254, 215, 215, 0.95), rgba(255, 245, 245, 0.95));
            color: #742a2a;
            border-left: 4px solid #e53e3e;
        }

        .notification.warning {
            background: linear-gradient(135deg, rgba(254, 245, 231, 0.95), rgba(255, 251, 235, 0.95));
            color: #744210;
            border-left: 4px solid #ed8936;
        }

        .notification.info {
            background: linear-gradient(135deg, rgba(190, 227, 248, 0.95), rgba(235, 248, 255, 0.95));
            color: #2c5282;
            border-left: 4px solid #3182ce;
        }

        .hidden {
            display: none !important;
        }

        /* Filtro de unidade */
        .unit-filter {
            background: var(--bg-primary);
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .unit-selector {
            display: inline-block;
            margin: 0 10px;
            padding: 10px 20px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .unit-selector.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        /* Tabelas */
        .data-table {
            width: 100%;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin-top: 20px;
        }

        .data-table th {
            background: var(--dark-gradient);
            color: white;
            padding: 20px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .data-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .data-table tr:hover {
            background: var(--bg-primary);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Chart container */
        .chart-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            margin: 20px 0;
        }

        .chart-canvas {
            width: 100%;
            height: 300px;
            background: var(--bg-primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Calendar */
        .calendar-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            margin: 20px 0;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
        }

        .calendar-day {
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .calendar-day:hover {
            background: var(--bg-primary);
        }

        .calendar-day.today {
            background: var(--primary-gradient);
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-events {
            background: rgba(56, 161, 105, 0.1);
            border: 2px solid #38a169;
        }

        /* Activity feed */
        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px 0;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .activity-item:hover {
            background: var(--bg-primary);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .activity-description {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .activity-time {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        /* Modal para notifica√ß√µes */
        .notification-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-lg);
            z-index: 9998;
            display: none;
            overflow: hidden;
        }

        .notification-panel-header {
            background: var(--dark-gradient);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-panel-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-item:hover {
            background: var(--bg-primary);
        }

        .notification-item.unread {
            background: rgba(102, 126, 234, 0.05);
            border-left: 4px solid #667eea;
        }

        /* Ranking espec√≠fico */
        .rank-1 { 
            background: linear-gradient(135deg, #ffd700, #ffed4e); 
            color: #2d3748; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .rank-2 { 
            background: linear-gradient(135deg, #c0c0c0, #e2e8f0); 
            color: #2d3748; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .rank-3 { 
            background: linear-gradient(135deg, #cd7f32, #dd6b20); 
            color: white; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .rank-other { 
            background: linear-gradient(135deg, #4a5568, #2d3748); 
            color: white; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Badges para roles */
        .role-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .role-vendedor {
            background: rgba(56, 161, 105, 0.1);
            color: #38a169;
        }
        
        .role-gerente {
            background: rgba(237, 137, 54, 0.1);
            color: #ed8936;
        }
        
        .role-assistente {
            background: rgba(49, 130, 206, 0.1);
            color: #3182ce;
        }
        
        .role-admin {
            background: rgba(229, 62, 62, 0.1);
            color: #e53e3e;
        }

        /* Gamifica√ß√£o */
        .mission-card {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            border: 2px solid #38a169;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            transition: var(--transition);
        }

        .mission-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(56, 161, 105, 0.2);
        }

        .mission-completed {
            background: linear-gradient(135deg, #c6f6d5, #e6fffa);
            border-color: #2f855a;
        }

        .mission-failed {
            background: linear-gradient(135deg, #fed7d7, #fef5e7);
            border-color: #e53e3e;
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .mission-title {
            font-weight: bold;
            color: var(--text-primary);
            font-size: 16px;
        }

        .mission-reward {
            background: #38a169;
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
        }

        .mission-progress {
            margin: 12px 0;
        }

        .achievement-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
            margin: 4px;
            transition: var(--transition);
            cursor: pointer;
        }

        .achievement-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .xp-badge {
            background: var(--primary-gradient);
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Se√ß√µes especiais */
        .team-overview {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            border: 2px solid #38a169;
            border-radius: 15px;
            padding: 25px;
            margin: 25px;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .team-member-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            text-align: center;
            transition: var(--transition);
        }

        .team-member-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .member-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: white;
            margin: 0 auto 15px;
        }

        .member-name {
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 16px;
        }

        .member-role {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .member-stats {
            font-size: 12px;
            color: #38a169;
            font-weight: 600;
        }

        .visits-section {
            background: linear-gradient(135deg, #fef5e7, #fed7c2);
            border: 2px solid #ed8936;
            border-radius: 15px;
            padding: 25px;
            margin: 25px;
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            min-width: 300px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Bot√µes de a√ß√£o */
        .action-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            min-width: auto;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .close-modal {
            background: var(--danger-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
        }

        /* Export buttons */
        .export-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transition: var(--transition);
            z-index: 1000;
        }

        .floating-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 20px;
            }
            
            .nav-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .tab-button {
                min-width: 140px;
                padding: 16px 20px;
            }

            .user-info {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .page-header {
                padding: 20px;
                flex-direction: column;
                gap: 20px;
            }

            .stat-card {
                padding: 25px;
            }

            .notification {
                max-width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }

            .notification-panel {
                width: calc(100vw - 40px);
                right: 20px;
            }

            .team-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                flex-direction: column;
            }

            .action-buttons {
                flex-direction: column;
            }

            .floating-action-btn {
                bottom: 20px;
                right: 20px;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 30px 25px;
                margin: 20px;
            }

            .btn {
                padding: 12px 20px;
                font-size: 13px;
            }

            .quick-actions .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .print-area, .print-area * {
                visibility: visible;
            }
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .btn, .action-buttons, .floating-action-btn {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <h1>üéÆ Game Creators</h1>
            <p class="login-subtitle">Sistema Avan√ßado de Comiss√µes e Gamifica√ß√£o V2</p>
            <div class="form-group">
                <label>üë§ Usu√°rio:</label>
                <input type="text" id="loginUsername" placeholder="Digite seu usu√°rio" autocomplete="username">
            </div>
            <div class="form-group">
                <label>üîí Senha:</label>
                <input type="password" id="loginPassword" placeholder="Digite sua senha" autocomplete="current-password">
            </div>
            <button class="btn btn-primary" onclick="login()" style="width: 100%; margin-top: 25px;">
                üöÄ Entrar no Sistema
            </button>
            <div class="forgot-password" onclick="showForgotPassword()">
                Esqueceu sua senha?
            </div>
            <div id="loginError" class="notification error hidden" style="position: relative; margin-top: 20px;">
                Usu√°rio ou senha incorretos!
            </div>
        </div>
    </div>

    <!-- Sistema Principal -->
    <div id="mainSystem" class="main-container">
        <!-- Header com Info do Usu√°rio -->
        <div class="page-header">
            <div class="header-content">
                <h1 id="headerTitle">üéÆ Game Creators Pro V2</h1>
                <p style="font-size: 14px; opacity: 0.8; margin-top: 4px;">Sistema Avan√ßado de Gest√£o e Gamifica√ß√£o</p>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()">üåô Modo Escuro</button>
                <div class="notification-bell" onclick="toggleNotificationPanel()">
                    üîî Notifica√ß√µes
                    <span class="notification-badge" id="notificationBadge">3</span>
                </div>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">A</div>
                <div class="user-details">
                    <h3 id="userName">Usu√°rio</h3>
                    <div class="user-level" id="userLevel">N√≠vel 1 - Iniciante</div>
                    <div class="unit-badge" id="userUnit">Shopping Conjunto Nacional</div>
                    <div class="sync-status" id="syncStatus">
                        <span id="syncIcon">üü¢</span>
                        <span id="syncText">Online</span>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">üö™ Sair</button>
            </div>
        </div>

        <!-- Painel de Notifica√ß√µes -->
        <div id="notificationPanel" class="notification-panel">
            <div class="notification-panel-header">
                üîî Notifica√ß√µes
                <button style="background: none; border: none; color: white; cursor: pointer;" onclick="toggleNotificationPanel()">√ó</button>
            </div>
            <div class="notification-panel-content" id="notificationPanelContent">
                <!-- Preenchido dinamicamente -->
            </div>
        </div>

        <!-- Filtro de Unidade (apenas para admins) -->
        <div id="unitFilter" class="unit-filter hidden">
            <strong>üè¢ Filtrar por Unidade:</strong>
            <div id="unitSelectors" style="margin-top: 15px;">
                <!-- Preenchido dinamicamente -->
            </div>
        </div>

        <!-- Navega√ß√£o -->
        <div class="nav-tabs" id="navTabs">
            <!-- Preenchido dinamicamente -->
        </div>

        <!-- Dashboard Principal -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid" id="dashboardGrid">
                <!-- Preenchido dinamicamente -->
            </div>

            <!-- Gr√°ficos de Performance -->
            <div style="padding: 30px;">
                <div class="chart-container">
                    <h3>üìà Performance Mensal</h3>
                    <div class="chart-canvas" id="performanceChart">
                        Gr√°fico de performance ser√° exibido aqui
                    </div>
                </div>

                <div class="chart-container">
                    <h3>üìä Convers√£o por Per√≠odo</h3>
                    <div class="chart-canvas" id="conversionChart">
                        Gr√°fico de convers√£o ser√° exibido aqui
                    </div>
                </div>
            </div>

            <!-- Atividades Recentes -->
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üìã Atividades Recentes</h3>
                    <div class="activity-feed" id="activityFeed">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Calend√°rio -->
        <div id="calendario" class="tab-content">
            <div style="padding: 30px;">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="changeMonth(-1)">‚óÄ Anterior</button>
                        <h3 id="calendarTitle">Janeiro 2024</h3>
                        <button class="calendar-nav" onclick="changeMonth(1)">Pr√≥ximo ‚ñ∂</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Eventos do Dia -->
                <div class="stat-card">
                    <h3>üìÖ Eventos de <span id="selectedDate">Hoje</span></h3>
                    <div id="dayEvents">
                        <p style="text-align: center; color: #666; padding: 20px;">Selecione um dia no calend√°rio para ver os eventos</p>
                    </div>
                </div>

                <!-- Adicionar Evento -->
                <div class="stat-card">
                    <h3>‚ûï Adicionar Evento/Lembrete</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>T√≠tulo:</label>
                            <input type="text" id="eventTitle" placeholder="Ex: Reuni√£o de equipe">
                        </div>
                        <div class="form-group">
                            <label>Data:</label>
                            <input type="date" id="eventDate">
                        </div>
                        <div class="form-group">
                            <label>Hora:</label>
                            <input type="time" id="eventTime">
                        </div>
                        <div class="form-group">
                            <label>Tipo:</label>
                            <select id="eventType">
                                <option value="reuniao">üìã Reuni√£o</option>
                                <option value="meta">üéØ Meta</option>
                                <option value="lembrete">üîî Lembrete</option>
                                <option value="evento">üéâ Evento</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o:</label>
                        <textarea id="eventDescription" rows="3" placeholder="Detalhes do evento..."></textarea>
                    </div>
                    <button class="btn btn-success" onclick="addEvent()">üìÖ Adicionar Evento</button>
                </div>
            </div>
        </div>

        <!-- Gamifica√ß√£o -->
        <div id="gamificacao" class="tab-content">
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üéÆ Meu Progresso Gamer</h3>
                    <div id="userProgress">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üéØ Miss√µes Ativas</h3>
                    <div id="activeMissions">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üèÜ Hall da Fama</h3>
                    <div id="userAchievements">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Loja de Recompensas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üõí Loja de Recompensas</h3>
                    <div id="rewardsStore">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div style="border: 2px solid #38a169; border-radius: 12px; padding: 20px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üéÅ</div>
                                <h4>Vale Presente R$ 50</h4>
                                <p style="color: #666; font-size: 12px; margin: 10px 0;">Troque por vale presente</p>
                                <div style="font-weight: bold; color: #38a169; margin-bottom: 15px;">1000 XP</div>
                                <button class="btn btn-success btn-sm" onclick="redeemReward('gift50', 1000)">üõí Resgatar</button>
                            </div>
                            <div style="border: 2px solid #ed8936; border-radius: 12px; padding: 20px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üèñÔ∏è</div>
                                <h4>Dia de Folga Extra</h4>
                                <p style="color: #666; font-size: 12px; margin: 10px 0;">Um dia de descanso merecido</p>
                                <div style="font-weight: bold; color: #ed8936; margin-bottom: 15px;">2000 XP</div>
                                <button class="btn btn-warning btn-sm" onclick="redeemReward('dayoff', 2000)">üõí Resgatar</button>
                            </div>
                            <div style="border: 2px solid #667eea; border-radius: 12px; padding: 20px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üéñÔ∏è</div>
                                <h4>Certificado Destaque</h4>
                                <p style="color: #666; font-size: 12px; margin: 10px 0;">Reconhecimento oficial</p>
                                <div style="font-weight: bold; color: #667eea; margin-bottom: 15px;">1500 XP</div>
                                <button class="btn btn-primary btn-sm" onclick="redeemReward('certificate', 1500)">üõí Resgatar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Criar Miss√£o (Admin/Gerente) -->
                <div id="createMissionSection" class="stat-card hidden" style="margin-top: 25px;">
                    <h3>‚ûï Criar Nova Miss√£o</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>T√≠tulo da Miss√£o:</label>
                            <input type="text" id="missionTitle" placeholder="Ex: Vender 5 matr√≠culas esta semana">
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o:</label>
                            <textarea id="missionDescription" rows="3" placeholder="Descri√ß√£o detalhada da miss√£o..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Tipo:</label>
                            <select id="missionType">
                                <option value="vendas">üìä Meta de Vendas</option>
                                <option value="visitas">üë• Meta de Visitas</option>
                                <option value="conversao">üìà Meta de Convers√£o</option>
                                <option value="especial">‚≠ê Miss√£o Especial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Meta (n√∫mero):</label>
                            <input type="number" id="missionTarget" min="1" placeholder="Ex: 5">
                        </div>
                        <div class="form-group">
                            <label>Recompensa (XP):</label>
                            <input type="number" id="missionReward" min="10" placeholder="Ex: 100">
                        </div>
                        <div class="form-group">
                            <label>Prazo:</label>
                            <input type="date" id="missionDeadline">
                        </div>
                        <div class="form-group">
                            <label>Para quem:</label>
                            <select id="missionTarget_user">
                                <option value="all">Todos da unidade</option>
                                <option value="vendedores">Apenas vendedores</option>
                                <option value="assistentes">Apenas assistentes</option>
                                <option value="specific">Pessoa espec√≠fica</option>
                            </select>
                        </div>
                        <div class="form-group" id="specificUserGroup" style="display: none;">
                            <label>Usu√°rio espec√≠fico:</label>
                            <select id="missionSpecificUser">
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="createMission()" style="margin-top: 15px;">üéØ Criar Miss√£o</button>
                </div>
            </div>
        </div>

        <!-- Visitas e Convers√£o -->
        <div id="visitas" class="tab-content">
            <div class="visits-section">
                <h3>üë• Central de Visitas - <span id="visitsUnitName">Shopping Conjunto Nacional</span></h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="form-group">
                        <label>üìÖ Data da Visita:</label>
                        <input type="date" id="visitDate" required>
                    </div>
                    <div class="form-group">
                        <label>üë§ Nome do Visitante:</label>
                        <input type="text" id="visitName" placeholder="Nome completo" required>
                    </div>
                    <div class="form-group">
                        <label>üì± Telefone:</label>
                        <input type="tel" id="visitPhone" placeholder="(11) 99999-9999" required>
                    </div>
                    <div class="form-group">
                        <label>üéì Curso de Interesse:</label>
                        <select id="visitCourse" required>
                            <option value="">Selecione...</option>
                            <option value="Creators 2D">Creators 2D</option>
                            <option value="Creators 3D">Creators 3D</option>
                            <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                            <option value="Creators Dev">Creators Dev</option>
                            <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üë®‚Äçüíº Atendido por:</label>
                        <select id="visitAttendant" required>
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üìù Observa√ß√µes:</label>
                        <input type="text" id="visitNotes" placeholder="Ex: Muito interessado, vai decidir em 3 dias...">
                    </div>
                </div>
                
                <div class="quick-actions">
                    <button class="btn btn-success" onclick="addVisit()">‚ú® Registrar Visita</button>
                    <button class="btn btn-warning" onclick="convertVisitToMatricula()">üéØ Converter em Matr√≠cula</button>
                </div>
            </div>
            
            <div style="padding: 30px;">
                <!-- Filtros de Visitas -->
                <div class="stat-card">
                    <h3>üîç Filtros de Visitas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>üóìÔ∏è Per√≠odo:</label>
                            <select id="visitPeriodFilter" onchange="filterVisits()">
                                <option value="today">Hoje</option>
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este M√™s</option>
                                <option value="all">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üë§ Atendente:</label>
                            <select id="visitAttendantFilter" onchange="filterVisits()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìä Status:</label>
                            <select id="visitStatusFilter" onchange="filterVisits()">
                                <option value="">Todos</option>
                                <option value="pending">Pendentes</option>
                                <option value="converted">Convertidos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üîç Buscar:</label>
                            <input type="text" class="search-box" id="visitSearchBox" placeholder="Nome ou telefone..." onkeyup="filterVisits()">
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <h3>üìä Dashboard de Convers√£o - <span id="conversionMonthYear">Dezembro 2024</span></h3>
                    <div id="conversionMetrics">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
                
                <div class="stat-card" style="margin-top: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>üìã Hist√≥rico de Visitas</h3>
                        <div class="export-buttons">
                            <button class="btn btn-info btn-sm" onclick="exportVisits('csv')">üìÑ CSV</button>
                            <button class="btn btn-warning btn-sm" onclick="exportVisits('excel')">üìä Excel</button>
                        </div>
                    </div>
                    <div id="recentVisits" style="max-height: 450px; overflow-y: auto;">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Equipe (apenas para gerentes) -->
        <div id="equipe" class="tab-content">
            <div class="team-overview">
                <h3>üë• Minha Equipe - <span id="teamUnitName">Shopping Conjunto Nacional</span></h3>
                <div class="team-grid" id="teamGrid">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>
            
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üìä Performance da Equipe - <span id="teamMonthYear">Dezembro 2024</span></h3>
                    <div id="teamPerformance">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Comunica√ß√£o da Equipe -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üí¨ Comunica√ß√£o da Equipe</h3>
                    <div class="form-group">
                        <label>üì¢ Enviar Mensagem para a Equipe:</label>
                        <textarea id="teamMessage" rows="3" placeholder="Digite sua mensagem para toda a equipe..."></textarea>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="sendTeamMessage()">üì§ Enviar Mensagem</button>
                        <button class="btn btn-success" onclick="scheduleTeamMeeting()">üìÖ Agendar Reuni√£o</button>
                    </div>
                </div>

                <!-- Metas Individuais -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üéØ Definir Metas Individuais</h3>
                    <div id="individualGoals">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Ranking -->
        <div id="ranking" class="tab-content">
            <div style="padding: 30px;">
                <!-- Filtros do Ranking -->
                <div class="stat-card">
                    <h3>üîç Filtros do Ranking</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>üìÖ Per√≠odo:</label>
                            <select id="rankingPeriod" onchange="updateRanking()">
                                <option value="month" selected>Este M√™s</option>
                                <option value="quarter">Trimestre</option>
                                <option value="year">Este Ano</option>
                                <option value="all">Todos os Tempos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìä Crit√©rio:</label>
                            <select id="rankingCriteria" onchange="updateRanking()">
                                <option value="matriculas" selected>Matr√≠culas</option>
                                <option value="conversao">Taxa de Convers√£o</option>
                                <option value="visitas">Visitas</option>
                                <option value="xp">Experi√™ncia (XP)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üè¢ Unidade:</label>
                            <select id="rankingUnit" onchange="updateRanking()">
                                <option value="">Todas</option>
                            </select>
                        </div>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üèÜ Ranking</th>
                            <th>üë§ Nome</th>
                            <th>üè¢ Unidade</th>
                            <th>üíº Cargo</th>
                            <th>üë• Visitas</th>
                            <th>üìä Matr√≠culas</th>
                            <th>üìà Convers√£o</th>
                            <th>üí∞ Comiss√£o</th>
                            <th>‚≠ê Experi√™ncia</th>
                        </tr>
                    </thead>
                    <tbody id="rankingBody">
                        <!-- Preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Painel Admin -->
        <div id="admin" class="tab-content">
            <div style="padding: 30px;">
                <h2>üë®‚Äçüíº Painel Administrativo</h2>
                
                <!-- Analytics Avan√ßado -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>üìà Analytics Avan√ßado</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                            <div style="font-size: 28px; font-weight: bold; color: #38a169;" id="totalRevenue">R$ 0</div>
                            <div style="font-size: 14px; color: #666;">Faturamento Total</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                            <div style="font-size: 28px; font-weight: bold; color: #667eea;" id="avgTicket">R$ 0</div>
                            <div style="font-size: 14px; color: #666;">Ticket M√©dio</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                            <div style="font-size: 28px; font-weight: bold; color: #ed8936;" id="growthRate">0%</div>
                            <div style="font-size: 14px; color: #666;">Crescimento Mensal</div>
                        </div>
                    </div>
                </div>

                <!-- Backup e Restore -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>üíæ Backup e Restore</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="createBackup()">üì¶ Criar Backup</button>
                        <button class="btn btn-warning" onclick="downloadBackup()">‚¨áÔ∏è Download Backup</button>
                        <input type="file" id="backupFile" accept=".json" style="display: none;" onchange="restoreBackup()">
                        <button class="btn btn-info" onclick="document.getElementById('backupFile').click()">‚¨ÜÔ∏è Restaurar Backup</button>
                        <button class="btn btn-danger" onclick="resetSystem()">üóëÔ∏è Reset Sistema</button>
                    </div>
                    <div id="backupStatus" style="margin-top: 15px; font-size: 12px; color: #666;"></div>
                </div>

                <!-- Configura√ß√µes do Sistema -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>‚öôÔ∏è Configura√ß√µes do Sistema</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div class="form-group">
                            <label>üîÑ Sincroniza√ß√£o Autom√°tica:</label>
                            <select id="autoSyncInterval">
                                <option value="0">Desabilitada</option>
                                <option value="300000">5 minutos</option>
                                <option value="600000" selected>10 minutos</option>
                                <option value="1800000">30 minutos</option>
                                <option value="3600000">1 hora</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìß Email Administrativo:</label>
                            <input type="email" id="adminEmail" placeholder="admin@gamecreatorsadm.com">
                        </div>
                        <div class="form-group">
                            <label>üåê URL da Empresa:</label>
                            <input type="url" id="companyUrl" placeholder="https://gamecreatorsadm.com">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="saveSystemConfig()">üíæ Salvar Configura√ß√µes</button>
                </div>

                <!-- Auditoria do Sistema -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>üîç Log de Auditoria</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <select id="auditFilter">
                            <option value="all">Todas as Atividades</option>
                            <option value="login">Logins</option>
                            <option value="matricula">Matr√≠culas</option>
                            <option value="visita">Visitas</option>
                            <option value="config">Configura√ß√µes</option>
                        </select>
                        <button class="btn btn-primary btn-sm" onclick="filterAuditLog()">üîç Filtrar</button>
                        <button class="btn btn-warning btn-sm" onclick="exportAuditLog()">üìÑ Exportar</button>
                    </div>
                    <div id="auditLog" style="max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; background: var(--bg-primary); padding: 15px; border-radius: 8px;">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Gerenciar Unidades -->
                <div class="stat-card" style="max-width: 600px; margin: 20px 0;">
                    <h3>üè¢ Gerenciar Unidades</h3>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: end;">
                        <div class="form-group">
                            <label>Nome da Nova Unidade:</label>
                            <input type="text" id="newUnitName" placeholder="Ex: Shopping Iguatemi">
                        </div>
                        <button class="btn btn-success" onclick="addNewUnit()">‚ûï Adicionar Unidade</button>
                    </div>
                    <div id="currentUnits" style="margin-top: 15px;">
                        <h4>Unidades Ativas:</h4>
                        <div id="unitsList">
                            <!-- Preenchido dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√£o de Metas -->
                <div class="stat-card" style="max-width: 800px; margin: 20px 0;">
                    <h3>üéØ Configura√ß√£o de Metas Mensais</h3>
                    <div id="metasConfig">
                        <!-- Preenchido dinamicamente baseado nas unidades existentes -->
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="salvarMetas()">üíæ Salvar Metas</button>
                        <button class="btn btn-primary" onclick="carregarMetas()">üîÑ Recarregar Metas</button>
                    </div>
                    <div id="metasStatus" style="margin-top: 10px;"></div>
                </div>

                <!-- Adicionar Usu√°rio -->
                <div class="stat-card" style="max-width: 500px; margin: 20px 0;">
                    <h3>‚ûï Adicionar Novo Usu√°rio</h3>
                    <div class="form-group">
                        <label>Nome:</label>
                        <input type="text" id="newUserName" placeholder="Nome completo">
                    </div>
                    <div class="form-group">
                        <label>Usu√°rio:</label>
                        <input type="text" id="newUserUsername" placeholder="nome.usuario@gamecreatorsadm.com">
                    </div>
                    <div class="form-group">
                        <label>Senha:</label>
                        <input type="password" id="newUserPassword" placeholder="senha123">
                    </div>
                    <div class="form-group">
                        <label>Tipo:</label>
                        <select id="newUserRole">
                            <option value="vendedor">üë®‚Äçüíº Vendedor</option>
                            <option value="gerente">üëî Gerente</option>
                            <option value="assistente">üë©‚Äçüíª Assistente</option>
                            <option value="admin">üîß Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Unidade:</label>
                        <select id="newUserUnit">
                            <!-- Preenchido dinamicamente -->
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="addUser()">‚ûï Adicionar Usu√°rio</button>
                </div>

                <!-- Configura√ß√µes do Google Sheets -->
                <div class="stat-card" style="max-width: 800px; margin: 20px 0;">
                    <h3>‚òÅÔ∏è Configura√ß√£o Google Sheets</h3>
                    <div class="form-group">
                        <label>URL do Google Apps Script:</label>
                        <input type="url" id="googleScriptUrl" placeholder="https://script.google.com/macros/s/SEU_SCRIPT_ID_AQUI/exec" value="">
                    </div>
                    
                    <div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin: 15px 0; font-size: 12px; border-left: 4px solid #38a169;">
                        <strong>üìã INSTRU√á√ïES PASSO A PASSO:</strong><br><br>
                        
                        <strong>1Ô∏è‚É£ Criar Nova Planilha:</strong><br>
                        ‚Ä¢ Acesse <a href="https://sheets.google.com" target="_blank">Google Sheets</a><br>
                        ‚Ä¢ Crie uma nova planilha em branco<br>
                        ‚Ä¢ Renomeie para "Game Creators Database"<br>
                        ‚Ä¢ Copie o ID da URL (entre /d/ e /edit)<br><br>
                        
                        <strong>2Ô∏è‚É£ Criar Google Apps Script:</strong><br>
                        ‚Ä¢ Acesse <a href="https://script.google.com" target="_blank">Google Apps Script</a><br>
                        ‚Ä¢ Clique em "Novo projeto"<br>
                        ‚Ä¢ Apague o c√≥digo padr√£o<br>
                        ‚Ä¢ Cole o c√≥digo fornecido no bot√£o "Ver C√≥digo"<br><br>
                        
                        <strong>3Ô∏è‚É£ Configurar ID da Planilha:</strong><br>
                        ‚Ä¢ No c√≥digo, encontre a linha: const SPREADSHEET_ID = 'SUA_PLANILHA_ID_AQUI';<br>
                        ‚Ä¢ Substitua SUA_PLANILHA_ID_AQUI pelo ID copiado da planilha<br>
                        ‚Ä¢ Salve o projeto (Ctrl+S)<br><br>
                        
                        <strong>4Ô∏è‚É£ Publicar como Aplicativo Web:</strong><br>
                        ‚Ä¢ Clique em "Implantar" ‚Üí "Nova implanta√ß√£o"<br>
                        ‚Ä¢ Tipo: "Aplicativo da Web"<br>
                        ‚Ä¢ Executar como: "Eu (seu email)"<br>
                        ‚Ä¢ Quem tem acesso: "Qualquer pessoa"<br>
                        ‚Ä¢ Clique em "Implantar"<br><br>
                        
                        <strong>5Ô∏è‚É£ Copiar URL e Testar:</strong><br>
                        ‚Ä¢ Copie a "URL do aplicativo da Web"<br>
                        ‚Ä¢ Cole no campo acima<br>
                        ‚Ä¢ Clique em "Salvar Configura√ß√£o"<br>
                        ‚Ä¢ Clique em "Testar Conex√£o"<br>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="testGoogleSheetsConnection()">üîç Testar Conex√£o</button>
                        <button class="btn btn-success" onclick="saveGoogleSheetsConfig()">üíæ Salvar Configura√ß√£o</button>
                        <button class="btn btn-warning" onclick="forceSync()">üîÑ Sincronizar Agora</button>
                        <button class="btn btn-info" onclick="showGoogleScriptCode()">üìù Ver C√≥digo Google Script</button>
                        <button class="btn btn-danger" onclick="showTroubleshooting()">üîß Solu√ß√£o de Problemas</button>
                    </div>
                    <div id="syncResult" style="margin-top: 10px;"></div>
                </div>

                <!-- Lista de Usu√°rios -->
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üë§ Nome</th>
                            <th>üîë Usu√°rio</th>
                            <th>üè¢ Unidade</th>
                            <th>üíº Tipo</th>
                            <th>üìä Matr√≠culas</th>
                            <th>üë• Visitas</th>
                            <th>‚≠ê XP</th>
                            <th>üîß A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="userManagementBody">
                        <!-- Preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Matr√≠culas -->
        <div id="matriculas" class="tab-content">
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>‚ûï Adicionar Nova Matr√≠cula</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Data:</label>
                            <input type="date" id="newData" required>
                        </div>
                        <div class="form-group">
                            <label>Nome do Aluno:</label>
                            <input type="text" id="newNome" placeholder="Nome completo" required>
                        </div>
                        <div class="form-group">
                            <label>Telefone:</label>
                            <input type="tel" id="newTelefone" placeholder="(11) 99999-9999">
                        </div>
                        <div class="form-group">
                            <label>Curso:</label>
                            <select id="newCurso" required>
                                <option value="">Selecione...</option>
                                <option value="Creators 2D">Creators 2D</option>
                                <option value="Creators 3D">Creators 3D</option>
                                <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                                <option value="Creators Dev">Creators Dev</option>
                                <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Valor Total do Curso (R$):</label>
                            <input type="number" id="newValorTotal" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Valor de Entrada (R$):</label>
                            <input type="number" id="newValorEntrada" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Tipo de Venda:</label>
                            <select id="newTipo" required>
                                <option value="Convencional">Convencional (√Ä vista ou parcelado normal)</option>
                                <option value="Blackin">Blackin (6x no cart√£o)</option>
                                <option value="Black">Black (10x+ no cart√£o)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Parcelas (se aplic√°vel):</label>
                            <input type="number" id="newParcelas" min="1" max="24" placeholder="Ex: 6, 10, 12...">
                        </div>
                        <div class="form-group">
                            <label>Vendedor:</label>
                            <select id="newVendedor" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Gerente:</label>
                            <select id="newGerente" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Assistente:</label>
                            <select id="newAssistente" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Origem do Cliente:</label>
                            <select id="newFromVisit" onchange="toggleCustomOrigin()">
                                <option value="">Cliente Direto</option>
                                <option value="porta">Cliente Porta</option>
                                <option value="street">Street Marketing</option>
                                <option value="agendamento">Agendamento</option>
                                <option value="evento">Evento</option>
                                <option value="custom">Outra (especificar)</option>
                            </select>
                        </div>
                        <div class="form-group" id="customOriginGroup" style="display: none;">
                            <label>Especificar Origem:</label>
                            <input type="text" id="customOriginText" placeholder="Digite a origem personalizada">
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="addMatricula()" style="margin-top: 15px;">‚ûï Adicionar Matr√≠cula</button>
                </div>

                <!-- Filtros de Matr√≠culas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üîç Filtros de Matr√≠culas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>üìÖ Per√≠odo:</label>
                            <select id="matriculaPeriodFilter" onchange="filterMatriculas()">
                                <option value="today">Hoje</option>
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este M√™s</option>
                                <option value="all">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üë§ Vendedor:</label>
                            <select id="matriculaVendedorFilter" onchange="filterMatriculas()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üéì Curso:</label>
                            <select id="matriculaCursoFilter" onchange="filterMatriculas()">
                                <option value="">Todos</option>
                                <option value="Creators 2D">Creators 2D</option>
                                <option value="Creators 3D">Creators 3D</option>
                                <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                                <option value="Creators Dev">Creators Dev</option>
                                <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üîç Buscar:</label>
                            <input type="text" class="search-box" id="matriculaSearchBox" placeholder="Nome do aluno..." onkeyup="filterMatriculas()">
                        </div>
                    </div>
                </div>

                <!-- Lista de Matr√≠culas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>üìä Matr√≠culas Recentes</h3>
                        <div class="export-buttons">
                            <button class="btn btn-info btn-sm" onclick="exportMatriculas('csv')">üìÑ CSV</button>
                            <button class="btn btn-warning btn-sm" onclick="exportMatriculas('excel')">üìä Excel</button>
                        </div>
                    </div>
                    <div id="matriculasList" style="max-height: 400px; overflow-y: auto;">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Relat√≥rios -->
        <div id="relatorios" class="tab-content">
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üìä Relat√≥rios de Performance</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>M√™s/Ano:</label>
                            <input type="month" id="relatorioMes">
                        </div>
                        <div class="form-group">
                            <label>Unidade:</label>
                            <select id="relatorioUnidade">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Colaborador:</label>
                            <select id="relatorioColaborador">
                                <option value="">Todos</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="gerarRelatorioComissoes()">üí∞ Relat√≥rio Comiss√µes</button>
                        <button class="btn btn-success" onclick="gerarRelatorioConversao()">üìà Relat√≥rio Convers√£o</button>
                        <button class="btn btn-warning" onclick="gerarRelatorioUnidade()">üè¢ Relat√≥rio por Unidade</button>
                        <button class="btn btn-info" onclick="gerarRelatorioMetas()">üéØ Relat√≥rio Metas vs Realizado</button>
                        <button class="btn btn-primary" onclick="gerarRelatorioTendencias()">üìà An√°lise de Tend√™ncias</button>
                        <button class="btn btn-success" onclick="gerarRelatorioPrevisao()">üîÆ Previs√£o de Vendas</button>
                    </div>
                </div>

                <div id="relatorioResultado" class="print-area">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>
        </div>

        <!-- Chat/Mensagens -->
        <div id="chat" class="tab-content">
            <div style="padding: 30px;">
                <!-- Salas de Chat -->
                <div class="stat-card">
                    <h3>üí¨ Salas de Conversa</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div style="border: 2px solid #38a169; border-radius: 12px; padding: 20px; cursor: pointer;" onclick="openChatRoom('geral')">
                            <h4>üåê Chat Geral</h4>
                            <p style="color: #666; font-size: 12px;">Conversa aberta para todos</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="font-size: 12px; color: #38a169;">Online: 5</span>
                                <span style="font-size: 12px; color: #666;">3 mensagens n√£o lidas</span>
                            </div>
                        </div>
                        <div style="border: 2px solid #ed8936; border-radius: 12px; padding: 20px; cursor: pointer;" onclick="openChatRoom('vendas')">
                            <h4>üìä Chat Vendas</h4>
                            <p style="color: #666; font-size: 12px;">Para discuss√µes sobre vendas</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="font-size: 12px; color: #ed8936;">Online: 3</span>
                                <span style="font-size: 12px; color: #666;">1 mensagem n√£o lida</span>
                            </div>
                        </div>
                        <div style="border: 2px solid #667eea; border-radius: 12px; padding: 20px; cursor: pointer;" onclick="openChatRoom('suporte')">
                            <h4>üÜò Chat Suporte</h4>
                            <p style="color: #666; font-size: 12px;">Ajuda e suporte t√©cnico</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="font-size: 12px; color: #667eea;">Online: 2</span>
                                <span style="font-size: 12px; color: #666;">0 mensagens n√£o lidas</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- √Årea de Chat -->
                <div class="stat-card" style="margin-top: 25px;">
                    <div id="chatHeader" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 id="chatRoomTitle">üí¨ Selecione uma sala de chat</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary btn-sm" onclick="refreshChat()">üîÑ Atualizar</button>
                            <button class="btn btn-success btn-sm" onclick="toggleChatNotifications()">üîî Notifica√ß√µes</button>
                        </div>
                    </div>
                    
                    <div id="chatMessages" style="height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; background: var(--bg-primary); margin-bottom: 15px;">
                        <p style="text-align: center; color: #666;">Selecione uma sala de chat para come√ßar a conversar</p>
                    </div>

                    <div id="chatInputArea" style="display: none;">
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="chatMessage" placeholder="Digite sua mensagem..." style="flex: 1; padding: 12px; border: 2px solid var(--border-color); border-radius: 25px;" onkeypress="handleChatKeyPress(event)">
                            <button class="btn btn-primary" onclick="sendChatMessage()">üì§ Enviar</button>
                        </div>
                    </div>
                </div>

                <!-- Mensagens Privadas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üíå Mensagens Privadas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Para:</label>
                            <select id="privateMessageTo">
                                <option value="">Selecione um usu√°rio...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Assunto:</label>
                            <input type="text" id="privateMessageSubject" placeholder="Assunto da mensagem">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Mensagem:</label>
                        <textarea id="privateMessageContent" rows="4" placeholder="Digite sua mensagem privada..."></textarea>
                    </div>
                    <button class="btn btn-success" onclick="sendPrivateMessage()">üì© Enviar Mensagem Privada</button>

                    <!-- Lista de Mensagens Privadas -->
                    <div style="margin-top: 25px;">
                        <h4>üì® Suas Mensagens</h4>
                        <div id="privateMessagesList" style="max-height: 300px; overflow-y: auto;">
                            <!-- Preenchido dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot√£o Flutuante -->
    <button class="floating-action-btn" onclick="quickAddMatricula()" title="Adicionar Matr√≠cula R√°pida">
        ‚ûï
    </button>

    <!-- Modal para editar visita -->
    <div id="editVisitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Editar Visita</h3>
                <button class="close-modal" onclick="closeEditVisitModal()">√ó</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <div class="form-group">
                    <label>üìÖ Data da Visita:</label>
                    <input type="date" id="editVisitDate">
                </div>
                <div class="form-group">
                    <label>üë§ Nome do Visitante:</label>
                    <input type="text" id="editVisitName">
                </div>
                <div class="form-group">
                    <label>üì± Telefone:</label>
                    <input type="tel" id="editVisitPhone">
                </div>
                <div class="form-group">
                    <label>üéì Curso de Interesse:</label>
                    <select id="editVisitCourse">
                        <option value="">Selecione...</option>
                        <option value="Creators 2D">Creators 2D</option>
                        <option value="Creators 3D">Creators 3D</option>
                        <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                        <option value="Creators Dev">Creators Dev</option>
                        <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üìù Observa√ß√µes:</label>
                    <input type="text" id="editVisitNotes">
                </div>
            </div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn btn-success" onclick="saveEditVisit()">üíæ Salvar Altera√ß√µes</button>
                <button class="btn btn-danger" onclick="closeEditVisitModal()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para c√≥digo Google Script -->
    <div id="scriptModal" class="loading-overlay" style="display: none;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 80%; max-height: 80%; overflow-y: auto;">
            <h3>üìù C√≥digo para Google Apps Script</h3>
            <p style="margin-bottom: 15px;">Cole este c√≥digo no seu projeto do Google Apps Script:</p>
            <textarea readonly style="width: 100%; height: 400px; font-family: monospace; font-size: 12px; border: 1px solid #ccc; padding: 10px;" id="scriptCode"></textarea>
            <div style="margin-top: 15px; text-align: right;">
                <button class="btn btn-primary" onclick="copyScriptCode()">üìã Copiar C√≥digo</button>
                <button class="btn btn-danger" onclick="hideScriptModal()">‚ùå Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar Matr√≠cula R√°pida -->
    <div id="quickMatriculaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ö° Matr√≠cula R√°pida</h3>
                <button class="close-modal" onclick="closeQuickMatriculaModal()">√ó</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="quickNome" placeholder="Nome do aluno">
                </div>
                <div class="form-group">
                    <label>Curso:</label>
                    <select id="quickCurso">
                        <option value="Creators 2D">Creators 2D</option>
                        <option value="Creators 3D">Creators 3D</option>
                        <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor Entrada:</label>
                    <input type="number" id="quickValor" placeholder="Ex: 300" step="0.01">
                </div>
            </div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn btn-success" onclick="saveQuickMatricula()">‚ö° Adicionar R√°pido</button>
                <button class="btn btn-danger" onclick="closeQuickMatriculaModal()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // === SISTEMA COMPLETO DO GAME CREATORS PRO V2 ===
        // Vari√°veis globais
        let GOOGLE_APPS_SCRIPT_URL = localStorage.getItem('googleScriptUrl') || '';
        let currentUser = null;
        let selectedUnit = 'all';
        let users = {};
        let matriculas = [];
        let visitas = [];
        let userStats = {};
        let missions = [];
        let achievements = [];
        let metas = {};
        let unidades = [];
        let events = [];
        let chatMessages = {};
        let privateMessages = [];
        let notifications = [];
        let auditLog = [];
        let systemConfig = {};
        let currentChatRoom = null;
        let editingVisitId = null;
        let isOnline = navigator.onLine;
        let currentTheme = localStorage.getItem('theme') || 'light';
        let autoSyncInterval = null;
        let currentCalendarDate = new Date();

        // Usu√°rios padr√£o
        const defaultUsers = {
            'admin@gamecreatorsadm.com': { 
                name: 'Administrador Supremo', 
                username: 'admin@gamecreatorsadm.com', 
                password: '15212602', 
                role: 'admin', 
                level: 15, 
                xp: 10000,
                unit: 'Todas as Unidades'
            },
            'gerente.nacional@gamecreatorsadm.com': {
                name: 'Maria Silva',
                username: 'gerente.nacional@gamecreatorsadm.com',
                password: '123456',
                role: 'gerente',
                level: 8,
                xp: 4500,
                unit: 'Shopping Conjunto Nacional'
            },
            'vendedor1.nacional@gamecreatorsadm.com': {
                name: 'Jo√£o Santos',
                username: 'vendedor1.nacional@gamecreatorsadm.com',
                password: '123456',
                role: 'vendedor',
                level: 5,
                xp: 2200,
                unit: 'Shopping Conjunto Nacional'
            },
            'demo@gamecreatorsadm.com': {
                name: 'Usu√°rio Demo',
                username: 'demo@gamecreatorsadm.com',
                password: 'demo',
                role: 'vendedor',
                level: 3,
                xp: 1500,
                unit: 'Shopping Conjunto Nacional'
            }
        };

        // Unidades padr√£o
        const defaultUnidades = ['Shopping Conjunto Nacional', 'JK Shopping'];

        // Tabelas de comiss√µes
        const COMISSAO_VENDEDOR = [
            { min: 10, max: 20, valor: 35 },
            { min: 21, max: 30, valor: 50 },
            { min: 31, max: 40, valor: 60 },
            { min: 41, max: 999, valor: 70 }
        ];

        const COMISSAO_GERENTE = [
            { min: 26, max: 52, valor: 50 },
            { min: 53, max: 78, valor: 80 }
        ];

        const COMISSAO_ASSISTENTE = [
            { min: 10, max: 20, valor: 10 },
            { min: 21, max: 30, valor: 15 },
            { min: 31, max: 40, valor: 25 },
            { min: 41, max: 999, valor: 30 }
        ];

        // Sistema de Conquistas
        const ACHIEVEMENT_DEFINITIONS = [
            { id: 'first_sale', name: 'Primeira Venda', description: 'Realizar sua primeira matr√≠cula', icon: 'üéØ', xp: 50 },
            { id: 'sales_5', name: 'Vendedor Iniciante', description: 'Alcan√ßar 5 matr√≠culas no m√™s', icon: 'üìà', xp: 100 },
            { id: 'sales_10', name: 'Vendedor Experiente', description: 'Alcan√ßar 10 matr√≠culas no m√™s', icon: 'üöÄ', xp: 200 },
            { id: 'sales_20', name: 'Vendedor Expert', description: 'Alcan√ßar 20 matr√≠culas no m√™s', icon: '‚≠ê', xp: 500 },
            { id: 'conversion_80', name: 'Mestre da Convers√£o', description: 'Atingir 80% de convers√£o', icon: 'üéñÔ∏è', xp: 300 },
            { id: 'visits_50', name: 'Networking Master', description: 'Atender 50 visitas no m√™s', icon: 'üë•', xp: 150 },
            { id: 'level_5', name: 'Veterano', description: 'Alcan√ßar n√≠vel 5', icon: 'üèÜ', xp: 250 },
            { id: 'team_player', name: 'Jogador de Equipe', description: 'Enviar 10 mensagens no chat', icon: 'üí¨', xp: 100 },
            { id: 'early_bird', name: 'Madrugador', description: 'Fazer login antes das 8h por 5 dias', icon: 'üåÖ', xp: 150 }
        ];

        // INICIALIZA√á√ÉO DO SISTEMA
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando Game Creators Pro V2...');
            loadDataFromLocal();
            applyTheme();
            setCurrentDate();
            setCurrentMonthForReport();
            setupNetworkMonitoring();
            setupLoginEvents();
            setupPhoneFormatting();
            initializeCalendar();
            loadSystemConfig();
            startAutoSyncIfEnabled();
            
            // Carregar URL do Google Sheets salva
            const savedUrl = localStorage.getItem('googleScriptUrl');
            if (savedUrl) {
                document.getElementById('googleScriptUrl').value = savedUrl;
                GOOGLE_APPS_SCRIPT_URL = savedUrl;
            }

            // Gerar metas padr√£o se n√£o existirem
            generateDefaultMetas();
            
            console.log('‚úÖ Sistema inicializado com sucesso!');
        });

        // SISTEMA DE TEMA
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
            applyTheme();
        }

        function applyTheme() {
            if (currentTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                const themeBtn = document.querySelector('.theme-toggle');
                if (themeBtn) themeBtn.textContent = '‚òÄÔ∏è Modo Claro';
            } else {
                document.body.removeAttribute('data-theme');
                const themeBtn = document.querySelector('.theme-toggle');
                if (themeBtn) themeBtn.textContent = 'üåô Modo Escuro';
            }
        }

        // SISTEMA DE NOTIFICA√á√ïES
        function addNotification(title, message, type = 'info', priority = 'normal') {
            const notification = {
                id: Date.now(),
                title,
                message,
                type,
                priority,
                timestamp: new Date().toISOString(),
                read: false,
                user: currentUser?.name || 'Sistema'
            };
            
            notifications.unshift(notification);
            
            // Manter apenas as 50 notifica√ß√µes mais recentes
            if (notifications.length > 50) {
                notifications = notifications.slice(0, 50);
            }
            
            updateNotificationBadge();
            saveDataToLocal();
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            const unreadCount = notifications.filter(n => !n.read).length;
            
            if (badge) {
                badge.textContent = unreadCount;
                badge.style.display = unreadCount > 0 ? 'flex' : 'none';
            }
        }

        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            const isVisible = panel.style.display === 'block';
            
            if (isVisible) {
                panel.style.display = 'none';
            } else {
                panel.style.display = 'block';
                updateNotificationPanel();
            }
        }

        function updateNotificationPanel() {
            const content = document.getElementById('notificationPanelContent');
            if (!content) return;
            
            let html = '';
            
            if (notifications.length === 0) {
                html = '<div style="padding: 20px; text-align: center; color: #666;">Nenhuma notifica√ß√£o</div>';
            } else {
                notifications.slice(0, 10).forEach(notif => {
                    const timeAgo = getTimeAgo(notif.timestamp);
                    const readClass = notif.read ? '' : 'unread';
                    
                    html += `
                        <div class="notification-item ${readClass}" onclick="markNotificationAsRead(${notif.id})">
                            <div style="font-weight: bold; margin-bottom: 5px;">${notif.title}</div>
                            <div style="font-size: 13px; color: #666; margin-bottom: 5px;">${notif.message}</div>
                            <div style="font-size: 12px; color: #999;">${timeAgo}</div>
                        </div>
                    `;
                });
            }
            
            content.innerHTML = html;
        }

        function markNotificationAsRead(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                updateNotificationBadge();
                updateNotificationPanel();
                saveDataToLocal();
            }
        }

        function getTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Agora';
            if (diffMins < 60) return `${diffMins}min atr√°s`;
            if (diffHours < 24) return `${diffHours}h atr√°s`;
            return `${diffDays}d atr√°s`;
        }

        // SISTEMA DE CALEND√ÅRIO
        function initializeCalendar() {
            updateCalendarDisplay();
            updateDayEvents();
        }

        function updateCalendarDisplay() {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            if (!calendarGrid || !calendarTitle) return;
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            calendarTitle.textContent = new Date(year, month).toLocaleDateString('pt-BR', { 
                month: 'long', 
                year: 'numeric' 
            });
            
            // Limpar grade
            calendarGrid.innerHTML = '';
            
            // Cabe√ßalhos dos dias da semana
            const weekDays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            weekDays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.style.fontWeight = 'bold';
                dayHeader.style.padding = '10px';
                dayHeader.style.textAlign = 'center';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            // Primeiro dia do m√™s e √∫ltimo dia
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const firstDayWeek = firstDay.getDay();
            
            // Dias em branco antes do primeiro dia
            for (let i = 0; i < firstDayWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Dias do m√™s
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const currentDate = new Date(year, month, day);
                const today = new Date();
                
                // Marcar dia atual
                if (currentDate.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // Verificar se h√° eventos neste dia
                const dayEvents = events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.toDateString() === currentDate.toDateString();
                });
                
                if (dayEvents.length > 0) {
                    dayElement.classList.add('has-events');
                }
                
                dayElement.onclick = () => selectCalendarDay(currentDate);
                calendarGrid.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            updateCalendarDisplay();
        }

        function selectCalendarDay(date) {
            const dayEvents = events.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate.toDateString() === date.toDateString();
            });
            
            document.getElementById('selectedDate').textContent = date.toLocaleDateString('pt-BR');
            
            const dayEventsDiv = document.getElementById('dayEvents');
            let html = '';
            
            if (dayEvents.length === 0) {
                html = '<p style="text-align: center; color: #666; padding: 20px;">Nenhum evento neste dia</p>';
            } else {
                dayEvents.forEach(event => {
                    const eventTypeIcons = {
                        'reuniao': 'üìã',
                        'meta': 'üéØ',
                        'lembrete': 'üîî',
                        'evento': 'üéâ'
                    };
                    
                    html += `
                        <div style="border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4>${eventTypeIcons[event.type] || 'üìÖ'} ${event.title}</h4>
                                    <p style="color: #666; font-size: 13px; margin: 5px 0;">${event.description}</p>
                                    <p style="color: #999; font-size: 12px;">${event.time ? `‚è∞ ${event.time}` : ''}</p>
                                </div>
                                <button class="btn btn-danger btn-sm" onclick="deleteEvent(${event.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                });
            }
            
            dayEventsDiv.innerHTML = html;
        }

        function addEvent() {
            const title = document.getElementById('eventTitle').value.trim();
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const type = document.getElementById('eventType').value;
            const description = document.getElementById('eventDescription').value.trim();
            
            if (!title || !date) {
                showNotification('Preencha pelo menos o t√≠tulo e a data!', 'error');
                return;
            }
            
            const newEvent = {
                id: Date.now(),
                title,
                date,
                time,
                type,
                description,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            events.push(newEvent);
            saveDataToLocal();
            
            // Limpar formul√°rio
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';
            
            updateCalendarDisplay();
            addNotification('üìÖ Evento Criado', `Evento "${title}" agendado para ${new Date(date).toLocaleDateString('pt-BR')}`, 'success');
            showNotification('‚úÖ Evento criado com sucesso!', 'success');
        }

        function deleteEvent(eventId) {
            if (confirm('Tem certeza que deseja excluir este evento?')) {
                events = events.filter(e => e.id !== eventId);
                saveDataToLocal();
                updateCalendarDisplay();
                updateDayEvents();
                showNotification('‚úÖ Evento exclu√≠do com sucesso!', 'success');
            }
        }

        function updateDayEvents() {
            const today = new Date();
            selectCalendarDay(today);
        }

        // SISTEMA DE CHAT
        function openChatRoom(roomName) {
            currentChatRoom = roomName;
            document.getElementById('chatRoomTitle').textContent = `üí¨ Chat ${roomName.charAt(0).toUpperCase() + roomName.slice(1)}`;
            document.getElementById('chatInputArea').style.display = 'flex';
            
            if (!chatMessages[roomName]) {
                chatMessages[roomName] = [];
            }
            
            updateChatMessages();
        }

        function updateChatMessages() {
            const chatMessagesDiv = document.getElementById('chatMessages');
            if (!currentChatRoom || !chatMessagesDiv) return;
            
            const roomMessages = chatMessages[currentChatRoom] || [];
            let html = '';
            
            if (roomMessages.length === 0) {
                html = '<p style="text-align: center; color: #666;">Nenhuma mensagem ainda. Seja o primeiro a enviar!</p>';
            } else {
                roomMessages.forEach(msg => {
                    const isMyMessage = msg.user === currentUser.name;
                    const messageClass = isMyMessage ? 'my-message' : 'other-message';
                    const timestamp = new Date(msg.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                    
                    html += `
                        <div style="margin-bottom: 15px; ${isMyMessage ? 'text-align: right;' : ''}">
                            <div style="display: inline-block; max-width: 70%; padding: 10px 15px; border-radius: 18px; ${isMyMessage ? 'background: var(--primary-gradient); color: white;' : 'background: var(--bg-secondary); color: var(--text-primary);'}">
                                ${!isMyMessage ? `<div style="font-weight: bold; font-size: 12px; margin-bottom: 5px; opacity: 0.8;">${msg.user}</div>` : ''}
                                <div>${msg.message}</div>
                                <div style="font-size: 11px; opacity: 0.7; margin-top: 3px;">${timestamp}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            chatMessagesDiv.innerHTML = html;
            chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
        }

        function sendChatMessage() {
            const messageInput = document.getElementById('chatMessage');
            const message = messageInput.value.trim();
            
            if (!message || !currentChatRoom) return;
            
            const chatMessage = {
                id: Date.now(),
                user: currentUser.name,
                message: message,
                timestamp: new Date().toISOString(),
                room: currentChatRoom
            };
            
            if (!chatMessages[currentChatRoom]) {
                chatMessages[currentChatRoom] = [];
            }
            
            chatMessages[currentChatRoom].push(chatMessage);
            
            // Manter apenas as 100 mensagens mais recentes por sala
            if (chatMessages[currentChatRoom].length > 100) {
                chatMessages[currentChatRoom] = chatMessages[currentChatRoom].slice(-100);
            }
            
            messageInput.value = '';
            updateChatMessages();
            saveDataToLocal();
            
            // Adicionar achievement se for uma das primeiras mensagens
            checkChatAchievements();
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function refreshChat() {
            updateChatMessages();
            showNotification('üîÑ Chat atualizado!', 'info');
        }

        function toggleChatNotifications() {
            const enabled = localStorage.getItem('chatNotifications') !== 'false';
            localStorage.setItem('chatNotifications', !enabled);
            showNotification(enabled ? 'üîï Notifica√ß√µes de chat desabilitadas' : 'üîî Notifica√ß√µes de chat habilitadas', 'info');
        }

        function checkChatAchievements() {
            const userMessages = Object.values(chatMessages).flat().filter(msg => msg.user === currentUser.name);
            
            if (userMessages.length >= 10) {
                const hasAchievement = userStats[currentUser.username]?.achievements?.includes('team_player');
                if (!hasAchievement) {
                    const achievement = ACHIEVEMENT_DEFINITIONS.find(a => a.id === 'team_player');
                    if (achievement) {
                        unlockAchievement(achievement);
                    }
                }
            }
        }

        // MENSAGENS PRIVADAS
        function sendPrivateMessage() {
            const to = document.getElementById('privateMessageTo').value;
            const subject = document.getElementById('privateMessageSubject').value.trim();
            const content = document.getElementById('privateMessageContent').value.trim();
            
            if (!to || !subject || !content) {
                showNotification('Preencha todos os campos!', 'error');
                return;
            }
            
            const message = {
                id: Date.now(),
                from: currentUser.name,
                to: to,
                subject: subject,
                content: content,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            privateMessages.push(message);
            saveDataToLocal();
            
            // Limpar formul√°rio
            document.getElementById('privateMessageTo').value = '';
            document.getElementById('privateMessageSubject').value = '';
            document.getElementById('privateMessageContent').value = '';
            
            updatePrivateMessagesList();
            addNotification('üì© Mensagem Enviada', `Mensagem enviada para ${to}`, 'success');
            showNotification('‚úÖ Mensagem privada enviada!', 'success');
        }

        function updatePrivateMessagesList() {
            const messagesList = document.getElementById('privateMessagesList');
            if (!messagesList) return;
            
            const userMessages = privateMessages.filter(msg => 
                msg.from === currentUser.name || msg.to === currentUser.name
            ).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            let html = '';
            
            if (userMessages.length === 0) {
                html = '<p style="text-align: center; color: #666; padding: 20px;">Nenhuma mensagem privada</p>';
            } else {
                userMessages.forEach(msg => {
                    const isFromMe = msg.from === currentUser.name;
                    const otherUser = isFromMe ? msg.to : msg.from;
                    const timestamp = new Date(msg.timestamp).toLocaleDateString('pt-BR');
                    
                    html += `
                        <div style="border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 10px; ${!msg.read && !isFromMe ? 'background: rgba(102, 126, 234, 0.05);' : ''}">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div>
                                    <strong>${isFromMe ? 'üì§ Para:' : 'üì• De:'} ${otherUser}</strong>
                                    <div style="font-size: 12px; color: #666;">${timestamp}</div>
                                </div>
                                ${!isFromMe && !msg.read ? '<div style="background: #667eea; color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px;">NOVA</div>' : ''}
                            </div>
                            <div style="font-weight: bold; margin-bottom: 8px;">${msg.subject}</div>
                            <div style="color: #666; font-size: 14px;">${msg.content}</div>
                            ${!isFromMe && !msg.read ? `<button class="btn btn-primary btn-sm" onclick="markPrivateMessageAsRead(${msg.id})" style="margin-top: 10px;">‚úÖ Marcar como Lida</button>` : ''}
                        </div>
                    `;
                });
            }
            
            messagesList.innerHTML = html;
        }

        function markPrivateMessageAsRead(messageId) {
            const message = privateMessages.find(m => m.id === messageId);
            if (message) {
                message.read = true;
                saveDataToLocal();
                updatePrivateMessagesList();
            }
        }

        // SISTEMA DE BACKUP E RESTORE
        function createBackup() {
            const backupData = {
                version: '2.0',
                timestamp: new Date().toISOString(),
                users: users,
                matriculas: matriculas,
                visitas: visitas,
                userStats: userStats,
                missions: missions,
                metas: metas,
                unidades: unidades,
                events: events,
                chatMessages: chatMessages,
                privateMessages: privateMessages,
                notifications: notifications,
                systemConfig: systemConfig
            };
            
            localStorage.setItem('gameCreatorsBackup', JSON.stringify(backupData));
            document.getElementById('backupStatus').textContent = `‚úÖ Backup criado em ${new Date().toLocaleString('pt-BR')}`;
            showNotification('‚úÖ Backup criado com sucesso!', 'success');
        }

        function downloadBackup() {
            const backupData = localStorage.getItem('gameCreatorsBackup');
            if (!backupData) {
                showNotification('‚ùå Nenhum backup encontrado. Crie um backup primeiro!', 'error');
                return;
            }
            
            const blob = new Blob([backupData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `game-creators-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('‚¨áÔ∏è Backup baixado com sucesso!', 'success');
        }

        function restoreBackup() {
            const fileInput = document.getElementById('backupFile');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (!backupData.version || !backupData.users) {
                        throw new Error('Arquivo de backup inv√°lido');
                    }
                    
                    if (confirm('‚ö†Ô∏è Isso ir√° substituir todos os dados atuais. Tem certeza?')) {
                        users = backupData.users || {};
                        matriculas = backupData.matriculas || [];
                        visitas = backupData.visitas || [];
                        userStats = backupData.userStats || {};
                        missions = backupData.missions || [];
                        metas = backupData.metas || {};
                        unidades = backupData.unidades || [];
                        events = backupData.events || [];
                        chatMessages = backupData.chatMessages || {};
                        privateMessages = backupData.privateMessages || [];
                        notifications = backupData.notifications || [];
                        systemConfig = backupData.systemConfig || {};
                        
                        saveDataToLocal();
                        
                        showNotification('‚úÖ Backup restaurado com sucesso! Recarregue a p√°gina.', 'success');
                        document.getElementById('backupStatus').textContent = `‚úÖ Backup restaurado de ${new Date(backupData.timestamp).toLocaleString('pt-BR')}`;
                    }
                } catch (error) {
                    showNotification('‚ùå Erro ao restaurar backup: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
            
            fileInput.value = '';
        }

        function resetSystem() {
            if (currentUser.role !== 'admin') {
                showNotification('‚ùå Apenas administradores podem resetar o sistema!', 'error');
                return;
            }
            
            const confirmation = prompt('‚ö†Ô∏è CUIDADO! Isso ir√° apagar TODOS os dados do sistema!\n\nDigite "RESETAR TUDO" para confirmar:');
            
            if (confirmation === 'RESETAR TUDO') {
                localStorage.clear();
                
                users = {...defaultUsers};
                matriculas = [];
                visitas = [];
                userStats = {};
                missions = [];
                metas = {};
                unidades = [...defaultUnidades];
                events = [];
                chatMessages = {};
                privateMessages = [];
                notifications = [];
                systemConfig = {};
                
                saveDataToLocal();
                
                showNotification('üîÑ Sistema resetado! Recarregue a p√°gina.', 'warning');
                setTimeout(() => location.reload(), 2000);
            }
        }

        // CONFIGURA√á√ïES DO SISTEMA
        function saveSystemConfig() {
            const autoSyncInterval = document.getElementById('autoSyncInterval').value;
            const adminEmail = document.getElementById('adminEmail').value;
            const companyUrl = document.getElementById('companyUrl').value;
            
            systemConfig = {
                autoSyncInterval: parseInt(autoSyncInterval),
                adminEmail: adminEmail,
                companyUrl: companyUrl,
                lastUpdate: new Date().toISOString()
            };
            
            localStorage.setItem('systemConfig', JSON.stringify(systemConfig));
            
            // Reiniciar auto sync se necess√°rio
            startAutoSyncIfEnabled();
            
            showNotification('‚úÖ Configura√ß√µes salvas com sucesso!', 'success');
        }

        function loadSystemConfig() {
            const savedConfig = localStorage.getItem('systemConfig');
            if (savedConfig) {
                systemConfig = JSON.parse(savedConfig);
                
                // Aplicar configura√ß√µes na interface
                const autoSyncSelect = document.getElementById('autoSyncInterval');
                const adminEmailInput = document.getElementById('adminEmail');
                const companyUrlInput = document.getElementById('companyUrl');
                
                if (autoSyncSelect) autoSyncSelect.value = systemConfig.autoSyncInterval || 600000;
                if (adminEmailInput) adminEmailInput.value = systemConfig.adminEmail || '';
                if (companyUrlInput) companyUrlInput.value = systemConfig.companyUrl || '';
            }
        }

        function startAutoSyncIfEnabled() {
            // Limpar intervalo anterior
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
                autoSyncInterval = null;
            }
            
            const interval = systemConfig.autoSyncInterval || 0;
            
            if (interval > 0 && GOOGLE_APPS_SCRIPT_URL) {
                autoSyncInterval = setInterval(() => {
                    if (currentUser) {
                        console.log('üîÑ Auto sync executado');
                        forceSync();
                    }
                }, interval);
                
                console.log(`‚è∞ Auto sync configurado para ${interval / 60000} minutos`);
            }
        }

        // AUDITORIA DO SISTEMA
        function logAuditEvent(type, description, data = {}) {
            const auditEvent = {
                id: Date.now(),
                type: type,
                description: description,
                user: currentUser?.name || 'Sistema',
                timestamp: new Date().toISOString(),
                data: data
            };
            
            auditLog.unshift(auditEvent);
            
            // Manter apenas os 1000 eventos mais recentes
            if (auditLog.length > 1000) {
                auditLog = auditLog.slice(0, 1000);
            }
            
            saveDataToLocal();
        }

        function filterAuditLog() {
            const filter = document.getElementById('auditFilter').value;
            updateAuditLogDisplay(filter);
        }

        function updateAuditLogDisplay(filter = 'all') {
            const auditLogDiv = document.getElementById('auditLog');
            if (!auditLogDiv) return;
            
            let filteredLog = auditLog;
            if (filter !== 'all') {
                filteredLog = auditLog.filter(event => event.type === filter);
            }
            
            let html = '';
            
            if (filteredLog.length === 0) {
                html = 'Nenhum evento de auditoria encontrado.';
            } else {
                filteredLog.slice(0, 50).forEach(event => {
                    const timestamp = new Date(event.timestamp).toLocaleString('pt-BR');
                    html += `[${timestamp}] [${event.type.toUpperCase()}] ${event.user}: ${event.description}\n`;
                });
            }
            
            auditLogDiv.textContent = html;
        }

        function exportAuditLog() {
            const filter = document.getElementById('auditFilter').value;
            let filteredLog = auditLog;
            if (filter !== 'all') {
                filteredLog = auditLog.filter(event => event.type === filter);
            }
            
            let csvContent = 'Timestamp,Tipo,Usu√°rio,Descri√ß√£o\n';
            filteredLog.forEach(event => {
                const timestamp = new Date(event.timestamp).toLocaleString('pt-BR');
                csvContent += `"${timestamp}","${event.type}","${event.user}","${event.description}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `audit-log-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üìÑ Log de auditoria exportado!', 'success');
        }

        // SISTEMA DE LOGIN APRIMORADO
        function setupLoginEvents() {
            const loginUsername = document.getElementById('loginUsername');
            const loginPassword = document.getElementById('loginPassword');
            
            if (loginUsername) {
                loginUsername.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('loginPassword').focus();
                    }
                });
            }
            
            if (loginPassword) {
                loginPassword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });
            }
        }

        function setupPhoneFormatting() {
            document.addEventListener('input', function(e) {
                if (e.target.type === 'tel') {
                    formatPhone(e.target);
                }
            });
        }

        function formatPhone(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value.length <= 11) {
                if (value.length <= 10) {
                    value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                } else {
                    value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                }
            }
            
            input.value = value;
        }

        function showForgotPassword() {
            showNotification('üí° Dica: As senhas padr√£o s√£o "123456" para usu√°rios demo ou "15212602" para admin', 'info', 8000);
        }

        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const errorDiv = document.getElementById('loginError');

            if (!username || !password) {
                showNotification('Por favor, preencha todos os campos!', 'error');
                return;
            }

            console.log('Tentando login com:', username);
            
            if (users[username] && users[username].password === password) {
                currentUser = users[username];
                
                console.log('Login bem-sucedido:', currentUser);
                
                // Log de auditoria
                logAuditEvent('login', `Login realizado com sucesso`, { username });
                
                // Verificar achievement de login matinal
                const now = new Date();
                if (now.getHours() < 8) {
                    checkEarlyBirdAchievement();
                }
                
                // Anima√ß√£o de transi√ß√£o suave
                document.getElementById('loginScreen').style.animation = 'fadeOut 0.5s ease-out';
                
                setTimeout(() => {
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainSystem').style.display = 'block';
                    document.getElementById('mainSystem').style.animation = 'fadeIn 0.5s ease-in';
                    
                    setupUserInterface();
                    initializeGamification();
                    updateNotificationBadge();
                    updateNotificationPanel();
                    updatePrivateMessagesList();
                    addNotification('üéâ Login Realizado', `Bem-vindo(a) de volta, ${currentUser.name}!`, 'success');
                    showNotification(`üéâ Bem-vindo(a), ${currentUser.name}!`, 'success');
                }, 500);
                
                errorDiv.classList.add('hidden');
            } else {
                console.log('Login falhou para:', username);
                logAuditEvent('login', `Tentativa de login falhada`, { username });
                errorDiv.classList.remove('hidden');
                showNotification('Credenciais inv√°lidas!', 'error');
            }
        }

        function checkEarlyBirdAchievement() {
            // Implementar l√≥gica para achievement de login matinal
            const earlyLogins = JSON.parse(localStorage.getItem('earlyLogins') || '[]');
            const today = new Date().toDateString();
            
            if (!earlyLogins.includes(today)) {
                earlyLogins.push(today);
                localStorage.setItem('earlyLogins', JSON.stringify(earlyLogins));
                
                if (earlyLogins.length >= 5) {
                    const hasAchievement = userStats[currentUser.username]?.achievements?.includes('early_bird');
                    if (!hasAchievement) {
                        const achievement = ACHIEVEMENT_DEFINITIONS.find(a => a.id === 'early_bird');
                        if (achievement) {
                            unlockAchievement(achievement);
                        }
                    }
                }
            }
        }

        function logout() {
            logAuditEvent('logout', `Logout realizado`);
            
            currentUser = null;
            selectedUnit = 'all';
            currentChatRoom = null;
            
            document.getElementById('mainSystem').style.animation = 'fadeOut 0.5s ease-out';
            
            setTimeout(() => {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainSystem').style.display = 'none';
                document.getElementById('loginScreen').style.animation = 'fadeIn 0.5s ease-in';
                
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                
                showNotification('Logout realizado com sucesso!', 'info');
            }, 500);
        }

        // SISTEMA DE NOTIFICA√á√ïES APRIMORADO
        function showNotification(message, type = 'info', duration = 4000) {
            // Remove notifica√ß√µes existentes
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notif => {
                if (notif.style.position === 'fixed') {
                    notif.remove();
                }
            });

            // Cria nova notifica√ß√£o
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 18px;">
                        ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
                    </span>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            // Remove automaticamente
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => notification.remove(), 300);
                }
            }, duration);
        }

        // INTERFACE DO USU√ÅRIO
        function setupUserInterface() {
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userLevel').textContent = `N√≠vel ${currentUser.level} - ${getLevelTitle(currentUser.level)}`;
            document.getElementById('userUnit').textContent = currentUser.unit || unidades[0] || 'Shopping Conjunto Nacional';

            updateSyncStatus('online');

            if (currentUser.role === 'admin') {
                document.getElementById('unitFilter').classList.remove('hidden');
                setupUnitFilter();
                updateAuditLogDisplay();
            }

            setupNavigation();
            setupDashboard();
            updateUserSelects();
            updateVisitSelects();
            updateMatriculasList();
            updateActivityFeed();
            updateAnalytics();
        }

        function getLevelTitle(level) {
            if (level >= 15) return 'Lenda Suprema';
            if (level >= 12) return 'Mestre Absoluto';
            if (level >= 10) return 'Grande Mestre';
            if (level >= 8) return 'Especialista Elite';
            if (level >= 6) return 'Profissional';
            if (level >= 4) return 'Experiente';
            if (level >= 2) return 'Aprendiz';
            return 'Novato';
        }

        function setupNavigation() {
            const navTabs = document.getElementById('navTabs');
            let tabs = '';

            tabs += '<button class="tab-button active" onclick="showTab(\'dashboard\')">üè† Dashboard</button>';
            tabs += '<button class="tab-button" onclick="showTab(\'calendario\')">üìÖ Calend√°rio</button>';
            tabs += '<button class="tab-button" onclick="showTab(\'gamificacao\')">üéÆ Gamifica√ß√£o</button>';
            
            if (['admin', 'gerente', 'vendedor', 'assistente'].includes(currentUser.role)) {
                tabs += '<button class="tab-button" onclick="showTab(\'visitas\')">üë• Visitas</button>';
            }
            
            if (currentUser.role === 'gerente') {
                tabs += '<button class="tab-button" onclick="showTab(\'equipe\')">üë• Minha Equipe</button>';
            }
            
            tabs += '<button class="tab-button" onclick="showTab(\'ranking\')">üèÜ Ranking</button>';
            tabs += '<button class="tab-button" onclick="showTab(\'chat\')">üí¨ Chat</button>';

            if (currentUser.role === 'admin') {
                tabs += '<button class="tab-button" onclick="showTab(\'admin\')">‚öôÔ∏è Admin</button>';
            }

            if (['admin', 'gerente', 'vendedor'].includes(currentUser.role)) {
                tabs += '<button class="tab-button" onclick="showTab(\'matriculas\')">‚ûï Matr√≠culas</button>';
                tabs += '<button class="tab-button" onclick="showTab(\'relatorios\')">üìä Relat√≥rios</button>';
            }

            navTabs.innerHTML = tabs;
        }

        function showTab(tabName) {
            // Ocultar todas as abas
            const allTabs = document.querySelectorAll('.tab-content');
            const allButtons = document.querySelectorAll('.tab-button');
            
            allTabs.forEach(tab => tab.classList.remove('active'));
            allButtons.forEach(btn => btn.classList.remove('active'));
            
            // Mostrar aba selecionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Atualizar dados espec√≠ficos da aba
            switch(tabName) {
                case 'calendario':
                    updateCalendarDisplay();
                    updateDayEvents();
                    break;
                case 'gamificacao':
                    updateUserProgress();
                    updateMissionsDisplay();
                    updateAchievementsDisplay();
                    break;
                case 'visitas':
                    updateVisitsDisplay();
                    setCurrentDate();
                    break;
                case 'ranking':
                    updateRanking();
                    break;
                case 'admin':
                    updateAdminPanel();
                    updateUnitsConfig();
                    updateAuditLogDisplay();
                    break;
                case 'equipe':
                    updateTeamDisplay();
                    break;
                case 'matriculas':
                    updateMatriculasList();
                    break;
                case 'relatorios':
                    updateRelatorioUnidades();
                    break;
                case 'chat':
                    updateChatMessages();
                    updatePrivateMessagesList();
                    break;
            }
        }

        function setupDashboard() {
            const dashboardGrid = document.getElementById('dashboardGrid');
            let dashboardHTML = '';

            if (currentUser.role === 'admin') {
                dashboardHTML += generateAdminDashboard();
            } else if (currentUser.role === 'gerente') {
                dashboardHTML += generateManagerDashboard();
            } else {
                dashboardHTML += generateUserDashboard();
            }

            dashboardGrid.innerHTML = dashboardHTML;
        }

        function generateUserDashboard() {
            const userMatriculas = getUserMatriculas();
            const userVisits = getUserVisits();
            const monthData = getCurrentMonthData(userMatriculas);
            const monthVisits = getCurrentMonthData(userVisits, 'data');
            const todayData = getTodayData(userMatriculas);
            
            const conversionRate = monthVisits.length > 0 ? (monthData.length / monthVisits.length * 100).toFixed(1) : 0;
            const monthTarget = currentUser.role === 'vendedor' ? 30 : 25;
            const monthProgress = Math.min((monthData.length / monthTarget) * 100, 100);
            const monthCommission = calculateUserMonthCommission();

            return `
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üìä</span>
                    </div>
                    <div class="stat-value">${monthData.length}</div>
                    <div class="stat-label">Minhas Matr√≠culas</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${monthProgress}%"></div>
                    </div>
                    <div class="progress-text">${monthData.length} de ${monthTarget}</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üë•</span>
                    </div>
                    <div class="stat-value">${monthVisits.length}</div>
                    <div class="stat-label">Visitas Atendidas</div>
                </div>

                <div class="stat-card conversion-card">
                    <div class="stat-header">
                        <span class="stat-icon">üìà</span>
                    </div>
                    <div class="conversion-rate">${conversionRate}%</div>
                    <div class="stat-label">Minha Convers√£o</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üéØ</span>
                    </div>
                    <div class="stat-value">${todayData.length}</div>
                    <div class="stat-label">Vendas Hoje</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üí∞</span>
                    </div>
                    <div class="stat-value">${formatCurrency(monthCommission)}</div>
                    <div class="stat-label">Comiss√£o do M√™s</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">‚≠ê</span>
                        <span class="xp-badge">N√≠vel ${currentUser.level}</span>
                    </div>
                    <div class="stat-value">${currentUser.xp}</div>
                    <div class="stat-label">Pontos XP</div>
                </div>
            `;
        }

        function generateManagerDashboard() {
            const unitData = getUnitData(currentUser.unit);
            const unitVisits = getUnitVisits(currentUser.unit);
            const monthData = getCurrentMonthData(unitData);
            const monthVisits = getCurrentMonthData(unitVisits, 'data');
            
            const conversionRate = monthVisits.length > 0 ? (monthData.length / monthVisits.length * 100).toFixed(1) : 0;
            const totalUnitCommission = calculateManagerUnitCommission();
            const unitRevenue = calculateTotalRevenue(monthData);

            return `
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üè¢</span>
                        <span style="font-size: 12px; color: #666;">${currentUser.unit}</span>
                    </div>
                    <div class="stat-value">${monthData.length}</div>
                    <div class="stat-label">Matr√≠culas da Unidade</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üë•</span>
                    </div>
                    <div class="stat-value">${monthVisits.length}</div>
                    <div class="stat-label">Visitas do M√™s</div>
                </div>

                <div class="stat-card conversion-card">
                    <div class="stat-header">
                        <span class="stat-icon">üìà</span>
                    </div>
                    <div class="conversion-rate">${conversionRate}%</div>
                    <div class="stat-label">Taxa de Convers√£o</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(conversionRate, 100)}%; background: var(--warning-gradient);"></div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üí∞</span>
                    </div>
                    <div class="stat-value">${formatCurrency(totalUnitCommission)}</div>
                    <div class="stat-label">Minha Comiss√£o</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Baseada nas vendas da unidade
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üíµ</span>
                    </div>
                    <div class="stat-value">${formatCurrency(unitRevenue)}</div>
                    <div class="stat-label">Faturamento da Unidade</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üë®‚Äçüíº</span>
                    </div>
                    <div class="stat-value">${getTeamMembersCount()}</div>
                    <div class="stat-label">Membros da Equipe</div>
                </div>
            `;
        }

        function generateAdminDashboard() {
            const allData = selectedUnit === 'all' ? matriculas : getUnitData(selectedUnit);
            const allVisits = selectedUnit === 'all' ? visitas : getUnitVisits(selectedUnit);
            const monthData = getCurrentMonthData(allData);
            const monthVisits = getCurrentMonthData(allVisits, 'data');
            
            const conversionRate = monthVisits.length > 0 ? (monthData.length / monthVisits.length * 100).toFixed(1) : 0;
            const totalRevenue = calculateTotalRevenue(monthData);
            const totalCollaborators = Object.values(users).filter(u => u.role !== 'admin').length;

            return `
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üìä</span>
                        <span style="font-size: 12px; color: #666;">${selectedUnit === 'all' ? 'Todas' : selectedUnit}</span>
                    </div>
                    <div class="stat-value">${monthData.length}</div>
                    <div class="stat-label">Matr√≠culas do M√™s</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üë•</span>
                    </div>
                    <div class="stat-value">${monthVisits.length}</div>
                    <div class="stat-label">Visitas do M√™s</div>
                </div>

                <div class="stat-card conversion-card">
                    <div class="stat-header">
                        <span class="stat-icon">üìà</span>
                    </div>
                    <div class="conversion-rate">${conversionRate}%</div>
                    <div class="stat-label">Convers√£o Geral</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üí∞</span>
                    </div>
                    <div class="stat-value">${formatCurrency(totalRevenue)}</div>
                    <div class="stat-label">Faturamento</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üè¢</span>
                    </div>
                    <div class="stat-value">${unidades.length}</div>
                    <div class="stat-label">Unidades Ativas</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-icon">üë®‚Äçüíº</span>
                    </div>
                    <div class="stat-value">${totalCollaborators}</div>
                    <div class="stat-label">Colaboradores</div>
                </div>
            `;
        }

        // SISTEMA DE ANALYTICS
        function updateAnalytics() {
            if (currentUser.role !== 'admin') return;

            const totalRevenue = calculateTotalRevenue(matriculas);
            const avgTicket = matriculas.length > 0 ? totalRevenue / matriculas.length : 0;
            const growthRate = calculateGrowthRate();

            const totalRevenueEl = document.getElementById('totalRevenue');
            const avgTicketEl = document.getElementById('avgTicket');
            const growthRateEl = document.getElementById('growthRate');

            if (totalRevenueEl) totalRevenueEl.textContent = formatCurrency(totalRevenue);
            if (avgTicketEl) avgTicketEl.textContent = formatCurrency(avgTicket);
            if (growthRateEl) growthRateEl.textContent = `${growthRate >= 0 ? '+' : ''}${growthRate.toFixed(1)}%`;
        }

        function calculateGrowthRate() {
            const thisMonth = getCurrentMonthData(matriculas);
            const lastMonth = getLastMonthData(matriculas);
            
            if (lastMonth.length === 0) return 0;
            
            return ((thisMonth.length - lastMonth.length) / lastMonth.length) * 100;
        }

        function getLastMonthData(data) {
            const now = new Date();
            const lastMonth = now.getMonth() - 1;
            const year = lastMonth < 0 ? now.getFullYear() - 1 : now.getFullYear();
            const month = lastMonth < 0 ? 11 : lastMonth;
            
            return data.filter(item => {
                const date = new Date(item.data);
                return date.getMonth() === month && 
                       date.getFullYear() === year && 
                       !item.cancelado;
            });
        }

        // ATIVIDADES RECENTES
        function updateActivityFeed() {
            const activityFeed = document.getElementById('activityFeed');
            if (!activityFeed) return;

            const recentMatriculas = matriculas
                .filter(m => {
                    const date = new Date(m.data);
                    const now = new Date();
                    return (now - date) < (7 * 24 * 60 * 60 * 1000); // √öltimos 7 dias
                })
                .sort((a, b) => new Date(b.data) - new Date(a.data))
                .slice(0, 10);

            const recentVisitas = visitas
                .filter(v => {
                    const date = new Date(v.data);
                    const now = new Date();
                    return (now - date) < (7 * 24 * 60 * 60 * 1000);
                })
                .sort((a, b) => new Date(b.data) - new Date(a.data))
                .slice(0, 10);

            const activities = [];

            recentMatriculas.forEach(m => {
                activities.push({
                    type: 'matricula',
                    icon: 'üìä',
                    title: 'Nova Matr√≠cula',
                    description: `${m.nome} - ${m.curso}`,
                    time: m.data,
                    user: m.vendedor
                });
            });

            recentVisitas.forEach(v => {
                activities.push({
                    type: 'visita',
                    icon: 'üë•',
                    title: v.convertido ? 'Visita Convertida' : 'Nova Visita',
                    description: `${v.nome} - ${v.cursoInteresse}`,
                    time: v.data,
                    user: v.atendente
                });
            });

            activities.sort((a, b) => new Date(b.time) - new Date(a.time));

            let html = '';
            if (activities.length === 0) {
                html = '<p style="text-align: center; color: #666; padding: 20px;">Nenhuma atividade recente</p>';
            } else {
                activities.slice(0, 10).forEach(activity => {
                    const timeAgo = getTimeAgo(activity.time + 'T00:00:00.000Z');
                    html += `
                        <div class="activity-item">
                            <div class="activity-icon">${activity.icon}</div>
                            <div class="activity-content">
                                <div class="activity-title">${activity.title}</div>
                                <div class="activity-description">${activity.description}</div>
                                <div style="font-size: 11px; color: #999; margin-top: 3px;">por ${activity.user}</div>
                            </div>
                            <div class="activity-time">${timeAgo}</div>
                        </div>
                    `;
                });
            }

            activityFeed.innerHTML = html;
        }

        // SISTEMA DE GAMIFICA√á√ÉO
        function initializeGamification() {
            if (!missions) missions = [];
            if (!achievements) achievements = [];
            
            createAutoMissions();
            checkAchievements();
            updateMissionProgress();
            
            // Mostrar se√ß√£o de criar miss√£o para admin/gerente
            if (currentUser.role === 'admin' || currentUser.role === 'gerente') {
                document.getElementById('createMissionSection').classList.remove('hidden');
            }
        }

        function createAutoMissions() {
            const currentMonth = new Date().toISOString().substring(0, 7);
            
            const autoMissions = [
                {
                    id: `vendas_${currentMonth}`,
                    title: 'üéØ Meta de Vendas Mensal',
                    description: 'Alcan√ßar 15 matr√≠culas neste m√™s',
                    type: 'vendas',
                    target: 15,
                    reward: 200,
                    deadline: new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).toISOString().split('T')[0],
                    createdBy: 'Sistema',
                    assignedTo: 'all',
                    autoMission: true
                },
                {
                    id: `visitas_${currentMonth}`,
                    title: 'üë• Meta de Visitas',
                    description: 'Atender 30 visitas neste m√™s',
                    type: 'visitas',
                    target: 30,
                    reward: 150,
                    deadline: new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).toISOString().split('T')[0],
                    createdBy: 'Sistema',
                    assignedTo: 'all',
                    autoMission: true
                }
            ];

            autoMissions.forEach(mission => {
                if (!missions.find(m => m.id === mission.id)) {
                    missions.push(mission);
                }
            });
        }

        function updateUserProgress() {
            const userProgress = document.getElementById('userProgress');
            if (!userProgress || !currentUser) return;
            
            const nextLevelXP = currentUser.level * 500;
            const currentLevelXP = (currentUser.level - 1) * 500;
            const progressXP = currentUser.xp - currentLevelXP;
            const neededXP = nextLevelXP - currentLevelXP;
            const progressPercent = Math.min((progressXP / neededXP) * 100, 100);
            
            userProgress.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: var(--text-primary);">${currentUser.level}</div>
                        <div style="font-size: 14px; color: var(--text-secondary);">N√≠vel Atual</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: #667eea;">${currentUser.xp}</div>
                        <div style="font-size: 14px; color: var(--text-secondary);">XP Total</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: #38a169;">${userStats[currentUser.username]?.achievements?.length || 0}</div>
                        <div style="font-size: 14px; color: var(--text-secondary);">Conquistas</div>
                    </div>
                    <div style="padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="text-align: center; font-size: 18px; font-weight: bold; color: #ed8936; margin-bottom: 10px;">Pr√≥ximo N√≠vel</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressPercent}%; background: var(--primary-gradient);"></div>
                        </div>
                        <div style="text-align: center; font-size: 12px; color: var(--text-secondary); margin-top: 5px;">${progressXP}/${neededXP} XP</div>
                    </div>
                </div>
            `;
        }

        function updateMissionsDisplay() {
            const activeMissions = document.getElementById('activeMissions');
            if (!activeMissions) return;

            const userMissions = getUserMissions();
            let html = '';

            if (userMissions.length === 0) {
                html = '<p style="text-align: center; color: #666; padding: 20px;">Nenhuma miss√£o ativa no momento.</p>';
            } else {
                userMissions.forEach(mission => {
                    const progress = calculateMissionProgress(mission);
                    const isCompleted = progress >= mission.target;
                    const isExpired = new Date(mission.deadline) < new Date();
                    
                    let cardClass = 'mission-card';
                    if (isCompleted) cardClass += ' mission-completed';
                    else if (isExpired) cardClass += ' mission-failed';

                    html += `
                        <div class="${cardClass}">
                            <div class="mission-header">
                                <div class="mission-title">${mission.title}</div>
                                <div class="mission-reward">+${mission.reward} XP</div>
                            </div>
                            <div style="font-size: 14px; color: #666; margin-bottom: 10px;">
                                ${mission.description}
                            </div>
                            <div class="mission-progress">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                    <span style="font-size: 12px; color: #666;">Progresso:</span>
                                    <span style="font-size: 12px; font-weight: bold;">${progress}/${mission.target}</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.min((progress / mission.target) * 100, 100)}%"></div>
                                </div>
                            </div>
                            <div style="font-size: 12px; color: #666;">
                                üìÖ Prazo: ${formatDate(mission.deadline)}
                                ${isCompleted ? ' | ‚úÖ Conclu√≠da!' : isExpired ? ' | ‚ùå Expirada' : ''}
                            </div>
                        </div>
                    `;
                });
            }

            activeMissions.innerHTML = html;
        }

        function updateAchievementsDisplay() {
            const userAchievements = document.getElementById('userAchievements');
            if (!userAchievements || !currentUser) return;
            
            const userAchievementIds = userStats[currentUser.username]?.achievements || [];
            let html = '';

            if (userAchievementIds.length === 0) {
                html = '<p style="text-align: center; color: #666; padding: 20px;">Nenhuma conquista desbloqueada ainda. Complete miss√µes para ganhar conquistas!</p>';
            } else {
                userAchievementIds.forEach(achievementId => {
                    const achievement = ACHIEVEMENT_DEFINITIONS.find(a => a.id === achievementId);
                    if (achievement) {
                        html += `
                            <div class="achievement-badge" title="${achievement.description}">
                                ${achievement.icon} ${achievement.name}
                            </div>
                        `;
                    }
                });
            }
            
            userAchievements.innerHTML = html;
        }

        // SISTEMA DE RECOMPENSAS
        function redeemReward(rewardType, cost) {
            if (!currentUser || currentUser.xp < cost) {
                showNotification('‚ùå XP insuficiente para resgatar esta recompensa!', 'error');
                return;
            }

            const rewardNames = {
                'gift50': 'Vale Presente R$ 50',
                'dayoff': 'Dia de Folga Extra',
                'certificate': 'Certificado de Destaque'
            };

            if (confirm(`Deseja resgatar "${rewardNames[rewardType]}" por ${cost} XP?`)) {
                currentUser.xp -= cost;
                
                logAuditEvent('reward', `Resgatou recompensa: ${rewardNames[rewardType]}`, { rewardType, cost });
                addNotification('üéÅ Recompensa Resgatada', `Voc√™ resgatou: ${rewardNames[rewardType]}`, 'success');
                showNotification(`üéÅ Parab√©ns! Voc√™ resgatou: ${rewardNames[rewardType]}`, 'success');
                
                saveDataToLocal();
                updateUserProgress();
            }
        }

        // SISTEMA DE GERENCIAMENTO DE UNIDADES (ADMIN ONLY)
        function addNewUnit() {
            if (currentUser.role !== 'admin') {
                showNotification('‚ùå Apenas administradores podem adicionar novas unidades!', 'error');
                return;
            }

            const newUnitName = document.getElementById('newUnitName').value.trim();
            
            if (!newUnitName) {
                showNotification('Digite o nome da nova unidade!', 'error');
                return;
            }

            if (unidades.includes(newUnitName)) {
                showNotification('Esta unidade j√° existe!', 'error');
                return;
            }

            unidades.push(newUnitName);
            
            // Inicializar meta para a nova unidade
            const currentMonth = new Date().toISOString().substring(0, 7);
            if (!metas[currentMonth]) {
                metas[currentMonth] = {};
            }
            metas[currentMonth][newUnitName] = {
                matriculas: 30,
                faturamento: 30000
            };

            logAuditEvent('config', `Nova unidade criada: ${newUnitName}`);
            saveDataToLocal();
            if (GOOGLE_APPS_SCRIPT_URL) forceSync();

            updateUnitsConfig();
            updateUserSelects();
            updateRelatorioUnidades();
            setupUnitFilter();
            
            showNotification(`‚úÖ Unidade "${newUnitName}" adicionada com sucesso!`, 'success');
            document.getElementById('newUnitName').value = '';
        }

        function removeUnit(unitName) {
            if (currentUser.role !== 'admin') {
                showNotification('‚ùå Apenas administradores podem remover unidades!', 'error');
                return;
            }

            if (unidades.length <= 1) {
                showNotification('‚ùå N√£o √© poss√≠vel remover todas as unidades!', 'error');
                return;
            }

            // Verificar se h√° usu√°rios nesta unidade
            const usersInUnit = Object.values(users).filter(u => u.unit === unitName);
            if (usersInUnit.length > 0) {
                showNotification(`‚ùå N√£o √© poss√≠vel remover esta unidade pois h√° ${usersInUnit.length} usu√°rio(s) vinculado(s) a ela!`, 'error');
                return;
            }

            if (confirm(`Tem certeza que deseja remover a unidade "${unitName}"?`)) {
                unidades = unidades.filter(u => u !== unitName);
                
                // Remover metas da unidade
                Object.keys(metas).forEach(month => {
                    if (metas[month][unitName]) {
                        delete metas[month][unitName];
                    }
                });

                logAuditEvent('config', `Unidade removida: ${unitName}`);
                saveDataToLocal();
                if (GOOGLE_APPS_SCRIPT_URL) forceSync();

                updateUnitsConfig();
                updateUserSelects();
                updateRelatorioUnidades();
                setupUnitFilter();
                
                showNotification(`‚úÖ Unidade "${unitName}" removida com sucesso!`, 'success');
            }
        }

        function updateUnitsConfig() {
            // Atualizar lista de unidades no admin
            const unitsList = document.getElementById('unitsList');
            if (unitsList) {
                let html = '';
                unidades.forEach(unit => {
                    const userCount = Object.values(users).filter(u => u.unit === unit).length;
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-primary); border-radius: 8px; margin-bottom: 8px;">
                            <div>
                                <strong>${unit}</strong>
                                <div style="font-size: 12px; color: #666;">${userCount} usu√°rio(s)</div>
                            </div>
                            <button class="btn btn-danger btn-sm" onclick="removeUnit('${unit}')" ${unidades.length <= 1 ? 'disabled' : ''}>
                                üóëÔ∏è Remover
                            </button>
                        </div>
                    `;
                });
                unitsList.innerHTML = html;
            }

            // Atualizar select de unidades para novos usu√°rios
            const newUserUnit = document.getElementById('newUserUnit');
            if (newUserUnit) {
                newUserUnit.innerHTML = '';
                unidades.forEach(unit => {
                    newUserUnit.innerHTML += `<option value="${unit}">${unit}</option>`;
                });
            }

            // Atualizar configura√ß√£o de metas
            updateMetasConfigDisplay();
        }

        function updateMetasConfigDisplay() {
            const metasConfig = document.getElementById('metasConfig');
            if (!metasConfig) return;

            const currentMonth = new Date().toISOString().substring(0, 7);
            const metasDoMes = metas[currentMonth] || {};

            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">';

            unidades.forEach(unit => {
                const metaUnit = metasDoMes[unit] || {};
                const unitId = unit.replace(/\s+/g, '').replace(/[^a-zA-Z0-9]/g, '');
                
                html += `
                    <div>
                        <h4>${unit}</h4>
                        <div class="form-group">
                            <label>Meta de Matr√≠culas/M√™s:</label>
                            <input type="number" id="metaMatriculas${unitId}" min="1" placeholder="Ex: 50" value="${metaUnit.matriculas || ''}">
                        </div>
                        <div class="form-group">
                            <label>Meta de Faturamento/M√™s (R$):</label>
                            <input type="number" id="metaFaturamento${unitId}" min="0" step="0.01" placeholder="Ex: 50000" value="${metaUnit.faturamento || ''}">
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            metasConfig.innerHTML = html;
        }

        // SISTEMA DE VISITAS APRIMORADO
        function addVisit() {
            const data = document.getElementById('visitDate').value;
            const nome = document.getElementById('visitName').value.trim();
            const telefone = document.getElementById('visitPhone').value.trim();
            const cursoInteresse = document.getElementById('visitCourse').value;
            const atendente = document.getElementById('visitAttendant').value;
            const observacoes = document.getElementById('visitNotes').value.trim();

            if (!data || !nome || !telefone || !cursoInteresse || !atendente) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }

            const atendenteUser = Object.values(users).find(u => u.name === atendente);
            const unidade = atendenteUser ? atendenteUser.unit : currentUser.unit;

            const novaVisita = {
                id: Date.now(),
                data,
                nome,
                telefone,
                cursoInteresse,
                atendente,
                unidade,
                observacoes,
                convertido: false,
                matriculaId: null,
                dataConversao: null,
                criadoPor: currentUser.name,
                dataLancamento: new Date().toISOString()
            };

            visitas.push(novaVisita);
            giveXP(atendente, 10);
            
            logAuditEvent('visita', `Nova visita registrada: ${nome}`, { visitaId: novaVisita.id });
            saveDataToLocal();
            if (GOOGLE_APPS_SCRIPT_URL) forceSync();
            
            updateVisitsDisplay();
            updateMissionProgress();
            checkAchievements();
            showNotification('‚úÖ Visita registrada com sucesso!', 'success');
            clearVisitForm();
        }

        function editVisit(visitId) {
            const visita = visitas.find(v => v.id === visitId);
            if (!visita) {
                showNotification('Visita n√£o encontrada!', 'error');
                return;
            }

            editingVisitId = visitId;
            
            document.getElementById('editVisitDate').value = visita.data;
            document.getElementById('editVisitName').value = visita.nome;
            document.getElementById('editVisitPhone').value = visita.telefone;
            document.getElementById('editVisitCourse').value = visita.cursoInteresse;
            document.getElementById('editVisitNotes').value = visita.observacoes || '';
            
            document.getElementById('editVisitModal').style.display = 'flex';
        }

        function saveEditVisit() {
            if (!editingVisitId) return;
            
            const visita = visitas.find(v => v.id === editingVisitId);
            if (!visita) {
                showNotification('Visita n√£o encontrada!', 'error');
                return;
            }

            const data = document.getElementById('editVisitDate').value;
            const nome = document.getElementById('editVisitName').value.trim();
            const telefone = document.getElementById('editVisitPhone').value.trim();
            const cursoInteresse = document.getElementById('editVisitCourse').value;
            const observacoes = document.getElementById('editVisitNotes').value.trim();

            if (!data || !nome || !telefone || !cursoInteresse) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }

            visita.data = data;
            visita.nome = nome;
            visita.telefone = telefone;
            visita.cursoInteresse = cursoInteresse;
            visita.observacoes = observacoes;
            visita.editadoPor = currentUser.name;
            visita.dataEdicao = new Date().toISOString();

            logAuditEvent('visita', `Visita editada: ${nome}`, { visitaId: visita.id });
            saveDataToLocal();
            if (GOOGLE_APPS_SCRIPT_URL) forceSync();

            updateVisitsDisplay();
            closeEditVisitModal();
            showNotification('‚úÖ Visita editada com sucesso!', 'success');
        }

        function deleteVisit(visitId) {
            const visita = visitas.find(v => v.id === visitId);
            if (!visita) {
                showNotification('Visita n√£o encontrada!', 'error');
                return;
            }

            if (visita.convertido) {
                showNotification('‚ùå N√£o √© poss√≠vel excluir uma visita que j√° foi convertida em matr√≠cula!', 'error');
                return;
            }

            if (confirm(`Tem certeza que deseja excluir a visita de "${visita.nome}"?`)) {
                visitas = visitas.filter(v => v.id !== visitId);
                
                logAuditEvent('visita', `Visita exclu√≠da: ${visita.nome}`, { visitaId: visitId });
                saveDataToLocal();
                if (GOOGLE_APPS_SCRIPT_URL) forceSync();
                
                updateVisitsDisplay();
                showNotification('‚úÖ Visita exclu√≠da com sucesso!', 'success');
            }
        }

        function closeEditVisitModal() {
            document.getElementById('editVisitModal').style.display = 'none';
            editingVisitId = null;
        }

        function clearVisitForm() {
            document.getElementById('visitDate').value = '';
            document.getElementById('visitName').value = '';
            document.getElementById('visitPhone').value = '';
            document.getElementById('visitCourse').value = '';
            document.getElementById('visitNotes').value = '';
            
            if (currentUser.role === 'admin') {
                document.getElementById('visitAttendant').value = '';
            }
        }

        function convertVisitToMatricula() {
            showTab('matriculas');
            showNotification('Preencha os dados da matr√≠cula. Use o campo "Origem do Cliente" para vincular.', 'info');
        }

        function updateVisitsDisplay() {
            updateConversionMetrics();
            updateRecentVisits();
        }

        function updateConversionMetrics() {
            const conversionMetrics = document.getElementById('conversionMetrics');
            if (!conversionMetrics) return;

            const userVisits = getUserVisits();
            const monthVisits = getCurrentMonthData(userVisits, 'data');
            const convertedVisits = monthVisits.filter(v => v.convertido);
            
            const conversionRate = monthVisits.length > 0 ? (convertedVisits.length / monthVisits.length * 100).toFixed(1) : 0;
            
            conversionMetrics.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--text-primary);">${monthVisits.length}</div>
                        <div style="font-size: 12px; color: #666;">Total de Visitas</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #38a169;">${convertedVisits.length}</div>
                        <div style="font-size: 12px; color: #666;">Convertidas</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #ed8936;">${conversionRate}%</div>
                        <div style="font-size: 12px; color: #666;">Taxa de Convers√£o</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #667eea;">${monthVisits.length - convertedVisits.length}</div>
                        <div style="font-size: 12px; color: #666;">Pendentes</div>
                    </div>
                </div>
            `;
        }

        function filterVisits() {
            updateRecentVisits();
        }

        function updateRecentVisits() {
            const recentVisits = document.getElementById('recentVisits');
            if (!recentVisits) return;

            let userVisits = getUserVisits();
            
            // Aplicar filtros
            const periodFilter = document.getElementById('visitPeriodFilter')?.value;
            const attendantFilter = document.getElementById('visitAttendantFilter')?.value;
            const statusFilter = document.getElementById('visitStatusFilter')?.value;
            const searchBox = document.getElementById('visitSearchBox')?.value?.toLowerCase();

            // Filtro de per√≠odo
            if (periodFilter) {
                const now = new Date();
                userVisits = userVisits.filter(v => {
                    const visitDate = new Date(v.data);
                    switch(periodFilter) {
                        case 'today':
                            return visitDate.toDateString() === now.toDateString();
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return visitDate >= weekAgo;
                        case 'month':
                            return visitDate.getMonth() === now.getMonth() && visitDate.getFullYear() === now.getFullYear();
                        default:
                            return true;
                    }
                });
            }

            // Filtro de atendente
            if (attendantFilter) {
                userVisits = userVisits.filter(v => v.atendente === attendantFilter);
            }

            // Filtro de status
            if (statusFilter) {
                if (statusFilter === 'pending') {
                    userVisits = userVisits.filter(v => !v.convertido);
                } else if (statusFilter === 'converted') {
                    userVisits = userVisits.filter(v => v.convertido);
                }
            }

            // Filtro de busca
            if (searchBox) {
                userVisits = userVisits.filter(v => 
                    v.nome.toLowerCase().includes(searchBox) || 
                    v.telefone.toLowerCase().includes(searchBox)
                );
            }

            const sortedVisits = userVisits.sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 50);
            
            let html = '';
            if (sortedVisits.length === 0) {
                html = '<p style="text-align: center; color: #666; padding: 20px;">Nenhuma visita encontrada com os filtros aplicados.</p>';
            } else {
                sortedVisits.forEach(visita => {
                    html += `
                        <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 10px; ${visita.convertido ? 'background: #f0fff4; border-color: #38a169;' : ''}">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                                    <strong>${visita.nome}</strong>
                                    <div style="display: flex; gap: 8px; align-items: center;">
                                        <span style="color: ${visita.convertido ? '#38a169' : '#ed8936'}; font-weight: bold; font-size: 12px;">
                                            ${visita.convertido ? '‚úÖ Convertido' : '‚è≥ Pendente'}
                                        </span>
                                        <div class="action-buttons">
                                            <button class="btn btn-info btn-sm" onclick="editVisit(${visita.id})" title="Editar">
                                                ‚úèÔ∏è
                                            </button>
                                            <button class="btn btn-danger btn-sm" onclick="deleteVisit(${visita.id})" title="Excluir" ${visita.convertido ? 'disabled' : ''}>
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
                                üìÖ ${formatDate(visita.data)} ‚Ä¢ üéì ${visita.cursoInteresse} ‚Ä¢ üë§ ${visita.atendente}
                            </div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
                                üìû ${visita.telefone} ‚Ä¢ üè¢ ${visita.unidade}
                            </div>
                            ${visita.observacoes ? `<div style="font-size: 12px; color: #666; margin-top: 5px;">üí¨ ${visita.observacoes}</div>` : ''}
                            ${visita.convertido && visita.dataConversao ? `<div style="font-size: 11px; color: #38a169; margin-top: 5px;">‚úÖ Convertido em ${formatDate(visita.dataConversao)}</div>` : ''}
                        </div>
                    `;
                });
            }
            
            recentVisits.innerHTML = html;
        }

        // SISTEMA DE MATR√çCULAS APRIMORADO
        function toggleCustomOrigin() {
            const select = document.getElementById('newFromVisit');
            const customGroup = document.getElementById('customOriginGroup');
            
            if (select.value === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
            }
        }

        function addMatricula() {
            const data = document.getElementById('newData').value;
            const nome = document.getElementById('newNome').value.trim();
            const telefone = document.getElementById('newTelefone').value.trim();
            const curso = document.getElementById('newCurso').value;
            const valorTotal = parseFloat(document.getElementById('newValorTotal').value);
            const valorEntrada = parseFloat(document.getElementById('newValorEntrada').value);
            const tipo = document.getElementById('newTipo').value;
            const parcelas = parseInt(document.getElementById('newParcelas').value) || 1;
            const vendedor = document.getElementById('newVendedor').value;
            const gerente = document.getElementById('newGerente').value;
            const assistente = document.getElementById('newAssistente').value;
            const origem = document.getElementById('newFromVisit').value;
            const customOrigin = document.getElementById('customOriginText').value.trim();

            if (!data || !nome || !curso || !valorTotal || !valorEntrada || !vendedor || !gerente || !assistente) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }

            if (origem === 'custom' && !customOrigin) {
                showNotification('Especifique a origem personalizada!', 'error');
                return;
            }

            const gerenteUser = Object.values(users).find(u => u.name === gerente);
            const unidade = gerenteUser ? gerenteUser.unit : unidades[0] || 'Shopping Conjunto Nacional';

            let origemFinal = '';
            if (origem === 'custom') {
                origemFinal = customOrigin;
            } else if (origem) {
                const origemLabels = {
                    'porta': 'Cliente Porta',
                    'street': 'Street Marketing',
                    'agendamento': 'Agendamento',
                    'evento': 'Evento'
                };
                origemFinal = origemLabels[origem] || origem;
            } else {
                origemFinal = 'Cliente Direto';
            }

            const novaMatricula = {
                id: Date.now(),
                data,
                nome,
                telefone,
                curso,
                valorTotal,
                valorEntrada,
                tipo,
                parcelas,
                vendedor,
                gerente,
                assistente,
                unidade,
                origem: origemFinal,
                statusPagamento: 'Pago',
                cancelado: false,
                fromVisit: null,
                criadoPor: currentUser.name,
                dataLancamento: new Date().toISOString()
            };

            matriculas.push(novaMatricula);

            // Dar XP para os envolvidos
            giveXP(vendedor, 50);
            giveXP(gerente, 30);
            giveXP(assistente, 20);

            logAuditEvent('matricula', `Nova matr√≠cula registrada: ${nome}`, { matriculaId: novaMatricula.id });
            saveDataToLocal();
            if (GOOGLE_APPS_SCRIPT_URL) forceSync();
            
            setupDashboard();
            updateMissionProgress();
            checkAchievements();
            updateMatriculasList();
            showNotification('‚úÖ Matr√≠cula adicionada com sucesso!', 'success');
            clearMatriculaForm();
        }

        function filterMatriculas() {
            updateMatriculasList();
        }

        function updateMatriculasList() {
            const matriculasList = document.getElementById('matriculasList');
            if (!matriculasList) return;

            let userMatriculas = getUserMatriculas();
            
            // Aplicar filtros
            const periodFilter = document.getElementById('matriculaPeriodFilter')?.value;
            const vendedorFilter = document.getElementById('matriculaVendedorFilter')?.value;
            const cursoFilter = document.getElementById('matriculaCursoFilter')?.value;
            const searchBox = document.getElementById('matriculaSearchBox')?.value?.toLowerCase();

            // Filtro de per√≠odo
            if (periodFilter) {
                const now = new Date();
                userMatriculas = userMatriculas.filter(m => {
                    const matriculaDate = new Date(m.data);
                    switch(periodFilter) {
                        case 'today':
                            return matriculaDate.toDateString() === now.toDateString();
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return matriculaDate >= weekAgo;
                        case 'month':
                            return matriculaDate.getMonth() === now.getMonth() && matriculaDate.getFullYear() === now.getFullYear();
                        default:
                            return true;
                    }
                });
            }

            // Filtro de vendedor
            if (vendedorFilter) {
                userMatriculas = userMatriculas.filter(m => m.vendedor === vendedorFilter);
            }

            // Filtro de curso
            if (cursoFilter) {
                userMatriculas = userMatriculas.filter(m => m.curso === cursoFilter);
            }

            // Filtro de busca
            if (searchBox) {
                userMatriculas = userMatriculas.filter(m => 
                    m.nome.toLowerCase().includes(searchBox)
                );
            }

            const recentMatriculas = userMatriculas.sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 30);

            let html = '';
            if (recentMatriculas.length === 0) {
                html = '<p style="text-align: center; color: #666; padding: 20px;">Nenhuma matr√≠cula encontrada com os filtros aplicados.</p>';
            } else {
                recentMatriculas.forEach(matricula => {
                    html += `
                        <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 10px; ${matricula.cancelado ? 'background: #fed7d7; border-color: #e53e3e;' : 'background: #f0fff4; border-color: #38a169;'}">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <strong>${matricula.nome}</strong>
                                <div class="action-buttons">
                                    <button class="btn btn-info btn-sm" onclick="editMatricula(${matricula.id})" title="Editar">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteMatricula(${matricula.id})" title="Excluir">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
                                üìÖ ${formatDate(matricula.data)} ‚Ä¢ üéì ${matricula.curso} ‚Ä¢ üí∞ ${formatCurrency(matricula.valorEntrada)}
                            </div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
                                üë§ ${matricula.vendedor} ‚Ä¢ üëî ${matricula.gerente} ‚Ä¢ üë©‚Äçüíª ${matricula.assistente}
                            </div>
                            <div style="font-size: 12px; color: #666;">
                                üè¢ ${matricula.unidade} ‚Ä¢ üìä ${matricula.tipo} ‚Ä¢ üéØ ${matricula.origem}
                            </div>
                            ${matricula.cancelado ? '<div style="font-size: 11px; color: #e53e3e; margin-top: 5px;">‚ùå Matr√≠cula Cancelada</div>' : ''}
                        </div>
                    `;
                });
            }

            matriculasList.innerHTML = html;
        }

        function editMatricula(matriculaId) {
            const matricula = matriculas.find(m => m.id === matriculaId);
            if (!matricula) {
                showNotification('Matr√≠cula n√£o encontrada!', 'error');
                return;
            }

            // Preencher formul√°rio com dados da matr√≠cula
            document.getElementById('newData').value = matricula.data;
            document.getElementById('newNome').value = matricula.nome;
            document.getElementById('newTelefone').value = matricula.telefone || '';
            document.getElementById('newCurso').value = matricula.curso;
            document.getElementById('newValorTotal').value = matricula.valorTotal;
            document.getElementById('newValorEntrada').value = matricula.valorEntrada;
            document.getElementById('newTipo').value = matricula.tipo;
            document.getElementById('newParcelas').value = matricula.parcelas || '';
            document.getElementById('newVendedor').value = matricula.vendedor;
            document.getElementById('newGerente').value = matricula.gerente;
            document.getElementById('newAssistente').value = matricula.assistente;

            // Remover a matr√≠cula original para que seja substitu√≠da
            matriculas = matriculas.filter(m => m.id !== matriculaId);
            
            showNotification('üìù Matr√≠cula carregada para edi√ß√£o. Fa√ßa as altera√ß√µes e clique em "Adicionar Matr√≠cula".', 'info');
            
            // Scroll para o formul√°rio
            document.querySelector('#matriculas .stat-card').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteMatricula(matriculaId) {
            const matricula = matriculas.find(m => m.id === matriculaId);
            if (!matricula) {
                showNotification('Matr√≠cula n√£o encontrada!', 'error');
                return;
            }

            if (confirm(`Tem certeza que deseja excluir a matr√≠cula de "${matricula.nome}"?`)) {
                matriculas = matriculas.filter(m => m.id !== matriculaId);
                
                // Se foi convertida de uma visita, desmarcar a convers√£o
                const visitaRelacionada = visitas.find(v => v.matriculaId === matriculaId);
                if (visitaRelacionada) {
                    visitaRelacionada.convertido = false;
                    visitaRelacionada.matriculaId = null;
                    visitaRelacionada.dataConversao = null;
                }
                
                logAuditEvent('matricula', `Matr√≠cula exclu√≠da: ${matricula.nome}`, { matriculaId });
                saveDataToLocal();
                if (GOOGLE_APPS_SCRIPT_URL) forceSync();
                
                setupDashboard();
                updateMatriculasList();
                updateVisitsDisplay();
                showNotification('‚úÖ Matr√≠cula exclu√≠da com sucesso!', 'success');
            }
        }

        function clearMatriculaForm() {
            document.getElementById('newData').value = '';
            document.getElementById('newNome').value = '';
            document.getElementById('newTelefone').value = '';
            document.getElementById('newCurso').value = '';
            document.getElementById('newValorTotal').value = '';
            document.getElementById('newValorEntrada').value = '';
            document.getElementById('newTipo').value = 'Convencional';
            document.getElementById('newParcelas').value = '';
            document.getElementById('newFromVisit').value = '';
            document.getElementById('customOriginText').value = '';
            document.getElementById('customOriginGroup').style.display = 'none';
            
            if (currentUser.role === 'admin') {
                document.getElementById('newVendedor').value = '';
                document.getElementById('newGerente').value = '';
                document.getElementById('newAssistente').value = '';
            }
        }

        // SISTEMA DE MATR√çCULA R√ÅPIDA
        function quickAddMatricula() {
            document.getElementById('quickMatriculaModal').style.display = 'flex';
            setCurrentDate();
        }

        function closeQuickMatriculaModal() {
            document.getElementById('quickMatriculaModal').style.display = 'none';
        }

        function saveQuickMatricula() {
            const nome = document.getElementById('quickNome').value.trim();
            const curso = document.getElementById('quickCurso').value;
            const valor = parseFloat(document.getElementById('quickValor').value);

            if (!nome || !curso || !valor) {
                showNotification('Preencha todos os campos!', 'error');
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const novaMatricula = {
                id: Date.now(),
                data: today,
                nome: nome,
                telefone: '',
                curso: curso,
                valorTotal: valor * 10, // Assumindo que entrada √© 10% do total
                valorEntrada: valor,
                tipo: 'Convencional',
                parcelas: 1,
                vendedor: currentUser.name,
                gerente: currentUser.role === 'gerente' ? currentUser.name : 'A definir',
                assistente: 'A definir',
                unidade: currentUser.unit,
                origem: 'Matr√≠cula R√°pida',
                statusPagamento: 'Pago',
                cancelado: false,
                fromVisit: null,
                criadoPor: currentUser.name,
                dataLancamento: new Date().toISOString()
            };

            matriculas.push(novaMatricula);
            giveXP(currentUser.name, 50);

            logAuditEvent('matricula', `Matr√≠cula r√°pida registrada: ${nome}`, { matriculaId: novaMatricula.id });
            saveDataToLocal();
            if (GOOGLE_APPS_SCRIPT_URL) forceSync();

            setupDashboard();
            updateMissionProgress();
            checkAchievements();

            // Limpar formul√°rio
            document.getElementById('quickNome').value = '';
            document.getElementById('quickValor').value = '';

            closeQuickMatriculaModal();
            showNotification('‚ö° Matr√≠cula r√°pida adicionada com sucesso!', 'success');
        }

        // SISTEMA DE EXPORTA√á√ÉO
        function exportVisits(format) {
            const userVisits = getUserVisits();
            const data = userVisits.map(v => ({
                'Data': formatDate(v.data),
                'Nome': v.nome,
                'Telefone': v.telefone,
                'Curso': v.cursoInteresse,
                'Atendente': v.atendente,
                'Unidade': v.unidade,
                'Status': v.convertido ? 'Convertido' : 'Pendente',
                'Observa√ß√µes': v.observacoes || ''
            }));

            if (format === 'csv') {
                exportToCSV(data, 'visitas');
            } else if (format === 'excel') {
                exportToExcel(data, 'visitas');
            }
        }

        function exportMatriculas(format) {
            const userMatriculas = getUserMatriculas();
            const data = userMatriculas.map(m => ({
                'Data': formatDate(m.data),
                'Nome': m.nome,
                'Curso': m.curso,
                'Valor Total': m.valorTotal,
                'Valor Entrada': m.valorEntrada,
                'Tipo': m.tipo,
                'Vendedor': m.vendedor,
                'Gerente': m.gerente,
                'Assistente': m.assistente,
                'Unidade': m.unidade,
                'Origem': m.origem
            }));

            if (format === 'csv') {
                exportToCSV(data, 'matriculas');
            } else if (format === 'excel') {
                exportToExcel(data, 'matriculas');
            }
        }

        function exportToCSV(data, filename) {
            if (data.length === 0) {
                showNotification('‚ùå Nenhum dado para exportar!', 'error');
                return;
            }

            const headers = Object.keys(data[0]);
            let csvContent = headers.join(',') + '\n';

            data.forEach(row => {
                const values = headers.map(header => {
                    const value = row[header] || '';
                    return `"${value.toString().replace(/"/g, '""')}"`;
                });
                csvContent += values.join(',') + '\n';
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification(`üìÑ Arquivo CSV de ${filename} baixado com sucesso!`, 'success');
        }

        function exportToExcel(data, filename) {
            if (data.length === 0) {
                showNotification('‚ùå Nenhum dado para exportar!', 'error');
                return;
            }

            // Simula√ß√£o de export Excel (na verdade ser√° CSV)
            exportToCSV(data, filename + '-excel');
            showNotification(`üìä Arquivo Excel de ${filename} baixado com sucesso!`, 'success');
        }

        // SISTEMA DE RELAT√ìRIOS APRIMORADO
        function updateRelatorioUnidades() {
            const relatorioUnidade = document.getElementById('relatorioUnidade');
            if (!relatorioUnidade) return;

            relatorioUnidade.innerHTML = '<option value="">Todas</option>';
            unidades.forEach(unit => {
                relatorioUnidade.innerHTML += `<option value="${unit}">${unit}</option>`;
            });
        }

        function printReport() {
            window.print();
        }

        function gerarRelatorioComissoes() {
            const mes = document.getElementById('relatorioMes').value;
            const unidade = document.getElementById('relatorioUnidade').value;
            const colaborador = document.getElementById('relatorioColaborador').value;
            
            if (!mes) {
                showNotification('Selecione o m√™s para o relat√≥rio!', 'error');
                return;
            }

            showLoadingMessage('Gerando relat√≥rio de comiss√µes...');
            
            setTimeout(() => {
                hideLoadingMessage();
                
                const [year, month] = mes.split('-');
                const filteredData = matriculas.filter(m => {
                    const matriculaDate = new Date(m.data);
                    const mesMatch = matriculaDate.getFullYear() == year && matriculaDate.getMonth() == month - 1;
                    const unidadeMatch = !unidade || m.unidade === unidade;
                    const colaboradorMatch = !colaborador || m.vendedor === colaborador || m.gerente === colaborador || m.assistente === colaborador;
                    return mesMatch && unidadeMatch && colaboradorMatch && !m.cancelado;
                });

                const comissoes = {};
                
                filteredData.forEach(m => {
                    [m.vendedor, m.gerente, m.assistente].forEach((nome, index) => {
                        if (!nome) return;
                        
                        const user = Object.values(users).find(u => u.name === nome);
                        if (!user) return;
                        
                        if (!comissoes[nome]) {
                            comissoes[nome] = {
                                nome,
                                role: user.role,
                                unidade: user.unit,
                                matriculas: 0,
                                comissao: 0
                            };
                        }
                        
                        comissoes[nome].matriculas++;
                        
                        if (user.role === 'vendedor' && comissoes[nome].matriculas >= 10) {
                            comissoes[nome].comissao = comissoes[nome].matriculas * getCommissionByBand(comissoes[nome].matriculas, COMISSAO_VENDEDOR);
                        } else if (user.role === 'assistente' && comissoes[nome].matriculas >= 10) {
                            comissoes[nome].comissao = comissoes[nome].matriculas * getCommissionByBand(comissoes[nome].matriculas, COMISSAO_ASSISTENTE);
                        } else if (user.role === 'gerente') {
                            const unitMatriculas = filteredData.filter(m => m.unidade === user.unit).length;
                            if (unitMatriculas >= 26) {
                                comissoes[nome].comissao = unitMatriculas * getCommissionByBand(unitMatriculas, COMISSAO_GERENTE);
                            }
                        }
                    });
                });

                const relatorioResultado = document.getElementById('relatorioResultado');
                let html = `
                    <div class="stat-card" style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>üí∞ Relat√≥rio de Comiss√µes - ${new Date(year, month-1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}</h3>
                            <button class="btn btn-primary" onclick="printReport()">üñ®Ô∏è Imprimir</button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>üë§ Nome</th>
                                    <th>üíº Cargo</th>
                                    <th>üè¢ Unidade</th>
                                    <th>üìä Matr√≠culas</th>
                                    <th>üí∞ Comiss√£o</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                Object.values(comissoes).forEach(pessoa => {
                    html += `
                        <tr>
                            <td>${pessoa.nome}</td>
                            <td><span class="role-badge role-${pessoa.role}">${pessoa.role}</span></td>
                            <td>${pessoa.unidade}</td>
                            <td style="text-align: center;">${pessoa.matriculas}</td>
                            <td style="text-align: right; font-weight: bold;">${formatCurrency(pessoa.comissao)}</td>
                        </tr>
                    `;
                });

                const totalComissoes = Object.values(comissoes).reduce((total, p) => total + p.comissao, 0);

                html += `
                            </tbody>
                            <tfoot>
                                <tr style="background: var(--bg-primary); font-weight: bold;">
                                    <td colspan="4">TOTAL</td>
                                    <td style="text-align: right; color: #38a169;">${formatCurrency(totalComissoes)}</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                `;

                relatorioResultado.innerHTML = html;
                showNotification('‚úÖ Relat√≥rio de comiss√µes gerado!', 'success');
            }, 1500);
        }

        function gerarRelatorioConversao() {
            const mes = document.getElementById('relatorioMes').value;
            const unidade = document.getElementById('relatorioUnidade').value;
            const colaborador = document.getElementById('relatorioColaborador').value;
            
            if (!mes) {
                showNotification('Selecione o m√™s para o relat√≥rio!', 'error');
                return;
            }

            showLoadingMessage('Gerando relat√≥rio de convers√£o...');
            
            setTimeout(() => {
                hideLoadingMessage();
                
                const [year, month] = mes.split('-');
                
                const filteredVisitas = visitas.filter(v => {
                    const visitaDate = new Date(v.data);
                    const mesMatch = visitaDate.getFullYear() == year && visitaDate.getMonth() == month - 1;
                    const unidadeMatch = !unidade || v.unidade === unidade;
                    const colaboradorMatch = !colaborador || v.atendente === colaborador;
                    return mesMatch && unidadeMatch && colaboradorMatch;
                });

                const conversaoData = {};
                
                filteredVisitas.forEach(v => {
                    if (!conversaoData[v.atendente]) {
                        conversaoData[v.atendente] = {
                            nome: v.atendente,
                            unidade: v.unidade,
                            visitas: 0,
                            conversoes: 0
                        };
                    }
                    conversaoData[v.atendente].visitas++;
                    if (v.convertido) {
                        conversaoData[v.atendente].conversoes++;
                    }
                });

                const relatorioResultado = document.getElementById('relatorioResultado');
                let html = `
                    <div class="stat-card" style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>üìà Relat√≥rio de Convers√£o - ${new Date(year, month-1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}</h3>
                            <button class="btn btn-primary" onclick="printReport()">üñ®Ô∏è Imprimir</button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>üë§ Atendente</th>
                                    <th>üè¢ Unidade</th>
                                    <th>üë• Visitas</th>
                                    <th>‚úÖ Convers√µes</th>
                                    <th>üìà Taxa</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                Object.values(conversaoData).forEach(pessoa => {
                    const taxa = pessoa.visitas > 0 ? (pessoa.conversoes / pessoa.visitas * 100).toFixed(1) : 0;
                    html += `
                        <tr>
                            <td>${pessoa.nome}</td>
                            <td>${pessoa.unidade}</td>
                            <td style="text-align: center;">${pessoa.visitas}</td>
                            <td style="text-align: center;">${pessoa.conversoes}</td>
                            <td style="text-align: center; font-weight: bold; color: ${taxa >= 50 ? '#38a169' : '#e53e3e'};">${taxa}%</td>
                        </tr>
                    `;
                });

                const totalVisitas = Object.values(conversaoData).reduce((total, p) => total + p.visitas, 0);
                const totalConversoes = Object.values(conversaoData).reduce((total, p) => total + p.conversoes, 0);
                const taxaGeral = totalVisitas > 0 ? (totalConversoes / totalVisitas * 100).toFixed(1) : 0;

                html += `
                            </tbody>
                            <tfoot>
                                <tr style="background: var(--bg-primary); font-weight: bold;">
                                    <td colspan="2">TOTAL GERAL</td>
                                    <td style="text-align: center;">${totalVisitas}</td>
                                    <td style="text-align: center;">${totalConversoes}</td>
                                    <td style="text-align: center; color: #38a169;">${taxaGeral}%</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                `;

                relatorioResultado.innerHTML = html;
                showNotification('‚úÖ Relat√≥rio de convers√£o gerado!', 'success');
            }, 1500);
        }

        function gerarRelatorioUnidade() {
            const mes = document.getElementById('relatorioMes').value;
            
            if (!mes) {
                showNotification('Selecione o m√™s para o relat√≥rio!', 'error');
                return;
            }

            showLoadingMessage('Gerando relat√≥rio por unidade...');
            
            setTimeout(() => {
                hideLoadingMessage();
                
                const [year, month] = mes.split('-');
                const monthName = new Date(year, month-1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                
                const dadosUnidades = {};

                unidades.forEach(unidade => {
                    const matriculasUnidade = matriculas.filter(m => {
                        const matriculaDate = new Date(m.data);
                        return matriculaDate.getFullYear() == year && 
                               matriculaDate.getMonth() == month - 1 && 
                               m.unidade === unidade && 
                               !m.cancelado;
                    });

                    const visitasUnidade = visitas.filter(v => {
                        const visitaDate = new Date(v.data);
                        return visitaDate.getFullYear() == year && 
                               visitaDate.getMonth() == month - 1 && 
                               v.unidade === unidade;
                    });

                    const colaboradoresUnidade = Object.values(users).filter(u => 
                        u.unit === unidade && u.role !== 'admin'
                    ).length;

                    const faturamento = matriculasUnidade.reduce((total, m) => total + (m.valorEntrada || 0), 0);
                    const conversoes = visitasUnidade.filter(v => v.convertido).length;
                    const taxaConversao = visitasUnidade.length > 0 ? (conversoes / visitasUnidade.length * 100).toFixed(1) : 0;

                    const convencional = matriculasUnidade.filter(m => m.tipo === 'Convencional').length;
                    const blackin = matriculasUnidade.filter(m => m.tipo === 'Blackin').length;
                    const black = matriculasUnidade.filter(m => m.tipo === 'Black').length;

                    dadosUnidades[unidade] = {
                        nome: unidade,
                        colaboradores: colaboradoresUnidade,
                        visitas: visitasUnidade.length,
                        matriculas: matriculasUnidade.length,
                        conversao: taxaConversao,
                        faturamento: faturamento,
                        convencional: convencional,
                        blackin: blackin,
                        black: black
                    };
                });

                const relatorioResultado = document.getElementById('relatorioResultado');
                let html = `
                    <div class="stat-card" style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>üè¢ Relat√≥rio por Unidade - ${monthName}</h3>
                            <button class="btn btn-primary" onclick="printReport()">üñ®Ô∏è Imprimir</button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>üè¢ Unidade</th>
                                    <th>üë®‚Äçüíº Colaboradores</th>
                                    <th>üë• Visitas</th>
                                    <th>üìä Matr√≠culas</th>
                                    <th>üìà Convers√£o</th>
                                    <th>üí∞ Faturamento</th>
                                    <th>üìã Convencional</th>
                                    <th>üñ§ Blackin</th>
                                    <th>‚ö´ Black</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                let totals = {
                    colaboradores: 0,
                    visitas: 0,
                    matriculas: 0,
                    faturamento: 0,
                    convencional: 0,
                    blackin: 0,
                    black: 0
                };

                Object.values(dadosUnidades).forEach(unidade => {
                    totals.colaboradores += unidade.colaboradores;
                    totals.visitas += unidade.visitas;
                    totals.matriculas += unidade.matriculas;
                    totals.faturamento += unidade.faturamento;
                    totals.convencional += unidade.convencional;
                    totals.blackin += unidade.blackin;
                    totals.black += unidade.black;

                    html += `
                        <tr>
                            <td style="font-weight: bold;">${unidade.nome}</td>
                            <td style="text-align: center;">${unidade.colaboradores}</td>
                            <td style="text-align: center;">${unidade.visitas}</td>
                            <td style="text-align: center;">${unidade.matriculas}</td>
                            <td style="text-align: center; font-weight: bold; color: ${unidade.conversao >= 50 ? '#38a169' : '#e53e3e'};">${unidade.conversao}%</td>
                            <td style="text-align: right; font-weight: bold;">${formatCurrency(unidade.faturamento)}</td>
                            <td style="text-align: center;">${unidade.convencional}</td>
                            <td style="text-align: center;">${unidade.blackin}</td>
                            <td style="text-align: center;">${unidade.black}</td>
                        </tr>
                    `;
                });

                const conversaoTotal = totals.visitas > 0 ? ((totals.matriculas / totals.visitas) * 100).toFixed(1) : 0;

                html += `
                            </tbody>
                            <tfoot>
                                <tr style="background: var(--bg-primary); font-weight: bold;">
                                    <td>TOTAL GERAL</td>
                                    <td style="text-align: center;">${totals.colaboradores}</td>
                                    <td style="text-align: center;">${totals.visitas}</td>
                                    <td style="text-align: center;">${totals.matriculas}</td>
                                    <td style="text-align: center; color: #38a169;">${conversaoTotal}%</td>
                                    <td style="text-align: right; color: #38a169;">${formatCurrency(totals.faturamento)}</td>
                                    <td style="text-align: center;">${totals.convencional}</td>
                                    <td style="text-align: center;">${totals.blackin}</td>
                                    <td style="text-align: center;">${totals.black}</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                `;

                relatorioResultado.innerHTML = html;
                showNotification('‚úÖ Relat√≥rio por unidade gerado!', 'success');
            }, 1500);
        }

        function gerarRelatorioMetas() {
            const mes = document.getElementById('relatorioMes').value;
            
            if (!mes) {
                showNotification('Selecione o m√™s para o relat√≥rio!', 'error');
                return;
            }

            showLoadingMessage('Gerando relat√≥rio de metas...');
            
            setTimeout(() => {
                hideLoadingMessage();
                
                const [year, month] = mes.split('-');
                const metasDoMes = metas[mes] || {};
                
                const dadosComparacao = [];

                unidades.forEach(unidade => {
                    const matriculasUnidade = matriculas.filter(m => {
                        const matriculaDate = new Date(m.data);
                        return matriculaDate.getFullYear() == year && 
                               matriculaDate.getMonth() == month - 1 && 
                               m.unidade === unidade && 
                               !m.cancelado;
                    });

                    const faturamento = matriculasUnidade.reduce((total, m) => total + (m.valorEntrada || 0), 0);
                    const metaUnidade = metasDoMes[unidade] || {};

                    const progressMatriculas = metaUnidade.matriculas ? (matriculasUnidade.length / metaUnidade.matriculas * 100) : 0;
                    const progressFaturamento = metaUnidade.faturamento ? (faturamento / metaUnidade.faturamento * 100) : 0;

                    dadosComparacao.push({
                        unidade,
                        matriculasReal: matriculasUnidade.length,
                        matriculasMeta: metaUnidade.matriculas || 0,
                        progressMatriculas,
                        faturamentoReal: faturamento,
                        faturamentoMeta: metaUnidade.faturamento || 0,
                        progressFaturamento
                    });
                });

                const relatorioResultado = document.getElementById('relatorioResultado');
                let html = `
                    <div class="stat-card" style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>üéØ Relat√≥rio Metas vs Realizado - ${new Date(year, month-1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}</h3>
                            <button class="btn btn-primary" onclick="printReport()">üñ®Ô∏è Imprimir</button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>üè¢ Unidade</th>
                                    <th>üìä Matr√≠culas Real</th>
                                    <th>üéØ Meta Matr√≠culas</th>
                                    <th>üìà Progress %</th>
                                    <th>üí∞ Faturamento Real</th>
                                    <th>üéØ Meta Faturamento</th>
                                    <th>üìà Progress %</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                dadosComparacao.forEach(unidade => {
                    const statusMatriculas = unidade.progressMatriculas >= 100 ? '‚úÖ' : unidade.progressMatriculas >= 80 ? '‚ö†Ô∏è' : '‚ùå';
                    const statusFaturamento = unidade.progressFaturamento >= 100 ? '‚úÖ' : unidade.progressFaturamento >= 80 ? '‚ö†Ô∏è' : '‚ùå';
                    const corMatriculas = unidade.progressMatriculas >= 100 ? '#38a169' : unidade.progressMatriculas >= 80 ? '#ed8936' : '#e53e3e';
                    const corFaturamento = unidade.progressFaturamento >= 100 ? '#38a169' : unidade.progressFaturamento >= 80 ? '#ed8936' : '#e53e3e';

                    html += `
                        <tr>
                            <td style="font-weight: bold;">${unidade.unidade}</td>
                            <td style="text-align: center; font-weight: bold;">${unidade.matriculasReal}</td>
                            <td style="text-align: center;">${unidade.matriculasMeta}</td>
                            <td style="text-align: center;">
                                <span style="color: ${corMatriculas}; font-weight: bold;">
                                    ${statusMatriculas} ${unidade.progressMatriculas.toFixed(1)}%
                                </span>
                            </td>
                            <td style="text-align: right; font-weight: bold;">${formatCurrency(unidade.faturamentoReal)}</td>
                            <td style="text-align: right;">${formatCurrency(unidade.faturamentoMeta)}</td>
                            <td style="text-align: center;">
                                <span style="color: ${corFaturamento}; font-weight: bold;">
                                    ${statusFaturamento} ${unidade.progressFaturamento.toFixed(1)}%
                                </span>
                            </td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                `;

                relatorioResultado.innerHTML = html;
                showNotification('‚úÖ Relat√≥rio de metas gerado!', 'success');
            }, 1500);
        }

        function gerarRelatorioTendencias() {
            showLoadingMessage('Analisando tend√™ncias...');
            
            setTimeout(() => {
                hideLoadingMessage();
                
                const last6Months = [];
                for (let i = 5; i >= 0; i--) {
                    const date = new Date();
                    date.setMonth(date.getMonth() - i);
                    last6Months.push({
                        month: date.getMonth(),
                        year: date.getFullYear(),
                        label: date.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' })
                    });
                }

                const tendenciasData = last6Months.map(period => {
                    const periodMatriculas = matriculas.filter(m => {
                        const date = new Date(m.data);
                        return date.getMonth() === period.month && 
                               date.getFullYear() === period.year && 
                               !m.cancelado;
                    });

                    const periodVisitas = visitas.filter(v => {
                        const date = new Date(v.data);
                        return date.getMonth() === period.month && 
                               date.getFullYear() === period.year;
                    });

                    return {
                        periodo: period.label,
                        matriculas: periodMatriculas.length,
                        visitas: periodVisitas.length,
                        conversao: periodVisitas.length > 0 ? (periodMatriculas.length / periodVisitas.length * 100).toFixed(1) : 0,
                        faturamento: periodMatriculas.reduce((total, m) => total + (m.valorEntrada || 0), 0)
                    };
                });

                const relatorioResultado = document.getElementById('relatorioResultado');
                let html = `
                    <div class="stat-card" style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>üìà An√°lise de Tend√™ncias - √öltimos 6 Meses</h3>
                            <button class="btn btn-primary" onclick="printReport()">üñ®Ô∏è Imprimir</button>
                        </div>
                        
                        <div style="margin-bottom: 30px;">
                            <h4>üìä Resumo das Tend√™ncias:</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                `;

                // Calcular crescimento
                const firstMonth = tendenciasData[0];
                const lastMonth = tendenciasData[tendenciasData.length - 1];
                const crescimentoMatriculas = firstMonth.matriculas > 0 ? ((lastMonth.matriculas - firstMonth.matriculas) / firstMonth.matriculas * 100).toFixed(1) : 0;
                const crescimentoVisitas = firstMonth.visitas > 0 ? ((lastMonth.visitas - firstMonth.visitas) / firstMonth.visitas * 100).toFixed(1) : 0;

                html += `
                                <div style="text-align: center; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                                    <div style="font-size: 20px; font-weight: bold; color: ${crescimentoMatriculas >= 0 ? '#38a169' : '#e53e3e'};">${crescimentoMatriculas >= 0 ? '+' : ''}${crescimentoMatriculas}%</div>
                                    <div style="font-size: 12px; color: #666;">Crescimento Matr√≠culas</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                                    <div style="font-size: 20px; font-weight: bold; color: ${crescimentoVisitas >= 0 ? '#38a169' : '#e53e3e'};">${crescimentoVisitas >= 0 ? '+' : ''}${crescimentoVisitas}%</div>
                                    <div style="font-size: 12px; color: #666;">Crescimento Visitas</div>
                                </div>
                            </div>
                        </div>

                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>üìÖ Per√≠odo</th>
                                    <th>üë• Visitas</th>
                                    <th>üìä Matr√≠culas</th>
                                    <th>üìà Convers√£o</th>
                                    <th>üí∞ Faturamento</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                tendenciasData.forEach(period => {
                    html += `
                        <tr>
                            <td style="font-weight: bold;">${period.periodo}</td>
                            <td style="text-align: center;">${period.visitas}</td>
                            <td style="text-align: center;">${period.matriculas}</td>
                            <td style="text-align: center; font-weight: bold; color: ${period.conversao >= 50 ? '#38a169' : '#e53e3e'};">${period.conversao}%</td>
                            <td style="text-align: right; font-weight: bold;">${formatCurrency(period.faturamento)}</td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                `;

                relatorioResultado.innerHTML = html;
                showNotification('‚úÖ An√°lise de tend√™ncias gerada!', 'success');
            }, 2000);
        }

        function gerarRelatorioPrevisao() {
            showLoadingMessage('Calculando previs√µes...');
            
            setTimeout(() => {
                hideLoadingMessage();
                
                const currentMonth = new Date();
                const currentMatriculas = getCurrentMonthData(matriculas);
                const currentVisitas = getCurrentMonthData(visitas, 'data');
                
                // Calcular m√©dia dos √∫ltimos 3 meses
                const last3Months = [];
                for (let i = 1; i <= 3; i++) {
                    const date = new Date();
                    date.setMonth(date.getMonth() - i);
                    
                    const monthMatriculas = matriculas.filter(m => {
                        const matriculaDate = new Date(m.data);
                        return matriculaDate.getMonth() === date.getMonth() && 
                               matriculaDate.getFullYear() === date.getFullYear() && 
                               !m.cancelado;
                    }).length;

                    last3Months.push(monthMatriculas);
                }

                const mediaMatriculas = last3Months.reduce((a, b) => a + b, 0) / last3Months.length;
                const daysInMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0).getDate();
                const currentDay = currentMonth.getDate();
                const progressMonth = currentDay / daysInMonth;
                
                const previsaoAtualMes = Math.round(currentMatriculas.length / progressMonth);
                const previsaoProximoMes = Math.round(mediaMatriculas);

                const relatorioResultado = document.getElementById('relatorioResultado');
                let html = `
                    <div class="stat-card" style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>üîÆ Previs√£o de Vendas</h3>
                            <button class="btn btn-primary" onclick="printReport()">üñ®Ô∏è Imprimir</button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div style="padding: 20px; background: linear-gradient(135deg, #e6fffa, #f0fff4); border-radius: 12px; border: 2px solid #38a169;">
                                <h4>üìä M√™s Atual</h4>
                                <div style="font-size: 24px; font-weight: bold; color: #38a169; margin: 10px 0;">${currentMatriculas.length} / ${previsaoAtualMes}</div>
                                <div style="font-size: 12px; color: #666;">Realizado / Previs√£o</div>
                                <div style="margin-top: 10px;">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${Math.min((currentMatriculas.length / previsaoAtualMes) * 100, 100)}%"></div>
                                    </div>
                                    <div style="font-size: 11px; color: #666; margin-top: 5px;">${(progressMonth * 100).toFixed(1)}% do m√™s decorrido</div>
                                </div>
                            </div>
                            
                            <div style="padding: 20px; background: linear-gradient(135deg, #fef5e7, #fed7c2); border-radius: 12px; border: 2px solid #ed8936;">
                                <h4>üîÆ Pr√≥ximo M√™s</h4>
                                <div style="font-size: 24px; font-weight: bold; color: #ed8936; margin: 10px 0;">${previsaoProximoMes}</div>
                                <div style="font-size: 12px; color: #666;">Previs√£o baseada na m√©dia</div>
                                <div style="font-size: 11px; color: #666; margin-top: 10px;">
                                    Baseado nos √∫ltimos 3 meses: ${last3Months.join(', ')}
                                </div>
                            </div>
                        </div>

                        <div style="background: var(--bg-primary); padding: 20px; border-radius: 12px;">
                            <h4>üìà An√°lise e Recomenda√ß√µes:</h4>
                            <ul style="margin: 15px 0; padding-left: 20px;">
                `;

                // Gerar recomenda√ß√µes baseadas nos dados
                if (currentMatriculas.length < mediaMatriculas * progressMonth) {
                    html += '<li style="color: #e53e3e; margin: 8px 0;">‚ö†Ô∏è <strong>Aten√ß√£o:</strong> Performance abaixo da m√©dia hist√≥rica. Considere intensificar a√ß√µes de vendas.</li>';
                } else {
                    html += '<li style="color: #38a169; margin: 8px 0;">‚úÖ <strong>Parab√©ns:</strong> Performance acima da m√©dia hist√≥rica!</li>';
                }

                const conversionRate = currentVisitas.length > 0 ? (currentMatriculas.length / currentVisitas.length * 100) : 0;
                if (conversionRate < 30) {
                    html += '<li style="color: #ed8936; margin: 8px 0;">üí° <strong>Dica:</strong> Taxa de convers√£o baixa. Foque no treinamento da equipe de vendas.</li>';
                }

                if (currentVisitas.length < 50) {
                    html += '<li style="color: #667eea; margin: 8px 0;">üì¢ <strong>Sugest√£o:</strong> Intensificar a√ß√µes de marketing para aumentar o fluxo de visitantes.</li>';
                }

                html += `
                            </ul>
                        </div>
                    </div>
                `;

                relatorioResultado.innerHTML = html;
                showNotification('üîÆ Previs√£o de vendas gerada!', 'success');
            }, 2000);
        }

        // SISTEMA DE EQUIPE
        function sendTeamMessage() {
            const message = document.getElementById('teamMessage').value.trim();
            if (!message) {
                showNotification('Digite uma mensagem!', 'error');
                return;
            }

            const teamMembers = Object.values(users).filter(u => 
                u.unit === currentUser.unit && u.role !== 'admin' && u.name !== currentUser.name
            );

            teamMembers.forEach(member => {
                const privateMsg = {
                    id: Date.now() + Math.random(),
                    from: currentUser.name,
                    to: member.name,
                    subject: 'üì¢ Mensagem da Ger√™ncia',
                    content: message,
                    timestamp: new Date().toISOString(),
                    read: false
                };
                privateMessages.push(privateMsg);
            });

            document.getElementById('teamMessage').value = '';
            saveDataToLocal();
            showNotification(`üì§ Mensagem enviada para ${teamMembers.length} membros da equipe!`, 'success');
        }

        function scheduleTeamMeeting() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const meetingEvent = {
                id: Date.now(),
                title: 'üë• Reuni√£o de Equipe',
                description: 'Reuni√£o semanal da equipe de vendas',
                date: tomorrow.toISOString().split('T')[0],
                time: '09:00',
                type: 'reuniao',
                createdBy: currentUser.name
            };

            events.push(meetingEvent);
            saveDataToLocal();
            showNotification('üìÖ Reuni√£o de equipe agendada para amanh√£ √†s 9h!', 'success');
        }

        function updateTeamDisplay() {
            if (currentUser.role !== 'gerente') return;

            const teamGrid = document.getElementById('teamGrid');
            const teamPerformance = document.getElementById('teamPerformance');
            
            document.getElementById('teamUnitName').textContent = currentUser.unit;
            document.getElementById('teamMonthYear').textContent = new Date().toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });

            const teamMembers = Object.values(users).filter(user => 
                user.unit === currentUser.unit && user.role !== 'admin'
            );

            let teamHTML = '';
            let performanceHTML = '';
            let totalTeamMatriculas = 0;
            let totalTeamVisitas = 0;

            teamMembers.forEach(member => {
                const memberMatriculas = matriculas.filter(m => 
                    m.vendedor === member.name || 
                    m.gerente === member.name || 
                    m.assistente === member.name
                );
                const memberVisits = visitas.filter(v => v.atendente === member.name);
                
                const monthMatriculas = getCurrentMonthData(memberMatriculas);
                const monthVisits = getCurrentMonthData(memberVisits, 'data');
                
                totalTeamMatriculas += monthMatriculas.length;
                totalTeamVisitas += monthVisits.length;

                teamHTML += `
                    <div class="team-member-card">
                        <div class="member-avatar">${member.name.charAt(0).toUpperCase()}</div>
                        <div class="member-name">${member.name}</div>
                        <div class="member-role">${member.role}</div>
                        <div class="member-stats">
                            üìä ${monthMatriculas.length} matr√≠culas<br>
                            üë• ${monthVisits.length} visitas<br>
                            ‚≠ê ${member.xp} XP
                        </div>
                    </div>
                `;
            });

            const teamConversion = totalTeamVisitas > 0 ? (totalTeamMatriculas / totalTeamVisitas * 100).toFixed(1) : 0;

            performanceHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--text-primary);">${totalTeamMatriculas}</div>
                        <div style="font-size: 12px; color: #666;">Total Matr√≠culas</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #38a169;">${totalTeamVisitas}</div>
                        <div style="font-size: 12px; color: #666;">Total Visitas</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #ed8936;">${teamConversion}%</div>
                        <div style="font-size: 12px; color: #666;">Convers√£o da Equipe</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #667eea;">${teamMembers.length}</div>
                        <div style="font-size: 12px; color: #666;">Membros da Equipe</div>
                    </div>
                </div>
            `;

            teamGrid.innerHTML = teamHTML;
            teamPerformance.innerHTML = performanceHTML;

            // Atualizar metas individuais
            updateIndividualGoals(teamMembers);
        }

        function updateIndividualGoals(teamMembers) {
            const individualGoals = document.getElementById('individualGoals');
            if (!individualGoals) return;

            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">';

            teamMembers.forEach(member => {
                const memberMatriculas = getCurrentMonthData(matriculas.filter(m => 
                    m.vendedor === member.name || m.assistente === member.name
                ));

                const currentGoal = 15; // Meta padr√£o
                const progress = (memberMatriculas.length / currentGoal) * 100;

                html += `
                    <div style="border: 1px solid var(--border-color); border-radius: 12px; padding: 20px;">
                        <h4>${member.name}</h4>
                        <div style="margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Meta Individual:</span>
                                <span><strong>${memberMatriculas.length}/${currentGoal}</strong></span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">${progress.toFixed(1)}% da meta</div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" placeholder="Nova meta" id="newGoal${member.name.replace(/\s+/g, '')}" style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 5px;" min="1">
                            <button class="btn btn-primary btn-sm" onclick="setIndividualGoal('${member.name}')">üéØ Definir</button>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            individualGoals.innerHTML = html;
        }

        function setIndividualGoal(memberName) {
            const inputId = `newGoal${memberName.replace(/\s+/g, '')}`;
            const newGoal = parseInt(document.getElementById(inputId).value);

            if (!newGoal || newGoal < 1) {
                showNotification('Digite uma meta v√°lida!', 'error');
                return;
            }

            // Criar uma miss√£o individual
            const mission = {
                id: Date.now(),
                title: `üéØ Meta Individual - ${memberName}`,
                description: `Alcan√ßar ${newGoal} matr√≠culas neste m√™s`,
                type: 'vendas',
                target: newGoal,
                reward: newGoal * 10,
                deadline: new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).toISOString().split('T')[0],
                createdBy: currentUser.name,
                assignedTo: memberName,
                unit: currentUser.unit
            };

            missions.push(mission);
            saveDataToLocal();

            document.getElementById(inputId).value = '';
            showNotification(`üéØ Meta de ${newGoal} matr√≠culas definida para ${memberName}!`, 'success');
        }

        // SISTEMA DE RANKING
        function updateRanking() {
            const rankingBody = document.getElementById('rankingBody');
            if (!rankingBody) return;

            const rankings = calculateRankings();
            let html = '';

            rankings.forEach((user, index) => {
                const position = index + 1;
                const rankClass = position === 1 ? 'rank-1' : 
                                position === 2 ? 'rank-2' : 
                                position === 3 ? 'rank-3' : 'rank-other';

                html += `
                    <tr style="border-bottom: 1px solid #e2e8f0;">
                        <td style="padding: 15px;">
                            <div class="${rankClass}">${position}</div>
                        </td>
                        <td style="padding: 15px;">${user.name}</td>
                        <td style="padding: 15px;">${user.unit}</td>
                        <td style="padding: 15px;"><span class="role-badge role-${user.role}">${user.role}</span></td>
                        <td style="padding: 15px; text-align: center;">${user.visitas}</td>
                        <td style="padding: 15px; text-align: center;">${user.matriculas}</td>
                        <td style="padding: 15px; text-align: center; color: #ed8936; font-weight: bold;">${user.conversao}%</td>
                        <td style="padding: 15px; text-align: right;">${formatCurrency(user.earnings)}</td>
                        <td style="padding: 15px; text-align: center;"><span class="xp-badge">${user.xp} XP</span></td>
                    </tr>
                `;
            });

            rankingBody.innerHTML = html;

            // Atualizar selects de filtro
            updateRankingFilters();
        }

        function updateRankingFilters() {
            const rankingUnit = document.getElementById('rankingUnit');
            if (rankingUnit) {
                rankingUnit.innerHTML = '<option value="">Todas</option>';
                unidades.forEach(unit => {
                    rankingUnit.innerHTML += `<option value="${unit}">${unit}</option>`;
                });
            }
        }

        function calculateRankings() {
            const period = document.getElementById('rankingPeriod')?.value || 'month';
            const criteria = document.getElementById('rankingCriteria')?.value || 'matriculas';
            const unitFilter = document.getElementById('rankingUnit')?.value || '';

            const rankings = [];
            
            Object.entries(users).forEach(([username, user]) => {
                if (user.role !== 'admin') {
                    // Filtro de unidade
                    if (unitFilter && user.unit !== unitFilter) return;

                    let userMatriculas, userVisits;

                    // Filtro de per√≠odo
                    switch(period) {
                        case 'month':
                            userMatriculas = getCurrentMonthData(matriculas.filter(m => 
                                m.vendedor === user.name || 
                                m.gerente === user.name || 
                                m.assistente === user.name
                            ));
                            userVisits = getCurrentMonthData(visitas.filter(v => v.atendente === user.name), 'data');
                            break;
                        case 'quarter':
                            userMatriculas = getQuarterData(matriculas.filter(m => 
                                m.vendedor === user.name || 
                                m.gerente === user.name || 
                                m.assistente === user.name
                            ));
                            userVisits = getQuarterData(visitas.filter(v => v.atendente === user.name), 'data');
                            break;
                        case 'year':
                            userMatriculas = getYearData(matriculas.filter(m => 
                                m.vendedor === user.name || 
                                m.gerente === user.name || 
                                m.assistente === user.name
                            ));
                            userVisits = getYearData(visitas.filter(v => v.atendente === user.name), 'data');
                            break;
                        default:
                            userMatriculas = matriculas.filter(m => 
                                m.vendedor === user.name || 
                                m.gerente === user.name || 
                                m.assistente === user.name
                            );
                            userVisits = visitas.filter(v => v.atendente === user.name);
                    }

                    const conversionRate = userVisits.length > 0 ? (userMatriculas.length / userVisits.length * 100).toFixed(1) : 0;
                    
                    let earnings = 0;
                    if (user.role === 'vendedor') {
                        const vendMatriculas = userMatriculas.filter(m => m.vendedor === user.name);
                        if (vendMatriculas.length >= 10) {
                            earnings = vendMatriculas.length * getCommissionByBand(vendMatriculas.length, COMISSAO_VENDEDOR);
                        }
                    } else if (user.role === 'gerente') {
                        const unitData = getUnitData(user.unit);
                        const unitPeriodData = period === 'month' ? getCurrentMonthData(unitData) : 
                                             period === 'quarter' ? getQuarterData(unitData) :
                                             period === 'year' ? getYearData(unitData) : unitData;
                        if (unitPeriodData.length >= 26) {
                            earnings = unitPeriodData.length * getCommissionByBand(unitPeriodData.length, COMISSAO_GERENTE);
                        }
                    } else if (user.role === 'assistente') {
                        const assistMatriculas = userMatriculas.filter(m => m.assistente === user.name);
                        if (assistMatriculas.length >= 10) {
                            earnings = assistMatriculas.length * getCommissionByBand(assistMatriculas.length, COMISSAO_ASSISTENTE);
                        }
                    }

                    const rankingData = {
                        name: user.name,
                        unit: user.unit,
                        role: user.role,
                        visitas: userVisits.length,
                        matriculas: userMatriculas.length,
                        conversao: conversionRate,
                        earnings: earnings,
                        xp: user.xp
                    };

                    rankings.push(rankingData);
                }
            });

            // Ordenar por crit√©rio selecionado
            switch(criteria) {
                case 'conversao':
                    return rankings.sort((a, b) => parseFloat(b.conversao) - parseFloat(a.conversao));
                case 'visitas':
                    return rankings.sort((a, b) => b.visitas - a.visitas);
                case 'xp':
                    return rankings.sort((a, b) => b.xp - a.xp);
                default:
                    return rankings.sort((a, b) => b.matriculas - a.matriculas);
            }
        }

        function getQuarterData(data, dateField = 'data') {
            const now = new Date();
            const currentQuarter = Math.floor(now.getMonth() / 3);
            const quarterStart = new Date(now.getFullYear(), currentQuarter * 3, 1);
            const quarterEnd = new Date(now.getFullYear(), (currentQuarter + 1) * 3, 0);
            
            return data.filter(item => {
                const date = new Date(item[dateField]);
                return date >= quarterStart && date <= quarterEnd && !item.cancelado;
            });
        }

        function getYearData(data, dateField = 'data') {
            const now = new Date();
            const currentYear = now.getFullYear();
            
            return data.filter(item => {
                const date = new Date(item[dateField]);
                return date.getFullYear() === currentYear && !item.cancelado;
            });
        }

        // SISTEMA DE USU√ÅRIOS CORRIGIDO
        function addUser() {
            const name = document.getElementById('newUserName').value.trim();
            const username = document.getElementById('newUserUsername').value.trim();
            const password = document.getElementById('newUserPassword').value.trim();
            const role = document.getElementById('newUserRole').value;
            const unit = document.getElementById('newUserUnit').value;

            if (!name || !username || !password) {
                showNotification('Preencha todos os campos!', 'error');
                return;
            }

            if (users[username]) {
                showNotification('Usu√°rio j√° existe!', 'error');
                return;
            }

            // CORRE√á√ÉO: Criar usu√°rio com estrutura correta
            users[username] = {
                name: name,
                username: username,
                password: password,
                role: role,
                unit: unit,
                level: 1,
                xp: 0
            };

            // Inicializar estat√≠sticas do usu√°rio
            userStats[username] = {
                achievements: [],
                totalSales: 0,
                totalEarnings: 0,
                totalVisits: 0,
                conversionRate: 0
            };

            console.log('Usu√°rio criado:', users[username]); // Debug

            logAuditEvent('config', `Novo usu√°rio criado: ${name}`, { username, role });
            saveDataToLocal();
            if (GOOGLE_APPS_SCRIPT_URL) forceSync();
            
            updateAdminPanel();
            updateUserSelects();
            showNotification('‚úÖ Usu√°rio adicionado com sucesso!', 'success');

            // Limpar formul√°rio
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserUsername').value = '';
            document.getElementById('newUserPassword').value = '';
        }

        function deleteUser(username) {
            if (currentUser.role !== 'admin') {
                showNotification('‚ùå Apenas administradores podem excluir usu√°rios!', 'error');
                return;
            }

            if (confirm(`Tem certeza que deseja excluir ${users[username].name}?`)) {
                const deletedUser = users[username];
                delete users[username];
                delete userStats[username];
                
                logAuditEvent('config', `Usu√°rio exclu√≠do: ${deletedUser.name}`, { username });
                saveDataToLocal();
                if (GOOGLE_APPS_SCRIPT_URL) forceSync();
                
                updateAdminPanel();
                updateUserSelects();
                showNotification('‚úÖ Usu√°rio exclu√≠do com sucesso!', 'success');
            }
        }

        // FUN√á√ïES AUXILIARES COMPLETAS
        function getUserMatriculas() {
            if (currentUser.role === 'admin') {
                return selectedUnit === 'all' ? matriculas : getUnitData(selectedUnit);
            }
            if (currentUser.role === 'gerente') {
                return getUnitData(currentUser.unit);
            }
            return matriculas.filter(m => 
                m.vendedor === currentUser.name || 
                m.gerente === currentUser.name || 
                m.assistente === currentUser.name
            );
        }

        function getUserVisits() {
            return visitas.filter(v => {
                if (currentUser.role === 'admin') {
                    return selectedUnit === 'all' ? true : v.unidade === selectedUnit;
                }
                if (currentUser.role === 'gerente') {
                    return v.unidade === currentUser.unit;
                }
                return v.atendente === currentUser.name;
            });
        }

        function getUnitData(unit) {
            if (!unit || unit === 'all') return matriculas;
            return matriculas.filter(m => m.unidade === unit);
        }

        function getUnitVisits(unit) {
            if (!unit || unit === 'all') return visitas;
            return visitas.filter(v => v.unidade === unit);
        }

        function getCurrentMonthData(data, dateField = 'data') {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            return data.filter(item => {
                const date = new Date(item[dateField]);
                return date.getMonth() === currentMonth && 
                       date.getFullYear() === currentYear && 
                       !item.cancelado;
            });
        }

        function getTodayData(data) {
            const today = new Date().toISOString().split('T')[0];
            return data.filter(m => m.data === today && !m.cancelado);
        }

        function calculateUserMonthCommission() {
            if (currentUser.role === 'gerente') {
                return calculateManagerUnitCommission();
            }
            
            const monthData = getCurrentMonthData(getUserMatriculas());
            const myMatriculas = monthData.filter(m => {
                if (currentUser.role === 'vendedor') return m.vendedor === currentUser.name;
                if (currentUser.role === 'assistente') return m.assistente === currentUser.name;
                return false;
            });
            
            const count = myMatriculas.length;
            let commission = 0;
            
            if (currentUser.role === 'vendedor' && count >= 10) {
                commission = count * getCommissionByBand(count, COMISSAO_VENDEDOR);
            } else if (currentUser.role === 'assistente' && count >= 10) {
                commission = count * getCommissionByBand(count, COMISSAO_ASSISTENTE);
            }
            
            return commission;
        }

        function calculateManagerUnitCommission() {
            const unitData = getUnitData(currentUser.unit);
            const monthData = getCurrentMonthData(unitData);
            
            const totalMatriculas = monthData.length;
            let commission = 0;
            
            if (totalMatriculas >= 26) {
                commission = totalMatriculas * getCommissionByBand(totalMatriculas, COMISSAO_GERENTE);
            }
            
            const specialBonus = monthData.reduce((total, m) => {
                if (m.tipo === 'Blackin') total += 25;
                if (m.tipo === 'Black') total += 50;
                return total;
            }, 0);
            
            return commission + specialBonus;
        }

        function calculateTotalRevenue(data) {
            return data.reduce((total, m) => total + (m.valorEntrada || 0), 0);
        }

        function getCommissionByBand(matriculasCount, table) {
            for (let band of table) {
                if (matriculasCount >= band.min && matriculasCount <= band.max) {
                    return band.valor;
                }
            }
            return 0;
        }

        function getTeamMembersCount() {
            return Object.values(users).filter(u => 
                u.unit === currentUser.unit && u.role !== 'admin'
            ).length;
        }

        function getUserMissions() {
            return missions.filter(mission => {
                if (mission.assignedTo === 'all') return true;
                if (mission.assignedTo === 'vendedores' && currentUser.role === 'vendedor') return true;
                if (mission.assignedTo === 'assistentes' && currentUser.role === 'assistente') return true;
                if (mission.assignedTo === currentUser.name) return true;
                return false;
            });
        }

        function calculateMissionProgress(mission) {
            if (mission.type === 'vendas') {
                const userMatriculas = getUserMatriculas();
                return getCurrentMonthData(userMatriculas).length;
            } else if (mission.type === 'visitas') {
                const userVisits = getUserVisits();
                return getCurrentMonthData(userVisits, 'data').length;
            } else if (mission.type === 'conversao') {
                const userVisits = getUserVisits();
                const userMatriculas = getUserMatriculas();
                const monthVisits = getCurrentMonthData(userVisits, 'data');
                const monthMatriculas = getCurrentMonthData(userMatriculas);
                return monthVisits.length > 0 ? Math.round((monthMatriculas.length / monthVisits.length) * 100) : 0;
            }
            
            return 0;
        }

        function checkAchievements() {
            if (!currentUser) return;
            
            const userMatriculas = getUserMatriculas();
            const userVisits = getUserVisits();
            const monthMatriculas = getCurrentMonthData(userMatriculas);
            const monthVisits = getCurrentMonthData(userVisits, 'data');
            
            const conversionRate = monthVisits.length > 0 ? (monthMatriculas.length / monthVisits.length * 100) : 0;
            
            ACHIEVEMENT_DEFINITIONS.forEach(achievement => {
                if (userStats[currentUser.username] && userStats[currentUser.username].achievements.includes(achievement.id)) {
                    return;
                }
                
                let unlocked = false;
                
                switch (achievement.id) {
                    case 'first_sale':
                        unlocked = userMatriculas.length > 0;
                        break;
                    case 'sales_5':
                        unlocked = monthMatriculas.length >= 5;
                        break;
                    case 'sales_10':
                        unlocked = monthMatriculas.length >= 10;
                        break;
                    case 'sales_20':
                        unlocked = monthMatriculas.length >= 20;
                        break;
                    case 'conversion_80':
                        unlocked = conversionRate >= 80 && monthVisits.length >= 5;
                        break;
                    case 'visits_50':
                        unlocked = monthVisits.length >= 50;
                        break;
                    case 'level_5':
                        unlocked = currentUser.level >= 5;
                        break;
                }
                
                if (unlocked) {
                    unlockAchievement(achievement);
                }
            });
        }

        function unlockAchievement(achievement) {
            if (!userStats[currentUser.username]) {
                userStats[currentUser.username] = { achievements: [] };
            }
            
            userStats[currentUser.username].achievements.push(achievement.id);
            giveXP(currentUser.name, achievement.xp);
            
            addNotification('üèÜ Nova Conquista!', `${achievement.name} desbloqueada (+${achievement.xp} XP)`, 'success');
            showNotification(`üèÜ Conquista desbloqueada: ${achievement.name} (+${achievement.xp} XP)!`, 'success');
            updateAchievementsDisplay();
        }

        function updateMissionProgress() {
            const userMissions = getUserMissions();
            
            userMissions.forEach(mission => {
                const progress = calculateMissionProgress(mission);
                
                if (progress >= mission.target && !mission.completed) {
                    mission.completed = true;
                    mission.completedDate = new Date().toISOString();
                    
                    giveXP(currentUser.name, mission.reward);
                    addNotification('üéâ Miss√£o Conclu√≠da!', `${mission.title} completada (+${mission.reward} XP)`, 'success');
                    showNotification(`üéâ Miss√£o completada: ${mission.title} (+${mission.reward} XP)!`, 'success');
                }
            });
        }

        function createMission() {
            const title = document.getElementById('missionTitle').value.trim();
            const description = document.getElementById('missionDescription').value.trim();
            const type = document.getElementById('missionType').value;
            const target = parseInt(document.getElementById('missionTarget').value);
            const reward = parseInt(document.getElementById('missionReward').value);
            const deadline = document.getElementById('missionDeadline').value;
            const assignedTo = document.getElementById('missionTarget_user').value;
            const specificUser = document.getElementById('missionSpecificUser').value;

            if (!title || !description || !target || !reward || !deadline) {
                showNotification('Preencha todos os campos da miss√£o!', 'error');
                return;
            }

            const newMission = {
                id: Date.now(),
                title,
                description,
                type,
                target,
                reward,
                deadline,
                createdBy: currentUser.name,
                assignedTo: assignedTo === 'specific' ? specificUser : assignedTo,
                unit: currentUser.unit,
                created: new Date().toISOString()
            };

            missions.push(newMission);
            
            logAuditEvent('mission', `Nova miss√£o criada: ${title}`, { missionId: newMission.id });
            saveDataToLocal();
            
            if (GOOGLE_APPS_SCRIPT_URL) {
                forceSync();
            }

            showNotification('üéØ Miss√£o criada com sucesso!', 'success');
            clearMissionForm();
            updateMissionsDisplay();
        }

        function clearMissionForm() {
            document.getElementById('missionTitle').value = '';
            document.getElementById('missionDescription').value = '';
            document.getElementById('missionTarget').value = '';
            document.getElementById('missionReward').value = '';
            document.getElementById('missionDeadline').value = '';
        }

        function giveXP(userName, amount) {
            const user = Object.values(users).find(u => u.name === userName);
            if (user) {
                user.xp += amount;
                const newLevel = Math.floor(user.xp / 500) + 1;
                if (newLevel > user.level) {
                    const oldLevel = user.level;
                    user.level = newLevel;
                    if (userName === currentUser.name) {
                        addNotification('üéâ Level Up!', `Voc√™ subiu para o n√≠vel ${newLevel}!`, 'success');
                        showNotification(`üéâ Voc√™ subiu para o n√≠vel ${newLevel}!`, 'success');
                    } else {
                        addNotification('üéâ Level Up na Equipe!', `${userName} subiu para o n√≠vel ${newLevel}!`, 'info');
                    }
                }
            }
        }

        // FUN√á√ïES DE CONFIGURA√á√ÉO
        function updateUserSelects() {
            const vendedorSelect = document.getElementById('newVendedor');
            const gerenteSelect = document.getElementById('newGerente');
            const assistenteSelect = document.getElementById('newAssistente');
            const relatorioColaboradorSelect = document.getElementById('relatorioColaborador');
            const visitAttendantSelect = document.getElementById('visitAttendant');
            const privateMessageToSelect = document.getElementById('privateMessageTo');
            const visitAttendantFilterSelect = document.getElementById('visitAttendantFilter');
            const matriculaVendedorFilterSelect = document.getElementById('matriculaVendedorFilter');

            if (vendedorSelect) {
                vendedorSelect.innerHTML = '<option value="">Selecione...</option>';
                gerenteSelect.innerHTML = '<option value="">Selecione...</option>';
                assistenteSelect.innerHTML = '<option value="">Selecione...</option>';

                Object.entries(users).forEach(([username, user]) => {
                    if (currentUser.role === 'gerente' && user.unit !== currentUser.unit) return;
                    
                    if (user.role === 'vendedor') {
                        vendedorSelect.innerHTML += `<option value="${user.name}">${user.name} (${user.unit})</option>`;
                    }
                    if (user.role === 'gerente') {
                        gerenteSelect.innerHTML += `<option value="${user.name}">${user.name} (${user.unit})</option>`;
                    }
                    if (user.role === 'assistente') {
                        assistenteSelect.innerHTML += `<option value="${user.name}">${user.name} (${user.unit})</option>`;
                    }
                });

                if (currentUser.role === 'vendedor') {
                    vendedorSelect.value = currentUser.name;
                    vendedorSelect.disabled = true;
                } else if (currentUser.role === 'gerente') {
                    gerenteSelect.value = currentUser.name;
                    gerenteSelect.disabled = true;
                } else if (currentUser.role === 'assistente') {
                    assistenteSelect.value = currentUser.name;
                    assistenteSelect.disabled = true;
                }
            }

            // Atualizar outros selects
            const selects = [
                relatorioColaboradorSelect,
                privateMessageToSelect,
                visitAttendantFilterSelect,
                matriculaVendedorFilterSelect
            ];

            selects.forEach(select => {
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">Todos</option>';
                    
                    Object.entries(users).forEach(([username, user]) => {
                        if (user.role !== 'admin') {
                            if (currentUser.role === 'gerente' && user.unit !== currentUser.unit) return;
                            
                            const label = select === privateMessageToSelect ? 
                                user.name : 
                                `${user.name} (${user.role} - ${user.unit})`;
                            
                            select.innerHTML += `<option value="${user.name}">${label}</option>`;
                        }
                    });
                    
                    select.value = currentValue;
                }
            });
        }

        function updateVisitSelects() {
            const visitAttendantSelect = document.getElementById('visitAttendant');
            
            if (visitAttendantSelect) {
                visitAttendantSelect.innerHTML = '<option value="">Selecione...</option>';
                
                Object.entries(users).forEach(([username, user]) => {
                    if (user.role !== 'admin') {
                        if (currentUser.role === 'gerente' && user.unit !== currentUser.unit) return;
                        
                        visitAttendantSelect.innerHTML += `<option value="${user.name}">${user.name} (${user.role})</option>`;
                    }
                });

                if (currentUser.role !== 'admin') {
                    visitAttendantSelect.value = currentUser.name;
                    visitAttendantSelect.disabled = true;
                }
            }
        }

        function setupUnitFilter() {
            const unitSelectors = document.getElementById('unitSelectors');
            const units = ['all', ...unidades];
            
            let html = '';
            units.forEach(unit => {
                const label = unit === 'all' ? 'Todas as Unidades' : unit;
                const activeClass = selectedUnit === unit ? 'active' : '';
                html += `<span class="unit-selector ${activeClass}" onclick="selectUnit('${unit}')">${label}</span>`;
            });
            
            unitSelectors.innerHTML = html;
        }

        function selectUnit(unit) {
            selectedUnit = unit;
            setupUnitFilter();
            setupDashboard();
            updateRanking();
            showNotification(`Filtro aplicado: ${unit === 'all' ? 'Todas as Unidades' : unit}`, 'info');
        }

        // SISTEMA DE ADMINISTRA√á√ÉO
        function updateAdminPanel() {
            const userManagementBody = document.getElementById('userManagementBody');
            let html = '';

            Object.entries(users).forEach(([username, user]) => {
                if (user.role === 'admin') return;
                
                const userMatriculas = matriculas.filter(m => 
                    m.vendedor === user.name || 
                    m.gerente === user.name || 
                    m.assistente === user.name
                );
                const userVisits = visitas.filter(v => v.atendente === user.name);
                const monthMatriculas = getCurrentMonthData(userMatriculas);
                const monthVisits = getCurrentMonthData(userVisits, 'data');

                html += `
                    <tr style="border-bottom: 1px solid #e2e8f0;">
                        <td style="padding: 15px;">${user.name}</td>
                        <td style="padding: 15px;">${user.username}</td>
                        <td style="padding: 15px;">${user.unit}</td>
                        <td style="padding: 15px;"><span class="role-badge role-${user.role}">${user.role}</span></td>
                        <td style="padding: 15px; text-align: center;">${monthMatriculas.length}</td>
                        <td style="padding: 15px; text-align: center;">${monthVisits.length}</td>
                        <td style="padding: 15px; text-align: center;"><span class="xp-badge">${user.xp} XP</span></td>
                        <td style="padding: 15px;">
                            <button style="padding: 6px 10px; font-size: 10px; background: var(--danger-gradient); color: white; border: none; border-radius: 8px; cursor: pointer;" onclick="deleteUser('${username}')">
                                üóëÔ∏è Excluir
                            </button>
                        </td>
                    </tr>
                `;
            });

            userManagementBody.innerHTML = html;
        }

        // SISTEMA DE METAS
        function generateDefaultMetas() {
            const currentMonth = new Date().toISOString().substring(0, 7);
            
            if (!metas[currentMonth]) {
                metas[currentMonth] = {};
                unidades.forEach(unidade => {
                    metas[currentMonth][unidade] = {
                        matriculas: 50,
                        faturamento: 50000
                    };
                });
                saveDataToLocal();
            }
        }

        function salvarMetas() {
            const currentMonth = new Date().toISOString().substring(0, 7);
            
            if (!metas[currentMonth]) {
                metas[currentMonth] = {};
            }

            unidades.forEach(unidade => {
                const unitId = unidade.replace(/\s+/g, '').replace(/[^a-zA-Z0-9]/g, '');
                const metaMatriculas = parseInt(document.getElementById(`metaMatriculas${unitId}`).value) || 0;
                const metaFaturamento = parseFloat(document.getElementById(`metaFaturamento${unitId}`).value) || 0;

                metas[currentMonth][unidade] = {
                    matriculas: metaMatriculas,
                    faturamento: metaFaturamento
                };
            });

            logAuditEvent('config', `Metas atualizadas para ${currentMonth}`);
            saveDataToLocal();
            if (GOOGLE_APPS_SCRIPT_URL) forceSync();

            setupDashboard();

            showNotification('üéØ Metas salvas com sucesso!', 'success');
            document.getElementById('metasStatus').innerHTML = '<div style="color: #38a169; font-weight: bold;">‚úÖ Metas salvas e sincronizadas!</div>';
        }

        function carregarMetas() {
            updateMetasConfigDisplay();
            showNotification('üîÑ Metas recarregadas!', 'info');
        }

        // GOOGLE SHEETS INTEGRA√á√ÉO
        function saveGoogleSheetsConfig() {
            const url = document.getElementById('googleScriptUrl').value.trim();
            if (!url) {
                showNotification('Digite a URL do Google Apps Script!', 'error');
                return;
            }
            
            GOOGLE_APPS_SCRIPT_URL = url;
            localStorage.setItem('googleScriptUrl', url);
            showNotification('‚úÖ Configura√ß√£o salva! Teste a conex√£o agora.', 'success');
        }

        function testGoogleSheetsConnection() {
            if (!GOOGLE_APPS_SCRIPT_URL) {
                showNotification('Configure a URL primeiro!', 'error');
                return;
            }

            showLoadingMessage('Testando conex√£o com Google Sheets...');
            
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 15000);

            const data = { action: 'test' };
            
            fetch(GOOGLE_APPS_SCRIPT_URL, {
                method: 'POST',
                body: new URLSearchParams({ data: JSON.stringify(data) }),
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                signal: controller.signal
            })
            .then(response => {
                clearTimeout(timeoutId);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.text();
            })
            .then(text => {
                hideLoadingMessage();
                try {
                    const result = JSON.parse(text);
                    if (result.success) {
                        showNotification('‚úÖ Conex√£o com Google Sheets estabelecida!', 'success');
                        document.getElementById('syncResult').innerHTML = `
                            <div style="color: #38a169; font-weight: bold;">
                                ‚úÖ Conectado com sucesso!<br>
                                <small>Mensagem: ${result.message}</small>
                            </div>
                        `;
                        updateSyncStatus('online');
                    } else {
                        throw new Error(result.error || 'Erro desconhecido do servidor');
                    }
                } catch (parseError) {
                    throw new Error('Resposta inv√°lida do servidor: ' + text.substring(0, 100));
                }
            })
            .catch(error => {
                clearTimeout(timeoutId);
                hideLoadingMessage();
                
                let errorMessage = 'Erro desconhecido';
                
                if (error.name === 'AbortError') {
                    errorMessage = 'Timeout - Verifique a URL e configura√ß√£o do script';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'Erro de conex√£o - Verifique se:\n1. A URL est√° correta\n2. O script foi publicado como aplicativo web\n3. As permiss√µes est√£o configuradas';
                } else if (error.message.includes('HTTP')) {
                    errorMessage = 'Erro HTTP - ' + error.message;
                } else {
                    errorMessage = error.message;
                }
                
                showNotification('‚ùå Erro na conex√£o: ' + errorMessage, 'error');
                document.getElementById('syncResult').innerHTML = `
                    <div style="color: #e53e3e; font-weight: bold;">
                        ‚ùå Erro: ${errorMessage}<br>
                        <small>Verifique as instru√ß√µes de configura√ß√£o abaixo</small>
                    </div>
                `;
                updateSyncStatus('error');
            });
        }

        function forceSync() {
            if (!GOOGLE_APPS_SCRIPT_URL) {
                showNotification('Configure o Google Sheets primeiro!', 'error');
                return;
            }

            showLoadingMessage('Sincronizando dados...');
            updateSyncStatus('syncing');
            
            const data = {
                action: 'save',
                users: users,
                matriculas: matriculas,
                visitas: visitas,
                missions: missions,
                metas: metas,
                unidades: unidades,
                events: events,
                userStats: userStats,
                timestamp: new Date().toISOString()
            };

            submitToGoogleSheets(data)
                .then(result => {
                    hideLoadingMessage();
                    if (result.success) {
                        showNotification('‚úÖ Dados sincronizados com sucesso!', 'success');
                        updateSyncStatus('online');
                        saveDataToLocal();
                    } else {
                        throw new Error(result.error || 'Erro na sincroniza√ß√£o');
                    }
                })
                .catch(error => {
                    hideLoadingMessage();
                    showNotification('‚ö†Ô∏è Erro na sincroniza√ß√£o: ' + error.message, 'warning');
                    updateSyncStatus('error');
                    saveDataToLocal();
                });
        }

        function submitToGoogleSheets(data) {
            return new Promise((resolve, reject) => {
                if (!GOOGLE_APPS_SCRIPT_URL) {
                    reject(new Error('URL do Google Apps Script n√£o configurada'));
                    return;
                }

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);

                const formData = new URLSearchParams();
                formData.append('data', JSON.stringify(data));

                fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    signal: controller.signal
                })
                .then(response => {
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    return response.text();
                })
                .then(text => {
                    try {
                        const result = JSON.parse(text);
                        
                        if (result.success) {
                            resolve(result);
                        } else {
                            reject(new Error(result.error || 'Erro desconhecido do servidor'));
                        }
                    } catch (parseError) {
                        reject(new Error('Resposta inv√°lida do servidor. Verifique se o script foi publicado corretamente.'));
                    }
                })
                .catch(error => {
                    clearTimeout(timeoutId);
                    
                    if (error.name === 'AbortError') {
                        reject(new Error('Timeout - A requisi√ß√£o demorou mais que 30 segundos'));
                    } else if (error.message.includes('Failed to fetch')) {
                        reject(new Error('Falha na conex√£o. Verifique se a URL est√° correta e o script foi publicado.'));
                    } else {
                        reject(error);
                    }
                });
            });
        }

        function showGoogleScriptCode() {
            document.getElementById('scriptCode').value = `
/**
 * Google Apps Script - Game Creators Pro V2
 * Cole este c√≥digo no seu projeto do Google Apps Script
 */

// ‚ö†Ô∏è SUBSTITUA PELO ID DA SUA PLANILHA
const SPREADSHEET_ID = 'SUA_PLANILHA_ID_AQUI';

function doPost(e) {
  try {
    if (!e || !e.parameter || !e.parameter.data) {
      throw new Error('Dados n√£o recebidos');
    }
    
    const data = JSON.parse(e.parameter.data);
    const action = data.action;
    
    if (SPREADSHEET_ID === 'SUA_PLANILHA_ID_AQUI') {
      throw new Error('Substitua SUA_PLANILHA_ID_AQUI pelo ID real da planilha!');
    }
    
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    
    if (action === 'test') {
      return ContentService
        .createTextOutput(JSON.stringify({
          success: true,
          message: 'Conex√£o OK! Game Creators funcionando!',
          timestamp: new Date().toISOString()
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    if (action === 'save') {
      if (data.users) saveUsers(spreadsheet, data.users);
      if (data.matriculas) saveMatriculas(spreadsheet, data.matriculas);
      if (data.visitas) saveVisitas(spreadsheet, data.visitas);
      if (data.missions) saveMissions(spreadsheet, data.missions);
      if (data.metas) saveMetas(spreadsheet, data.metas);
      if (data.unidades) saveUnidades(spreadsheet, data.unidades);
      if (data.events) saveEvents(spreadsheet, data.events);
      if (data.userStats) saveUserStats(spreadsheet, data.userStats);
      
      return ContentService
        .createTextOutput(JSON.stringify({
          success: true,
          message: 'Dados salvos com sucesso!'
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    throw new Error('A√ß√£o n√£o reconhecida');
    
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        error: error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function saveUsers(spreadsheet, users) {
  let sheet = spreadsheet.getSheetByName('Usuarios');
  if (!sheet) sheet = spreadsheet.insertSheet('Usuarios');
  
  sheet.clear();
  const headers = ['Username', 'Name', 'Password', 'Role', 'Unit', 'Level', 'XP'];
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  
  const data = Object.entries(users).map(([username, user]) => [
    username, user.name, user.password, user.role, user.unit, user.level || 1, user.xp || 0
  ]);
  
  if (data.length > 0) {
    sheet.getRange(2, 1, data.length, headers.length).setValues(data);
  }
}

function saveMatriculas(spreadsheet, matriculas) {
  let sheet = spreadsheet.getSheetByName('Matriculas');
  if (!sheet) sheet = spreadsheet.insertSheet('Matriculas');
  
  sheet.clear();
  const headers = ['ID', 'Data', 'Nome', 'Telefone', 'Curso', 'ValorTotal', 'ValorEntrada', 'Tipo', 'Parcelas', 'Vendedor', 'Gerente', 'Assistente', 'Unidade', 'Origem', 'Status', 'Cancelado'];
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  
  const data = matriculas.map(m => [
    m.id, m.data, m.nome, m.telefone, m.curso, m.valorTotal, m.valorEntrada, m.tipo, m.parcelas, m.vendedor, m.gerente, m.assistente, m.unidade, m.origem, m.statusPagamento, m.cancelado
  ]);
  
  if (data.length > 0) {
    sheet.getRange(2, 1, data.length, headers.length).setValues(data);
  }
}

function saveVisitas(spreadsheet, visitas) {
  let sheet = spreadsheet.getSheetByName('Visitas');
  if (!sheet) sheet = spreadsheet.insertSheet('Visitas');
  
  sheet.clear();
  const headers = ['ID', 'Data', 'Nome', 'Telefone', 'CursoInteresse', 'Atendente', 'Unidade', 'Observacoes', 'Convertido', 'MatriculaID', 'DataConversao'];
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  
  const data = visitas.map(v => [
    v.id, v.data, v.nome, v.telefone, v.cursoInteresse, v.atendente, v.unidade, v.observacoes, v.convertido, v.matriculaId, v.dataConversao
  ]);
  
  if (data.length > 0) {
    sheet.getRange(2, 1, data.length, headers.length).setValues(data);
  }
}

function saveMissions(spreadsheet, missions) {
  let sheet = spreadsheet.getSheetByName('Missions');
  if (!sheet) sheet = spreadsheet.insertSheet('Missions');
  
  sheet.clear();
  const headers = ['ID', 'Title', 'Description', 'Type', 'Target', 'Reward', 'Deadline', 'CreatedBy', 'AssignedTo', 'Unit', 'Completed'];
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  
  const data = missions.map(m => [
    m.id, m.title, m.description, m.type, m.target, m.reward, m.deadline, m.createdBy, m.assignedTo, m.unit, m.completed || false
  ]);
  
  if (data.length > 0) {
    sheet.getRange(2, 1, data.length, headers.length).setValues(data);
  }
}

function saveMetas(spreadsheet, metas) {
  let sheet = spreadsheet.getSheetByName('Metas');
  if (!sheet) sheet = spreadsheet.insertSheet('Metas');
  
  sheet.clear();
  const headers = ['Mes', 'Unidade', 'MetaMatriculas', 'MetaFaturamento'];
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  
  const data = [];
  Object.entries(metas).forEach(([mes, metasMes]) => {
    Object.entries(metasMes).forEach(([unidade, meta]) => {
      data.push([mes, unidade, meta.matriculas, meta.faturamento]);
    });
  });
  
  if (data.length > 0) {
    sheet.getRange(2, 1, data.length, headers.length).setValues(data);
  }
}

function saveUnidades(spreadsheet, unidades) {
  let sheet = spreadsheet.getSheetByName('Unidades');
  if (!sheet) sheet = spreadsheet.insertSheet('Unidades');
  
  sheet.clear();
  const headers = ['Nome'];
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  
  const data = unidades.map(u => [u]);
  
  if (data.length > 0) {
    sheet.getRange(2, 1, data.length, headers.length).setValues(data);
  }
}

function saveEvents(spreadsheet, events) {
  let sheet = spreadsheet.getSheetByName('Events');
  if (!sheet) sheet = spreadsheet.insertSheet('Events');
  
  sheet.clear();
  const headers = ['ID', 'Title', 'Description', 'Date', 'Time', 'Type', 'CreatedBy'];
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  
  const data = events.map(e => [
    e.id, e.title, e.description, e.date, e.time, e.type, e.createdBy
  ]);
  
  if (data.length > 0) {
    sheet.getRange(2, 1, data.length, headers.length).setValues(data);
  }
}

function saveUserStats(spreadsheet, userStats) {
  let sheet = spreadsheet.getSheetByName('UserStats');
  if (!sheet) sheet = spreadsheet.insertSheet('UserStats');
  
  sheet.clear();
  const headers = ['Username', 'Achievements', 'TotalSales', 'TotalEarnings', 'TotalVisits', 'ConversionRate'];
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  
  const data = Object.entries(userStats).map(([username, stats]) => [
    username, 
    JSON.stringify(stats.achievements || []), 
    stats.totalSales || 0, 
    stats.totalEarnings || 0, 
    stats.totalVisits || 0, 
    stats.conversionRate || 0
  ]);
  
  if (data.length > 0) {
    sheet.getRange(2, 1, data.length, headers.length).setValues(data);
  }
}
            `;
            document.getElementById('scriptModal').style.display = 'flex';
        }

        function hideScriptModal() {
            document.getElementById('scriptModal').style.display = 'none';
        }

        function copyScriptCode() {
            const textarea = document.getElementById('scriptCode');
            textarea.select();
            document.execCommand('copy');
            showNotification('üìã C√≥digo copiado para a √°rea de transfer√™ncia!', 'success');
        }

        function showTroubleshooting() {
            const modal = document.createElement('div');
            modal.className = 'loading-overlay';
            modal.style.display = 'flex';
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 12px; max-width: 80%; max-height: 80%; overflow-y: auto;">
                    <h3>üîß Solu√ß√£o de Problemas</h3>
                    
                    <div style="background: #fed7d7; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>‚ùå ERRO: "Failed to fetch"</strong><br>
                        1. Verificar URL do script<br>
                        2. Republicar como aplicativo web<br>
                        3. Verificar permiss√µes<br>
                    </div>
                    
                    <div style="background: #fef5e7; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>‚ö†Ô∏è ERRO: "Unauthorized"</strong><br>
                        1. Executar como "Eu (seu email)"<br>
                        2. Autorizar todas as permiss√µes<br>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: right;">
                        <button class="btn btn-primary" onclick="this.parentElement.parentElement.parentElement.remove()">‚úÖ Entendi</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // SISTEMA DE ARMAZENAMENTO LOCAL
        function loadDataFromLocal() {
            try {
                const savedUsers = localStorage.getItem('users');
                const savedMatriculas = localStorage.getItem('matriculas');
                const savedVisitas = localStorage.getItem('visitas');
                const savedUserStats = localStorage.getItem('userStats');
                const savedMissions = localStorage.getItem('missions');
                const savedMetas = localStorage.getItem('metas');
                const savedUnidades = localStorage.getItem('unidades');
                const savedEvents = localStorage.getItem('events');
                const savedChatMessages = localStorage.getItem('chatMessages');
                const savedPrivateMessages = localStorage.getItem('privateMessages');
                const savedNotifications = localStorage.getItem('notifications');
                const savedAuditLog = localStorage.getItem('auditLog');

                if (savedUsers) {
                    users = JSON.parse(savedUsers);
                } else {
                    users = {...defaultUsers};
                }

                if (savedUnidades) {
                    unidades = JSON.parse(savedUnidades);
                } else {
                    unidades = [...defaultUnidades];
                }

                if (savedMatriculas) {
                    matriculas = JSON.parse(savedMatriculas);
                } else {
                    matriculas = generateSampleData();
                }

                if (savedVisitas) {
                    visitas = JSON.parse(savedVisitas);
                } else {
                    visitas = generateSampleVisits();
                }

                if (savedUserStats) {
                    userStats = JSON.parse(savedUserStats);
                } else {
                    userStats = {};
                }

                if (savedMissions) {
                    missions = JSON.parse(savedMissions);
                } else {
                    missions = [];
                }

                if (savedMetas) {
                    metas = JSON.parse(savedMetas);
                } else {
                    metas = {};
                }

                if (savedEvents) {
                    events = JSON.parse(savedEvents);
                } else {
                    events = [];
                }

                if (savedChatMessages) {
                    chatMessages = JSON.parse(savedChatMessages);
                } else {
                    chatMessages = {};
                }

                if (savedPrivateMessages) {
                    privateMessages = JSON.parse(savedPrivateMessages);
                } else {
                    privateMessages = [];
                }

                if (savedNotifications) {
                    notifications = JSON.parse(savedNotifications);
                } else {
                    notifications = [];
                }

                if (savedAuditLog) {
                    auditLog = JSON.parse(savedAuditLog);
                } else {
                    auditLog = [];
                }

                Object.keys(users).forEach(username => {
                    if (!userStats[username]) {
                        userStats[username] = {
                            achievements: [],
                            totalSales: 0,
                            totalEarnings: 0,
                            totalVisits: 0,
                            conversionRate: 0
                        };
                    }
                });

                console.log('üìä Dados carregados do localStorage');
                console.log('üë• Usu√°rios:', Object.keys(users));
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados locais:', error);
                users = {...defaultUsers};
                unidades = [...defaultUnidades];
                matriculas = generateSampleData();
                visitas = generateSampleVisits();
                userStats = {};
                missions = [];
                metas = {};
                events = [];
                chatMessages = {};
                privateMessages = [];
                notifications = [];
                auditLog = [];
            }
        }

        function saveDataToLocal() {
            try {
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('unidades', JSON.stringify(unidades));
                localStorage.setItem('matriculas', JSON.stringify(matriculas));
                localStorage.setItem('visitas', JSON.stringify(visitas));
                localStorage.setItem('userStats', JSON.stringify(userStats));
                localStorage.setItem('missions', JSON.stringify(missions));
                localStorage.setItem('metas', JSON.stringify(metas));
                localStorage.setItem('events', JSON.stringify(events));
                localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
                localStorage.setItem('privateMessages', JSON.stringify(privateMessages));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                localStorage.setItem('auditLog', JSON.stringify(auditLog));
                localStorage.setItem('lastLocalSave', new Date().toISOString());
                console.log('üíæ Dados salvos localmente');
            } catch (error) {
                console.error('‚ùå Erro ao salvar dados localmente:', error);
            }
        }

        function generateSampleData() {
            const sampleData = [];
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();

            for (let i = 0; i < 25; i++) {
                const randomDay = Math.floor(Math.random() * 28) + 1;
                const date = new Date(currentYear, currentMonth, randomDay);
                const unit = unidades[i % unidades.length];
                
                sampleData.push({
                    id: Date.now() + i,
                    data: date.toISOString().split('T')[0],
                    nome: `Aluno ${i + 1}`,
                    telefone: `(11) 9999-${String(i).padStart(4, '0')}`,
                    curso: ['Creators 2D', 'Creators 3D', 'Design Gr√°fico'][Math.floor(Math.random() * 3)],
                    valorTotal: 2400,
                    valorEntrada: Math.floor(Math.random() * 500) + 200,
                    tipo: ['Convencional', 'Blackin', 'Black'][Math.floor(Math.random() * 3)],
                    parcelas: Math.floor(Math.random() * 12) + 1,
                    vendedor: unit === unidades[0] ? 'Jo√£o Santos' : 'Paula Oliveira',
                    gerente: unit === unidades[0] ? 'Maria Silva' : 'Carlos Lima',
                    assistente: unit === unidades[0] ? 'Ana Costa' : 'Pedro Mendes',
                    unidade: unit,
                    origem: ['Cliente Direto', 'Cliente Porta', 'Street Marketing', 'Agendamento', 'Evento'][Math.floor(Math.random() * 5)],
                    statusPagamento: 'Pago',
                    cancelado: false,
                    fromVisit: Math.random() > 0.7
                });
            }

            return sampleData;
        }

        function generateSampleVisits() {
            const sampleVisits = [];
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();

            for (let i = 0; i < 40; i++) {
                const randomDay = Math.floor(Math.random() * 28) + 1;
                const date = new Date(currentYear, currentMonth, randomDay);
                const unit = unidades[i % unidades.length];
                const converted = Math.random() > 0.7;
                
                sampleVisits.push({
                    id: Date.now() + i,
                    data: date.toISOString().split('T')[0],
                    nome: `Visitante ${i + 1}`,
                    telefone: `(11) 8888-${String(i).padStart(4, '0')}`,
                    cursoInteresse: ['Creators 2D', 'Creators 3D', 'Design Gr√°fico'][Math.floor(Math.random() * 3)],
                    atendente: unit === unidades[0] ? 'Jo√£o Santos' : 'Paula Oliveira',
                    unidade: unit,
                    observacoes: 'Visitante interessado',
                    convertido: converted,
                    matriculaId: converted ? Date.now() + i + 1000 : null,
                    dataConversao: converted ? date.toISOString().split('T')[0] : null
                });
            }

            return sampleVisits;
        }

        // FUN√á√ïES UTILIT√ÅRIAS
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function setCurrentDate() {
            const today = new Date().toISOString().split('T')[0];
            const visitDateInput = document.getElementById('visitDate');
            const newDataInput = document.getElementById('newData');
            const missionDeadlineInput = document.getElementById('missionDeadline');
            const eventDateInput = document.getElementById('eventDate');
            
            if (visitDateInput) visitDateInput.value = today;
            if (newDataInput) newDataInput.value = today;
            if (eventDateInput) eventDateInput.value = today;
            if (missionDeadlineInput) {
                const nextWeek = new Date();
                nextWeek.setDate(nextWeek.getDate() + 7);
                missionDeadlineInput.value = nextWeek.toISOString().split('T')[0];
            }
        }

        function setCurrentMonthForReport() {
            const now = new Date();
            const monthString = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0');
            const relatorioMesInput = document.getElementById('relatorioMes');
            
            if (relatorioMesInput) relatorioMesInput.value = monthString;
            
            const monthYear = now.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            const conversionMonthYear = document.getElementById('conversionMonthYear');
            const teamMonthYear = document.getElementById('teamMonthYear');
            
            if (conversionMonthYear) conversionMonthYear.textContent = monthYear;
            if (teamMonthYear) teamMonthYear.textContent = monthYear;
        }

        function setupNetworkMonitoring() {
            window.addEventListener('online', function() {
                isOnline = true;
                updateSyncStatus('online');
                if (GOOGLE_APPS_SCRIPT_URL) {
                    showNotification('üü¢ Conectado! Tentando sincronizar...', 'info');
                    forceSync();
                }
            });

            window.addEventListener('offline', function() {
                isOnline = false;
                updateSyncStatus('offline');
                showNotification('üî¥ Offline. Dados ser√£o salvos localmente.', 'warning');
            });
        }

        function updateSyncStatus(status) {
            const syncIcon = document.getElementById('syncIcon');
            const syncText = document.getElementById('syncText');
            
            if (!syncIcon || !syncText) return;
            
            switch(status) {
                case 'online':
                    syncIcon.textContent = 'üü¢';
                    syncText.textContent = 'Online';
                    break;
                case 'offline':
                    syncIcon.textContent = 'üî¥';
                    syncText.textContent = 'Offline';
                    break;
                case 'syncing':
                    syncIcon.textContent = 'üü°';
                    syncText.textContent = 'Sincronizando...';
                    break;
                case 'error':
                    syncIcon.textContent = '‚ö†Ô∏è';
                    syncText.textContent = 'Erro de sync';
                    break;
            }
        }

        function showLoadingMessage(message) {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';
            overlay.id = 'loadingOverlay';
            
            overlay.innerHTML = `
                <div class="loading-content">
                    <div class="spinner"></div>
                    <div style="margin-top: 10px; color: var(--text-primary); font-weight: bold;">${message}</div>
                </div>
            `;
            
            document.body.appendChild(overlay);
        }

        function hideLoadingMessage() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Backup autom√°tico dos dados
        function autoBackup() {
            if (currentUser) {
                saveDataToLocal();
                console.log('üíæ Backup autom√°tico realizado:', new Date().toLocaleTimeString());
            }
        }

        // Executar backup a cada 5 minutos
        setInterval(autoBackup, 5 * 60 * 1000);

        // Salvar ao fechar/recarregar a p√°gina
        window.addEventListener('beforeunload', function() {
            if (currentUser) {
                saveDataToLocal();
            }
        });

        console.log('üéÆ Sistema Game Creators Pro V2 carregado com sucesso!');
        console.log('üí° Sistema completo com todas as funcionalidades implementadas!');
        console.log('‚úÖ Novas funcionalidades: Calend√°rio, Chat, Notifica√ß√µes, Analytics Avan√ßado, Backup/Restore, Auditoria, Tema Escuro, Matr√≠cula R√°pida, Filtros Avan√ßados, Exporta√ß√£o, Previs√µes!');
    </script>
</body>
</html>
