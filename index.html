<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Creators Pro V2 - Sistema Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            --warning-gradient: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            --danger-gradient: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            --info-gradient: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            --dark-gradient: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            
            --bg-primary: #f7fafc;
            --bg-secondary: #edf2f7;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --shadow-sm: 0 4px 15px rgba(0,0,0,0.1);
            --shadow-lg: 0 20px 60px rgba(0,0,0,0.3);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --text-primary: #f7fafc;
            --text-secondary: #cbd5e0;
            --border-color: #4a5568;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            padding: 10px;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-card h1 {
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 14px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            transition: var(--transition);
            background: white;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input.valid {
            border-color: #38a169;
            background-color: #f0fff4;
        }

        .form-group input.invalid {
            border-color: #e53e3e;
            background-color: #fed7d7;
        }

        .search-box {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 14px;
            width: 100%;
            max-width: 300px;
            transition: var(--transition);
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: var(--success-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(56, 161, 105, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(56, 161, 105, 0.4);
        }

        .btn-danger {
            background: var(--danger-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3);
        }

        .btn-warning {
            background: var(--warning-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(237, 137, 54, 0.3);
        }

        .btn-info {
            background: var(--info-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(49, 130, 206, 0.3);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
            margin: 2px;
        }

        .quick-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .forgot-password {
            margin-top: 15px;
            font-size: 12px;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
        }

        .debug-buttons {
            margin-top: 20px;
            display: none;
        }

        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin: 0 auto;
            max-width: 100%;
            display: none;
            backdrop-filter: blur(20px);
        }

        .page-header {
            background: var(--dark-gradient);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><radialGradient id="a" cx="50%" cy="0%" r="100%"><stop offset="0%" stop-color="rgba(255,255,255,0.1)"/><stop offset="100%" stop-color="rgba(255,255,255,0)"/></radialGradient></defs><rect width="100" height="20" fill="url(%23a)"/></svg>');
            pointer-events: none;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .theme-toggle, .notification-bell {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: var(--transition);
        }

        .theme-toggle:hover, .notification-bell:hover {
            background: rgba(255,255,255,0.25);
        }

        .notification-bell {
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e53e3e;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--success-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .user-details h3 {
            font-size: 18px;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .user-level, .unit-badge, .sync-status {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 2px;
        }

        .unit-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 4px;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
        }

        .logout-btn {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }

        /* Filtro de unidade */
        .unit-filter {
            background: var(--bg-primary);
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .unit-selector {
            display: inline-block;
            margin: 0 10px;
            padding: 10px 20px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .unit-selector.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .nav-tabs {
            background: var(--bg-primary);
            padding: 0;
            display: flex;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
            overflow-x: auto;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 18px 24px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-size: 14px;
            white-space: nowrap;
            position: relative;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .tab-button:hover {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            color: #38a169;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            padding: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow-sm);
            border-left: 5px solid #38a169;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, rgba(56,161,105,0.08), rgba(104,211,145,0.08));
            border-radius: 50%;
            transform: translate(40px, -40px);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .stat-icon {
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .conversion-card {
            border-left-color: #ed8936;
        }

        .conversion-rate {
            font-size: 28px;
            font-weight: 800;
            color: #ed8936;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-gradient);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .notification {
            padding: 16px 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: 600;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 420px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.success {
            background: linear-gradient(135deg, rgba(199, 246, 213, 0.95), rgba(240, 253, 244, 0.95));
            color: #22543d;
            border-left: 4px solid #38a169;
        }

        .notification.error {
            background: linear-gradient(135deg, rgba(254, 215, 215, 0.95), rgba(255, 245, 245, 0.95));
            color: #742a2a;
            border-left: 4px solid #e53e3e;
        }

        .notification.warning {
            background: linear-gradient(135deg, rgba(254, 245, 231, 0.95), rgba(255, 251, 235, 0.95));
            color: #744210;
            border-left: 4px solid #ed8936;
        }

        .notification.info {
            background: linear-gradient(135deg, rgba(190, 227, 248, 0.95), rgba(235, 248, 255, 0.95));
            color: #2c5282;
            border-left: 4px solid #3182ce;
        }

        .hidden {
            display: none !important;
        }

        /* Tabelas */
        .data-table {
            width: 100%;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin-top: 20px;
        }

        .data-table th {
            background: var(--dark-gradient);
            color: white;
            padding: 20px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .data-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .data-table tr:hover {
            background: var(--bg-primary);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Chart container */
        .chart-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            margin: 20px 0;
        }

        .chart-canvas {
            width: 100%;
            height: 300px;
            background: var(--bg-primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Calendar */
        .calendar-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            margin: 20px 0;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
        }

        .calendar-day {
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .calendar-day:hover {
            background: var(--bg-primary);
        }

        .calendar-day.today {
            background: var(--primary-gradient);
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-events {
            background: rgba(56, 161, 105, 0.1);
            border: 2px solid #38a169;
        }

        /* Activity feed */
        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px 0;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .activity-item:hover {
            background: var(--bg-primary);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .activity-description {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .activity-time {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        /* Modal para notifica√ß√µes */
        .notification-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-lg);
            z-index: 9998;
            display: none;
            overflow: hidden;
        }

        .notification-panel-header {
            background: var(--dark-gradient);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-panel-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-item:hover {
            background: var(--bg-primary);
        }

        .notification-item.unread {
            background: rgba(102, 126, 234, 0.05);
            border-left: 4px solid #667eea;
        }

        /* Ranking espec√≠fico */
        .rank-1 { 
            background: linear-gradient(135deg, #ffd700, #ffed4e); 
            color: #2d3748; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .rank-2 { 
            background: linear-gradient(135deg, #c0c0c0, #e2e8f0); 
            color: #2d3748; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .rank-3 { 
            background: linear-gradient(135deg, #cd7f32, #dd6b20); 
            color: white; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .rank-other { 
            background: linear-gradient(135deg, #4a5568, #2d3748); 
            color: white; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Badges para roles */
        .role-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .role-vendedor {
            background: rgba(56, 161, 105, 0.1);
            color: #38a169;
        }
        
        .role-gerente {
            background: rgba(237, 137, 54, 0.1);
            color: #ed8936;
        }
        
        .role-assistente {
            background: rgba(49, 130, 206, 0.1);
            color: #3182ce;
        }
        
        .role-admin {
            background: rgba(229, 62, 62, 0.1);
            color: #e53e3e;
        }

        /* Gamifica√ß√£o */
        .mission-card {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            border: 2px solid #38a169;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            transition: var(--transition);
        }

        .mission-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(56, 161, 105, 0.2);
        }

        .mission-completed {
            background: linear-gradient(135deg, #c6f6d5, #e6fffa);
            border-color: #2f855a;
        }

        .mission-failed {
            background: linear-gradient(135deg, #fed7d7, #fef5e7);
            border-color: #e53e3e;
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .mission-title {
            font-weight: bold;
            color: var(--text-primary);
            font-size: 16px;
        }

        .mission-reward {
            background: #38a169;
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
        }

        .mission-progress {
            margin: 12px 0;
        }

        .achievement-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
            margin: 4px;
            transition: var(--transition);
            cursor: pointer;
        }

        .achievement-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .xp-badge {
            background: var(--primary-gradient);
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Se√ß√µes especiais */
        .team-overview {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            border: 2px solid #38a169;
            border-radius: 15px;
            padding: 25px;
            margin: 25px;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .team-member-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            text-align: center;
            transition: var(--transition);
        }

        .team-member-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .member-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: white;
            margin: 0 auto 15px;
        }

        .member-name {
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 16px;
        }

        .member-role {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .member-stats {
            font-size: 12px;
            color: #38a169;
            font-weight: 600;
        }

        .visits-section {
            background: linear-gradient(135deg, #fef5e7, #fed7c2);
            border: 2px solid #ed8936;
            border-radius: 15px;
            padding: 25px;
            margin: 25px;
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            min-width: 300px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Bot√µes de a√ß√£o */
        .action-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .close-modal {
            background: var(--danger-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
        }

        /* Export buttons */
        .export-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transition: var(--transition);
            z-index: 1000;
        }

        .floating-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
        }

        /* Estilos para Funcionalidades Avan√ßadas */
        .script-tab-content {
            margin-top: 20px;
        }

        .script-tab-content pre {
            max-height: 400px;
            overflow-y: auto;
        }

        .script-tab-content code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
        }

        .script-tab-content table {
            font-size: 12px;
        }

        .script-tab-content .form-group {
            margin-bottom: 15px;
        }

        .script-tab-content .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            display: block;
        }

        .script-tab-content .form-group input,
        .script-tab-content .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
        }

        .script-tab-content h5 {
            color: #38a169;
            margin: 20px 0 10px 0;
            font-weight: 600;
        }

        /* Estilos para Tour Guiado */
        #welcomeTour .modal-content {
            animation: slideInScale 0.5s ease-out;
        }

        @keyframes slideInScale {
            from { 
                opacity: 0; 
                transform: scale(0.8) translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0); 
            }
        }

        /* Estilos para Help Bubble */
        #helpBubble:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(49, 130, 206, 0.4);
        }

        /* Estilos para Widgets */
        #quickInfoWidget, #weatherWidget {
            animation: slideInLeft 0.3s ease-out;
        }

        @keyframes slideInLeft {
            from { 
                opacity: 0; 
                transform: translateX(-20px); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }

        /* Estilos para Exportador Avan√ßado */
        #advancedExporter .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }

        #exportProgress {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

        #exportProgressBar {
            transition: width 0.5s ease-out;
            box-shadow: 0 2px 10px rgba(56, 161, 105, 0.3);
        }

        #exportPreview {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
        }

        /* Estilos para Tags */
        .tag {
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
        }

        .tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Estilos para Atalhos de Teclado */
        kbd {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            box-shadow: 0 1px 0 rgba(0,0,0,0.2), 0 0 0 2px #fff inset;
            color: #333;
            display: inline-block;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 11px;
            font-weight: 700;
            line-height: 1;
            padding: 2px 4px;
            white-space: nowrap;
        }

        /* Anima√ß√µes suaves para elementos din√¢micos */
        .stat-card, .team-member-card, .mission-card {
            transition: var(--transition);
        }

        .stat-card:hover, .team-member-card:hover, .mission-card:hover {
            transform: translateY(-3px);
        }

        /* Indicadores visuais para funcionalidades ativas */
        .feature-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 12px;
            height: 12px;
            background: #38a169;
            border-radius: 50%;
            border: 2px solid white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Estilos para modo escuro melhorados */
        [data-theme="dark"] #quickInfoWidget,
        [data-theme="dark"] #weatherWidget {
            background: #2d3748;
            color: #f7fafc;
            border: 1px solid #4a5568;
        }

        [data-theme="dark"] .modal-content {
            background: #2d3748;
            color: #f7fafc;
        }

        [data-theme="dark"] kbd {
            background: #4a5568;
            color: #f7fafc;
            border-color: #718096;
        }

        /* Responsividade melhorada para dispositivos m√≥veis */
        @media (max-width: 768px) {
            #quickInfoWidget, #weatherWidget {
                position: relative;
                top: auto;
                left: auto;
                right: auto;
                margin: 10px;
                width: calc(100% - 20px);
            }
            
            #helpBubble {
                bottom: 140px;
                right: 20px;
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .tour-content, .help-content {
                padding: 15px;
            }
            
            #advancedExporter .modal-content {
                margin: 10px;
                max-width: calc(100% - 20px);
            }
        }

        /* Indicadores de status aprimorados */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-online {
            background: rgba(56, 161, 105, 0.1);
            color: #38a169;
        }

        .status-offline {
            background: rgba(229, 62, 62, 0.1);
            color: #e53e3e;
        }

        .status-syncing {
            background: rgba(237, 137, 54, 0.1);
            color: #ed8936;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 20px;
            }
            
            .nav-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .tab-button {
                min-width: 140px;
                padding: 16px 20px;
            }

            .user-info {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .page-header {
                padding: 20px;
                flex-direction: column;
                gap: 20px;
            }

            .stat-card {
                padding: 25px;
            }

            .notification {
                max-width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }

            .notification-panel {
                width: calc(100vw - 40px);
                right: 20px;
            }

            .team-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                flex-direction: column;
            }

            .action-buttons {
                flex-direction: column;
            }

            .floating-action-btn {
                bottom: 20px;
                right: 20px;
            }

            .login-card {
                padding: 30px 25px;
                margin: 20px;
            }

            .debug-buttons {
                flex-direction: column;
            }

            .btn {
                padding: 12px 20px;
                font-size: 13px;
            }

            .quick-actions .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .form-group {
                margin-bottom: 15px;
            }

            .dashboard-grid {
                padding: 15px;
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-value {
                font-size: 28px;
            }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .print-area, .print-area * {
                visibility: visible;
            }
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .btn, .action-buttons, .floating-action-btn {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <h1>üéÆ Game Creators</h1>
            <p class="login-subtitle">Sistema Avan√ßado de Comiss√µes e Gamifica√ß√£o V2 ULTIMATE</p>
            <div class="form-group">
                <label>üë§ Usu√°rio:</label>
                <input type="text" id="loginUsername" placeholder="Digite seu usu√°rio" autocomplete="username">
            </div>
            <div class="form-group">
                <label>üîí Senha:</label>
                <input type="password" id="loginPassword" placeholder="Digite sua senha" autocomplete="current-password">
            </div>
            <button class="btn btn-primary" onclick="login()" style="width: 100%; margin-top: 25px;">
                üöÄ Entrar no Sistema
            </button>
            <div class="forgot-password" onclick="showForgotPassword()">
                Esqueceu sua senha?
            </div>
            <div id="debugButtons" class="debug-buttons">
                <div style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; margin-top: 15px;">
                    <button class="btn btn-info btn-sm" onclick="diagnosticoCompleto()">üîç Diagn√≥stico</button>
                    <button class="btn btn-success btn-sm" onclick="criarUsuarioTeste()">üß™ Criar Teste</button>
                    <button class="btn btn-warning btn-sm" onclick="repararSistema()">üîß Reparar</button>
                    <button class="btn btn-primary btn-sm" onclick="loginAutomatico('admin@gamecreatorsadm.com')">üëë Admin</button>
                    <button class="btn btn-danger btn-sm" onclick="resetTotal()">üóëÔ∏è Reset</button>
                </div>
            </div>
            <div id="loginError" class="notification error hidden" style="position: relative; margin-top: 20px;">
                Usu√°rio ou senha incorretos!
            </div>
        </div>
    </div>

    <!-- Sistema Principal -->
    <div id="mainSystem" class="main-container">
        <!-- Header com Info do Usu√°rio -->
        <div class="page-header">
            <div class="header-content">
                <h1 id="headerTitle">üéÆ Game Creators Pro V2 ULTIMATE</h1>
                <p style="font-size: 14px; opacity: 0.8; margin-top: 4px;">Sistema Completo de Gest√£o e Gamifica√ß√£o</p>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()">üåô Modo Escuro</button>
                <div class="notification-bell" onclick="toggleNotificationPanel()">
                    üîî Notifica√ß√µes
                    <span class="notification-badge" id="notificationBadge">0</span>
                </div>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <h3 id="userName">Usu√°rio</h3>
                    <div class="user-level" id="userLevel">N√≠vel 1 - Iniciante</div>
                    <div class="unit-badge" id="userUnit">Shopping Conjunto Nacional</div>
                    <div class="sync-status" id="syncStatus">
                        <span id="syncIcon">üü¢</span>
                        <span id="syncText">Online</span>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">üö™ Sair</button>
            </div>
        </div>

        <!-- Painel de Notifica√ß√µes -->
        <div id="notificationPanel" class="notification-panel">
            <div class="notification-panel-header">
                üîî Notifica√ß√µes
                <button style="background: none; border: none; color: white; cursor: pointer;" onclick="toggleNotificationPanel()">√ó</button>
            </div>
            <div class="notification-panel-content" id="notificationPanelContent">
                <!-- Preenchido dinamicamente -->
            </div>
        </div>

        <!-- Filtro de Unidade (apenas para admins) -->
        <div id="unitFilter" class="unit-filter hidden">
            <strong>üè¢ Filtrar por Unidade:</strong>
            <div id="unitSelectors" style="margin-top: 15px;">
                <!-- Preenchido dinamicamente -->
            </div>
        </div>

        <!-- Navega√ß√£o -->
        <div class="nav-tabs" id="navTabs">
            <!-- Preenchido dinamicamente -->
        </div>

        <!-- Dashboard Principal -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid" id="dashboardGrid">
                <!-- Preenchido dinamicamente -->
            </div>

            <!-- Gr√°ficos de Performance -->
            <div style="padding: 30px;">
                <div class="chart-container">
                    <h3>üìà Performance Mensal</h3>
                    <div class="chart-canvas" id="performanceChart">
                        Gr√°fico de performance ser√° exibido aqui
                    </div>
                </div>

                <div class="chart-container">
                    <h3>üìä Convers√£o por Per√≠odo</h3>
                    <div class="chart-canvas" id="conversionChart">
                        Gr√°fico de convers√£o ser√° exibido aqui
                    </div>
                </div>
            </div>

            <!-- Atividades Recentes -->
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üìã Atividades Recentes</h3>
                    <div class="activity-feed" id="activityFeed">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Calend√°rio -->
        <div id="calendario" class="tab-content">
            <div style="padding: 30px;">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="changeMonth(-1)">‚óÄ Anterior</button>
                        <h3 id="calendarTitle">Janeiro 2024</h3>
                        <button class="calendar-nav" onclick="changeMonth(1)">Pr√≥ximo ‚ñ∂</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Eventos do Dia -->
                <div class="stat-card">
                    <h3>üìÖ Eventos de <span id="selectedDate">Hoje</span></h3>
                    <div id="dayEvents">
                        <p style="text-align: center; color: #666; padding: 20px;">Selecione um dia no calend√°rio para ver os eventos</p>
                    </div>
                </div>

                <!-- Adicionar Evento -->
                <div class="stat-card">
                    <h3>‚ûï Adicionar Evento/Lembrete</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>T√≠tulo:</label>
                            <input type="text" id="eventTitle" placeholder="Ex: Reuni√£o de equipe">
                        </div>
                        <div class="form-group">
                            <label>Data:</label>
                            <input type="date" id="eventDate">
                        </div>
                        <div class="form-group">
                            <label>Hora:</label>
                            <input type="time" id="eventTime">
                        </div>
                        <div class="form-group">
                            <label>Tipo:</label>
                            <select id="eventType">
                                <option value="reuniao">üìã Reuni√£o</option>
                                <option value="meta">üéØ Meta</option>
                                <option value="lembrete">üîî Lembrete</option>
                                <option value="evento">üéâ Evento</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o:</label>
                        <textarea id="eventDescription" rows="3" placeholder="Detalhes do evento..."></textarea>
                    </div>
                    <button class="btn btn-success" onclick="addEvent()">üìÖ Adicionar Evento</button>
                </div>
            </div>
        </div>

        <!-- Gamifica√ß√£o -->
        <div id="gamificacao" class="tab-content">
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üéÆ Meu Progresso Gamer</h3>
                    <div id="userProgress">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üéØ Miss√µes Ativas</h3>
                    <div id="activeMissions">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üèÜ Hall da Fama</h3>
                    <div id="userAchievements">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Loja de Recompensas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üõí Loja de Recompensas</h3>
                    <div id="rewardsStore">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div style="border: 2px solid #38a169; border-radius: 12px; padding: 20px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üéÅ</div>
                                <h4>Vale Presente R$ 50</h4>
                                <p style="color: #666; font-size: 12px; margin: 10px 0;">Troque por vale presente</p>
                                <div style="font-weight: bold; color: #38a169; margin-bottom: 15px;">1000 XP</div>
                                <button class="btn btn-success btn-sm" onclick="redeemReward('gift50', 1000)">üõí Resgatar</button>
                            </div>
                            <div style="border: 2px solid #ed8936; border-radius: 12px; padding: 20px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üèñÔ∏è</div>
                                <h4>Dia de Folga Extra</h4>
                                <p style="color: #666; font-size: 12px; margin: 10px 0;">Um dia de descanso merecido</p>
                                <div style="font-weight: bold; color: #ed8936; margin-bottom: 15px;">2000 XP</div>
                                <button class="btn btn-warning btn-sm" onclick="redeemReward('dayoff', 2000)">üõí Resgatar</button>
                            </div>
                            <div style="border: 2px solid #667eea; border-radius: 12px; padding: 20px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üéñÔ∏è</div>
                                <h4>Certificado Destaque</h4>
                                <p style="color: #666; font-size: 12px; margin: 10px 0;">Reconhecimento oficial</p>
                                <div style="font-weight: bold; color: #667eea; margin-bottom: 15px;">1500 XP</div>
                                <button class="btn btn-primary btn-sm" onclick="redeemReward('certificate', 1500)">üõí Resgatar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Criar Miss√£o (Admin/Gerente) -->
                <div id="createMissionSection" class="stat-card hidden" style="margin-top: 25px;">
                    <h3>‚ûï Criar Nova Miss√£o</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>T√≠tulo da Miss√£o:</label>
                            <input type="text" id="missionTitle" placeholder="Ex: Vender 5 matr√≠culas esta semana">
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o:</label>
                            <textarea id="missionDescription" rows="3" placeholder="Descri√ß√£o detalhada da miss√£o..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Tipo:</label>
                            <select id="missionType">
                                <option value="vendas">üìä Meta de Vendas</option>
                                <option value="visitas">üë• Meta de Visitas</option>
                                <option value="conversao">üìà Meta de Convers√£o</option>
                                <option value="especial">‚≠ê Miss√£o Especial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Meta (n√∫mero):</label>
                            <input type="number" id="missionTarget" min="1" placeholder="Ex: 5">
                        </div>
                        <div class="form-group">
                            <label>Recompensa (XP):</label>
                            <input type="number" id="missionReward" min="10" placeholder="Ex: 100">
                        </div>
                        <div class="form-group">
                            <label>Prazo:</label>
                            <input type="date" id="missionDeadline">
                        </div>
                        <div class="form-group">
                            <label>Para quem:</label>
                            <select id="missionTarget_user">
                                <option value="all">Todos da unidade</option>
                                <option value="vendedores">Apenas vendedores</option>
                                <option value="assistentes">Apenas assistentes</option>
                                <option value="specific">Pessoa espec√≠fica</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="createMission()" style="margin-top: 15px;">üéØ Criar Miss√£o</button>
                </div>
            </div>
        </div>

        <!-- Visitas e Convers√£o -->
        <div id="visitas" class="tab-content">
            <div class="visits-section">
                <h3>üë• Central de Visitas - <span id="visitsUnitName">Shopping Conjunto Nacional</span></h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="form-group">
                        <label>üìÖ Data da Visita:</label>
                        <input type="date" id="visitDate" required>
                    </div>
                    <div class="form-group">
                        <label>üë§ Nome do Visitante:</label>
                        <input type="text" id="visitName" placeholder="Nome completo" required>
                    </div>
                    <div class="form-group">
                        <label>üì± Telefone:</label>
                        <input type="tel" id="visitPhone" placeholder="(11) 99999-9999" required>
                    </div>
                    <div class="form-group">
                        <label>üéì Curso de Interesse:</label>
                        <select id="visitCourse" required>
                            <option value="">Selecione...</option>
                            <option value="Creators 2D">Creators 2D</option>
                            <option value="Creators 3D">Creators 3D</option>
                            <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                            <option value="Creators Dev">Creators Dev</option>
                            <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üë®‚Äçüíº Atendido por:</label>
                        <select id="visitAttendant" required>
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üìù Observa√ß√µes:</label>
                        <input type="text" id="visitNotes" placeholder="Ex: Muito interessado, vai decidir em 3 dias...">
                    </div>
                </div>
                
                <div class="quick-actions">
                    <button class="btn btn-success" onclick="addVisit()">‚ú® Registrar Visita</button>
                    <button class="btn btn-warning" onclick="convertVisitToMatricula()">üéØ Converter em Matr√≠cula</button>
                </div>
            </div>
            
            <div style="padding: 30px;">
                <!-- Filtros de Visitas -->
                <div class="stat-card">
                    <h3>üîç Filtros de Visitas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>üóìÔ∏è Per√≠odo:</label>
                            <select id="visitPeriodFilter" onchange="filterVisits()">
                                <option value="today">Hoje</option>
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este M√™s</option>
                                <option value="all">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üë§ Atendente:</label>
                            <select id="visitAttendantFilter" onchange="filterVisits()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìä Status:</label>
                            <select id="visitStatusFilter" onchange="filterVisits()">
                                <option value="">Todos</option>
                                <option value="pending">Pendentes</option>
                                <option value="converted">Convertidos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üîç Buscar:</label>
                            <input type="text" class="search-box" id="visitSearchBox" placeholder="Nome ou telefone..." onkeyup="filterVisits()">
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <h3>üìä Dashboard de Convers√£o - <span id="conversionMonthYear">Dezembro 2024</span></h3>
                    <div id="conversionMetrics">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
                
                <div class="stat-card" style="margin-top: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>üìã Hist√≥rico de Visitas</h3>
                        <div class="export-buttons">
                            <button class="btn btn-info btn-sm" onclick="exportVisits('csv')">üìÑ CSV</button>
                            <button class="btn btn-warning btn-sm" onclick="exportVisits('excel')">üìä Excel</button>
                        </div>
                    </div>
                    <div id="recentVisits" style="max-height: 450px; overflow-y: auto;">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Equipe (apenas para gerentes) -->
        <div id="equipe" class="tab-content">
            <div class="team-overview">
                <h3>üë• Minha Equipe - <span id="teamUnitName">Shopping Conjunto Nacional</span></h3>
                <div class="team-grid" id="teamGrid">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>
            
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üìä Performance da Equipe - <span id="teamMonthYear">Dezembro 2024</span></h3>
                    <div id="teamPerformance">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Comunica√ß√£o da Equipe -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üí¨ Comunica√ß√£o da Equipe</h3>
                    <div class="form-group">
                        <label>üì¢ Enviar Mensagem para a Equipe:</label>
                        <textarea id="teamMessage" rows="3" placeholder="Digite sua mensagem para toda a equipe..."></textarea>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="sendTeamMessage()">üì§ Enviar Mensagem</button>
                        <button class="btn btn-success" onclick="scheduleTeamMeeting()">üìÖ Agendar Reuni√£o</button>
                    </div>
                </div>

                <!-- Metas Individuais -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üéØ Definir Metas Individuais</h3>
                    <div id="individualGoals">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Ranking -->
        <div id="ranking" class="tab-content">
            <div style="padding: 30px;">
                <!-- Filtros do Ranking -->
                <div class="stat-card">
                    <h3>üîç Filtros do Ranking</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>üìÖ Per√≠odo:</label>
                            <select id="rankingPeriod" onchange="updateRanking()">
                                <option value="month" selected>Este M√™s</option>
                                <option value="quarter">Trimestre</option>
                                <option value="year">Este Ano</option>
                                <option value="all">Todos os Tempos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìä Crit√©rio:</label>
                            <select id="rankingCriteria" onchange="updateRanking()">
                                <option value="matriculas" selected>Matr√≠culas</option>
                                <option value="conversao">Taxa de Convers√£o</option>
                                <option value="visitas">Visitas</option>
                                <option value="xp">Experi√™ncia (XP)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üè¢ Unidade:</label>
                            <select id="rankingUnit" onchange="updateRanking()">
                                <option value="">Todas</option>
                            </select>
                        </div>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üèÜ Ranking</th>
                            <th>üë§ Nome</th>
                            <th>üè¢ Unidade</th>
                            <th>üíº Cargo</th>
                            <th>üë• Visitas</th>
                            <th>üìä Matr√≠culas</th>
                            <th>üìà Convers√£o</th>
                            <th>üí∞ Comiss√£o</th>
                            <th>‚≠ê Experi√™ncia</th>
                        </tr>
                    </thead>
                    <tbody id="rankingBody">
                        <!-- Preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Painel Admin -->
        <div id="admin" class="tab-content">
            <div style="padding: 30px;">
                <h2>üë®‚Äçüíº Painel Administrativo</h2>
                
                <!-- Analytics Avan√ßado -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>üìà Analytics Avan√ßado</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                            <div style="font-size: 28px; font-weight: bold; color: #38a169;" id="totalRevenue">R$ 0</div>
                            <div style="font-size: 14px; color: #666;">Faturamento Total</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                            <div style="font-size: 28px; font-weight: bold; color: #667eea;" id="avgTicket">R$ 0</div>
                            <div style="font-size: 14px; color: #666;">Ticket M√©dio</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                            <div style="font-size: 28px; font-weight: bold; color: #ed8936;" id="growthRate">0%</div>
                            <div style="font-size: 14px; color: #666;">Crescimento Mensal</div>
                        </div>
                    </div>
                </div>

                <!-- Backup e Restore -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>üíæ Backup e Restore</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="createBackup()">üì¶ Criar Backup</button>
                        <button class="btn btn-warning" onclick="downloadBackup()">‚¨áÔ∏è Download Backup</button>
                        <input type="file" id="backupFile" accept=".json" style="display: none;" onchange="restoreBackup()">
                        <button class="btn btn-info" onclick="document.getElementById('backupFile').click()">‚¨ÜÔ∏è Restaurar Backup</button>
                        <button class="btn btn-danger" onclick="resetSystem()">üóëÔ∏è Reset Sistema</button>
                    </div>
                    <div id="backupStatus" style="margin-top: 15px; font-size: 12px; color: #666;"></div>
                </div>

                <!-- Configura√ß√µes do Sistema -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>‚öôÔ∏è Configura√ß√µes do Sistema</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div class="form-group">
                            <label>üîÑ Sincroniza√ß√£o Autom√°tica:</label>
                            <select id="autoSyncInterval">
                                <option value="0">Desabilitada</option>
                                <option value="300000">5 minutos</option>
                                <option value="600000" selected>10 minutos</option>
                                <option value="1800000">30 minutos</option>
                                <option value="3600000">1 hora</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìß Email Administrativo:</label>
                            <input type="email" id="adminEmail" placeholder="admin@gamecreatorsadm.com">
                        </div>
                        <div class="form-group">
                            <label>üåê URL da Empresa:</label>
                            <input type="url" id="companyUrl" placeholder="https://gamecreatorsadm.com">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="saveSystemConfig()">üíæ Salvar Configura√ß√µes</button>
                </div>

                <!-- Gerenciar Unidades -->
                <div class="stat-card" style="max-width: 600px; margin: 20px 0;">
                    <h3>üè¢ Gerenciar Unidades</h3>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: end;">
                        <div class="form-group">
                            <label>Nome da Nova Unidade:</label>
                            <input type="text" id="newUnitName" placeholder="Ex: Shopping Iguatemi">
                        </div>
                        <button class="btn btn-success" onclick="addNewUnit()">‚ûï Adicionar Unidade</button>
                    </div>
                    <div id="currentUnits" style="margin-top: 15px;">
                        <h4>Unidades Ativas:</h4>
                        <div id="unitsList">
                            <!-- Preenchido dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Scripts e Templates Google Sheets -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>üìù Scripts e Templates para Google Sheets</h3>
                    <p style="color: #666; margin-bottom: 20px;">Scripts prontos e templates para facilitar a integra√ß√£o com Google Sheets.</p>

                    <!-- Navega√ß√£o por Abas -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--border-color);">
                        <button class="btn btn-primary btn-sm" onclick="showScriptTab('setup')" id="setupTab">üîß Configura√ß√£o</button>
                        <button class="btn btn-info btn-sm" onclick="showScriptTab('script')" id="scriptTab">üìú Google Apps Script</button>
                        <button class="btn btn-success btn-sm" onclick="showScriptTab('template')" id="templateTab">üìä Template Planilha</button>
                        <button class="btn btn-warning btn-sm" onclick="showScriptTab('webhook')" id="webhookTab">üîó Webhook</button>
                    </div>

                    <!-- Aba Configura√ß√£o -->
                    <div id="setupContent" class="script-tab-content">
                        <h4>üîß Passo a Passo da Configura√ß√£o</h4>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; line-height: 1.6;">
                            <h5>1Ô∏è‚É£ Criar Projeto no Google Cloud Console</h5>
                            <ol style="margin: 10px 0; padding-left: 20px;">
                                <li>Acesse <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a></li>
                                <li>Crie um novo projeto ou selecione um existente</li>
                                <li>V√° em "APIs e Servi√ßos" ‚Üí "Biblioteca"</li>
                                <li>Procure e ative "Google Sheets API"</li>
                                <li>V√° em "Credenciais" ‚Üí "Criar Credenciais" ‚Üí "Chave de API"</li>
                                <li>Copie a chave gerada</li>
                            </ol>

                            <h5>2Ô∏è‚É£ Configurar Planilha Google Sheets</h5>
                            <ol style="margin: 10px 0; padding-left: 20px;">
                                <li>Crie uma nova planilha no Google Sheets</li>
                                <li>Configure as colunas conforme o template</li>
                                <li>V√° em "Compartilhar" ‚Üí Alterar para "Qualquer pessoa com o link pode editar"</li>
                                <li>Copie o link da planilha</li>
                            </ol>

                            <h5>3Ô∏è‚É£ Configurar no Game Creators</h5>
                            <ol style="margin: 10px 0; padding-left: 20px;">
                                <li>Cole a URL da planilha no campo acima</li>
                                <li>Insira a API Key obtida</li>
                                <li>Configure o nome da aba (padr√£o: Sheet1)</li>
                                <li>Clique em "Testar Conex√£o"</li>
                                <li>Configure o mapeamento de colunas</li>
                            </ol>

                            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <strong>‚ö†Ô∏è Importante:</strong><br>
                                ‚Ä¢ Sempre fa√ßa backup antes da primeira sincroniza√ß√£o<br>
                                ‚Ä¢ Teste em uma planilha separada primeiro<br>
                                ‚Ä¢ Monitore os logs de sincroniza√ß√£o<br>
                                ‚Ä¢ Configure sincroniza√ß√£o autom√°tica ap√≥s testes
                            </div>
                        </div>
                    </div>

                    <!-- Aba Google Apps Script -->
                    <div id="scriptContent" class="script-tab-content" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4>üìú Google Apps Script (Opcional)</h4>
                            <button class="btn btn-info btn-sm" onclick="copyScriptCode()">üìã Copiar Script</button>
                        </div>
                        <p style="color: #666; margin-bottom: 15px;">Script para automatizar opera√ß√µes avan√ßadas na planilha:</p>
                        
                        <pre id="googleAppsScript" style="background: #f8f9fa; padding: 20px; border-radius: 8px; overflow-x: auto; font-size: 12px; line-height: 1.4;"><code>/**
 * Game Creators Pro - Google Apps Script
 * Automatiza opera√ß√µes na planilha Google Sheets
 */

// Configura√ß√µes
const CONFIG = {
  SHEET_NAME: 'Vendas', // Nome da aba
  WEBHOOK_URL: 'https://seu-webhook.com/sync', // URL do seu webhook
  EMAIL_NOTIFICACAO: 'admin@gamecreatorsadm.com'
};

/**
 * Fun√ß√£o principal executada quando dados s√£o alterados
 */
function onEdit(e) {
  console.log('Dados alterados na planilha');
  
  // Verificar se a altera√ß√£o foi na aba correta
  if (e.source.getActiveSheet().getName() !== CONFIG.SHEET_NAME) return;
  
  // Processar altera√ß√£o
  processarAlteracao(e);
}

/**
 * Processar altera√ß√£o na planilha
 */
function processarAlteracao(e) {
  const range = e.range;
  const value = e.value;
  const row = range.getRow();
  const col = range.getColumn();
  
  console.log(`Linha ${row}, Coluna ${col}: ${value}`);
  
  // Validar dados
  if (validarDados(row, col, value)) {
    // Aplicar formata√ß√£o autom√°tica
    aplicarFormatacao(range);
    
    // Calcular totais se necess√°rio
    calcularTotais();
    
    // Notificar webhook (opcional)
    notificarWebhook({
      tipo: 'alteracao',
      linha: row,
      coluna: col,
      valor: value,
      timestamp: new Date().toISOString()
    });
  }
}

/**
 * Validar dados inseridos
 */
function validarDados(row, col, value) {
  const sheet = SpreadsheetApp.getActiveSheet();
  
  // Validar email (coluna 3)
  if (col === 3 && value) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(value)) {
      SpreadsheetApp.getUi().alert('Email inv√°lido!');
      return false;
    }
  }
  
  // Validar telefone (coluna 4)
  if (col === 4 && value) {
    const phoneRegex = /^\(\d{2}\)\s\d{4,5}-\d{4}$/;
    if (!phoneRegex.test(value)) {
      sheet.getRange(row, col).setNote('Formato: (11) 99999-9999');
    }
  }
  
  // Validar valores monet√°rios (colunas 6 e 7)
  if ((col === 6 || col === 7) && value) {
    if (isNaN(value) || value < 0) {
      SpreadsheetApp.getUi().alert('Valor deve ser num√©rico e positivo!');
      return false;
    }
  }
  
  return true;
}

/**
 * Aplicar formata√ß√£o autom√°tica
 */
function aplicarFormatacao(range) {
  const col = range.getColumn();
  
  // Formatar valores monet√°rios
  if (col === 6 || col === 7) {
    range.setNumberFormat('R$ #,##0.00');
  }
  
  // Formatar datas
  if (col === 1) {
    range.setNumberFormat('dd/mm/yyyy');
  }
  
  // Formatar telefone
  if (col === 4) {
    range.setNumberFormat('@'); // Texto
  }
}

/**
 * Calcular totais autom√°ticos
 */
function calcularTotais() {
  const sheet = SpreadsheetApp.getActiveSheet();
  const lastRow = sheet.getLastRow();
  
  if (lastRow < 2) return; // N√£o h√° dados al√©m do cabe√ßalho
  
  // Calcular total de vendas (coluna F)
  const totalVendas = `=SUM(F2:F${lastRow})`;
  sheet.getRange('F1').setNote('Total: ' + totalVendas);
  
  // Calcular m√©dia de tickets
  const mediaTicket = `=AVERAGE(F2:F${lastRow})`;
  sheet.getRange('G1').setNote('M√©dia: ' + mediaTicket);
  
  // Contar matr√≠culas por curso
  contarMatriculasPorCurso();
}

/**
 * Contar matr√≠culas por curso
 */
function contarMatriculasPorCurso() {
  const sheet = SpreadsheetApp.getActiveSheet();
  const data = sheet.getDataRange().getValues();
  
  const cursos = {};
  
  // Contar (assumindo curso na coluna E)
  for (let i = 1; i < data.length; i++) {
    const curso = data[i][4]; // Coluna E (√≠ndice 4)
    if (curso) {
      cursos[curso] = (cursos[curso] || 0) + 1;
    }
  }
  
  // Registrar no log
  console.log('Matr√≠culas por curso:', cursos);
}

/**
 * Enviar notifica√ß√£o para webhook
 */
function notificarWebhook(dados) {
  if (!CONFIG.WEBHOOK_URL) return;
  
  try {
    const payload = {
      'source': 'google_sheets',
      'event': 'data_changed',
      'data': dados,
      'spreadsheet_id': SpreadsheetApp.getActive().getId(),
      'sheet_name': CONFIG.SHEET_NAME
    };
    
    const options = {
      'method': 'POST',
      'contentType': 'application/json',
      'payload': JSON.stringify(payload)
    };
    
    UrlFetchApp.fetch(CONFIG.WEBHOOK_URL, options);
    
  } catch (error) {
    console.error('Erro ao notificar webhook:', error);
  }
}

/**
 * Fun√ß√£o para importar dados do Game Creators
 */
function importarDadosGameCreators() {
  // Esta fun√ß√£o seria chamada por trigger ou manualmente
  console.log('Importando dados do Game Creators...');
  
  // Implementar l√≥gica de importa√ß√£o via API
  // Exemplo: fetch dos dados do sistema e inser√ß√£o na planilha
}

/**
 * Fun√ß√£o para exportar dados para Game Creators
 */
function exportarDadosGameCreators() {
  const sheet = SpreadsheetApp.getActiveSheet();
  const data = sheet.getDataRange().getValues();
  
  // Converter para formato JSON
  const headers = data[0];
  const jsonData = [];
  
  for (let i = 1; i < data.length; i++) {
    const row = {};
    for (let j = 0; j < headers.length; j++) {
      row[headers[j]] = data[i][j];
    }
    jsonData.push(row);
  }
  
  console.log('Dados exportados:', jsonData);
  
  // Enviar para Game Creators via webhook
  if (CONFIG.WEBHOOK_URL) {
    notificarWebhook({
      tipo: 'exportacao_completa',
      dados: jsonData,
      timestamp: new Date().toISOString()
    });
  }
}

/**
 * Configurar triggers autom√°ticos
 */
function configurarTriggers() {
  // Deletar triggers existentes
  const triggers = ScriptApp.getProjectTriggers();
  triggers.forEach(trigger => ScriptApp.deleteTrigger(trigger));
  
  // Criar novo trigger para edi√ß√µes
  ScriptApp.newTrigger('onEdit')
    .onEdit()
    .create();
  
  // Trigger para sincroniza√ß√£o di√°ria
  ScriptApp.newTrigger('sincronizacaoDiaria')
    .timeBased()
    .everyDays(1)
    .atHour(8) // 8h da manh√£
    .create();
    
  console.log('Triggers configurados com sucesso');
}

/**
 * Sincroniza√ß√£o di√°ria autom√°tica
 */
function sincronizacaoDiaria() {
  console.log('Executando sincroniza√ß√£o di√°ria...');
  
  // Backup dos dados
  backupDados();
  
  // Limpar dados antigos (opcional)
  // limparDadosAntigos();
  
  // Importar novos dados
  importarDadosGameCreators();
  
  // Enviar relat√≥rio por email
  enviarRelatorioEmail();
}

/**
 * Criar backup dos dados
 */
function backupDados() {
  const sheet = SpreadsheetApp.getActiveSheet();
  const backupSheet = SpreadsheetApp.getActive()
    .insertSheet('Backup_' + Utilities.formatDate(new Date(), 'GMT-3', 'yyyy-MM-dd'));
  
  // Copiar dados
  const data = sheet.getDataRange().getValues();
  backupSheet.getRange(1, 1, data.length, data[0].length).setValues(data);
  
  console.log('Backup criado:', backupSheet.getName());
}

/**
 * Enviar relat√≥rio por email
 */
function enviarRelatorioEmail() {
  if (!CONFIG.EMAIL_NOTIFICACAO) return;
  
  const sheet = SpreadsheetApp.getActiveSheet();
  const lastRow = sheet.getLastRow();
  
  const assunto = `Game Creators - Relat√≥rio Di√°rio ${Utilities.formatDate(new Date(), 'GMT-3', 'dd/MM/yyyy')}`;
  const corpo = `
    Relat√≥rio autom√°tico do Game Creators:
    
    üìä Total de registros: ${lastRow - 1}
    üìÖ Data: ${Utilities.formatDate(new Date(), 'GMT-3', 'dd/MM/yyyy HH:mm')}
    üìã Planilha: ${SpreadsheetApp.getActive().getName()}
    
    Acesse a planilha: ${SpreadsheetApp.getActive().getUrl()}
    
    --
    Game Creators Pro V2 ULTIMATE
  `;
  
  try {
    MailApp.sendEmail(CONFIG.EMAIL_NOTIFICACAO, assunto, corpo);
    console.log('Relat√≥rio enviado por email');
  } catch (error) {
    console.error('Erro ao enviar email:', error);
  }
}

// Executar configura√ß√£o inicial
function instalarScript() {
  console.log('Instalando Game Creators Script...');
  configurarTriggers();
  console.log('Script instalado com sucesso!');
}</code></pre>
                    </div>

                    <!-- Aba Template Planilha -->
                    <div id="templateContent" class="script-tab-content" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4>üìä Template da Planilha</h4>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-success btn-sm" onclick="createGoogleSheetTemplate()">üîó Criar Planilha Template</button>
                                <button class="btn btn-info btn-sm" onclick="copyTemplateHeaders()">üìã Copiar Cabe√ßalhos</button>
                            </div>
                        </div>
                        
                        <p style="color: #666; margin-bottom: 15px;">Estrutura recomendada para a planilha Google Sheets:</p>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                            <h5>üìã Aba "Matr√≠culas" - Colunas Recomendadas:</h5>
                            <table class="data-table" style="margin-top: 15px;">
                                <thead>
                                    <tr>
                                        <th>Coluna</th>
                                        <th>Campo</th>
                                        <th>Tipo</th>
                                        <th>Exemplo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>A</td><td>Data</td><td>Data</td><td>01/12/2024</td></tr>
                                    <tr><td>B</td><td>Nome</td><td>Texto</td><td>Jo√£o Silva</td></tr>
                                    <tr><td>C</td><td>Email</td><td>Texto</td><td>joao@email.com</td></tr>
                                    <tr><td>D</td><td>Telefone</td><td>Texto</td><td>(11) 99999-9999</td></tr>
                                    <tr><td>E</td><td>Curso</td><td>Texto</td><td>Creators 2D</td></tr>
                                    <tr><td>F</td><td>Valor Total</td><td>Moeda</td><td>R$ 2.500,00</td></tr>
                                    <tr><td>G</td><td>Valor Entrada</td><td>Moeda</td><td>R$ 500,00</td></tr>
                                    <tr><td>H</td><td>Tipo Venda</td><td>Texto</td><td>Convencional</td></tr>
                                    <tr><td>I</td><td>Parcelas</td><td>N√∫mero</td><td>6</td></tr>
                                    <tr><td>J</td><td>Vendedor</td><td>Texto</td><td>Ana Silva</td></tr>
                                    <tr><td>K</td><td>Gerente</td><td>Texto</td><td>Carlos Manager</td></tr>
                                    <tr><td>L</td><td>Assistente</td><td>Texto</td><td>Jo√£o Santos</td></tr>
                                    <tr><td>M</td><td>Unidade</td><td>Texto</td><td>Shopping Conjunto Nacional</td></tr>
                                    <tr><td>N</td><td>Comiss√£o Vendedor</td><td>Moeda</td><td>R$ 150,00</td></tr>
                                    <tr><td>O</td><td>Comiss√£o Gerente</td><td>Moeda</td><td>R$ 62,50</td></tr>
                                    <tr><td>P</td><td>Comiss√£o Assistente</td><td>Moeda</td><td>R$ 37,50</td></tr>
                                </tbody>
                            </table>

                            <h5 style="margin-top: 25px;">üë• Aba "Visitas" - Colunas Recomendadas:</h5>
                            <table class="data-table" style="margin-top: 15px;">
                                <thead>
                                    <tr>
                                        <th>Coluna</th>
                                        <th>Campo</th>
                                        <th>Tipo</th>
                                        <th>Exemplo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>A</td><td>Data</td><td>Data</td><td>01/12/2024</td></tr>
                                    <tr><td>B</td><td>Nome</td><td>Texto</td><td>Maria Santos</td></tr>
                                    <tr><td>C</td><td>Telefone</td><td>Texto</td><td>(11) 88888-8888</td></tr>
                                    <tr><td>D</td><td>Curso Interesse</td><td>Texto</td><td>Creators 3D</td></tr>
                                    <tr><td>E</td><td>Atendente</td><td>Texto</td><td>Ana Silva</td></tr>
                                    <tr><td>F</td><td>Status</td><td>Lista</td><td>Pendente/Convertido</td></tr>
                                    <tr><td>G</td><td>Unidade</td><td>Texto</td><td>Shopping Conjunto Nacional</td></tr>
                                    <tr><td>H</td><td>Observa√ß√µes</td><td>Texto</td><td>Muito interessado</td></tr>
                                </tbody>
                            </table>

                            <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px;">
                                <strong>üí° Dicas para a Planilha:</strong><br>
                                ‚Ä¢ Use valida√ß√£o de dados para campos como Status<br>
                                ‚Ä¢ Configure formata√ß√£o condicional para destacar convers√µes<br>
                                ‚Ä¢ Crie f√≥rmulas para calcular totais automaticamente<br>
                                ‚Ä¢ Use filtros para facilitar a an√°lise dos dados<br>
                                ‚Ä¢ Configure prote√ß√£o para c√©lulas importantes
                            </div>
                        </div>
                    </div>

                    <!-- Aba Webhook -->
                    <div id="webhookContent" class="script-tab-content" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4>üîó Configura√ß√£o de Webhook</h4>
                            <button class="btn btn-warning btn-sm" onclick="copyWebhookCode()">üìã Copiar C√≥digo</button>
                        </div>
                        
                        <p style="color: #666; margin-bottom: 15px;">Configure um endpoint para receber notifica√ß√µes em tempo real:</p>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                            <h5>üåê URL do Webhook:</h5>
                            <div class="form-group">
                                <input type="url" id="webhookUrl" placeholder="https://seu-servidor.com/webhook/game-creators" style="width: 100%;">
                                <small style="color: #666;">URL do seu servidor que receber√° as notifica√ß√µes</small>
                            </div>

                            <h5>üîß Exemplo de C√≥digo PHP:</h5>
                            <pre id="webhookCode" style="background: #263238; color: #eeffff; padding: 20px; border-radius: 8px; overflow-x: auto; font-size: 12px; margin-top: 15px;"><code>&lt;?php
/**
 * Webhook Game Creators Pro - Receptor
 * Processa notifica√ß√µes do Google Sheets
 */

// Configura√ß√µes
define('LOG_FILE', 'game_creators_webhook.log');
define('SECRET_KEY', 'sua_chave_secreta_aqui');

// Verificar m√©todo
if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    http_response_code(405);
    exit('M√©todo n√£o permitido');
}

// Ler dados recebidos
$input = file_get_contents('php://input');
$data = json_decode($input, true);

// Validar dados
if (!$data || !isset($data['source']) || $data['source'] !== 'google_sheets') {
    http_response_code(400);
    exit('Dados inv√°lidos');
}

// Log da requisi√ß√£o
error_log(date('Y-m-d H:i:s') . " - Webhook recebido: " . $input . "\n", 3, LOG_FILE);

// Processar diferentes tipos de eventos
switch ($data['event']) {
    case 'data_changed':
        processarAlteracaoSheet($data);
        break;
        
    case 'exportacao_completa':
        processarExportacaoCompleta($data);
        break;
        
    default:
        error_log("Evento desconhecido: " . $data['event'], 3, LOG_FILE);
}

/**
 * Processar altera√ß√£o na planilha
 */
function processarAlteracaoSheet($data) {
    $alteracao = $data['data'];
    
    // Validar dados da altera√ß√£o
    if (!isset($alteracao['linha']) || !isset($alteracao['valor'])) {
        return false;
    }
    
    // Conectar com banco de dados
    $pdo = conectarBanco();
    
    // Processar baseado na linha alterada
    if ($alteracao['linha'] > 1) { // Ignorar cabe√ßalho
        
        // Buscar dados completos da linha na planilha
        $dadosLinha = buscarDadosLinha($data['spreadsheet_id'], $alteracao['linha']);
        
        if ($dadosLinha) {
            // Atualizar ou inserir no banco local
            atualizarBancoLocal($dadosLinha);
            
            // Notificar outros sistemas
            notificarSistemasIntegrados($dadosLinha);
        }
    }
    
    return true;
}

/**
 * Processar exporta√ß√£o completa
 */
function processarExportacaoCompleta($data) {
    $dados = $data['dados'];
    
    if (!is_array($dados)) {
        return false;
    }
    
    $pdo = conectarBanco();
    
    // Processar cada registro
    foreach ($dados as $registro) {
        atualizarBancoLocal($registro);
    }
    
    // Gerar relat√≥rio de sincroniza√ß√£o
    gerarRelatorioSincronizacao(count($dados));
    
    return true;
}

/**
 * Conectar com banco de dados
 */
function conectarBanco() {
    try {
        $pdo = new PDO(
            'mysql:host=localhost;dbname=game_creators',
            'usuario',
            'senha',
            [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]
        );
        return $pdo;
    } catch (PDOException $e) {
        error_log("Erro de conex√£o: " . $e->getMessage(), 3, LOG_FILE);
        return null;
    }
}

/**
 * Buscar dados completos da linha na planilha
 */
function buscarDadosLinha($spreadsheetId, $linha) {
    // Implementar chamada √† API do Google Sheets
    // para buscar dados completos da linha
    
    $apiKey = 'sua_api_key_aqui';
    $range = "Sheet1!A{$linha}:P{$linha}";
    $url = "https://sheets.googleapis.com/v4/spreadsheets/{$spreadsheetId}/values/{$range}?key={$apiKey}";
    
    $response = file_get_contents($url);
    $data = json_decode($response, true);
    
    if (isset($data['values'][0])) {
        return $data['values'][0];
    }
    
    return null;
}

/**
 * Atualizar banco local
 */
function atualizarBancoLocal($dados) {
    $pdo = conectarBanco();
    if (!$pdo) return false;
    
    // Exemplo para tabela de matr√≠culas
    $sql = "INSERT INTO matriculas (
        data, nome, email, telefone, curso, valor_total, valor_entrada,
        tipo_venda, parcelas, vendedor, gerente, assistente, unidade,
        comissao_vendedor, comissao_gerente, comissao_assistente,
        sincronizado_sheets
    ) VALUES (
        :data, :nome, :email, :telefone, :curso, :valor_total, :valor_entrada,
        :tipo_venda, :parcelas, :vendedor, :gerente, :assistente, :unidade,
        :comissao_vendedor, :comissao_gerente, :comissao_assistente, 1
    ) ON DUPLICATE KEY UPDATE
        nome = VALUES(nome),
        valor_total = VALUES(valor_total),
        sincronizado_sheets = 1";
    
    $stmt = $pdo->prepare($sql);
    
    // Mapear dados (ajustar √≠ndices conforme sua planilha)
    $parametros = [
        ':data' => $dados[0] ?? null,
        ':nome' => $dados[1] ?? null,
        ':email' => $dados[2] ?? null,
        ':telefone' => $dados[3] ?? null,
        ':curso' => $dados[4] ?? null,
        ':valor_total' => $dados[5] ?? 0,
        ':valor_entrada' => $dados[6] ?? 0,
        ':tipo_venda' => $dados[7] ?? null,
        ':parcelas' => $dados[8] ?? 1,
        ':vendedor' => $dados[9] ?? null,
        ':gerente' => $dados[10] ?? null,
        ':assistente' => $dados[11] ?? null,
        ':unidade' => $dados[12] ?? null,
        ':comissao_vendedor' => $dados[13] ?? 0,
        ':comissao_gerente' => $dados[14] ?? 0,
        ':comissao_assistente' => $dados[15] ?? 0
    ];
    
    return $stmt->execute($parametros);
}

/**
 * Notificar outros sistemas integrados
 */
function notificarSistemasIntegrados($dados) {
    // Exemplo: notificar sistema de CRM
    $crmWebhook = 'https://seu-crm.com/webhook';
    
    $payload = json_encode([
        'source' => 'game_creators',
        'type' => 'new_enrollment',
        'data' => $dados,
        'timestamp' => date('c')
    ]);
    
    $context = stream_context_create([
        'http' => [
            'method' => 'POST',
            'header' => 'Content-Type: application/json',
            'content' => $payload
        ]
    ]);
    
    file_get_contents($crmWebhook, false, $context);
}

/**
 * Gerar relat√≥rio de sincroniza√ß√£o
 */
function gerarRelatorioSincronizacao($totalRegistros) {
    $relatorio = [
        'timestamp' => date('c'),
        'total_processado' => $totalRegistros,
        'status' => 'sucesso'
    ];
    
    file_put_contents('relatorio_sync.json', json_encode($relatorio));
}

// Responder sucesso
http_response_code(200);
echo json_encode(['status' => 'success', 'message' => 'Webhook processado']);
?></code></pre>

                            <h5 style="margin-top: 20px;">üîó Configurar no Google Apps Script:</h5>
                            <pre style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 12px;"><code>// No seu Google Apps Script, configure:
const CONFIG = {
  WEBHOOK_URL: 'https://seu-servidor.com/webhook/game-creators'
};

// A fun√ß√£o notificarWebhook() enviar√° dados para esta URL</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Integra√ß√£o com Google Sheets -->
                <div class="stat-card" style="margin: 20px 0;">
                    <h3>üìä Integra√ß√£o com Google Sheets</h3>
                    <p style="color: #666; margin-bottom: 20px;">Configure a sincroniza√ß√£o autom√°tica com planilhas do Google para backup e integra√ß√£o de dados.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div class="form-group">
                            <label>üîó URL da Planilha Google:</label>
                            <input type="url" id="googleSheetUrl" placeholder="https://docs.google.com/spreadsheets/d/..." style="font-size: 12px;">
                            <small style="color: #666;">Cole o link completo da sua planilha do Google Sheets</small>
                        </div>
                        <div class="form-group">
                            <label>üîë ID da Planilha:</label>
                            <input type="text" id="googleSheetId" placeholder="1ABC...XYZ" readonly>
                            <small style="color: #666;">Extra√≠do automaticamente da URL</small>
                        </div>
                        <div class="form-group">
                            <label>üõ°Ô∏è API Key do Google:</label>
                            <input type="password" id="googleApiKey" placeholder="AIza...">
                            <small style="color: #666;">Chave de API para acessar Google Sheets</small>
                        </div>
                        <div class="form-group">
                            <label>üìã Nome da Aba (Opcional):</label>
                            <input type="text" id="googleSheetTab" placeholder="Vendas" value="Sheet1">
                            <small style="color: #666;">Nome da aba onde os dados ser√£o sincronizados</small>
                        </div>
                    </div>

                    <div style="margin: 20px 0;">
                        <h4>üîÑ Configura√ß√µes de Sincroniza√ß√£o</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                            <div class="form-group">
                                <label>üì§ Sincroniza√ß√£o Autom√°tica:</label>
                                <select id="autoGoogleSync">
                                    <option value="0">Desabilitada</option>
                                    <option value="3600000">A cada 1 hora</option>
                                    <option value="21600000">A cada 6 horas</option>
                                    <option value="86400000">Diariamente</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>üìä Tipo de Dados:</label>
                                <select id="googleSyncDataType">
                                    <option value="matriculas">Apenas Matr√≠culas</option>
                                    <option value="visitas">Apenas Visitas</option>
                                    <option value="both">Matr√≠culas e Visitas</option>
                                    <option value="complete">Todos os Dados</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>üîÑ Modo de Sincroniza√ß√£o:</label>
                                <select id="googleSyncMode">
                                    <option value="append">Adicionar Novos (Recomendado)</option>
                                    <option value="overwrite">Sobrescrever Tudo</option>
                                    <option value="merge">Mesclar Dados</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin: 20px 0;">
                        <button class="btn btn-primary" onclick="testGoogleConnection()">üîç Testar Conex√£o</button>
                        <button class="btn btn-success" onclick="exportToGoogleSheets()">üì§ Exportar para Google</button>
                        <button class="btn btn-warning" onclick="importFromGoogleSheets()">üì• Importar do Google</button>
                        <button class="btn btn-info" onclick="syncWithGoogleSheets()">üîÑ Sincronizar</button>
                        <button class="btn btn-primary" onclick="openGoogleSheetHelper()">‚ùì Como Configurar</button>
                    </div>

                    <div id="googleSheetsStatus" style="padding: 15px; border-radius: 8px; margin-top: 15px; background: var(--bg-primary);">
                        <h4>üìä Status da Integra√ß√£o</h4>
                        <div id="googleConnectionStatus" style="margin: 10px 0;">
                            <span style="color: #666;">üî¥ N√£o Conectado</span>
                        </div>
                        <div id="googleLastSync" style="font-size: 12px; color: #666;">
                            √öltima sincroniza√ß√£o: Nunca
                        </div>
                        <div id="googleSyncLog" style="margin-top: 10px; max-height: 150px; overflow-y: auto; font-family: monospace; font-size: 11px; background: #f8f9fa; padding: 10px; border-radius: 4px; display: none;">
                            <!-- Log de sincroniza√ß√£o -->
                        </div>
                    </div>

                    <!-- Mapeamento de Colunas -->
                    <div id="googleColumnMapping" style="margin-top: 25px; display: none;">
                        <h4>üóÇÔ∏è Mapeamento de Colunas</h4>
                        <p style="color: #666; margin-bottom: 15px;">Configure como os dados ser√£o organizados na planilha:</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="form-group">
                                <label>üìÖ Coluna Data:</label>
                                <select id="columnData">
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>üë§ Coluna Nome:</label>
                                <select id="columnNome">
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>üéì Coluna Curso:</label>
                                <select id="columnCurso">
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>üí∞ Coluna Valor:</label>
                                <select id="columnValor">
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn btn-success" onclick="saveColumnMapping()" style="margin-top: 15px;">üíæ Salvar Mapeamento</button>
                    </div>
                </div>

                <!-- Configura√ß√£o de Metas -->
                <div class="stat-card" style="max-width: 800px; margin: 20px 0;">
                    <h3>üéØ Configura√ß√£o de Metas Mensais</h3>
                    <div id="metasConfig">
                        <!-- Preenchido dinamicamente baseado nas unidades existentes -->
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="salvarMetas()">üíæ Salvar Metas</button>
                        <button class="btn btn-primary" onclick="carregarMetas()">üîÑ Recarregar Metas</button>
                    </div>
                    <div id="metasStatus" style="margin-top: 10px;"></div>
                </div>

                <!-- Adicionar Usu√°rio -->
                <div class="stat-card" style="max-width: 500px; margin: 20px 0;">
                    <h3>‚ûï Adicionar Novo Usu√°rio</h3>
                    <div class="form-group">
                        <label>Nome:</label>
                        <input type="text" id="newUserName" placeholder="Nome completo">
                    </div>
                    <div class="form-group">
                        <label>Usu√°rio:</label>
                        <input type="text" id="newUserUsername" placeholder="nome.usuario@gamecreatorsadm.com">
                    </div>
                    <div class="form-group">
                        <label>Senha:</label>
                        <input type="password" id="newUserPassword" placeholder="senha123">
                    </div>
                    <div class="form-group">
                        <label>Tipo:</label>
                        <select id="newUserRole">
                            <option value="vendedor">üë®‚Äçüíº Vendedor</option>
                            <option value="gerente">üëî Gerente</option>
                            <option value="assistente">üë©‚Äçüíª Assistente</option>
                            <option value="admin">üîß Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Unidade:</label>
                        <select id="newUserUnit">
                            <!-- Preenchido dinamicamente -->
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="addUser()">‚ûï Adicionar Usu√°rio</button>
                </div>

                <!-- Lista de Usu√°rios -->
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üë§ Nome</th>
                            <th>üîë Usu√°rio</th>
                            <th>üè¢ Unidade</th>
                            <th>üíº Tipo</th>
                            <th>üìä Matr√≠culas</th>
                            <th>üë• Visitas</th>
                            <th>‚≠ê XP</th>
                            <th>üîß A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="userManagementBody">
                        <!-- Preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Matr√≠culas -->
        <div id="matriculas" class="tab-content">
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>‚ûï Adicionar Nova Matr√≠cula</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Data:</label>
                            <input type="date" id="newData" required>
                        </div>
                        <div class="form-group">
                            <label>Nome do Aluno:</label>
                            <input type="text" id="newNome" placeholder="Nome completo" required>
                        </div>
                        <div class="form-group">
                            <label>Telefone:</label>
                            <input type="tel" id="newTelefone" placeholder="(11) 99999-9999">
                        </div>
                        <div class="form-group">
                            <label>Curso:</label>
                            <select id="newCurso" required>
                                <option value="">Selecione...</option>
                                <option value="Creators 2D">Creators 2D</option>
                                <option value="Creators 3D">Creators 3D</option>
                                <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                                <option value="Creators Dev">Creators Dev</option>
                                <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Valor Total do Curso (R$):</label>
                            <input type="number" id="newValorTotal" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Valor de Entrada (R$):</label>
                            <input type="number" id="newValorEntrada" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Tipo de Venda:</label>
                            <select id="newTipo" required>
                                <option value="Convencional">Convencional (√Ä vista ou parcelado normal)</option>
                                <option value="Blackin">Blackin (6x no cart√£o)</option>
                                <option value="Black">Black (10x+ no cart√£o)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Parcelas (se aplic√°vel):</label>
                            <input type="number" id="newParcelas" min="1" max="24" placeholder="Ex: 6, 10, 12...">
                        </div>
                        <div class="form-group">
                            <label>Vendedor:</label>
                            <select id="newVendedor" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Gerente:</label>
                            <select id="newGerente" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Assistente:</label>
                            <select id="newAssistente" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Origem do Cliente:</label>
                            <select id="newFromVisit" onchange="toggleCustomOrigin()">
                                <option value="">Cliente Direto</option>
                                <option value="porta">Cliente Porta</option>
                                <option value="street">Street Marketing</option>
                                <option value="agendamento">Agendamento</option>
                                <option value="evento">Evento</option>
                                <option value="custom">Outra (especificar)</option>
                            </select>
                        </div>
                        <div class="form-group" id="customOriginGroup" style="display: none;">
                            <label>Especificar Origem:</label>
                            <input type="text" id="customOriginText" placeholder="Digite a origem personalizada">
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="addMatricula()" style="margin-top: 15px;">‚ûï Adicionar Matr√≠cula</button>
                </div>

                <!-- Filtros de Matr√≠culas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üîç Filtros de Matr√≠culas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>üìÖ Per√≠odo:</label>
                            <select id="matriculaPeriodFilter" onchange="filterMatriculas()">
                                <option value="today">Hoje</option>
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este M√™s</option>
                                <option value="all">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üë§ Vendedor:</label>
                            <select id="matriculaVendedorFilter" onchange="filterMatriculas()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üéì Curso:</label>
                            <select id="matriculaCursoFilter" onchange="filterMatriculas()">
                                <option value="">Todos</option>
                                <option value="Creators 2D">Creators 2D</option>
                                <option value="Creators 3D">Creators 3D</option>
                                <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                                <option value="Creators Dev">Creators Dev</option>
                                <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üîç Buscar:</label>
                            <input type="text" class="search-box" id="matriculaSearchBox" placeholder="Nome do aluno..." onkeyup="filterMatriculas()">
                        </div>
                    </div>
                </div>

                <!-- Lista de Matr√≠culas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>üìä Matr√≠culas Recentes</h3>
                        <div class="export-buttons">
                            <button class="btn btn-info btn-sm" onclick="exportMatriculas('csv')">üìÑ CSV</button>
                            <button class="btn btn-warning btn-sm" onclick="exportMatriculas('excel')">üìä Excel</button>
                        </div>
                    </div>
                    <div id="matriculasList" style="max-height: 400px; overflow-y: auto;">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Relat√≥rios -->
        <div id="relatorios" class="tab-content">
            <div style="padding: 30px;">
                <div class="stat-card">
                    <h3>üìä Relat√≥rios de Performance</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>M√™s/Ano:</label>
                            <input type="month" id="relatorioMes">
                        </div>
                        <div class="form-group">
                            <label>Unidade:</label>
                            <select id="relatorioUnidade">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Colaborador:</label>
                            <select id="relatorioColaborador">
                                <option value="">Todos</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="gerarRelatorioComissoes()">üí∞ Relat√≥rio Comiss√µes</button>
                        <button class="btn btn-success" onclick="gerarRelatorioConversao()">üìà Relat√≥rio Convers√£o</button>
                        <button class="btn btn-warning" onclick="gerarRelatorioUnidade()">üè¢ Relat√≥rio por Unidade</button>
                        <button class="btn btn-info" onclick="gerarRelatorioMetas()">üéØ Relat√≥rio Metas vs Realizado</button>
                        <button class="btn btn-primary" onclick="gerarRelatorioTendencias()">üìà An√°lise de Tend√™ncias</button>
                        <button class="btn btn-success" onclick="gerarRelatorioPrevisao()">üîÆ Previs√£o de Vendas</button>
                    </div>
                </div>

                <div id="relatorioResultado" class="print-area">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>
        </div>

        <!-- Chat/Mensagens -->
        <div id="chat" class="tab-content">
            <div style="padding: 30px;">
                <!-- Salas de Chat -->
                <div class="stat-card">
                    <h3>üí¨ Salas de Conversa</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div style="border: 2px solid #38a169; border-radius: 12px; padding: 20px; cursor: pointer;" onclick="openChatRoom('geral')">
                            <h4>üåê Chat Geral</h4>
                            <p style="color: #666; font-size: 12px;">Conversa aberta para todos</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="font-size: 12px; color: #38a169;">Online: 5</span>
                                <span style="font-size: 12px; color: #666;">3 mensagens n√£o lidas</span>
                            </div>
                        </div>
                        <div style="border: 2px solid #ed8936; border-radius: 12px; padding: 20px; cursor: pointer;" onclick="openChatRoom('vendas')">
                            <h4>üìä Chat Vendas</h4>
                            <p style="color: #666; font-size: 12px;">Para discuss√µes sobre vendas</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="font-size: 12px; color: #ed8936;">Online: 3</span>
                                <span style="font-size: 12px; color: #666;">1 mensagem n√£o lida</span>
                            </div>
                        </div>
                        <div style="border: 2px solid #667eea; border-radius: 12px; padding: 20px; cursor: pointer;" onclick="openChatRoom('suporte')">
                            <h4>üÜò Chat Suporte</h4>
                            <p style="color: #666; font-size: 12px;">Ajuda e suporte t√©cnico</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="font-size: 12px; color: #667eea;">Online: 2</span>
                                <span style="font-size: 12px; color: #666;">0 mensagens n√£o lidas</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- √Årea de Chat -->
                <div class="stat-card" style="margin-top: 25px;">
                    <div id="chatHeader" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 id="chatRoomTitle">üí¨ Selecione uma sala de chat</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary btn-sm" onclick="refreshChat()">üîÑ Atualizar</button>
                            <button class="btn btn-success btn-sm" onclick="toggleChatNotifications()">üîî Notifica√ß√µes</button>
                        </div>
                    </div>
                    
                    <div id="chatMessages" style="height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; background: var(--bg-primary); margin-bottom: 15px;">
                        <p style="text-align: center; color: #666;">Selecione uma sala de chat para come√ßar a conversar</p>
                    </div>

                    <div id="chatInputArea" style="display: none;">
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="chatMessage" placeholder="Digite sua mensagem..." style="flex: 1; padding: 12px; border: 2px solid var(--border-color); border-radius: 25px;" onkeypress="handleChatKeyPress(event)">
                            <button class="btn btn-primary" onclick="sendChatMessage()">üì§ Enviar</button>
                        </div>
                    </div>
                </div>

                <!-- Mensagens Privadas -->
                <div class="stat-card" style="margin-top: 25px;">
                    <h3>üíå Mensagens Privadas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Para:</label>
                            <select id="privateMessageTo">
                                <option value="">Selecione um usu√°rio...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Assunto:</label>
                            <input type="text" id="privateMessageSubject" placeholder="Assunto da mensagem">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Mensagem:</label>
                        <textarea id="privateMessageContent" rows="4" placeholder="Digite sua mensagem privada..."></textarea>
                    </div>
                    <button class="btn btn-success" onclick="sendPrivateMessage()">üì© Enviar Mensagem Privada</button>

                    <!-- Lista de Mensagens Privadas -->
                    <div style="margin-top: 25px;">
                        <h4>üì® Suas Mensagens</h4>
                        <div id="privateMessagesList" style="max-height: 300px; overflow-y: auto;">
                            <!-- Preenchido dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot√£o Flutuante -->
    <button class="floating-action-btn" onclick="quickAddMatricula()" title="Adicionar Matr√≠cula R√°pida">
        ‚ûï
    </button>

    <!-- Modal para Adicionar Matr√≠cula R√°pida -->
    <div id="quickMatriculaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ö° Matr√≠cula R√°pida</h3>
                <button class="close-modal" onclick="closeQuickMatriculaModal()">√ó</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="quickNome" placeholder="Nome do aluno">
                </div>
                <div class="form-group">
                    <label>Curso:</label>
                    <select id="quickCurso">
                        <option value="Creators 2D">Creators 2D</option>
                        <option value="Creators 3D">Creators 3D</option>
                        <option value="Design Gr√°fico e Edi√ß√£o">Design Gr√°fico e Edi√ß√£o</option>
                        <option value="Creators Dev">Creators Dev</option>
                        <option value="Jogos Digitais T√©cnico">Jogos Digitais T√©cnico</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor (R$):</label>
                    <input type="number" id="quickValor" placeholder="2000" step="0.01">
                </div>
                <div class="form-group">
                    <label>Vendedor:</label>
                    <select id="quickVendedor">
                        <!-- Preenchido dinamicamente -->
                    </select>
                </div>
            </div>
            <button class="btn btn-success" onclick="addQuickMatricula()" style="margin-top: 15px; width: 100%;">‚ö° Adicionar Matr√≠cula R√°pida</button>
        </div>
    </div>

    <!-- Tour Guiado para Novos Usu√°rios -->
    <div id="welcomeTour" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="tourTitle">üëã Bem-vindo ao Game Creators!</h3>
                <button class="close-modal" onclick="closeTour()">√ó</button>
            </div>
            <div id="tourContent" style="line-height: 1.6; min-height: 200px;">
                <!-- Conte√∫do do tour ser√° preenchido dinamicamente -->
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                <div>
                    <span id="tourStep">1</span> de <span id="tourTotal">5</span>
                    <div style="width: 200px; height: 4px; background: #e2e8f0; border-radius: 2px; margin-top: 5px;">
                        <div id="tourProgress" style="height: 100%; background: var(--primary-gradient); border-radius: 2px; width: 20%; transition: width 0.3s;"></div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="tourPrev" class="btn btn-info btn-sm" onclick="previousTourStep()" disabled>‚óÄ Anterior</button>
                    <button id="tourNext" class="btn btn-primary btn-sm" onclick="nextTourStep()">Pr√≥ximo ‚ñ∂</button>
                    <button id="tourFinish" class="btn btn-success btn-sm" onclick="finishTour()" style="display: none;">üéâ Come√ßar!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Widget de Informa√ß√µes R√°pidas -->
    <div id="quickInfoWidget" style="position: fixed; top: 20px; left: 20px; background: white; border-radius: 12px; padding: 15px; box-shadow: var(--shadow-sm); z-index: 1000; min-width: 250px; display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h4 style="margin: 0; font-size: 14px;">üìä Info R√°pida</h4>
            <button onclick="toggleQuickInfo()" style="background: none; border: none; cursor: pointer; font-size: 16px;">√ó</button>
        </div>
        <div id="quickInfoContent" style="font-size: 12px; line-height: 1.4;">
            <!-- Preenchido dinamicamente -->
        </div>
    </div>

    <!-- Help Bubble -->
    <div id="helpBubble" style="position: fixed; bottom: 100px; right: 30px; width: 50px; height: 50px; border-radius: 50%; background: var(--info-gradient); color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1000; font-size: 20px; box-shadow: 0 4px 15px rgba(49, 130, 206, 0.3); transition: var(--transition);" onclick="toggleHelp()" title="Ajuda e Atalhos">
        ‚ùì
    </div>

    <!-- Painel de Ajuda -->
    <div id="helpPanel" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>‚ùì Central de Ajuda</h3>
                <button class="close-modal" onclick="toggleHelp()">√ó</button>
            </div>
            <div style="line-height: 1.6;">
                <!-- Abas de Ajuda -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--border-color);">
                    <button class="btn btn-primary btn-sm" onclick="showHelpTab('shortcuts')" id="shortcutsHelpTab">‚å®Ô∏è Atalhos</button>
                    <button class="btn btn-info btn-sm" onclick="showHelpTab('features')" id="featuresHelpTab">üéÆ Funcionalidades</button>
                    <button class="btn btn-success btn-sm" onclick="showHelpTab('tips')" id="tipsHelpTab">üí° Dicas</button>
                    <button class="btn btn-warning btn-sm" onclick="showHelpTab('faq')" id="faqHelpTab">‚ùì FAQ</button>
                </div>

                <!-- Conte√∫do da Ajuda -->
                <div id="helpContent">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Exportador Avan√ßado -->
    <div id="advancedExporter" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>üìä Exportador Avan√ßado de Dados</h3>
                <button class="close-modal" onclick="closeAdvancedExporter()">√ó</button>
            </div>
            <div style="line-height: 1.6;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <h4>üìã Selecionar Dados</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="exportMatriculas" checked style="margin-right: 8px;">
                                üìö Matr√≠culas
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="exportVisitas" checked style="margin-right: 8px;">
                                üë• Visitas
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="exportUsuarios" style="margin-right: 8px;">
                                üë§ Usu√°rios
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="exportComissoes" style="margin-right: 8px;">
                                üí∞ Comiss√µes
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="exportEventos" style="margin-right: 8px;">
                                üìÖ Eventos
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <h4>‚öôÔ∏è Op√ß√µes de Export</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div class="form-group">
                                <label>üìÖ Per√≠odo:</label>
                                <select id="exportPeriod">
                                    <option value="all">Todos os dados</option>
                                    <option value="today">Hoje</option>
                                    <option value="week">Esta semana</option>
                                    <option value="month" selected>Este m√™s</option>
                                    <option value="quarter">Trimestre</option>
                                    <option value="year">Este ano</option>
                                    <option value="custom">Per√≠odo personalizado</option>
                                </select>
                            </div>
                            
                            <div id="customPeriod" style="display: none;">
                                <div class="form-group">
                                    <label>De:</label>
                                    <input type="date" id="exportDateFrom">
                                </div>
                                <div class="form-group">
                                    <label>At√©:</label>
                                    <input type="date" id="exportDateTo">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>üìÑ Formato:</label>
                                <select id="exportFormat">
                                    <option value="csv">CSV (Excel)</option>
                                    <option value="json">JSON (Desenvolvedor)</option>
                                    <option value="pdf">PDF (Relat√≥rio)</option>
                                    <option value="xlsx">Excel Avan√ßado</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>üè¢ Unidade:</label>
                                <select id="exportUnit">
                                    <option value="">Todas as unidades</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <div id="exportProgress" style="display: none; margin-bottom: 15px;">
                        <div style="background: #e2e8f0; height: 4px; border-radius: 2px;">
                            <div id="exportProgressBar" style="height: 100%; background: var(--success-gradient); border-radius: 2px; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <div id="exportStatus" style="font-size: 12px; margin-top: 5px; color: #666;">Preparando exporta√ß√£o...</div>
                    </div>
                    
                    <button class="btn btn-success" onclick="executeAdvancedExport()" style="margin-right: 10px;">
                        üöÄ Exportar Dados
                    </button>
                    <button class="btn btn-info" onclick="previewExportData()">
                        üëÅÔ∏è Visualizar Pr√©via
                    </button>
                </div>
                
                <div id="exportPreview" style="display: none; margin-top: 20px; max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <!-- Pr√©via dos dados -->
                </div>
            </div>
        </div>
    </div>

    <!-- Sistema de Tags -->
    <div id="tagSystem" style="display: none;">
        <div class="stat-card" style="margin: 20px;">
            <h3>üè∑Ô∏è Sistema de Tags</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin: 15px 0;">
                <div class="tag" style="background: #e6fffa; color: #38a169; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                    #VendaR√°pida
                </div>
                <div class="tag" style="background: #fef5e7; color: #ed8936; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                    #ClienteVIP
                </div>
                <div class="tag" style="background: #f0f8ff; color: #3182ce; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                    #Seguimento
                </div>
                <button class="btn btn-sm" style="padding: 5px 12px; font-size: 12px;" onclick="addNewTag()">
                    ‚ûï Nova Tag
                </button>
            </div>
        </div>
    </div>

    <!-- Widget de Clima/Informa√ß√µes -->
    <div id="weatherWidget" style="position: fixed; top: 80px; left: 20px; background: white; border-radius: 12px; padding: 12px; box-shadow: var(--shadow-sm); z-index: 999; min-width: 200px; display: none;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="font-size: 24px;" id="weatherIcon">‚òÄÔ∏è</div>
            <div>
                <div style="font-weight: 600; font-size: 14px;" id="weatherTemp">25¬∞C</div>
                <div style="font-size: 11px; color: #666;" id="weatherLocation">Bras√≠lia, DF</div>
            </div>
        </div>
        <div style="font-size: 11px; color: #666; margin-top: 5px;" id="weatherTime">
            <!-- Hora atual -->
        </div>
    </div>

    <script>
        // Sistema de Tour Guiado para Novos Usu√°rios
        let currentTourStep = 0;
        const tourSteps = [
            {
                title: "üëã Bem-vindo ao Game Creators!",
                content: `
                    <div style="text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üéÆ</div>
                        <p>Ol√° <strong>${currentUser?.name || 'Usu√°rio'}</strong>!</p>
                        <p>Bem-vindo ao sistema mais avan√ßado de gest√£o de vendas com gamifica√ß√£o!</p>
                        <p>Vamos fazer um tour r√°pido pelas principais funcionalidades?</p>
                    </div>
                `
            },
            {
                title: "üìä Dashboard Inteligente",
                content: `
                    <div>
                        <h4>Seu Centro de Controle</h4>
                        <p>O dashboard mostra todas suas m√©tricas em tempo real:</p>
                        <ul style="margin: 15px 0; padding-left: 20px;">
                            <li><strong>Matr√≠culas:</strong> Suas vendas do m√™s</li>
                            <li><strong>Visitas:</strong> Leads registrados</li>
                            <li><strong>Convers√£o:</strong> Taxa de fechamento</li>
                            <li><strong>Comiss√£o:</strong> Seus ganhos</li>
                            <li><strong>XP:</strong> Experi√™ncia gamificada</li>
                        </ul>
                        <p style="color: #38a169;"><strong>üí° Dica:</strong> Use Ctrl+D para ir direto ao dashboard!</p>
                    </div>
                `
            },
            {
                title: "üéÆ Sistema de Gamifica√ß√£o",
                content: `
                    <div>
                        <h4>Venda Jogando!</h4>
                        <p>Transformamos vendas em um jogo divertido:</p>
                        <ul style="margin: 15px 0; padding-left: 20px;">
                            <li><strong>XP:</strong> Ganhe experi√™ncia a cada a√ß√£o</li>
                            <li><strong>N√≠veis:</strong> Evolua de Iniciante a Lenda</li>
                            <li><strong>Miss√µes:</strong> Desafios com recompensas</li>
                            <li><strong>Conquistas:</strong> Badges especiais</li>
                            <li><strong>Ranking:</strong> Compete com a equipe</li>
                        </ul>
                        <p style="color: #667eea;"><strong>üéØ Meta:</strong> Cada venda = +100 XP!</p>
                    </div>
                `
            },
            {
                title: "üìä Google Sheets Integration",
                content: `
                    <div>
                        <h4>Sincroniza√ß√£o Autom√°tica</h4>
                        <p>Seus dados sincronizados com Google Sheets:</p>
                        <ul style="margin: 15px 0; padding-left: 20px;">
                            <li><strong>Backup autom√°tico</strong> na nuvem</li>
                            <li><strong>Colabora√ß√£o</strong> em tempo real</li>
                            <li><strong>Scripts prontos</strong> para automa√ß√£o</li>
                            <li><strong>Templates</strong> pr√©-configurados</li>
                        </ul>
                        <p style="color: #ed8936;"><strong>‚ö° Admin:</strong> Configure na aba Admin!</p>
                    </div>
                `
            },
            {
                title: "üöÄ Voc√™ est√° pronto!",
                content: `
                    <div style="text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üèÜ</div>
                        <p><strong>Parab√©ns!</strong> Agora voc√™ conhece o Game Creators!</p>
                        <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <strong>üî• Atalhos √öteis:</strong><br>
                            ‚Ä¢ <kbd>Ctrl+M</kbd> - Nova matr√≠cula<br>
                            ‚Ä¢ <kbd>Ctrl+V</kbd> - Nova visita<br>
                            ‚Ä¢ <kbd>Ctrl+R</kbd> - Ver ranking<br>
                            ‚Ä¢ <kbd>F1</kbd> - Ajuda
                        </div>
                        <p>Que tal registrar sua primeira venda? üéØ</p>
                    </div>
                `
            }
        ];

        function startTour() {
            currentTourStep = 0;
            updateTourContent();
            document.getElementById('welcomeTour').style.display = 'flex';
        }

        function updateTourContent() {
            const step = tourSteps[currentTourStep];
            document.getElementById('tourTitle').innerHTML = step.title;
            document.getElementById('tourContent').innerHTML = step.content;
            document.getElementById('tourStep').textContent = currentTourStep + 1;
            document.getElementById('tourTotal').textContent = tourSteps.length;
            
            const progress = ((currentTourStep + 1) / tourSteps.length) * 100;
            document.getElementById('tourProgress').style.width = progress + '%';
            
            // Controles de navega√ß√£o
            document.getElementById('tourPrev').disabled = currentTourStep === 0;
            
            if (currentTourStep === tourSteps.length - 1) {
                document.getElementById('tourNext').style.display = 'none';
                document.getElementById('tourFinish').style.display = 'inline-flex';
            } else {
                document.getElementById('tourNext').style.display = 'inline-flex';
                document.getElementById('tourFinish').style.display = 'none';
            }
        }

        function nextTourStep() {
            if (currentTourStep < tourSteps.length - 1) {
                currentTourStep++;
                updateTourContent();
            }
        }

        function previousTourStep() {
            if (currentTourStep > 0) {
                currentTourStep--;
                updateTourContent();
            }
        }

        function finishTour() {
            closeTour();
            localStorage.setItem('tourCompleted', 'true');
            showNotification('üéâ Tour conclu√≠do! Bem-vindo ao Game Creators!', 'success');
            addXP(50, 'Tour de boas-vindas conclu√≠do');
        }

        function closeTour() {
            document.getElementById('welcomeTour').style.display = 'none';
        }

        // Sistema de Ajuda e Atalhos
        function toggleHelp() {
            const panel = document.getElementById('helpPanel');
            const isVisible = panel.style.display === 'flex';
            panel.style.display = isVisible ? 'none' : 'flex';
            
            if (!isVisible) {
                showHelpTab('shortcuts');
            }
        }

        function showHelpTab(tabName) {
            // Remover ativo de todos os bot√µes
            document.querySelectorAll('#shortcutsHelpTab, #featuresHelpTab, #tipsHelpTab, #faqHelpTab').forEach(btn => {
                btn.className = btn.className.replace('btn-primary', 'btn-info');
            });
            
            // Ativar bot√£o selecionado
            document.getElementById(tabName + 'HelpTab').className = document.getElementById(tabName + 'HelpTab').className.replace('btn-info', 'btn-primary');
            
            const content = getHelpContent(tabName);
            document.getElementById('helpContent').innerHTML = content;
        }

        function getHelpContent(tabName) {
            const contents = {
                shortcuts: `
                    <div>
                        <h4>‚å®Ô∏è Atalhos do Teclado</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div>
                                <h5>üß≠ Navega√ß√£o:</h5>
                                <ul style="font-family: monospace; font-size: 13px;">
                                    <li><kbd>Ctrl+D</kbd> - Dashboard</li>
                                    <li><kbd>Ctrl+G</kbd> - Gamifica√ß√£o</li>
                                    <li><kbd>Ctrl+K</kbd> - Calend√°rio</li>
                                    <li><kbd>Ctrl+R</kbd> - Ranking</li>
                                    <li><kbd>Ctrl+A</kbd> - Admin (se admin)</li>
                                </ul>
                            </div>
                            <div>
                                <h5>‚ûï A√ß√µes R√°pidas:</h5>
                                <ul style="font-family: monospace; font-size: 13px;">
                                    <li><kbd>Ctrl+M</kbd> - Nova Matr√≠cula</li>
                                    <li><kbd>Ctrl+V</kbd> - Nova Visita</li>
                                    <li><kbd>Ctrl+E</kbd> - Novo Evento</li>
                                    <li><kbd>Ctrl+S</kbd> - Salvar/Sync</li>
                                    <li><kbd>Space</kbd> - Matr√≠cula R√°pida</li>
                                </ul>
                            </div>
                            <div>
                                <h5>üîß Sistema:</h5>
                                <ul style="font-family: monospace; font-size: 13px;">
                                    <li><kbd>F1</kbd> - Esta ajuda</li>
                                    <li><kbd>F5</kbd> - Atualizar dados</li>
                                    <li><kbd>Ctrl+B</kbd> - Backup</li>
                                    <li><kbd>Ctrl+I</kbd> - Info r√°pida</li>
                                    <li><kbd>Esc</kbd> - Fechar modais</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `,
                features: `
                    <div>
                        <h4>üéÆ Principais Funcionalidades</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <div style="background: #f0fff4; padding: 15px; border-radius: 8px;">
                                <h5 style="color: #38a169;">üìä Dashboard</h5>
                                <p>M√©tricas em tempo real, gr√°ficos interativos e indicadores de performance.</p>
                            </div>
                            <div style="background: #f0f8ff; padding: 15px; border-radius: 8px;">
                                <h5 style="color: #3182ce;">üéÆ Gamifica√ß√£o</h5>
                                <p>Sistema completo de XP, n√≠veis, miss√µes, conquistas e rankings.</p>
                            </div>
                            <div style="background: #fffaf0; padding: 15px; border-radius: 8px;">
                                <h5 style="color: #ed8936;">üë• Gest√£o de Visitas</h5>
                                <p>Controle completo do funil de vendas, desde o primeiro contato at√© a convers√£o.</p>
                            </div>
                            <div style="background: #fef5e7; padding: 15px; border-radius: 8px;">
                                <h5 style="color: #dd6b20;">üìö Matr√≠culas</h5>
                                <p>Sistema completo de vendas com c√°lculo autom√°tico de comiss√µes.</p>
                            </div>
                            <div style="background: #f8faff; padding: 15px; border-radius: 8px;">
                                <h5 style="color: #667eea;">üìä Google Sheets</h5>
                                <p>Integra√ß√£o completa com sincroniza√ß√£o autom√°tica e scripts prontos.</p>
                            </div>
                            <div style="background: #f0fff0; padding: 15px; border-radius: 8px;">
                                <h5 style="color: #2f855a;">üì± Mobile Ready</h5>
                                <p>Interface totalmente responsiva para todos os dispositivos.</p>
                            </div>
                        </div>
                    </div>
                `,
                tips: `
                    <div>
                        <h4>üí° Dicas de Produtividade</h4>
                        <div style="line-height: 1.8;">
                            <div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h5>üöÄ Para Vendedores:</h5>
                                <ul>
                                    <li>Use o bot√£o flutuante (‚ûï) para matr√≠culas r√°pidas</li>
                                    <li>Registre visitas imediatamente ap√≥s o atendimento</li>
                                    <li>Acompanhe suas miss√µes di√°rias na aba Gamifica√ß√£o</li>
                                    <li>Use tags para categorizar clientes especiais</li>
                                </ul>
                            </div>
                            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h5>üëî Para Gerentes:</h5>
                                <ul>
                                    <li>Monitore a performance da equipe em tempo real</li>
                                    <li>Crie miss√µes personalizadas para motivar vendedores</li>
                                    <li>Use o chat para comunica√ß√£o r√°pida com a equipe</li>
                                    <li>Configure metas mensais no painel Admin</li>
                                </ul>
                            </div>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <h5>üîß Para Admins:</h5>
                                <ul>
                                    <li>Configure Google Sheets para backup autom√°tico</li>
                                    <li>Use o exportador avan√ßado para an√°lises detalhadas</li>
                                    <li>Monitore logs de sincroniza√ß√£o regularmente</li>
                                    <li>Fa√ßa backups antes de grandes altera√ß√µes</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `,
                faq: `
                    <div>
                        <h4>‚ùì Perguntas Frequentes</h4>
                        <div style="line-height: 1.6;">
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #38a169;">Como ganho XP?</h5>
                                <p>Voc√™ ganha XP por v√°rias a√ß√µes: registrar visitas (+20 XP), fazer matr√≠culas (+100 XP), completar miss√µes (varia), subir de n√≠vel (+200 XP b√¥nus).</p>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #3182ce;">Como funciona o c√°lculo de comiss√µes?</h5>
                                <p>As comiss√µes s√£o calculadas automaticamente baseadas no valor de entrada: Vendedor (60%), Gerente (25%), Assistente (15%). Vendas Black/Blackin t√™m multiplicadores especiais.</p>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #ed8936;">Posso usar em mobile?</h5>
                                <p>Sim! O sistema √© 100% responsivo e funciona perfeitamente em smartphones e tablets.</p>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #667eea;">Como configurar Google Sheets?</h5>
                                <p>V√° em Admin ‚Üí Integra√ß√£o Google Sheets e siga o tutorial passo a passo. H√° scripts prontos e templates para facilitar.</p>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #2f855a;">Os dados ficam seguros?</h5>
                                <p>Sim! Os dados ficam salvos no seu navegador (localStorage) e podem ser sincronizados com Google Sheets para backup na nuvem.</p>
                            </div>
                        </div>
                    </div>
                `
            };
            return contents[tabName] || '';
        }

        // Widget de Informa√ß√µes R√°pidas
        function toggleQuickInfo() {
            const widget = document.getElementById('quickInfoWidget');
            const isVisible = widget.style.display === 'block';
            
            if (isVisible) {
                widget.style.display = 'none';
            } else {
                updateQuickInfo();
                widget.style.display = 'block';
            }
        }

        function updateQuickInfo() {
            const content = document.getElementById('quickInfoContent');
            const stats = calculateUserStats();
            const now = new Date();
            
            content.innerHTML = `
                <div style="margin-bottom: 8px;">
                    <strong>üìÖ ${now.toLocaleDateString()}</strong><br>
                    <small>${now.toLocaleTimeString()}</small>
                </div>
                <hr style="margin: 8px 0;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px;">
                    <div>üìä ${stats.matriculas} vendas</div>
                    <div>üë• ${stats.visitas} visitas</div>
                    <div>üìà ${(stats.conversao * 100).toFixed(1)}%</div>
                    <div>‚≠ê ${currentUser.xp || 0} XP</div>
                </div>
                <hr style="margin: 8px 0;">
                <div style="font-size: 11px;">
                    üí∞ R$ ${stats.comissao.toFixed(2)}<br>
                    üè¢ ${currentUnit}
                </div>
            `;
        }

        // Sistema de Atalhos de Teclado
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Ignorar se estiver digitando em input
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'd':
                            e.preventDefault();
                            switchTab('dashboard');
                            break;
                        case 'g':
                            e.preventDefault();
                            switchTab('gamificacao');
                            break;
                        case 'k':
                            e.preventDefault();
                            switchTab('calendario');
                            break;
                        case 'r':
                            e.preventDefault();
                            switchTab('ranking');
                            break;
                        case 'm':
                            e.preventDefault();
                            switchTab('matriculas');
                            break;
                        case 'v':
                            e.preventDefault();
                            switchTab('visitas');
                            break;
                        case 'a':
                            e.preventDefault();
                            if (currentUser.role === 'admin') {
                                switchTab('admin');
                            }
                            break;
                        case 's':
                            e.preventDefault();
                            saveGameData();
                            showNotification('Dados salvos!', 'success');
                            break;
                        case 'b':
                            e.preventDefault();
                            if (currentUser.role === 'admin') {
                                createBackup();
                            }
                            break;
                        case 'i':
                            e.preventDefault();
                            toggleQuickInfo();
                            break;
                        case 'e':
                            e.preventDefault();
                            openAdvancedExporter();
                            break;
                    }
                } else {
                    switch(e.key) {
                        case 'F1':
                            e.preventDefault();
                            toggleHelp();
                            break;
                        case 'F5':
                            e.preventDefault();
                            location.reload();
                            break;
                        case ' ':
                            if (e.target === document.body) {
                                e.preventDefault();
                                quickAddMatricula();
                            }
                            break;
                        case 'Escape':
                            // Fechar todos os modais
                            document.querySelectorAll('.modal').forEach(modal => {
                                modal.style.display = 'none';
                            });
                            break;
                    }
                }
            });
        }

        // Exportador Avan√ßado
        function openAdvancedExporter() {
            document.getElementById('advancedExporter').style.display = 'flex';
            
            // Popular unidades
            const unitSelect = document.getElementById('exportUnit');
            unitSelect.innerHTML = '<option value="">Todas as unidades</option>' +
                gameData.units.map(unit => `<option value="${unit}">${unit}</option>`).join('');
            
            // Configurar evento de per√≠odo personalizado
            document.getElementById('exportPeriod').addEventListener('change', function() {
                const customDiv = document.getElementById('customPeriod');
                customDiv.style.display = this.value === 'custom' ? 'block' : 'none';
            });
        }

        function closeAdvancedExporter() {
            document.getElementById('advancedExporter').style.display = 'none';
        }

        function previewExportData() {
            const exportData = gatherExportData();
            const preview = document.getElementById('exportPreview');
            
            let previewContent = '<h4>üìã Pr√©via dos Dados:</h4>';
            
            Object.entries(exportData).forEach(([key, data]) => {
                if (data.length > 0) {
                    previewContent += `
                        <div style="margin-bottom: 15px;">
                            <h5>${getDataTypeLabel(key)} (${data.length} registros):</h5>
                            <div style="background: white; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 11px; max-height: 100px; overflow-y: auto;">
                                ${JSON.stringify(data.slice(0, 3), null, 2)}
                                ${data.length > 3 ? '\n... e mais ' + (data.length - 3) + ' registros' : ''}
                            </div>
                        </div>
                    `;
                }
            });
            
            preview.innerHTML = previewContent;
            preview.style.display = 'block';
        }

        function executeAdvancedExport() {
            const progressDiv = document.getElementById('exportProgress');
            const progressBar = document.getElementById('exportProgressBar');
            const statusDiv = document.getElementById('exportStatus');
            
            progressDiv.style.display = 'block';
            
            // Simular progresso
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                progressBar.style.width = Math.min(progress, 100) + '%';
                
                if (progress < 30) {
                    statusDiv.textContent = 'Coletando dados...';
                } else if (progress < 60) {
                    statusDiv.textContent = 'Processando filtros...';
                } else if (progress < 90) {
                    statusDiv.textContent = 'Formatando arquivo...';
                } else {
                    statusDiv.textContent = 'Finalizando...';
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Executar exporta√ß√£o real
                    const exportData = gatherExportData();
                    const format = document.getElementById('exportFormat').value;
                    
                    exportDataAsFile(exportData, format);
                    
                    setTimeout(() => {
                        progressDiv.style.display = 'none';
                        closeAdvancedExporter();
                        showNotification('Dados exportados com sucesso!', 'success');
                    }, 500);
                }
            }, 100);
        }

        function gatherExportData() {
            const exportData = {};
            const period = document.getElementById('exportPeriod').value;
            const unit = document.getElementById('exportUnit').value;
            
            // Filtrar por per√≠odo
            const dateFilter = createDateFilter(period);
            
            // Coletar dados selecionados
            if (document.getElementById('exportMatriculas').checked) {
                exportData.matriculas = gameData.matriculas.filter(item => {
                    return dateFilter(item.data) && (!unit || item.unidade === unit);
                });
            }
            
            if (document.getElementById('exportVisitas').checked) {
                exportData.visitas = gameData.visitas.filter(item => {
                    return dateFilter(item.data) && (!unit || item.unidade === unit);
                });
            }
            
            if (document.getElementById('exportUsuarios').checked) {
                exportData.usuarios = Object.values(gameData.users).filter(user => {
                    return !unit || user.unit === unit;
                });
            }
            
            if (document.getElementById('exportComissoes').checked) {
                exportData.comissoes = calculateCommissionsReport(dateFilter, unit);
            }
            
            if (document.getElementById('exportEventos').checked) {
                exportData.eventos = (gameData.events || []).filter(event => {
                    return dateFilter(event.date);
                });
            }
            
            return exportData;
        }

        function createDateFilter(period) {
            const now = new Date();
            
            switch(period) {
                case 'today':
                    return (date) => new Date(date).toDateString() === now.toDateString();
                case 'week':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return (date) => new Date(date) >= weekAgo;
                case 'month':
                    return (date) => {
                        const d = new Date(date);
                        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
                    };
                case 'quarter':
                    const quarterStart = new Date(now.getFullYear(), Math.floor(now.getMonth() / 3) * 3, 1);
                    return (date) => new Date(date) >= quarterStart;
                case 'year':
                    return (date) => new Date(date).getFullYear() === now.getFullYear();
                case 'custom':
                    const from = new Date(document.getElementById('exportDateFrom').value);
                    const to = new Date(document.getElementById('exportDateTo').value);
                    return (date) => {
                        const d = new Date(date);
                        return d >= from && d <= to;
                    };
                default:
                    return () => true;
            }
        }

        function exportDataAsFile(exportData, format) {
            let content, filename, mimeType;
            
            switch(format) {
                case 'json':
                    content = JSON.stringify(exportData, null, 2);
                    filename = `game-creators-export-${new Date().toISOString().split('T')[0]}.json`;
                    mimeType = 'application/json';
                    break;
                    
                case 'csv':
                    content = convertToCSVMultiple(exportData);
                    filename = `game-creators-export-${new Date().toISOString().split('T')[0]}.csv`;
                    mimeType = 'text/csv';
                    break;
                    
                case 'pdf':
                    // Simular PDF - em produ√ß√£o, usar biblioteca como jsPDF
                    content = generatePDFContent(exportData);
                    filename = `game-creators-relatorio-${new Date().toISOString().split('T')[0]}.txt`;
                    mimeType = 'text/plain';
                    break;
                    
                default:
                    content = JSON.stringify(exportData, null, 2);
                    filename = `game-creators-export-${new Date().toISOString().split('T')[0]}.json`;
                    mimeType = 'application/json';
            }
            
            downloadFile(content, filename, mimeType);
        }

        function convertToCSVMultiple(exportData) {
            let csvContent = '';
            
            Object.entries(exportData).forEach(([key, data]) => {
                if (data.length > 0) {
                    csvContent += `\n=== ${getDataTypeLabel(key).toUpperCase()} ===\n`;
                    const headers = Object.keys(data[0]);
                    csvContent += headers.join(',') + '\n';
                    
                    data.forEach(item => {
                        const row = headers.map(header => {
                            const value = item[header] || '';
                            return `"${value.toString().replace(/"/g, '""')}"`;
                        });
                        csvContent += row.join(',') + '\n';
                    });
                    csvContent += '\n';
                }
            });
            
            return csvContent;
        }

        function generatePDFContent(exportData) {
            let content = `GAME CREATORS PRO - RELAT√ìRIO COMPLETO\n`;
            content += `Data: ${new Date().toLocaleString()}\n`;
            content += `Usu√°rio: ${currentUser.name}\n`;
            content += `======================================\n\n`;
            
            Object.entries(exportData).forEach(([key, data]) => {
                if (data.length > 0) {
                    content += `${getDataTypeLabel(key).toUpperCase()}\n`;
                    content += `Total de registros: ${data.length}\n`;
                    content += `--------------------------------------\n`;
                    
                    data.slice(0, 10).forEach((item, index) => {
                        content += `${index + 1}. ${JSON.stringify(item, null, 2)}\n`;
                    });
                    
                    if (data.length > 10) {
                        content += `... e mais ${data.length - 10} registros\n`;
                    }
                    content += '\n';
                }
            });
            
            return content;
        }

        function getDataTypeLabel(key) {
            const labels = {
                matriculas: 'üìö Matr√≠culas',
                visitas: 'üë• Visitas',
                usuarios: 'üë§ Usu√°rios',
                comissoes: 'üí∞ Comiss√µes',
                eventos: 'üìÖ Eventos'
            };
            return labels[key] || key;
        }

        function calculateCommissionsReport(dateFilter, unit) {
            const commissions = [];
            
            Object.values(gameData.users).forEach(user => {
                if (unit && user.unit !== unit) return;
                
                const userMatriculas = gameData.matriculas.filter(m => {
                    return dateFilter(m.data) && 
                           (m.vendedor === user.name || m.gerente === user.name || m.assistente === user.name);
                });
                
                let totalCommission = 0;
                userMatriculas.forEach(m => {
                    if (m.vendedor === user.name) totalCommission += m.comissaoVendedor || 0;
                    if (m.gerente === user.name) totalCommission += m.comissaoGerente || 0;
                    if (m.assistente === user.name) totalCommission += m.comissaoAssistente || 0;
                });
                
                if (totalCommission > 0) {
                    commissions.push({
                        nome: user.name,
                        role: user.role,
                        unidade: user.unit,
                        totalComissao: totalCommission,
                        matriculas: userMatriculas.length
                    });
                }
            });
            
            return commissions;
        }

        // Widget de Clima/Informa√ß√µes
        function initWeatherWidget() {
            updateWeatherWidget();
            setInterval(updateWeatherWidget, 60000); // Atualizar a cada minuto
        }

        function updateWeatherWidget() {
            const now = new Date();
            document.getElementById('weatherTime').textContent = now.toLocaleTimeString();
            
            // Simular dados de clima para Bras√≠lia
            const weather = getSimulatedWeather();
            document.getElementById('weatherIcon').textContent = weather.icon;
            document.getElementById('weatherTemp').textContent = weather.temp;
            
            // Mostrar widget se habilitado
            if (localStorage.getItem('showWeatherWidget') === 'true') {
                document.getElementById('weatherWidget').style.display = 'block';
            }
        }

        function getSimulatedWeather() {
            const hour = new Date().getHours();
            const weathers = [
                { icon: 'üåô', temp: '18¬∞C' }, // Noite
                { icon: 'üåÖ', temp: '22¬∞C' }, // Manh√£
                { icon: '‚òÄÔ∏è', temp: '28¬∞C' }, // Dia
                { icon: 'üåÜ', temp: '25¬∞C' }  // Tarde
            ];
            
            if (hour >= 6 && hour < 12) return weathers[1];
            if (hour >= 12 && hour < 18) return weathers[2];
            if (hour >= 18 && hour < 22) return weathers[3];
            return weathers[0];
        }

        // Sistema de Tags
        function addNewTag() {
            const tagName = prompt('Nome da nova tag:');
            if (tagName) {
                showNotification(`Tag "${tagName}" criada!`, 'success');
                // Implementar l√≥gica de tags
            }
        }

        // Inicializa√ß√£o dos novos sistemas
        function initializeAdvancedFeatures() {
            setupKeyboardShortcuts();
            initWeatherWidget();
            
            // Verificar se √© primeira visita para mostrar tour
            if (!localStorage.getItem('tourCompleted')) {
                setTimeout(() => {
                    if (currentUser) {
                        startTour();
                    }
                }, 2000);
            }
            
            // Mostrar widget de info r√°pida para admins
            if (currentUser?.role === 'admin') {
                setTimeout(() => {
                    toggleQuickInfo();
                }, 3000);
            }
        }
        let currentUser = null;
        let currentUnit = null;
        let currentTheme = 'light';
        let autoSyncInterval = null;
        let currentChatRoom = null;
        let notifications = [];
        let systemConfig = {};

        // Estrutura de dados
        let gameData = {
            users: {},
            matriculas: [],
            visitas: [],
            comissoes: [],
            units: ['Shopping Conjunto Nacional', 'Shopping Eldorado', 'Shopping Morumbi'],
            events: [],
            missions: [],
            achievements: [],
            chatMessages: {},
            privateMessages: [],
            metas: {}
        };

        // Fun√ß√£o principal de inicializa√ß√£o
        function initializeSystem() {
            loadGameData();
            initializeDefaultData();
            setupEventListeners();
            updateCurrentDateTime();
            checkAutoLogin();
            showDebugButtons();
        }

        // Carregamento e salvamento de dados
        function loadGameData() {
            try {
                const saved = JSON.parse(localStorage.getItem('gameCreatorsData') || '{}');
                gameData = { ...gameData, ...saved };
                console.log('‚úÖ Dados carregados com sucesso');
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                showNotification('Erro ao carregar dados salvos', 'error');
            }
        }

        function saveGameData() {
            try {
                localStorage.setItem('gameCreatorsData', JSON.stringify(gameData));
                updateSyncStatus('success');
            } catch (error) {
                console.error('‚ùå Erro ao salvar dados:', error);
                updateSyncStatus('error');
                showNotification('Erro ao salvar dados', 'error');
            }
        }

        // Inicializa√ß√£o de dados padr√£o
        function initializeDefaultData() {
            if (!gameData.users || Object.keys(gameData.users).length === 0) {
                createDefaultUsers();
            }
            if (!gameData.metas || Object.keys(gameData.metas).length === 0) {
                initializeDefaultMetas();
            }
            if (!gameData.chatMessages) {
                gameData.chatMessages = {
                    geral: [],
                    vendas: [],
                    suporte: []
                };
            }
        }

        function createDefaultUsers() {
            const defaultUsers = [
                {
                    username: 'admin@gamecreatorsadm.com',
                    password: 'admin123',
                    name: 'Administrador',
                    role: 'admin',
                    unit: 'Shopping Conjunto Nacional',
                    xp: 5000,
                    level: 10,
                    achievements: ['first_sale', 'super_seller', 'team_leader']
                },
                {
                    username: 'gerente@gamecreatorsadm.com',
                    password: 'gerente123',
                    name: 'Carlos Manager',
                    role: 'gerente',
                    unit: 'Shopping Conjunto Nacional',
                    xp: 3500,
                    level: 7,
                    achievements: ['first_sale', 'team_leader']
                },
                {
                    username: 'vendedor@gamecreatorsadm.com',
                    password: 'vendedor123',
                    name: 'Ana Silva',
                    role: 'vendedor',
                    unit: 'Shopping Conjunto Nacional',
                    xp: 2100,
                    level: 5,
                    achievements: ['first_sale', 'super_seller']
                },
                {
                    username: 'assistente@gamecreatorsadm.com',
                    password: 'assistente123',
                    name: 'Jo√£o Santos',
                    role: 'assistente',
                    unit: 'Shopping Conjunto Nacional',
                    xp: 1200,
                    level: 3,
                    achievements: ['first_sale']
                }
            ];

            defaultUsers.forEach(user => {
                gameData.users[user.username] = {
                    ...user,
                    id: generateId(),
                    createdAt: new Date().toISOString(),
                    stats: {
                        matriculas: Math.floor(Math.random() * 20),
                        visitas: Math.floor(Math.random() * 50),
                        conversao: Math.random() * 0.5,
                        comissao: Math.random() * 5000
                    }
                };
            });

            console.log('‚úÖ Usu√°rios padr√£o criados');
        }

        function initializeDefaultMetas() {
            gameData.units.forEach(unit => {
                gameData.metas[unit] = {
                    vendedores: 15,
                    gerentes: 20,
                    assistentes: 10,
                    unidade: 50
                };
            });
        }

        // Sistema de login
        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!username || !password) {
                showNotification('Por favor, preencha todos os campos', 'warning');
                return;
            }

            const user = gameData.users[username];
            
            if (user && user.password === password) {
                currentUser = user;
                currentUnit = user.unit;
                
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                showNotification(`Bem-vindo, ${user.name}! üéâ`, 'success');
                
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainSystem').style.display = 'block';
                
                initializeUserInterface();
                addActivity('login', `${user.name} fez login no sistema`);
                
                console.log('‚úÖ Login realizado com sucesso');
            } else {
                document.getElementById('loginError').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('loginError').classList.add('hidden');
                }, 3000);
                console.log('‚ùå Credenciais inv√°lidas');
            }
        }

        function logout() {
            if (currentUser) {
                addActivity('logout', `${currentUser.name} saiu do sistema`);
            }
            
            currentUser = null;
            currentUnit = null;
            
            localStorage.removeItem('currentUser');
            
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainSystem').style.display = 'none';
            
            clearInterval(autoSyncInterval);
            
            showNotification('Logout realizado com sucesso! üëã', 'info');
            console.log('‚úÖ Logout realizado');
        }

        function checkAutoLogin() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    currentUnit = currentUser.unit;
                    
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainSystem').style.display = 'block';
                    
                    initializeUserInterface();
                    showNotification(`Bem-vindo de volta, ${currentUser.name}! üéâ`, 'success');
                } catch (error) {
                    console.error('‚ùå Erro no auto-login:', error);
                    localStorage.removeItem('currentUser');
                }
            }
        }

        // Interface do usu√°rio
        function initializeUserInterface() {
            updateUserInfo();
            createNavigation();
            updateDashboard();
            setupUnitFilter();
            populateSelects();
            loadNotifications();
            startAutoSync();
            updateCalendar();
            loadGoogleSheetsConfig();
            setupGoogleSheetsListeners();
            initializeAdvancedFeatures();
        }

        function updateUserInfo() {
            if (!currentUser) return;

            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userLevel').textContent = `N√≠vel ${currentUser.level} - ${getLevelName(currentUser.level)}`;
            document.getElementById('userUnit').textContent = currentUser.unit;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            
            // Atualizar cores do avatar baseado no n√≠vel
            const avatar = document.getElementById('userAvatar');
            const level = currentUser.level;
            if (level >= 10) avatar.style.background = 'linear-gradient(135deg, #ffd700, #ffed4e)';
            else if (level >= 7) avatar.style.background = 'linear-gradient(135deg, #c0c0c0, #e2e8f0)';
            else if (level >= 5) avatar.style.background = 'linear-gradient(135deg, #cd7f32, #dd6b20)';
        }

        function createNavigation() {
            const navTabs = document.getElementById('navTabs');
            const tabs = [
                { id: 'dashboard', name: 'üìä Dashboard', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'calendario', name: 'üìÖ Calend√°rio', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'gamificacao', name: 'üéÆ Gamifica√ß√£o', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'visitas', name: 'üë• Visitas', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'matriculas', name: 'üìö Matr√≠culas', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'equipe', name: 'üë• Equipe', roles: ['admin', 'gerente'] },
                { id: 'ranking', name: 'üèÜ Ranking', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'relatorios', name: 'üìä Relat√≥rios', roles: ['admin', 'gerente'] },
                { id: 'chat', name: 'üí¨ Chat', roles: ['admin', 'gerente', 'vendedor', 'assistente'] },
                { id: 'admin', name: '‚öôÔ∏è Admin', roles: ['admin'] }
            ];

            navTabs.innerHTML = tabs
                .filter(tab => tab.roles.includes(currentUser.role))
                .map(tab => `
                    <button class="tab-button ${tab.id === 'dashboard' ? 'active' : ''}" 
                            onclick="switchTab('${tab.id}')">
                        ${tab.name}
                    </button>
                `).join('');
        }

        function switchTab(tabId) {
            // Remover active de todas as tabs
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Ativar tab selecionada
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            // Carregar conte√∫do espec√≠fico da tab
            switch(tabId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'gamificacao':
                    updateGamification();
                    break;
                case 'visitas':
                    updateVisitasTab();
                    break;
                case 'equipe':
                    updateTeamTab();
                    break;
                case 'ranking':
                    updateRanking();
                    break;
                case 'admin':
                    updateAdminTab();
                    break;
                case 'matriculas':
                    updateMatriculasTab();
                    break;
                case 'relatorios':
                    updateRelatoriosTab();
                    break;
                case 'chat':
                    updateChatTab();
                    break;
                case 'calendario':
                    updateCalendar();
                    break;
            }
        }

        // Dashboard
        function updateDashboard() {
            const grid = document.getElementById('dashboardGrid');
            const userStats = calculateUserStats();
            const unitStats = calculateUnitStats();

            const cards = [
                {
                    title: 'Matr√≠culas do M√™s',
                    value: userStats.matriculas,
                    icon: 'üìö',
                    color: '#38a169',
                    progress: (userStats.matriculas / (gameData.metas[currentUnit]?.[currentUser.role] || 10)) * 100
                },
                {
                    title: 'Visitas Registradas',
                    value: userStats.visitas,
                    icon: 'üë•',
                    color: '#3182ce',
                    progress: (userStats.visitas / 50) * 100
                },
                {
                    title: 'Taxa de Convers√£o',
                    value: `${(userStats.conversao * 100).toFixed(1)}%`,
                    icon: 'üìà',
                    color: '#ed8936',
                    progress: userStats.conversao * 100
                },
                {
                    title: 'Comiss√£o do M√™s',
                    value: `R$ ${userStats.comissao.toFixed(2)}`,
                    icon: 'üí∞',
                    color: '#38a169',
                    progress: (userStats.comissao / 5000) * 100
                },
                {
                    title: 'Experi√™ncia (XP)',
                    value: currentUser.xp || 0,
                    icon: '‚≠ê',
                    color: '#667eea',
                    progress: ((currentUser.xp || 0) % 1000) / 10
                },
                {
                    title: 'N√≠vel Atual',
                    value: currentUser.level || 1,
                    icon: 'üéÆ',
                    color: '#ed8936',
                    progress: 100
                }
            ];

            grid.innerHTML = cards.map(card => `
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">${card.icon}</div>
                        <div style="font-size: 14px; font-weight: 600; color: ${card.color};">${card.title}</div>
                    </div>
                    <div class="stat-value" style="color: ${card.color};">${card.value}</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(card.progress, 100)}%; background: linear-gradient(135deg, ${card.color}, ${card.color}90);"></div>
                    </div>
                    <div class="progress-text">${Math.min(card.progress, 100).toFixed(0)}% da meta</div>
                </div>
            `).join('');

            updateActivityFeed();
        }

        function calculateUserStats() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const matriculas = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                return date.getMonth() === currentMonth && 
                       date.getFullYear() === currentYear &&
                       (m.vendedor === currentUser.name || m.gerente === currentUser.name || m.assistente === currentUser.name);
            });

            const visitas = gameData.visitas.filter(v => {
                const date = new Date(v.data);
                return date.getMonth() === currentMonth && 
                       date.getFullYear() === currentYear &&
                       v.atendente === currentUser.name;
            });

            const comissao = matriculas.reduce((sum, m) => sum + (m.comissaoVendedor || 0) + (m.comissaoGerente || 0) + (m.comissaoAssistente || 0), 0);
            const conversao = visitas.length > 0 ? matriculas.length / visitas.length : 0;

            return {
                matriculas: matriculas.length,
                visitas: visitas.length,
                conversao: conversao,
                comissao: comissao
            };
        }

        function calculateUnitStats() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const unitMatriculas = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                return date.getMonth() === currentMonth && 
                       date.getFullYear() === currentYear;
            });

            const unitVisitas = gameData.visitas.filter(v => {
                const date = new Date(v.data);
                return date.getMonth() === currentMonth && 
                       date.getFullYear() === currentYear;
            });

            return {
                matriculas: unitMatriculas.length,
                visitas: unitVisitas.length,
                conversao: unitVisitas.length > 0 ? unitMatriculas.length / unitVisitas.length : 0
            };
        }

        // Sistema de gamifica√ß√£o
        function updateGamification() {
            updateUserProgress();
            updateActiveMissions();
            updateUserAchievements();
            
            if (currentUser.role === 'admin' || currentUser.role === 'gerente') {
                document.getElementById('createMissionSection').classList.remove('hidden');
            }
        }

        function updateUserProgress() {
            const progressDiv = document.getElementById('userProgress');
            const xp = currentUser.xp || 0;
            const level = currentUser.level || 1;
            const nextLevelXP = level * 1000;
            const currentLevelXP = (level - 1) * 1000;
            const progressXP = xp - currentLevelXP;
            const neededXP = nextLevelXP - currentLevelXP;

            progressDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 25px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 15px;">
                        <div style="font-size: 32px; margin-bottom: 10px;">üéÆ</div>
                        <div style="font-size: 28px; font-weight: bold; margin-bottom: 8px;">N√≠vel ${level}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${getLevelName(level)}</div>
                        <div class="xp-badge" style="margin-top: 15px;">${xp} XP Total</div>
                    </div>
                    <div style="padding: 25px;">
                        <h4 style="margin-bottom: 15px;">üìà Progresso para o Pr√≥ximo N√≠vel</h4>
                        <div class="progress-bar" style="height: 15px; margin-bottom: 10px;">
                            <div class="progress-fill" style="width: ${(progressXP / neededXP) * 100}%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
                            <span>${progressXP} XP</span>
                            <span>${neededXP - progressXP} XP restantes</span>
                        </div>
                    </div>
                    <div style="padding: 25px;">
                        <h4 style="margin-bottom: 15px;">üèÜ Conquistas</h4>
                        <div>
                            ${(currentUser.achievements || []).map(achievement => 
                                `<span class="achievement-badge">${getAchievementName(achievement)}</span>`
                            ).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function getLevelName(level) {
            if (level >= 10) return 'Lenda';
            if (level >= 8) return 'Especialista';
            if (level >= 6) return 'Veterano';
            if (level >= 4) return 'Experiente';
            if (level >= 2) return 'Aprendiz';
            return 'Iniciante';
        }

        function getAchievementName(achievement) {
            const achievements = {
                'first_sale': 'üéØ Primeira Venda',
                'super_seller': '‚≠ê Super Vendedor',
                'team_leader': 'üëë L√≠der de Equipe',
                'month_champion': 'üèÜ Campe√£o do M√™s',
                'conversion_master': 'üìà Mestre da Convers√£o'
            };
            return achievements[achievement] || achievement;
        }

        function updateActiveMissions() {
            const missionsDiv = document.getElementById('activeMissions');
            
            // Criar miss√µes de exemplo se n√£o existirem
            if (!gameData.missions || gameData.missions.length === 0) {
                gameData.missions = [
                    {
                        id: generateId(),
                        title: 'Meta Mensal de Vendas',
                        description: 'Alcance sua meta de vendas do m√™s',
                        type: 'vendas',
                        target: gameData.metas[currentUnit]?.[currentUser.role] || 10,
                        current: calculateUserStats().matriculas,
                        reward: 500,
                        deadline: getEndOfMonth(),
                        status: 'active'
                    },
                    {
                        id: generateId(),
                        title: 'Conquistador de Leads',
                        description: 'Registre 30 visitas este m√™s',
                        type: 'visitas',
                        target: 30,
                        current: calculateUserStats().visitas,
                        reward: 300,
                        deadline: getEndOfMonth(),
                        status: 'active'
                    },
                    {
                        id: generateId(),
                        title: 'Mestre da Convers√£o',
                        description: 'Mantenha taxa de convers√£o acima de 25%',
                        type: 'conversao',
                        target: 0.25,
                        current: calculateUserStats().conversao,
                        reward: 400,
                        deadline: getEndOfMonth(),
                        status: 'active'
                    }
                ];
            }

            missionsDiv.innerHTML = gameData.missions.map(mission => {
                const progress = mission.type === 'conversao' ? 
                    (mission.current * 100) : 
                    (mission.current / mission.target) * 100;
                
                const isCompleted = mission.current >= mission.target;
                const cardClass = isCompleted ? 'mission-completed' : 'mission-card';

                return `
                    <div class="${cardClass}">
                        <div class="mission-header">
                            <div class="mission-title">${mission.title}</div>
                            <div class="mission-reward">${mission.reward} XP</div>
                        </div>
                        <p style="color: #666; margin-bottom: 15px;">${mission.description}</p>
                        <div class="mission-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(progress, 100)}%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 12px; margin-top: 5px;">
                                <span>${mission.type === 'conversao' ? 
                                    `${(mission.current * 100).toFixed(1)}%` : 
                                    `${mission.current} de ${mission.target}`}</span>
                                <span>Prazo: ${new Date(mission.deadline).toLocaleDateString()}</span>
                            </div>
                        </div>
                        ${isCompleted ? 
                            '<div style="text-align: center; margin-top: 15px; color: #38a169; font-weight: bold;">‚úÖ Miss√£o Completa!</div>' : 
                            '<div style="text-align: center; margin-top: 15px; color: #666; font-size: 12px;">Continue trabalhando para completar esta miss√£o</div>'
                        }
                    </div>
                `;
            }).join('');
        }

        function updateUserAchievements() {
            const achievementsDiv = document.getElementById('userAchievements');
            const allAchievements = [
                { id: 'first_sale', name: 'üéØ Primeira Venda', description: 'Fa√ßa sua primeira venda' },
                { id: 'super_seller', name: '‚≠ê Super Vendedor', description: 'Venda 10 matr√≠culas em um m√™s' },
                { id: 'team_leader', name: 'üëë L√≠der de Equipe', description: 'Lidere uma equipe de vendas' },
                { id: 'month_champion', name: 'üèÜ Campe√£o do M√™s', description: 'Seja o #1 do m√™s' },
                { id: 'conversion_master', name: 'üìà Mestre da Convers√£o', description: 'Mantenha 30%+ de convers√£o' }
            ];

            const userAchievements = currentUser.achievements || [];

            achievementsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    ${allAchievements.map(achievement => `
                        <div style="border: 2px solid ${userAchievements.includes(achievement.id) ? '#38a169' : '#e2e8f0'}; 
                                    border-radius: 12px; padding: 20px; text-align: center;
                                    background: ${userAchievements.includes(achievement.id) ? 'linear-gradient(135deg, #e6fffa, #f0fff4)' : '#f8f9fa'};">
                            <div style="font-size: 32px; margin-bottom: 10px;">${achievement.name.split(' ')[0]}</div>
                            <h4 style="color: ${userAchievements.includes(achievement.id) ? '#38a169' : '#666'};">
                                ${achievement.name.substring(2)}
                            </h4>
                            <p style="color: #666; font-size: 12px; margin: 10px 0;">${achievement.description}</p>
                            ${userAchievements.includes(achievement.id) ? 
                                '<div style="color: #38a169; font-weight: bold; font-size: 12px;">‚úÖ Conquistado!</div>' : 
                                '<div style="color: #999; font-size: 12px;">üîí Bloqueado</div>'
                            }
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Sistema de visitas
        function updateVisitasTab() {
            document.getElementById('visitsUnitName').textContent = currentUnit;
            document.getElementById('visitDate').value = new Date().toISOString().split('T')[0];
            populateVisitSelects();
            updateConversionMetrics();
            updateVisitsList();
        }

        function populateVisitSelects() {
            const attendantSelect = document.getElementById('visitAttendant');
            const attendantFilter = document.getElementById('visitAttendantFilter');
            
            const unitUsers = Object.values(gameData.users).filter(user => 
                user.unit === currentUnit && ['vendedor', 'gerente', 'assistente'].includes(user.role)
            );

            const options = unitUsers.map(user => 
                `<option value="${user.name}">${user.name} (${user.role})</option>`
            ).join('');

            attendantSelect.innerHTML = '<option value="">Selecione...</option>' + options;
            attendantFilter.innerHTML = '<option value="">Todos</option>' + options;
        }

        function addVisit() {
            const visitData = {
                id: generateId(),
                data: document.getElementById('visitDate').value,
                nome: document.getElementById('visitName').value,
                telefone: document.getElementById('visitPhone').value,
                curso: document.getElementById('visitCourse').value,
                atendente: document.getElementById('visitAttendant').value,
                observacoes: document.getElementById('visitNotes').value,
                unidade: currentUnit,
                status: 'pending',
                createdAt: new Date().toISOString(),
                createdBy: currentUser.name
            };

            if (!visitData.data || !visitData.nome || !visitData.telefone || !visitData.curso || !visitData.atendente) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'warning');
                return;
            }

            gameData.visitas.push(visitData);
            saveGameData();

            // Adicionar XP
            addXP(20, 'Visita registrada');
            
            showNotification('Visita registrada com sucesso! +20 XP', 'success');
            addActivity('visit_added', `${currentUser.name} registrou uma visita de ${visitData.nome}`);

            // Limpar formul√°rio
            document.getElementById('visitName').value = '';
            document.getElementById('visitPhone').value = '';
            document.getElementById('visitCourse').value = '';
            document.getElementById('visitAttendant').value = '';
            document.getElementById('visitNotes').value = '';

            updateVisitsList();
            updateConversionMetrics();
        }

        function updateConversionMetrics() {
            const metricsDiv = document.getElementById('conversionMetrics');
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const monthVisitas = gameData.visitas.filter(v => {
                const date = new Date(v.data);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });

            const monthMatriculas = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });

            const conversionRate = monthVisitas.length > 0 ? (monthMatriculas.length / monthVisitas.length) * 100 : 0;

            metricsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: #3182ce;">${monthVisitas.length}</div>
                        <div style="font-size: 14px; color: #666;">Visitas do M√™s</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: #38a169;">${monthMatriculas.length}</div>
                        <div style="font-size: 14px; color: #666;">Matr√≠culas do M√™s</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: #ed8936;">${conversionRate.toFixed(1)}%</div>
                        <div style="font-size: 14px; color: #666;">Taxa de Convers√£o</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 32px; font-weight: bold; color: #667eea;">${monthVisitas.filter(v => v.status === 'pending').length}</div>
                        <div style="font-size: 14px; color: #666;">Visitas Pendentes</div>
                    </div>
                </div>
            `;
        }

        function updateVisitsList() {
            const visitsDiv = document.getElementById('recentVisits');
            let filteredVisits = [...gameData.visitas].reverse();

            // Aplicar filtros
            const periodFilter = document.getElementById('visitPeriodFilter')?.value || 'month';
            const attendantFilter = document.getElementById('visitAttendantFilter')?.value || '';
            const statusFilter = document.getElementById('visitStatusFilter')?.value || '';
            const searchBox = document.getElementById('visitSearchBox')?.value || '';

            // Filtro por per√≠odo
            const now = new Date();
            filteredVisits = filteredVisits.filter(visit => {
                const visitDate = new Date(visit.data);
                switch(periodFilter) {
                    case 'today':
                        return visitDate.toDateString() === now.toDateString();
                    case 'week':
                        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        return visitDate >= weekAgo;
                    case 'month':
                        return visitDate.getMonth() === now.getMonth() && visitDate.getFullYear() === now.getFullYear();
                    default:
                        return true;
                }
            });

            // Outros filtros
            if (attendantFilter) {
                filteredVisits = filteredVisits.filter(visit => visit.atendente === attendantFilter);
            }
            if (statusFilter) {
                filteredVisits = filteredVisits.filter(visit => visit.status === statusFilter);
            }
            if (searchBox) {
                filteredVisits = filteredVisits.filter(visit => 
                    visit.nome.toLowerCase().includes(searchBox.toLowerCase()) ||
                    visit.telefone.includes(searchBox)
                );
            }

            if (filteredVisits.length === 0) {
                visitsDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Nenhuma visita encontrada</p>';
                return;
            }

            visitsDiv.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üìÖ Data</th>
                            <th>üë§ Nome</th>
                            <th>üì± Telefone</th>
                            <th>üéì Curso</th>
                            <th>üë®‚Äçüíº Atendente</th>
                            <th>üìä Status</th>
                            <th>üîß A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredVisits.map(visit => `
                            <tr>
                                <td>${new Date(visit.data).toLocaleDateString()}</td>
                                <td>${visit.nome}</td>
                                <td>${visit.telefone}</td>
                                <td>${visit.curso}</td>
                                <td>${visit.atendente}</td>
                                <td>
                                    <span class="role-badge ${visit.status === 'converted' ? 'role-admin' : 'role-assistente'}">
                                        ${visit.status === 'converted' ? '‚úÖ Convertido' : '‚è≥ Pendente'}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        ${visit.status === 'pending' ? 
                                            `<button class="btn btn-success btn-sm" onclick="convertVisit('${visit.id}')">üéØ Converter</button>` :
                                            `<button class="btn btn-info btn-sm" onclick="viewVisitDetails('${visit.id}')">üëÅÔ∏è Ver</button>`
                                        }
                                        <button class="btn btn-danger btn-sm" onclick="deleteVisit('${visit.id}')">üóëÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function filterVisits() {
            updateVisitsList();
        }

        // Sistema de matr√≠culas
        function updateMatriculasTab() {
            document.getElementById('newData').value = new Date().toISOString().split('T')[0];
            populateMatriculaSelects();
            updateMatriculasList();
        }

        function populateMatriculaSelects() {
            const vendedorSelect = document.getElementById('newVendedor');
            const gerenteSelect = document.getElementById('newGerente');
            const assistenteSelect = document.getElementById('newAssistente');
            const filterVendedor = document.getElementById('matriculaVendedorFilter');

            const unitUsers = Object.values(gameData.users).filter(user => user.unit === currentUnit);
            
            const vendedores = unitUsers.filter(user => user.role === 'vendedor');
            const gerentes = unitUsers.filter(user => user.role === 'gerente');
            const assistentes = unitUsers.filter(user => user.role === 'assistente');

            vendedorSelect.innerHTML = '<option value="">Selecione...</option>' + 
                vendedores.map(user => `<option value="${user.name}">${user.name}</option>`).join('');
            
            gerenteSelect.innerHTML = '<option value="">Selecione...</option>' + 
                gerentes.map(user => `<option value="${user.name}">${user.name}</option>`).join('');
            
            assistenteSelect.innerHTML = '<option value="">Selecione...</option>' + 
                assistentes.map(user => `<option value="${user.name}">${user.name}</option>`).join('');

            filterVendedor.innerHTML = '<option value="">Todos</option>' + 
                vendedores.map(user => `<option value="${user.name}">${user.name}</option>`).join('');
        }

        function addMatricula() {
            const matriculaData = {
                id: generateId(),
                data: document.getElementById('newData').value,
                nome: document.getElementById('newNome').value,
                telefone: document.getElementById('newTelefone').value,
                curso: document.getElementById('newCurso').value,
                valorTotal: parseFloat(document.getElementById('newValorTotal').value),
                valorEntrada: parseFloat(document.getElementById('newValorEntrada').value),
                tipo: document.getElementById('newTipo').value,
                parcelas: parseInt(document.getElementById('newParcelas').value) || 1,
                vendedor: document.getElementById('newVendedor').value,
                gerente: document.getElementById('newGerente').value,
                assistente: document.getElementById('newAssistente').value,
                origem: document.getElementById('newFromVisit').value,
                origemCustom: document.getElementById('customOriginText').value,
                unidade: currentUnit,
                createdAt: new Date().toISOString(),
                createdBy: currentUser.name
            };

            // Valida√ß√µes
            if (!matriculaData.data || !matriculaData.nome || !matriculaData.curso || 
                !matriculaData.valorTotal || !matriculaData.valorEntrada ||
                !matriculaData.vendedor || !matriculaData.gerente || !matriculaData.assistente) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'warning');
                return;
            }

            if (matriculaData.valorEntrada > matriculaData.valorTotal) {
                showNotification('Valor de entrada n√£o pode ser maior que o valor total', 'error');
                return;
            }

            // Calcular comiss√µes
            const comissoes = calculateCommissions(matriculaData);
            matriculaData.comissaoVendedor = comissoes.vendedor;
            matriculaData.comissaoGerente = comissoes.gerente;
            matriculaData.comissaoAssistente = comissoes.assistente;

            gameData.matriculas.push(matriculaData);
            
            // Marcar visita como convertida se houver origem
            if (matriculaData.origem && matriculaData.origem !== 'custom') {
                const relatedVisit = gameData.visitas.find(v => 
                    v.nome.toLowerCase().includes(matriculaData.nome.toLowerCase()) ||
                    v.telefone === matriculaData.telefone
                );
                if (relatedVisit) {
                    relatedVisit.status = 'converted';
                    relatedVisit.convertedAt = new Date().toISOString();
                    relatedVisit.matriculaId = matriculaData.id;
                }
            }

            saveGameData();

            // Adicionar XP para todos os envolvidos
            const xpGain = 100;
            addXPToUser(matriculaData.vendedor, xpGain, 'Matr√≠cula realizada');
            addXPToUser(matriculaData.gerente, xpGain * 0.5, 'Supervis√£o de matr√≠cula');
            addXPToUser(matriculaData.assistente, xpGain * 0.3, 'Apoio em matr√≠cula');

            showNotification('Matr√≠cula adicionada com sucesso! +100 XP', 'success');
            addActivity('matricula_added', `${currentUser.name} adicionou matr√≠cula de ${matriculaData.nome}`);

            // Verificar conquistas
            checkAchievements();

            // Limpar formul√°rio
            clearMatriculaForm();
            updateMatriculasList();
            updateDashboard();
        }

        function calculateCommissions(matricula) {
            const baseCommission = matricula.valorEntrada * 0.1; // 10% base

            let multiplier = 1;
            switch(matricula.tipo) {
                case 'Blackin':
                    multiplier = 1.2;
                    break;
                case 'Black':
                    multiplier = 1.5;
                    break;
                default:
                    multiplier = 1;
            }

            const totalCommission = baseCommission * multiplier;

            return {
                vendedor: totalCommission * 0.6,  // 60% para vendedor
                gerente: totalCommission * 0.25,  // 25% para gerente
                assistente: totalCommission * 0.15 // 15% para assistente
            };
        }

        function clearMatriculaForm() {
            document.getElementById('newNome').value = '';
            document.getElementById('newTelefone').value = '';
            document.getElementById('newCurso').value = '';
            document.getElementById('newValorTotal').value = '';
            document.getElementById('newValorEntrada').value = '';
            document.getElementById('newTipo').value = '';
            document.getElementById('newParcelas').value = '';
            document.getElementById('newVendedor').value = '';
            document.getElementById('newGerente').value = '';
            document.getElementById('newAssistente').value = '';
            document.getElementById('newFromVisit').value = '';
            document.getElementById('customOriginText').value = '';
            document.getElementById('customOriginGroup').style.display = 'none';
        }

        function toggleCustomOrigin() {
            const select = document.getElementById('newFromVisit');
            const customGroup = document.getElementById('customOriginGroup');
            
            if (select.value === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
            }
        }

        function updateMatriculasList() {
            const listDiv = document.getElementById('matriculasList');
            let filteredMatriculas = [...gameData.matriculas].reverse();

            // Aplicar filtros
            const periodFilter = document.getElementById('matriculaPeriodFilter')?.value || 'month';
            const vendedorFilter = document.getElementById('matriculaVendedorFilter')?.value || '';
            const cursoFilter = document.getElementById('matriculaCursoFilter')?.value || '';
            const searchBox = document.getElementById('matriculaSearchBox')?.value || '';

            // Filtro por per√≠odo
            const now = new Date();
            filteredMatriculas = filteredMatriculas.filter(matricula => {
                const matriculaDate = new Date(matricula.data);
                switch(periodFilter) {
                    case 'today':
                        return matriculaDate.toDateString() === now.toDateString();
                    case 'week':
                        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        return matriculaDate >= weekAgo;
                    case 'month':
                        return matriculaDate.getMonth() === now.getMonth() && matriculaDate.getFullYear() === now.getFullYear();
                    default:
                        return true;
                }
            });

            // Outros filtros
            if (vendedorFilter) {
                filteredMatriculas = filteredMatriculas.filter(matricula => matricula.vendedor === vendedorFilter);
            }
            if (cursoFilter) {
                filteredMatriculas = filteredMatriculas.filter(matricula => matricula.curso === cursoFilter);
            }
            if (searchBox) {
                filteredMatriculas = filteredMatriculas.filter(matricula => 
                    matricula.nome.toLowerCase().includes(searchBox.toLowerCase())
                );
            }

            if (filteredMatriculas.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Nenhuma matr√≠cula encontrada</p>';
                return;
            }

            listDiv.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üìÖ Data</th>
                            <th>üë§ Aluno</th>
                            <th>üì± Telefone</th>
                            <th>üéì Curso</th>
                            <th>üí∞ Valor</th>
                            <th>üë®‚Äçüíº Vendedor</th>
                            <th>üìä Tipo</th>
                            <th>üîß A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredMatriculas.map(matricula => `
                            <tr>
                                <td>${new Date(matricula.data).toLocaleDateString()}</td>
                                <td>${matricula.nome}</td>
                                <td>${matricula.telefone}</td>
                                <td>${matricula.curso}</td>
                                <td>R$ ${matricula.valorTotal.toFixed(2)}</td>
                                <td>${matricula.vendedor}</td>
                                <td>
                                    <span class="role-badge ${matricula.tipo === 'Black' ? 'role-admin' : 
                                        matricula.tipo === 'Blackin' ? 'role-gerente' : 'role-vendedor'}">
                                        ${matricula.tipo}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-info btn-sm" onclick="viewMatriculaDetails('${matricula.id}')">üëÅÔ∏è Ver</button>
                                        <button class="btn btn-warning btn-sm" onclick="editMatricula('${matricula.id}')">‚úèÔ∏è Editar</button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteMatricula('${matricula.id}')">üóëÔ∏è Excluir</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function filterMatriculas() {
            updateMatriculasList();
        }

        // Sistema de XP e n√≠veis
        function addXP(amount, reason) {
            if (!currentUser) return;

            const oldLevel = currentUser.level || 1;
            currentUser.xp = (currentUser.xp || 0) + amount;
            currentUser.level = Math.floor(currentUser.xp / 1000) + 1;

            // Atualizar no gameData
            gameData.users[currentUser.username] = currentUser;
            
            if (currentUser.level > oldLevel) {
                showNotification(`üéâ Parab√©ns! Voc√™ subiu para o n√≠vel ${currentUser.level}!`, 'success');
                addActivity('level_up', `${currentUser.name} subiu para o n√≠vel ${currentUser.level}`);
            }

            saveGameData();
            updateUserInfo();

            console.log(`‚úÖ +${amount} XP adicionado por: ${reason}`);
        }

        function addXPToUser(userName, amount, reason) {
            const userEntry = Object.entries(gameData.users).find(([key, user]) => user.name === userName);
            if (!userEntry) return;

            const [userKey, user] = userEntry;
            const oldLevel = user.level || 1;
            user.xp = (user.xp || 0) + amount;
            user.level = Math.floor(user.xp / 1000) + 1;

            if (user.level > oldLevel) {
                addActivity('level_up', `${user.name} subiu para o n√≠vel ${user.level}`);
            }

            saveGameData();
        }

        // Sistema de conquistas
        function checkAchievements() {
            if (!currentUser.achievements) {
                currentUser.achievements = [];
            }

            const stats = calculateUserStats();

            // Primeira venda
            if (!currentUser.achievements.includes('first_sale') && stats.matriculas > 0) {
                currentUser.achievements.push('first_sale');
                showNotification('üéØ Conquista desbloqueada: Primeira Venda!', 'success');
                addXP(200, 'Conquista: Primeira Venda');
            }

            // Super vendedor
            if (!currentUser.achievements.includes('super_seller') && stats.matriculas >= 10) {
                currentUser.achievements.push('super_seller');
                showNotification('‚≠ê Conquista desbloqueada: Super Vendedor!', 'success');
                addXP(500, 'Conquista: Super Vendedor');
            }

            // Mestre da convers√£o
            if (!currentUser.achievements.includes('conversion_master') && stats.conversao >= 0.3) {
                currentUser.achievements.push('conversion_master');
                showNotification('üìà Conquista desbloqueada: Mestre da Convers√£o!', 'success');
                addXP(400, 'Conquista: Mestre da Convers√£o');
            }

            gameData.users[currentUser.username] = currentUser;
            saveGameData();
        }

        // Sistema de ranking
        function updateRanking() {
            const rankingBody = document.getElementById('rankingBody');
            const period = document.getElementById('rankingPeriod')?.value || 'month';
            const criteria = document.getElementById('rankingCriteria')?.value || 'matriculas';
            const unit = document.getElementById('rankingUnit')?.value || '';

            let users = Object.values(gameData.users);
            
            // Filtrar por unidade se especificado
            if (unit) {
                users = users.filter(user => user.unit === unit);
            }

            // Calcular estat√≠sticas para cada usu√°rio
            users = users.map(user => {
                const userStats = calculateUserStatsForUser(user, period);
                return {
                    ...user,
                    stats: userStats
                };
            });

            // Ordenar por crit√©rio
            users.sort((a, b) => {
                switch(criteria) {
                    case 'matriculas':
                        return b.stats.matriculas - a.stats.matriculas;
                    case 'conversao':
                        return b.stats.conversao - a.stats.conversao;
                    case 'visitas':
                        return b.stats.visitas - a.stats.visitas;
                    case 'xp':
                        return (b.xp || 0) - (a.xp || 0);
                    default:
                        return b.stats.matriculas - a.stats.matriculas;
                }
            });

            rankingBody.innerHTML = users.map((user, index) => {
                const position = index + 1;
                const rankClass = position === 1 ? 'rank-1' : 
                                 position === 2 ? 'rank-2' : 
                                 position === 3 ? 'rank-3' : 'rank-other';

                return `
                    <tr>
                        <td>
                            <div class="${rankClass}">${position}</div>
                        </td>
                        <td>${user.name}</td>
                        <td>${user.unit}</td>
                        <td>
                            <span class="role-badge role-${user.role}">${user.role}</span>
                        </td>
                        <td>${user.stats.visitas}</td>
                        <td>${user.stats.matriculas}</td>
                        <td>${(user.stats.conversao * 100).toFixed(1)}%</td>
                        <td>R$ ${user.stats.comissao.toFixed(2)}</td>
                        <td>
                            <span class="xp-badge">${user.xp || 0} XP</span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function calculateUserStatsForUser(user, period) {
            const now = new Date();
            let startDate;

            switch(period) {
                case 'quarter':
                    startDate = new Date(now.getFullYear(), Math.floor(now.getMonth() / 3) * 3, 1);
                    break;
                case 'year':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    break;
                case 'all':
                    startDate = new Date(2020, 0, 1);
                    break;
                default: // month
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
            }

            const matriculas = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                return date >= startDate && 
                       (m.vendedor === user.name || m.gerente === user.name || m.assistente === user.name);
            });

            const visitas = gameData.visitas.filter(v => {
                const date = new Date(v.data);
                return date >= startDate && v.atendente === user.name;
            });

            const comissao = matriculas.reduce((sum, m) => {
                let userCommission = 0;
                if (m.vendedor === user.name) userCommission += m.comissaoVendedor || 0;
                if (m.gerente === user.name) userCommission += m.comissaoGerente || 0;
                if (m.assistente === user.name) userCommission += m.comissaoAssistente || 0;
                return sum + userCommission;
            }, 0);

            const conversao = visitas.length > 0 ? matriculas.length / visitas.length : 0;

            return {
                matriculas: matriculas.length,
                visitas: visitas.length,
                conversao: conversao,
                comissao: comissao
            };
        }

        // Sistema de calend√°rio
        let currentCalendarDate = new Date();

        function updateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            calendarTitle.textContent = `${getMonthName(month)} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const days = [];
            const today = new Date();
            
            // Cabe√ßalho dos dias da semana
            const weekDays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            weekDays.forEach(day => {
                days.push(`<div style="font-weight: bold; padding: 10px; text-align: center; background: var(--bg-secondary);">${day}</div>`);
            });
            
            // Dias do calend√°rio
            for (let i = 0; i < 42; i++) {
                const currentDay = new Date(startDate);
                currentDay.setDate(startDate.getDate() + i);
                
                const isCurrentMonth = currentDay.getMonth() === month;
                const isToday = currentDay.toDateString() === today.toDateString();
                const hasEvents = gameData.events?.some(event => 
                    new Date(event.date).toDateString() === currentDay.toDateString()
                );
                
                const dayClass = `calendar-day ${isToday ? 'today' : ''} ${hasEvents ? 'has-events' : ''}`;
                const dayStyle = isCurrentMonth ? '' : 'opacity: 0.3;';
                
                days.push(`
                    <div class="${dayClass}" style="${dayStyle}" onclick="selectCalendarDay('${currentDay.toISOString()}')">
                        ${currentDay.getDate()}
                    </div>
                `);
            }
            
            calendarGrid.innerHTML = days.join('');
        }

        function changeMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            updateCalendar();
        }

        function selectCalendarDay(dateString) {
            const selectedDate = new Date(dateString);
            document.getElementById('selectedDate').textContent = selectedDate.toLocaleDateString();
            
            const dayEvents = gameData.events?.filter(event => 
                new Date(event.date).toDateString() === selectedDate.toDateString()
            ) || [];
            
            const eventsDiv = document.getElementById('dayEvents');
            
            if (dayEvents.length === 0) {
                eventsDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Nenhum evento neste dia</p>';
            } else {
                eventsDiv.innerHTML = dayEvents.map(event => `
                    <div style="border-left: 4px solid #38a169; padding: 15px; margin: 10px 0; background: var(--bg-primary); border-radius: 8px;">
                        <div style="font-weight: bold; margin-bottom: 5px;">${event.title}</div>
                        <div style="color: #666; font-size: 12px; margin-bottom: 5px;">
                            ${event.time} - ${event.type}
                        </div>
                        <div style="color: #666; font-size: 14px;">${event.description}</div>
                    </div>
                `).join('');
            }
        }

        function addEvent() {
            const eventData = {
                id: generateId(),
                title: document.getElementById('eventTitle').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                type: document.getElementById('eventType').value,
                description: document.getElementById('eventDescription').value,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };

            if (!eventData.title || !eventData.date) {
                showNotification('Preencha pelo menos o t√≠tulo e a data', 'warning');
                return;
            }

            if (!gameData.events) gameData.events = [];
            gameData.events.push(eventData);
            saveGameData();

            showNotification('Evento adicionado com sucesso!', 'success');
            addActivity('event_added', `${currentUser.name} adicionou evento: ${eventData.title}`);

            // Limpar formul√°rio
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';

            updateCalendar();
        }

        function getMonthName(month) {
            const months = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            return months[month];
        }

        // Sistema de atividades
        function addActivity(type, description) {
            if (!gameData.activities) gameData.activities = [];
            
            gameData.activities.unshift({
                id: generateId(),
                type: type,
                description: description,
                timestamp: new Date().toISOString(),
                user: currentUser?.name || 'Sistema'
            });

            // Manter apenas os √∫ltimos 100 registros
            if (gameData.activities.length > 100) {
                gameData.activities = gameData.activities.slice(0, 100);
            }

            saveGameData();
        }

        function updateActivityFeed() {
            const feedDiv = document.getElementById('activityFeed');
            const activities = gameData.activities?.slice(0, 10) || [];

            if (activities.length === 0) {
                feedDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Nenhuma atividade recente</p>';
                return;
            }

            feedDiv.innerHTML = activities.map(activity => {
                const timeAgo = getTimeAgo(activity.timestamp);
                const icon = getActivityIcon(activity.type);

                return `
                    <div class="activity-item">
                        <div class="activity-icon">${icon}</div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.description}</div>
                            <div class="activity-description">Por ${activity.user}</div>
                        </div>
                        <div class="activity-time">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }

        function getActivityIcon(type) {
            const icons = {
                'login': 'üîë',
                'logout': 'üö™',
                'matricula_added': 'üìö',
                'visit_added': 'üë•',
                'level_up': '‚¨ÜÔ∏è',
                'achievement': 'üèÜ',
                'event_added': 'üìÖ',
                'mission_completed': 'üéØ',
                'message_sent': 'üí¨'
            };
            return icons[type] || 'üìã';
        }

        function getTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffInMinutes = Math.floor((now - time) / (1000 * 60));

            if (diffInMinutes < 1) return 'Agora';
            if (diffInMinutes < 60) return `${diffInMinutes}min`;
            if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h`;
            return `${Math.floor(diffInMinutes / 1440)}d`;
        }

        // Sistema de notifica√ß√µes
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Adicionar √†s notifica√ß√µes do usu√°rio
            addUserNotification(message, type);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function addUserNotification(message, type) {
            if (!gameData.userNotifications) gameData.userNotifications = {};
            if (!gameData.userNotifications[currentUser.username]) gameData.userNotifications[currentUser.username] = [];
            
            gameData.userNotifications[currentUser.username].unshift({
                id: generateId(),
                message: message,
                type: type,
                timestamp: new Date().toISOString(),
                read: false
            });

            // Manter apenas as √∫ltimas 50 notifica√ß√µes
            if (gameData.userNotifications[currentUser.username].length > 50) {
                gameData.userNotifications[currentUser.username] = gameData.userNotifications[currentUser.username].slice(0, 50);
            }

            updateNotificationBadge();
            saveGameData();
        }

        function loadNotifications() {
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            const userNotifications = gameData.userNotifications?.[currentUser.username] || [];
            const unreadCount = userNotifications.filter(n => !n.read).length;
            
            badge.textContent = unreadCount;
            badge.style.display = unreadCount > 0 ? 'flex' : 'none';
        }

        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            const isVisible = panel.style.display === 'block';
            
            panel.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                updateNotificationPanel();
            }
        }

        function updateNotificationPanel() {
            const content = document.getElementById('notificationPanelContent');
            const userNotifications = gameData.userNotifications?.[currentUser.username] || [];
            
            if (userNotifications.length === 0) {
                content.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Nenhuma notifica√ß√£o</div>';
                return;
            }

            content.innerHTML = userNotifications.map(notification => {
                const timeAgo = getTimeAgo(notification.timestamp);
                
                return `
                    <div class="notification-item ${!notification.read ? 'unread' : ''}" onclick="markNotificationAsRead('${notification.id}')">
                        <div style="font-weight: ${!notification.read ? 'bold' : 'normal'}; margin-bottom: 5px;">
                            ${notification.message}
                        </div>
                        <div style="font-size: 11px; color: #666;">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }

        function markNotificationAsRead(notificationId) {
            const userNotifications = gameData.userNotifications?.[currentUser.username] || [];
            const notification = userNotifications.find(n => n.id === notificationId);
            
            if (notification) {
                notification.read = true;
                saveGameData();
                updateNotificationBadge();
                updateNotificationPanel();
            }
        }

        // Fun√ß√µes auxiliares
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function getEndOfMonth() {
            const now = new Date();
            return new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString().split('T')[0];
        }

        function updateCurrentDateTime() {
            setInterval(() => {
                const now = new Date();
                document.getElementById('syncText').textContent = `Atualizado ${now.toLocaleTimeString()}`;
            }, 60000);
        }

        function updateSyncStatus(status) {
            const syncIcon = document.getElementById('syncIcon');
            const syncText = document.getElementById('syncText');
            
            switch(status) {
                case 'success':
                    syncIcon.textContent = 'üü¢';
                    syncText.textContent = 'Sincronizado';
                    break;
                case 'error':
                    syncIcon.textContent = 'üî¥';
                    syncText.textContent = 'Erro de sincroniza√ß√£o';
                    break;
                case 'syncing':
                    syncIcon.textContent = 'üü°';
                    syncText.textContent = 'Sincronizando...';
                    break;
            }
        }

        function startAutoSync() {
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
            }
            
            const interval = parseInt(document.getElementById('autoSyncInterval')?.value) || 600000;
            if (interval > 0) {
                autoSyncInterval = setInterval(() => {
                    updateSyncStatus('syncing');
                    saveGameData();
                    setTimeout(() => updateSyncStatus('success'), 1000);
                }, interval);
            }
        }

        // Fun√ß√µes de debug e teste
        function showDebugButtons() {
            // Mostrar bot√µes de debug apenas em desenvolvimento
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                document.getElementById('debugButtons').style.display = 'block';
            }
        }

        function diagnosticoCompleto() {
            console.log('üîç DIAGN√ìSTICO COMPLETO DO SISTEMA');
            console.log('Estado atual dos dados:', gameData);
            console.log('Usu√°rio atual:', currentUser);
            console.log('Unidade atual:', currentUnit);
            console.log('Dados salvos no localStorage:', localStorage.getItem('gameCreatorsData'));
            
            showNotification('Diagn√≥stico executado - veja o console', 'info');
        }

        function criarUsuarioTeste() {
            const testUser = {
                username: 'teste@gamecreatorsadm.com',
                password: 'teste123',
                name: 'Usuario Teste',
                role: 'vendedor',
                unit: 'Shopping Conjunto Nacional',
                xp: 500,
                level: 1,
                achievements: [],
                id: generateId(),
                createdAt: new Date().toISOString(),
                stats: {
                    matriculas: 0,
                    visitas: 0,
                    conversao: 0,
                    comissao: 0
                }
            };

            gameData.users[testUser.username] = testUser;
            saveGameData();
            showNotification('Usu√°rio de teste criado: teste@gamecreatorsadm.com / teste123', 'success');
        }

        function repararSistema() {
            // Verificar e reparar estruturas de dados
            if (!gameData.users) gameData.users = {};
            if (!gameData.matriculas) gameData.matriculas = [];
            if (!gameData.visitas) gameData.visitas = [];
            if (!gameData.events) gameData.events = [];
            if (!gameData.missions) gameData.missions = [];
            if (!gameData.activities) gameData.activities = [];
            if (!gameData.chatMessages) gameData.chatMessages = { geral: [], vendas: [], suporte: [] };
            if (!gameData.metas) gameData.metas = {};

            // Reparar usu√°rios sem estat√≠sticas
            Object.values(gameData.users).forEach(user => {
                if (!user.stats) {
                    user.stats = {
                        matriculas: 0,
                        visitas: 0,
                        conversao: 0,
                        comissao: 0
                    };
                }
                if (!user.xp) user.xp = 0;
                if (!user.level) user.level = 1;
                if (!user.achievements) user.achievements = [];
            });

            saveGameData();
            showNotification('Sistema reparado com sucesso!', 'success');
        }

        function loginAutomatico(username) {
            document.getElementById('loginUsername').value = username;
            document.getElementById('loginPassword').value = username === 'admin@gamecreatorsadm.com' ? 'admin123' : 'vendedor123';
            login();
        }

        function resetTotal() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso apagar√° TODOS os dados do sistema. Tem certeza?')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Inicializa√ß√£o ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
        });

        // Event listeners adicionais
        function setupEventListeners() {
            // Enter para login
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });

            // Escape para fechar modais
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.getElementById('notificationPanel').style.display = 'none';
                }
            });
        }

        // Fun√ß√µes para Scripts e Templates Google Sheets
        function showScriptTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.script-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remover classe active de todos os bot√µes
            document.querySelectorAll('#setupTab, #scriptTab, #templateTab, #webhookTab').forEach(btn => {
                btn.className = btn.className.replace('btn-primary', 'btn-info');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName + 'Content').style.display = 'block';
            
            // Ativar bot√£o correspondente
            document.getElementById(tabName + 'Tab').className = document.getElementById(tabName + 'Tab').className.replace('btn-info', 'btn-primary');
        }

        function copyScriptCode() {
            const code = document.getElementById('googleAppsScript').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showNotification('Script copiado para a √°rea de transfer√™ncia!', 'success');
            }).catch(() => {
                showNotification('Erro ao copiar. Selecione e copie manualmente.', 'warning');
            });
        }

        function copyTemplateHeaders() {
            const headers = [
                'Data', 'Nome', 'Email', 'Telefone', 'Curso', 'Valor Total', 'Valor Entrada',
                'Tipo Venda', 'Parcelas', 'Vendedor', 'Gerente', 'Assistente', 'Unidade',
                'Comiss√£o Vendedor', 'Comiss√£o Gerente', 'Comiss√£o Assistente'
            ];
            
            navigator.clipboard.writeText(headers.join('\t')).then(() => {
                showNotification('Cabe√ßalhos copiados! Cole na primeira linha da sua planilha.', 'success');
            }).catch(() => {
                showNotification('Erro ao copiar cabe√ßalhos', 'error');
            });
        }

        function copyWebhookCode() {
            const code = document.getElementById('webhookCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showNotification('C√≥digo PHP copiado para a √°rea de transfer√™ncia!', 'success');
            }).catch(() => {
                showNotification('Erro ao copiar. Selecione e copie manualmente.', 'warning');
            });
        }

        function createGoogleSheetTemplate() {
            const templateUrl = createTemplateSpreadsheet();
            if (templateUrl) {
                window.open(templateUrl, '_blank');
                showNotification('Template de planilha criado! Fa√ßa uma c√≥pia para usar.', 'success');
            } else {
                showNotification('Use o link manual: https://docs.google.com/spreadsheets/create', 'info');
            }
        }

        function createTemplateSpreadsheet() {
            // Gerar URL com template pr√©-configurado
            const headers = [
                'Data', 'Nome', 'Email', 'Telefone', 'Curso', 'Valor%20Total', 'Valor%20Entrada',
                'Tipo%20Venda', 'Parcelas', 'Vendedor', 'Gerente', 'Assistente', 'Unidade',
                'Comiss√£o%20Vendedor', 'Comiss√£o%20Gerente', 'Comiss√£o%20Assistente'
            ];
            
            // Google Sheets n√£o permite cria√ß√£o direta via URL, mas podemos dar instru√ß√µes
            return 'https://docs.google.com/spreadsheets/create';
        }

        // Melhorar a fun√ß√£o de teste de conex√£o do Google Sheets
        function testGoogleConnection() {
            const apiKey = document.getElementById('googleApiKey').value;
            const sheetId = document.getElementById('googleSheetId').value;
            const tabName = document.getElementById('googleSheetTab').value || 'Sheet1';

            if (!apiKey || !sheetId) {
                showNotification('Preencha a API Key e ID da planilha primeiro', 'warning');
                return;
            }

            showLoadingOverlay('Testando conex√£o com Google Sheets...');
            updateGoogleStatus('üü° Testando conex√£o...', 'warning');

            // Fazer chamada real para a API do Google Sheets
            testRealGoogleSheetsConnection(apiKey, sheetId, tabName)
                .then(success => {
                    hideLoadingOverlay();
                    
                    if (success) {
                        googleSheetsConfig.connected = true;
                        googleSheetsConfig.apiKey = apiKey;
                        googleSheetsConfig.sheetId = sheetId;
                        googleSheetsConfig.tabName = tabName;
                        
                        updateGoogleStatus('üü¢ Conectado com sucesso!', 'success');
                        showNotification('Conex√£o com Google Sheets estabelecida!', 'success');
                        document.getElementById('googleColumnMapping').style.display = 'block';
                        
                        addGoogleSyncLog('‚úÖ Conex√£o testada com sucesso');
                        saveGoogleSheetsConfig();
                    } else {
                        updateGoogleStatus('üî¥ Erro na conex√£o', 'error');
                        showNotification('Erro ao conectar. Verifique a API Key e permiss√µes', 'error');
                        addGoogleSyncLog('‚ùå Falha no teste de conex√£o');
                    }
                })
                .catch(error => {
                    hideLoadingOverlay();
                    updateGoogleStatus('üî¥ Erro na conex√£o', 'error');
                    showNotification('Erro: ' + error.message, 'error');
                    addGoogleSyncLog('‚ùå Erro: ' + error.message);
                });
        }

        async function testRealGoogleSheetsConnection(apiKey, sheetId, tabName) {
            try {
                // Testar leitura da planilha
                const testRange = `${tabName}!A1:A1`;
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${testRange}?key=${apiKey}`;
                
                const response = await fetch(url);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Teste de conex√£o bem-sucedido:', data);
                    return true;
                } else {
                    const error = await response.json();
                    console.error('Erro na API:', error);
                    throw new Error(error.error?.message || 'Erro desconhecido');
                }
            } catch (error) {
                console.error('Erro ao testar conex√£o:', error);
                throw error;
            }
        }

        // Implementar exporta√ß√£o real para Google Sheets
        async function exportToGoogleSheetsReal() {
            if (!googleSheetsConfig.connected) {
                showNotification('Configure e teste a conex√£o primeiro', 'warning');
                return;
            }

            const dataType = document.getElementById('googleSyncDataType').value;
            showLoadingOverlay('Exportando dados para Google Sheets...');
            
            try {
                // Preparar dados para exporta√ß√£o
                let exportData = [];
                let headers = [];
                
                switch(dataType) {
                    case 'matriculas':
                        headers = [
                            'Data', 'Nome', 'Email', 'Telefone', 'Curso', 'Valor Total', 'Valor Entrada',
                            'Tipo Venda', 'Parcelas', 'Vendedor', 'Gerente', 'Assistente', 'Unidade',
                            'Comiss√£o Vendedor', 'Comiss√£o Gerente', 'Comiss√£o Assistente'
                        ];
                        exportData = gameData.matriculas.map(m => [
                            m.data, m.nome, m.telefone || '', m.telefone, m.curso,
                            m.valorTotal, m.valorEntrada, m.tipo, m.parcelas || 1,
                            m.vendedor, m.gerente, m.assistente, m.unidade,
                            m.comissaoVendedor || 0, m.comissaoGerente || 0, m.comissaoAssistente || 0
                        ]);
                        break;
                        
                    case 'visitas':
                        headers = ['Data', 'Nome', 'Telefone', 'Curso', 'Atendente', 'Status', 'Unidade', 'Observa√ß√µes'];
                        exportData = gameData.visitas.map(v => [
                            v.data, v.nome, v.telefone, v.curso, v.atendente,
                            v.status, v.unidade, v.observacoes || ''
                        ]);
                        break;
                }
                
                // Combinar cabe√ßalhos com dados
                const allData = [headers, ...exportData];
                
                // Enviar para Google Sheets
                const success = await writeToGoogleSheets(allData);
                
                hideLoadingOverlay();
                
                if (success) {
                    googleSheetsConfig.lastSync = new Date().toISOString();
                    updateGoogleLastSync();
                    showNotification(`${exportData.length} registros exportados com sucesso!`, 'success');
                    addGoogleSyncLog(`üì§ Exportados ${exportData.length} registros (${dataType})`);
                    saveGoogleSheetsConfig();
                } else {
                    showNotification('Erro durante a exporta√ß√£o. Tente novamente.', 'error');
                    addGoogleSyncLog('‚ùå Falha na exporta√ß√£o');
                }
                
            } catch (error) {
                hideLoadingOverlay();
                showNotification('Erro: ' + error.message, 'error');
                addGoogleSyncLog('‚ùå Erro: ' + error.message);
            }
        }

        async function writeToGoogleSheets(data) {
            const { apiKey, sheetId, tabName } = googleSheetsConfig;
            
            try {
                // Limpar planilha primeiro (opcional)
                const clearUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${tabName}:clear?key=${apiKey}`;
                await fetch(clearUrl, { method: 'POST' });
                
                // Escrever novos dados
                const range = `${tabName}!A1`;
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?valueInputOption=RAW&key=${apiKey}`;
                
                const requestBody = {
                    values: data
                };
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (response.ok) {
                    console.log('Dados enviados com sucesso para Google Sheets');
                    return true;
                } else {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Erro ao escrever na planilha');
                }
                
            } catch (error) {
                console.error('Erro ao escrever na planilha:', error);
                throw error;
            }
        }

        // Implementar importa√ß√£o real do Google Sheets
        async function importFromGoogleSheetsReal() {
            if (!googleSheetsConfig.connected) {
                showNotification('Configure e teste a conex√£o primeiro', 'warning');
                return;
            }

            showLoadingOverlay('Importando dados do Google Sheets...');
            
            try {
                const importedData = await readFromGoogleSheets();
                
                if (importedData && importedData.length > 1) {
                    const headers = importedData[0];
                    const rows = importedData.slice(1);
                    
                    // Processar dados importados
                    const processedCount = processImportedData(headers, rows);
                    
                    hideLoadingOverlay();
                    
                    googleSheetsConfig.lastSync = new Date().toISOString();
                    updateGoogleLastSync();
                    showNotification(`${processedCount} registros importados com sucesso!`, 'success');
                    addGoogleSyncLog(`üì• Importados ${processedCount} registros`);
                    
                    updateDashboard();
                    updateMatriculasList();
                    updateVisitsList();
                    saveGoogleSheetsConfig();
                    saveGameData();
                } else {
                    hideLoadingOverlay();
                    showNotification('Nenhum dado encontrado na planilha', 'warning');
                }
                
            } catch (error) {
                hideLoadingOverlay();
                showNotification('Erro: ' + error.message, 'error');
                addGoogleSyncLog('‚ùå Erro na importa√ß√£o: ' + error.message);
            }
        }

        async function readFromGoogleSheets() {
            const { apiKey, sheetId, tabName } = googleSheetsConfig;
            
            try {
                const range = `${tabName}!A:P`; // Ler colunas A at√© P
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
                
                const response = await fetch(url);
                
                if (response.ok) {
                    const data = await response.json();
                    return data.values || [];
                } else {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Erro ao ler da planilha');
                }
                
            } catch (error) {
                console.error('Erro ao ler da planilha:', error);
                throw error;
            }
        }

        function processImportedData(headers, rows) {
            let processedCount = 0;
            
            rows.forEach(row => {
                if (row.length >= 4) { // Pelo menos dados b√°sicos
                    // Assumindo estrutura de matr√≠cula
                    const matricula = {
                        id: generateId(),
                        data: row[0] || new Date().toISOString().split('T')[0],
                        nome: row[1] || '',
                        telefone: row[3] || '',
                        curso: row[4] || '',
                        valorTotal: parseFloat(row[5]) || 0,
                        valorEntrada: parseFloat(row[6]) || 0,
                        tipo: row[7] || 'Convencional',
                        parcelas: parseInt(row[8]) || 1,
                        vendedor: row[9] || currentUser.name,
                        gerente: row[10] || currentUser.name,
                        assistente: row[11] || currentUser.name,
                        unidade: row[12] || currentUnit,
                        origem: 'google_sheets',
                        createdAt: new Date().toISOString(),
                        createdBy: 'Google Sheets Import'
                    };
                    
                    // Verificar se j√° existe (evitar duplicatas)
                    const exists = gameData.matriculas.some(m => 
                        m.nome === matricula.nome && 
                        m.telefone === matricula.telefone &&
                        m.data === matricula.data
                    );
                    
                    if (!exists) {
                        // Calcular comiss√µes
                        const comissoes = calculateCommissions(matricula);
                        matricula.comissaoVendedor = comissoes.vendedor;
                        matricula.comissaoGerente = comissoes.gerente;
                        matricula.comissaoAssistente = comissoes.assistente;
                        
                        gameData.matriculas.push(matricula);
                        processedCount++;
                    }
                }
            });
            
            return processedCount;
        }

        // Atualizar as chamadas das fun√ß√µes para usar as vers√µes reais
        function exportToGoogleSheets() {
            exportToGoogleSheetsReal();
        }

        function importFromGoogleSheets() {
            importFromGoogleSheetsReal();
        }
        let googleSheetsConfig = {
            url: '',
            sheetId: '',
            apiKey: '',
            tabName: 'Sheet1',
            autoSync: false,
            syncInterval: 0,
            dataType: 'matriculas',
            syncMode: 'append',
            columnMapping: {
                data: 'A',
                nome: 'B',
                curso: 'C',
                valor: 'D'
            },
            lastSync: null,
            connected: false
        };

        function extractSheetIdFromUrl() {
            const url = document.getElementById('googleSheetUrl').value;
            const sheetIdInput = document.getElementById('googleSheetId');
            
            if (url) {
                // Extrair ID da URL do Google Sheets
                const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                if (match) {
                    const sheetId = match[1];
                    sheetIdInput.value = sheetId;
                    googleSheetsConfig.sheetId = sheetId;
                    googleSheetsConfig.url = url;
                    showNotification('ID da planilha extra√≠do com sucesso!', 'success');
                } else {
                    showNotification('URL inv√°lida. Use o formato completo do Google Sheets', 'error');
                    sheetIdInput.value = '';
                }
            }
        }

        function testGoogleConnection() {
            const apiKey = document.getElementById('googleApiKey').value;
            const sheetId = document.getElementById('googleSheetId').value;
            const tabName = document.getElementById('googleSheetTab').value || 'Sheet1';

            if (!apiKey || !sheetId) {
                showNotification('Preencha a API Key e ID da planilha primeiro', 'warning');
                return;
            }

            showLoadingOverlay('Testando conex√£o com Google Sheets...');
            updateGoogleStatus('üü° Testando conex√£o...', 'warning');

            // Simular teste de conex√£o (em produ√ß√£o, faria uma chamada real √† API)
            setTimeout(() => {
                const success = Math.random() > 0.3; // 70% chance de sucesso para demo
                
                hideLoadingOverlay();
                
                if (success) {
                    googleSheetsConfig.connected = true;
                    googleSheetsConfig.apiKey = apiKey;
                    googleSheetsConfig.sheetId = sheetId;
                    googleSheetsConfig.tabName = tabName;
                    
                    updateGoogleStatus('üü¢ Conectado com sucesso!', 'success');
                    showNotification('Conex√£o com Google Sheets estabelecida!', 'success');
                    document.getElementById('googleColumnMapping').style.display = 'block';
                    
                    addGoogleSyncLog('‚úÖ Conex√£o testada com sucesso');
                    saveGoogleSheetsConfig();
                } else {
                    updateGoogleStatus('üî¥ Erro na conex√£o', 'error');
                    showNotification('Erro ao conectar. Verifique a API Key e permiss√µes', 'error');
                    addGoogleSyncLog('‚ùå Falha no teste de conex√£o');
                }
            }, 2000);
        }

        function exportToGoogleSheets() {
            if (!googleSheetsConfig.connected) {
                showNotification('Configure e teste a conex√£o primeiro', 'warning');
                return;
            }

            const dataType = document.getElementById('googleSyncDataType').value;
            showLoadingOverlay('Exportando dados para Google Sheets...');
            
            // Preparar dados para exporta√ß√£o
            let exportData = [];
            
            switch(dataType) {
                case 'matriculas':
                    exportData = prepareMatriculasForExport();
                    break;
                case 'visitas':
                    exportData = prepareVisitasForExport();
                    break;
                case 'both':
                    exportData = [...prepareMatriculasForExport(), ...prepareVisitasForExport()];
                    break;
                case 'complete':
                    exportData = prepareCompleteDataForExport();
                    break;
            }

            // Simular exporta√ß√£o
            setTimeout(() => {
                hideLoadingOverlay();
                
                const success = Math.random() > 0.2; // 80% chance de sucesso
                
                if (success) {
                    googleSheetsConfig.lastSync = new Date().toISOString();
                    updateGoogleLastSync();
                    showNotification(`${exportData.length} registros exportados com sucesso!`, 'success');
                    addGoogleSyncLog(`üì§ Exportados ${exportData.length} registros (${dataType})`);
                    saveGoogleSheetsConfig();
                } else {
                    showNotification('Erro durante a exporta√ß√£o. Tente novamente.', 'error');
                    addGoogleSyncLog('‚ùå Falha na exporta√ß√£o');
                }
            }, 3000);
        }

        function importFromGoogleSheets() {
            if (!googleSheetsConfig.connected) {
                showNotification('Configure e teste a conex√£o primeiro', 'warning');
                return;
            }

            showLoadingOverlay('Importando dados do Google Sheets...');
            
            // Simular importa√ß√£o
            setTimeout(() => {
                hideLoadingOverlay();
                
                const success = Math.random() > 0.2; // 80% chance de sucesso
                
                if (success) {
                    const importedCount = Math.floor(Math.random() * 20) + 5; // 5-25 registros
                    
                    // Simular dados importados (em produ√ß√£o, processaria dados reais da planilha)
                    generateSampleImportedData(importedCount);
                    
                    googleSheetsConfig.lastSync = new Date().toISOString();
                    updateGoogleLastSync();
                    showNotification(`${importedCount} registros importados com sucesso!`, 'success');
                    addGoogleSyncLog(`üì• Importados ${importedCount} registros`);
                    
                    updateDashboard();
                    updateMatriculasList();
                    updateVisitsList();
                    saveGoogleSheetsConfig();
                    saveGameData();
                } else {
                    showNotification('Erro durante a importa√ß√£o. Verifique a planilha.', 'error');
                    addGoogleSyncLog('‚ùå Falha na importa√ß√£o');
                }
            }, 3000);
        }

        function syncWithGoogleSheets() {
            if (!googleSheetsConfig.connected) {
                showNotification('Configure e teste a conex√£o primeiro', 'warning');
                return;
            }

            const syncMode = document.getElementById('googleSyncMode').value;
            showLoadingOverlay(`Sincronizando dados (${syncMode})...`);
            
            // Simular sincroniza√ß√£o bidirecional
            setTimeout(() => {
                hideLoadingOverlay();
                
                const success = Math.random() > 0.15; // 85% chance de sucesso
                
                if (success) {
                    const exportedCount = Math.floor(Math.random() * 10) + 1;
                    const importedCount = Math.floor(Math.random() * 5) + 1;
                    
                    googleSheetsConfig.lastSync = new Date().toISOString();
                    updateGoogleLastSync();
                    showNotification(`Sincroniza√ß√£o conclu√≠da! ${exportedCount} enviados, ${importedCount} recebidos`, 'success');
                    addGoogleSyncLog(`üîÑ Sincroniza√ß√£o: ${exportedCount}‚Üë ${importedCount}‚Üì`);
                    
                    updateDashboard();
                    saveGoogleSheetsConfig();
                } else {
                    showNotification('Erro na sincroniza√ß√£o. Tente novamente.', 'error');
                    addGoogleSyncLog('‚ùå Falha na sincroniza√ß√£o');
                }
            }, 4000);
        }

        function openGoogleSheetHelper() {
            const helperModal = document.createElement('div');
            helperModal.className = 'modal';
            helperModal.style.display = 'flex';
            helperModal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h3>‚ùì Como Configurar Google Sheets - Tutorial Completo</h3>
                        <button class="close-modal" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div style="line-height: 1.6;">
                        <div style="background: #e6fffa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="color: #38a169; margin-bottom: 15px;">üéØ Configura√ß√£o R√°pida (5 minutos)</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <div>
                                    <h5>1. üîë Google Cloud Console</h5>
                                    <ol style="font-size: 13px; margin: 10px 0; padding-left: 15px;">
                                        <li>Acesse <a href="https://console.cloud.google.com" target="_blank" style="color: #38a169;">console.cloud.google.com</a></li>
                                        <li>Crie projeto "Game Creators"</li>
                                        <li>Ative "Google Sheets API"</li>
                                        <li>Crie "Chave de API"</li>
                                        <li>Copie a chave gerada</li>
                                    </ol>
                                </div>
                                <div>
                                    <h5>2. üìä Google Sheets</h5>
                                    <ol style="font-size: 13px; margin: 10px 0; padding-left: 15px;">
                                        <li>Crie nova planilha</li>
                                        <li>Use o template fornecido</li>
                                        <li>Compartilhe como "P√∫blico"</li>
                                        <li>Copie o link da planilha</li>
                                        <li>Cole aqui no sistema</li>
                                    </ol>
                                </div>
                            </div>
                        </div>

                        <h4>üìã Passo a Passo Detalhado:</h4>
                        
                        <div style="border-left: 4px solid #38a169; padding: 15px; margin: 15px 0; background: #f0fff4;">
                            <h5>üîß Etapa 1: Google Cloud Console</h5>
                            <ol style="margin: 15px 0; padding-left: 20px;">
                                <li><strong>Acesse:</strong> <a href="https://console.cloud.google.com" target="_blank">https://console.cloud.google.com</a></li>
                                <li><strong>Projeto:</strong> Clique em "Selecionar projeto" ‚Üí "Novo projeto"</li>
                                <li><strong>Nome:</strong> "Game Creators Sync" ou similar</li>
                                <li><strong>API:</strong> Menu lateral ‚Üí "APIs e servi√ßos" ‚Üí "Biblioteca"</li>
                                <li><strong>Ativar:</strong> Procure "Google Sheets API" ‚Üí "Ativar"</li>
                                <li><strong>Credenciais:</strong> "APIs e servi√ßos" ‚Üí "Credenciais" ‚Üí "Criar credenciais" ‚Üí "Chave de API"</li>
                                <li><strong>Configurar:</strong> Restrinja a chave para "Google Sheets API"</li>
                            </ol>
                        </div>

                        <div style="border-left: 4px solid #3182ce; padding: 15px; margin: 15px 0; background: #f0f8ff;">
                            <h5>üìä Etapa 2: Criar Planilha</h5>
                            <ol style="margin: 15px 0; padding-left: 20px;">
                                <li><strong>Nova Planilha:</strong> <a href="https://sheets.google.com" target="_blank">sheets.google.com</a> ‚Üí "Em branco"</li>
                                <li><strong>Nome:</strong> "Game Creators - Vendas"</li>
                                <li><strong>Cabe√ßalhos:</strong> Use a aba "üìä Template Planilha" para copiar</li>
                                <li><strong>Formata√ß√£o:</strong> Configure colunas como Data, Moeda, etc.</li>
                                <li><strong>Abas:</strong> Crie "Matr√≠culas" e "Visitas" se necess√°rio</li>
                            </ol>
                        </div>

                        <div style="border-left: 4px solid #ed8936; padding: 15px; margin: 15px 0; background: #fffaf0;">
                            <h5>üîó Etapa 3: Compartilhamento</h5>
                            <ol style="margin: 15px 0; padding-left: 20px;">
                                <li><strong>Compartilhar:</strong> Bot√£o "Compartilhar" (canto superior direito)</li>
                                <li><strong>Permiss√µes:</strong> "Alterar para qualquer pessoa com o link"</li>
                                <li><strong>Acesso:</strong> Selecione "Editor" (para permitir escrita)</li>
                                <li><strong>Link:</strong> Clique "Copiar link"</li>
                                <li><strong>Cole:</strong> No campo "URL da Planilha" acima</li>
                            </ol>
                        </div>

                        <div style="border-left: 4px solid #667eea; padding: 15px; margin: 15px 0; background: #f8faff;">
                            <h5>‚öôÔ∏è Etapa 4: Configura√ß√£o Final</h5>
                            <ol style="margin: 15px 0; padding-left: 20px;">
                                <li><strong>URL:</strong> Cole o link da planilha no campo acima</li>
                                <li><strong>API Key:</strong> Cole a chave obtida no Google Cloud</li>
                                <li><strong>Aba:</strong> Nome da aba (geralmente "Sheet1" ou "Matr√≠culas")</li>
                                <li><strong>Teste:</strong> Clique "Testar Conex√£o"</li>
                                <li><strong>Mapeamento:</strong> Configure as colunas ap√≥s o teste</li>
                            </ol>
                        </div>

                        <h4>‚ö†Ô∏è Troubleshooting Comum:</h4>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li><strong>Erro 403:</strong> Planilha n√£o √© p√∫blica ou API Key incorreta</li>
                                <li><strong>Erro 404:</strong> ID da planilha inv√°lido ou planilha deletada</li>
                                <li><strong>Sem dados:</strong> Nome da aba incorreto ou planilha vazia</li>
                                <li><strong>Permiss√£o negada:</strong> API n√£o ativada no Google Cloud</li>
                            </ul>
                        </div>

                        <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px;">
                            <h4>‚úÖ Dicas de Sucesso:</h4>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>Sempre teste em uma planilha vazia primeiro</li>
                                <li>Fa√ßa backup antes da primeira sincroniza√ß√£o</li>
                                <li>Configure sincroniza√ß√£o autom√°tica ap√≥s testes</li>
                                <li>Monitore os logs na se√ß√£o de status</li>
                                <li>Use o Google Apps Script para automa√ß√µes avan√ßadas</li>
                            </ul>
                        </div>

                        <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin-top: 20px;">
                            <strong>üîó Links √öteis:</strong><br>
                            ‚Ä¢ <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a><br>
                            ‚Ä¢ <a href="https://sheets.google.com" target="_blank">Google Sheets</a><br>
                            ‚Ä¢ <a href="https://developers.google.com/sheets/api/quickstart/js" target="_blank">Documenta√ß√£o API</a><br>
                            ‚Ä¢ <a href="https://script.google.com" target="_blank">Google Apps Script</a>
                        </div>

                        <div style="text-align: center; margin-top: 25px;">
                            <button class="btn btn-primary" onclick="showScriptTab('template'); this.closest('.modal').remove();">
                                üìä Ver Template da Planilha
                            </button>
                            <button class="btn btn-success" onclick="testGoogleConnection(); this.closest('.modal').remove();">
                                üîç Testar Minha Configura√ß√£o
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(helperModal);
        }

        function saveColumnMapping() {
            googleSheetsConfig.columnMapping = {
                data: document.getElementById('columnData').value,
                nome: document.getElementById('columnNome').value,
                curso: document.getElementById('columnCurso').value,
                valor: document.getElementById('columnValor').value
            };
            
            saveGoogleSheetsConfig();
            showNotification('Mapeamento de colunas salvo!', 'success');
            addGoogleSyncLog('üíæ Mapeamento de colunas atualizado');
        }

        function prepareMatriculasForExport() {
            return gameData.matriculas.map(matricula => ({
                data: matricula.data,
                nome: matricula.nome,
                telefone: matricula.telefone,
                curso: matricula.curso,
                valor: matricula.valorTotal,
                vendedor: matricula.vendedor,
                unidade: matricula.unidade,
                tipo: matricula.tipo
            }));
        }

        function prepareVisitasForExport() {
            return gameData.visitas.map(visita => ({
                data: visita.data,
                nome: visita.nome,
                telefone: visita.telefone,
                curso: visita.curso,
                atendente: visita.atendente,
                status: visita.status,
                unidade: visita.unidade
            }));
        }

        function prepareCompleteDataForExport() {
            return {
                matriculas: prepareMatriculasForExport(),
                visitas: prepareVisitasForExport(),
                usuarios: Object.values(gameData.users).map(user => ({
                    nome: user.name,
                    role: user.role,
                    unidade: user.unit,
                    xp: user.xp,
                    level: user.level
                }))
            };
        }

        function generateSampleImportedData(count) {
            const cursos = ['Creators 2D', 'Creators 3D', 'Design Gr√°fico e Edi√ß√£o'];
            const nomes = ['Jo√£o Silva', 'Maria Santos', 'Pedro Costa', 'Ana Oliveira', 'Carlos Lima'];
            
            for (let i = 0; i < count; i++) {
                const matricula = {
                    id: generateId(),
                    data: new Date().toISOString().split('T')[0],
                    nome: nomes[Math.floor(Math.random() * nomes.length)] + ' (Importado)',
                    telefone: `(11) 9${Math.floor(Math.random() * 10000)}-${Math.floor(Math.random() * 10000)}`,
                    curso: cursos[Math.floor(Math.random() * cursos.length)],
                    valorTotal: Math.floor(Math.random() * 3000) + 1000,
                    valorEntrada: Math.floor(Math.random() * 500) + 200,
                    tipo: 'Convencional',
                    vendedor: currentUser.name,
                    gerente: currentUser.name,
                    assistente: currentUser.name,
                    unidade: currentUnit,
                    origem: 'google_sheets',
                    createdAt: new Date().toISOString(),
                    createdBy: 'Google Sheets Import'
                };
                
                gameData.matriculas.push(matricula);
            }
        }

        function updateGoogleStatus(message, type) {
            const statusDiv = document.getElementById('googleConnectionStatus');
            statusDiv.innerHTML = `<span style="color: ${type === 'success' ? '#38a169' : type === 'error' ? '#e53e3e' : '#ed8936'};">${message}</span>`;
        }

        function updateGoogleLastSync() {
            const lastSyncDiv = document.getElementById('googleLastSync');
            if (googleSheetsConfig.lastSync) {
                const date = new Date(googleSheetsConfig.lastSync);
                lastSyncDiv.textContent = `√öltima sincroniza√ß√£o: ${date.toLocaleString()}`;
            }
        }

        function addGoogleSyncLog(message) {
            const logDiv = document.getElementById('googleSyncLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            
            logDiv.textContent = logEntry + logDiv.textContent;
            logDiv.style.display = 'block';
            
            // Manter apenas os √∫ltimos 20 logs
            const lines = logDiv.textContent.split('\n');
            if (lines.length > 20) {
                logDiv.textContent = lines.slice(0, 20).join('\n');
            }
        }

        function saveGoogleSheetsConfig() {
            localStorage.setItem('googleSheetsConfig', JSON.stringify(googleSheetsConfig));
        }

        function loadGoogleSheetsConfig() {
            const saved = localStorage.getItem('googleSheetsConfig');
            if (saved) {
                googleSheetsConfig = { ...googleSheetsConfig, ...JSON.parse(saved) };
                
                // Restaurar valores nos campos
                document.getElementById('googleSheetUrl').value = googleSheetsConfig.url || '';
                document.getElementById('googleSheetId').value = googleSheetsConfig.sheetId || '';
                document.getElementById('googleApiKey').value = googleSheetsConfig.apiKey || '';
                document.getElementById('googleSheetTab').value = googleSheetsConfig.tabName || 'Sheet1';
                
                if (googleSheetsConfig.connected) {
                    updateGoogleStatus('üü¢ Conectado', 'success');
                    document.getElementById('googleColumnMapping').style.display = 'block';
                }
                
                updateGoogleLastSync();
            }
        }

        function showLoadingOverlay(message) {
            const overlay = document.createElement('div');
            overlay.id = 'loadingOverlay';
            overlay.className = 'loading-overlay';
            overlay.innerHTML = `
                <div class="loading-content">
                    <div class="spinner"></div>
                    <p>${message}</p>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Auto-detectar ID quando URL for alterada
        function convertVisit(visitId) {
            const visit = gameData.visitas.find(v => v.id === visitId);
            if (!visit) return;
            
            // Pr√©-preencher dados da matr√≠cula com dados da visita
            document.getElementById('newNome').value = visit.nome;
            document.getElementById('newTelefone').value = visit.telefone;
            document.getElementById('newCurso').value = visit.curso;
            
            // Marcar visita como convertida
            visit.status = 'converted';
            visit.convertedAt = new Date().toISOString();
            
            saveGameData();
            showNotification('Visita marcada para convers√£o! Complete os dados da matr√≠cula.', 'info');
            
            // Mudar para aba de matr√≠culas
            switchTab('matriculas');
        }

        function deleteVisit(visitId) {
            if (confirm('Tem certeza que deseja excluir esta visita?')) {
                gameData.visitas = gameData.visitas.filter(v => v.id !== visitId);
                saveGameData();
                showNotification('Visita exclu√≠da', 'info');
                updateVisitsList();
                updateDashboard();
            }
        }

        function viewVisitDetails(visitId) {
            const visit = gameData.visitas.find(v => v.id === visitId);
            if (!visit) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üëÅÔ∏è Detalhes da Visita</h3>
                        <button class="close-modal" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div style="line-height: 1.6;">
                        <p><strong>üìÖ Data:</strong> ${new Date(visit.data).toLocaleDateString()}</p>
                        <p><strong>üë§ Nome:</strong> ${visit.nome}</p>
                        <p><strong>üì± Telefone:</strong> ${visit.telefone}</p>
                        <p><strong>üéì Curso:</strong> ${visit.curso}</p>
                        <p><strong>üë®‚Äçüíº Atendente:</strong> ${visit.atendente}</p>
                        <p><strong>üìä Status:</strong> ${visit.status === 'converted' ? '‚úÖ Convertido' : '‚è≥ Pendente'}</p>
                        <p><strong>üè¢ Unidade:</strong> ${visit.unidade}</p>
                        <p><strong>üìù Observa√ß√µes:</strong> ${visit.observacoes || 'Nenhuma'}</p>
                        ${visit.convertedAt ? `<p><strong>üéØ Convertido em:</strong> ${new Date(visit.convertedAt).toLocaleString()}</p>` : ''}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function deleteMatricula(matriculaId) {
            if (confirm('Tem certeza que deseja excluir esta matr√≠cula?')) {
                gameData.matriculas = gameData.matriculas.filter(m => m.id !== matriculaId);
                saveGameData();
                showNotification('Matr√≠cula exclu√≠da', 'info');
                updateMatriculasList();
                updateDashboard();
            }
        }

        function editMatricula(matriculaId) {
            showNotification('Funcionalidade de edi√ß√£o em desenvolvimento', 'info');
        }

        function viewMatriculaDetails(matriculaId) {
            const matricula = gameData.matriculas.find(m => m.id === matriculaId);
            if (!matricula) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üëÅÔ∏è Detalhes da Matr√≠cula</h3>
                        <button class="close-modal" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div style="line-height: 1.6;">
                        <p><strong>üìÖ Data:</strong> ${new Date(matricula.data).toLocaleDateString()}</p>
                        <p><strong>üë§ Aluno:</strong> ${matricula.nome}</p>
                        <p><strong>üì± Telefone:</strong> ${matricula.telefone}</p>
                        <p><strong>üéì Curso:</strong> ${matricula.curso}</p>
                        <p><strong>üí∞ Valor Total:</strong> R$ ${matricula.valorTotal?.toFixed(2)}</p>
                        <p><strong>üí≥ Entrada:</strong> R$ ${matricula.valorEntrada?.toFixed(2)}</p>
                        <p><strong>üìä Tipo:</strong> ${matricula.tipo}</p>
                        <p><strong>üìù Parcelas:</strong> ${matricula.parcelas || 1}x</p>
                        <p><strong>üë®‚Äçüíº Vendedor:</strong> ${matricula.vendedor}</p>
                        <p><strong>üëî Gerente:</strong> ${matricula.gerente}</p>
                        <p><strong>üë©‚Äçüíª Assistente:</strong> ${matricula.assistente}</p>
                        <p><strong>üè¢ Unidade:</strong> ${matricula.unidade}</p>
                        <p><strong>üìç Origem:</strong> ${matricula.origem || 'Cliente direto'}</p>
                        <hr style="margin: 15px 0;">
                        <p><strong>üí∞ Comiss√£o Vendedor:</strong> R$ ${matricula.comissaoVendedor?.toFixed(2) || '0.00'}</p>
                        <p><strong>üí∞ Comiss√£o Gerente:</strong> R$ ${matricula.comissaoGerente?.toFixed(2) || '0.00'}</p>
                        <p><strong>üí∞ Comiss√£o Assistente:</strong> R$ ${matricula.comissaoAssistente?.toFixed(2) || '0.00'}</p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function exportVisits(format) {
            const data = gameData.visitas;
            if (data.length === 0) {
                showNotification('Nenhuma visita para exportar', 'warning');
                return;
            }
            
            if (format === 'csv') {
                const csvContent = convertToCSV(data, [
                    'data', 'nome', 'telefone', 'curso', 'atendente', 'status', 'unidade', 'observacoes'
                ]);
                downloadFile(csvContent, 'visitas.csv', 'text/csv');
            } else if (format === 'excel') {
                showNotification('Exporta√ß√£o para Excel em desenvolvimento', 'info');
            }
        }

        function exportMatriculas(format) {
            const data = gameData.matriculas;
            if (data.length === 0) {
                showNotification('Nenhuma matr√≠cula para exportar', 'warning');
                return;
            }
            
            if (format === 'csv') {
                const csvContent = convertToCSV(data, [
                    'data', 'nome', 'telefone', 'curso', 'valorTotal', 'valorEntrada', 'tipo', 'vendedor', 'gerente', 'assistente', 'unidade'
                ]);
                downloadFile(csvContent, 'matriculas.csv', 'text/csv');
            } else if (format === 'excel') {
                showNotification('Exporta√ß√£o para Excel em desenvolvimento', 'info');
            }
        }

        function convertToCSV(data, columns) {
            const header = columns.join(',');
            const rows = data.map(item => 
                columns.map(col => {
                    const value = item[col] || '';
                    return `"${value.toString().replace(/"/g, '""')}"`;
                }).join(',')
            );
            return [header, ...rows].join('\n');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`Arquivo ${filename} baixado com sucesso!`, 'success');
        }

        function redeemReward(rewardType, cost) {
            if ((currentUser.xp || 0) < cost) {
                showNotification(`Voc√™ precisa de ${cost} XP para resgatar esta recompensa`, 'warning');
                return;
            }
            
            if (confirm(`Resgatar esta recompensa por ${cost} XP?`)) {
                currentUser.xp -= cost;
                gameData.users[currentUser.username] = currentUser;
                saveGameData();
                
                const rewards = {
                    'gift50': 'Vale Presente de R$ 50',
                    'dayoff': 'Dia de Folga Extra',
                    'certificate': 'Certificado de Destaque'
                };
                
                showNotification(`üéÅ Parab√©ns! Voc√™ resgatou: ${rewards[rewardType]}`, 'success');
                addActivity('reward_redeemed', `${currentUser.name} resgatou: ${rewards[rewardType]}`);
                updateUserInfo();
                updateGamification();
            }
        }

        function createMission() {
            const missionData = {
                id: generateId(),
                title: document.getElementById('missionTitle').value,
                description: document.getElementById('missionDescription').value,
                type: document.getElementById('missionType').value,
                target: parseInt(document.getElementById('missionTarget').value),
                reward: parseInt(document.getElementById('missionReward').value),
                deadline: document.getElementById('missionDeadline').value,
                targetUser: document.getElementById('missionTarget_user').value,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString(),
                status: 'active',
                current: 0
            };
            
            if (!missionData.title || !missionData.description || !missionData.target || !missionData.reward || !missionData.deadline) {
                showNotification('Preencha todos os campos da miss√£o', 'warning');
                return;
            }
            
            if (!gameData.missions) gameData.missions = [];
            gameData.missions.push(missionData);
            saveGameData();
            
            showNotification('Miss√£o criada com sucesso!', 'success');
            addActivity('mission_created', `${currentUser.name} criou a miss√£o: ${missionData.title}`);
            
            // Limpar formul√°rio
            document.getElementById('missionTitle').value = '';
            document.getElementById('missionDescription').value = '';
            document.getElementById('missionTarget').value = '';
            document.getElementById('missionReward').value = '';
            document.getElementById('missionDeadline').value = '';
            
            updateActiveMissions();
        }

        // Fun√ß√µes de relat√≥rios
        function gerarRelatorioComissoes() {
            showNotification('Gerando relat√≥rio de comiss√µes...', 'info');
            const relatorio = generateCommissionReport();
            displayReport('Relat√≥rio de Comiss√µes', relatorio);
        }

        function gerarRelatorioConversao() {
            showNotification('Gerando relat√≥rio de convers√£o...', 'info');
            const relatorio = generateConversionReport();
            displayReport('Relat√≥rio de Convers√£o', relatorio);
        }

        function gerarRelatorioUnidade() {
            showNotification('Gerando relat√≥rio por unidade...', 'info');
            const relatorio = generateUnitReport();
            displayReport('Relat√≥rio por Unidade', relatorio);
        }

        function gerarRelatorioMetas() {
            showNotification('Gerando relat√≥rio de metas...', 'info');
            const relatorio = generateGoalsReport();
            displayReport('Relat√≥rio Metas vs Realizado', relatorio);
        }

        function gerarRelatorioTendencias() {
            showNotification('An√°lise de tend√™ncias em desenvolvimento', 'info');
        }

        function gerarRelatorioPrevisao() {
            showNotification('Previs√£o de vendas em desenvolvimento', 'info');
        }

        function generateCommissionReport() {
            const users = Object.values(gameData.users);
            let totalCommissions = 0;
            
            const userCommissions = users.map(user => {
                const stats = calculateUserStatsForUser(user, 'month');
                totalCommissions += stats.comissao;
                
                return {
                    nome: user.name,
                    role: user.role,
                    unidade: user.unit,
                    comissao: stats.comissao,
                    matriculas: stats.matriculas
                };
            }).sort((a, b) => b.comissao - a.comissao);
            
            return `
                <h3>üí∞ Relat√≥rio de Comiss√µes - ${new Date().toLocaleDateString()}</h3>
                <p><strong>Total de Comiss√µes:</strong> R$ ${totalCommissions.toFixed(2)}</p>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Cargo</th>
                            <th>Unidade</th>
                            <th>Matr√≠culas</th>
                            <th>Comiss√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${userCommissions.map(user => `
                            <tr>
                                <td>${user.nome}</td>
                                <td>${user.role}</td>
                                <td>${user.unidade}</td>
                                <td>${user.matriculas}</td>
                                <td>R$ ${user.comissao.toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function generateConversionReport() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthVisitas = gameData.visitas.filter(v => {
                const date = new Date(v.data);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });
            
            const monthMatriculas = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });
            
            const conversionRate = monthVisitas.length > 0 ? (monthMatriculas.length / monthVisitas.length) * 100 : 0;
            
            return `
                <h3>üìà Relat√≥rio de Convers√£o - ${new Date().toLocaleDateString()}</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 24px; font-weight: bold; color: #3182ce;">${monthVisitas.length}</div>
                        <div>Total de Visitas</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 24px; font-weight: bold; color: #38a169;">${monthMatriculas.length}</div>
                        <div>Total de Matr√≠culas</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 24px; font-weight: bold; color: #ed8936;">${conversionRate.toFixed(1)}%</div>
                        <div>Taxa de Convers√£o</div>
                    </div>
                </div>
                <p>Taxa de convers√£o ${conversionRate >= 25 ? 'excelente' : conversionRate >= 15 ? 'boa' : 'precisa melhorar'} para este per√≠odo.</p>
            `;
        }

        function generateUnitReport() {
            const unitStats = {};
            
            gameData.units.forEach(unit => {
                const unitUsers = Object.values(gameData.users).filter(user => user.unit === unit);
                const unitMatriculas = gameData.matriculas.filter(m => 
                    unitUsers.some(user => user.name === m.vendedor || user.name === m.gerente || user.name === m.assistente)
                );
                const unitVisitas = gameData.visitas.filter(v => 
                    unitUsers.some(user => user.name === v.atendente)
                );
                
                unitStats[unit] = {
                    usuarios: unitUsers.length,
                    matriculas: unitMatriculas.length,
                    visitas: unitVisitas.length,
                    conversao: unitVisitas.length > 0 ? (unitMatriculas.length / unitVisitas.length) * 100 : 0,
                    receita: unitMatriculas.reduce((sum, m) => sum + (m.valorTotal || 0), 0)
                };
            });
            
            return `
                <h3>üè¢ Relat√≥rio por Unidade - ${new Date().toLocaleDateString()}</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Unidade</th>
                            <th>Usu√°rios</th>
                            <th>Visitas</th>
                            <th>Matr√≠culas</th>
                            <th>Convers√£o</th>
                            <th>Receita</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(unitStats).map(([unit, stats]) => `
                            <tr>
                                <td>${unit}</td>
                                <td>${stats.usuarios}</td>
                                <td>${stats.visitas}</td>
                                <td>${stats.matriculas}</td>
                                <td>${stats.conversao.toFixed(1)}%</td>
                                <td>R$ ${stats.receita.toLocaleString()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function generateGoalsReport() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const unitProgress = {};
            
            gameData.units.forEach(unit => {
                const unitUsers = Object.values(gameData.users).filter(user => user.unit === unit);
                const metas = gameData.metas[unit] || {};
                
                const matriculasCount = gameData.matriculas.filter(m => {
                    const date = new Date(m.data);
                    return date.getMonth() === currentMonth && 
                           date.getFullYear() === currentYear &&
                           unitUsers.some(user => user.name === m.vendedor);
                }).length;
                
                unitProgress[unit] = {
                    meta: metas.unidade || 50,
                    realizado: matriculasCount,
                    porcentagem: metas.unidade ? (matriculasCount / metas.unidade) * 100 : 0
                };
            });
            
            return `
                <h3>üéØ Relat√≥rio Metas vs Realizado - ${new Date().toLocaleDateString()}</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Unidade</th>
                            <th>Meta</th>
                            <th>Realizado</th>
                            <th>% Atingido</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(unitProgress).map(([unit, progress]) => {
                            const status = progress.porcentagem >= 100 ? '‚úÖ Meta Atingida' :
                                          progress.porcentagem >= 80 ? 'üü° Pr√≥ximo da Meta' :
                                          progress.porcentagem >= 50 ? 'üü† Abaixo da Meta' : 'üî¥ Muito Abaixo';
                            
                            return `
                                <tr>
                                    <td>${unit}</td>
                                    <td>${progress.meta}</td>
                                    <td>${progress.realizado}</td>
                                    <td>${progress.porcentagem.toFixed(1)}%</td>
                                    <td>${status}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        function displayReport(title, content) {
            const resultDiv = document.getElementById('relatorioResultado');
            resultDiv.innerHTML = `
                <div class="stat-card">
                    ${content}
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Imprimir Relat√≥rio</button>
                        <button class="btn btn-info" onclick="exportReport('${title}')">üìÑ Exportar PDF</button>
                    </div>
                </div>
            `;
        }

        function setupGoogleSheetsListeners() {
            const urlInput = document.getElementById('googleSheetUrl');
            if (urlInput) {
                urlInput.addEventListener('blur', extractSheetIdFromUrl);
                urlInput.addEventListener('paste', () => {
                    setTimeout(extractSheetIdFromUrl, 100);
                });
            }
        }

        // Sistema de chat
        function updateChatTab() {
            loadChatMessages();
            populatePrivateMessageUsers();
        }

        function openChatRoom(roomName) {
            currentChatRoom = roomName;
            document.getElementById('chatRoomTitle').textContent = `üí¨ Chat ${roomName.charAt(0).toUpperCase() + roomName.slice(1)}`;
            document.getElementById('chatInputArea').style.display = 'block';
            loadChatMessages();
        }

        function loadChatMessages() {
            const messagesDiv = document.getElementById('chatMessages');
            
            if (!currentChatRoom) {
                messagesDiv.innerHTML = '<p style="text-align: center; color: #666;">Selecione uma sala de chat para come√ßar a conversar</p>';
                return;
            }
            
            const messages = gameData.chatMessages[currentChatRoom] || [];
            
            if (messages.length === 0) {
                messagesDiv.innerHTML = '<p style="text-align: center; color: #666;">Nenhuma mensagem ainda. Seja o primeiro a conversar!</p>';
                return;
            }
            
            messagesDiv.innerHTML = messages.map(message => `
                <div style="margin-bottom: 15px; padding: 10px; background: ${message.user === currentUser.name ? '#e6fffa' : '#f8f9fa'}; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <strong style="color: #38a169;">${message.user}</strong>
                        <small style="color: #666;">${new Date(message.timestamp).toLocaleTimeString()}</small>
                    </div>
                    <div>${message.message}</div>
                </div>
            `).join('');
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function sendChatMessage() {
            const messageInput = document.getElementById('chatMessage');
            const message = messageInput.value.trim();
            
            if (!message || !currentChatRoom) return;
            
            if (!gameData.chatMessages[currentChatRoom]) {
                gameData.chatMessages[currentChatRoom] = [];
            }
            
            const chatMessage = {
                id: generateId(),
                user: currentUser.name,
                message: message,
                timestamp: new Date().toISOString()
            };
            
            gameData.chatMessages[currentChatRoom].push(chatMessage);
            
            // Manter apenas as √∫ltimas 50 mensagens
            if (gameData.chatMessages[currentChatRoom].length > 50) {
                gameData.chatMessages[currentChatRoom] = gameData.chatMessages[currentChatRoom].slice(-50);
            }
            
            saveGameData();
            messageInput.value = '';
            loadChatMessages();
            
            addActivity('message_sent', `${currentUser.name} enviou mensagem no chat ${currentChatRoom}`);
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function refreshChat() {
            loadChatMessages();
            showNotification('Chat atualizado', 'info');
        }

        function toggleChatNotifications() {
            showNotification('Configura√ß√µes de notifica√ß√£o em desenvolvimento', 'info');
        }

        function populatePrivateMessageUsers() {
            const select = document.getElementById('privateMessageTo');
            const users = Object.values(gameData.users).filter(user => user.username !== currentUser.username);
            
            select.innerHTML = '<option value="">Selecione um usu√°rio...</option>' +
                users.map(user => `<option value="${user.username}">${user.name} (${user.role})</option>`).join('');
        }

        function sendPrivateMessage() {
            const to = document.getElementById('privateMessageTo').value;
            const subject = document.getElementById('privateMessageSubject').value;
            const content = document.getElementById('privateMessageContent').value;
            
            if (!to || !subject || !content) {
                showNotification('Preencha todos os campos da mensagem', 'warning');
                return;
            }
            
            const message = {
                id: generateId(),
                from: currentUser.username,
                fromName: currentUser.name,
                to: to,
                toName: gameData.users[to]?.name,
                subject: subject,
                content: content,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            if (!gameData.privateMessages) gameData.privateMessages = [];
            gameData.privateMessages.push(message);
            saveGameData();
            
            showNotification('Mensagem privada enviada!', 'success');
            addActivity('private_message_sent', `${currentUser.name} enviou mensagem privada para ${message.toName}`);
            
            // Limpar formul√°rio
            document.getElementById('privateMessageTo').value = '';
            document.getElementById('privateMessageSubject').value = '';
            document.getElementById('privateMessageContent').value = '';
            
            updatePrivateMessagesList();
        }

        function updatePrivateMessagesList() {
            const listDiv = document.getElementById('privateMessagesList');
            const userMessages = gameData.privateMessages?.filter(msg => 
                msg.from === currentUser.username || msg.to === currentUser.username
            ) || [];
            
            if (userMessages.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Nenhuma mensagem privada</p>';
                return;
            }
            
            listDiv.innerHTML = userMessages.reverse().map(message => {
                const isIncoming = message.to === currentUser.username;
                const otherUser = isIncoming ? message.fromName : message.toName;
                const direction = isIncoming ? 'üì• Recebida de' : 'üì§ Enviada para';
                
                return `
                    <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin: 10px 0; ${!message.read && isIncoming ? 'background: #f0f8ff;' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong>${message.subject}</strong>
                            <small style="color: #666;">${new Date(message.timestamp).toLocaleString()}</small>
                        </div>
                        <div style="color: #666; margin-bottom: 10px;">${direction} ${otherUser}</div>
                        <div style="border-top: 1px solid #e2e8f0; padding-top: 10px;">${message.content}</div>
                        ${!message.read && isIncoming ? '<div style="color: #38a169; font-weight: bold; margin-top: 10px;">üìß Nova mensagem</div>' : ''}
                    </div>
                `;
            }).join('');
        }

        // Finalizar outras fun√ß√µes necess√°rias
        function convertVisitToMatricula() {
            showNotification('Selecione uma visita na lista para converter em matr√≠cula', 'info');
        }

        function updateTeamTab() {
            if (currentUser.role !== 'gerente' && currentUser.role !== 'admin') return;
            
            document.getElementById('teamUnitName').textContent = currentUnit;
            updateTeamGrid();
            updateTeamPerformance();
        }

        function updateTeamGrid() {
            const teamGrid = document.getElementById('teamGrid');
            const teamMembers = Object.values(gameData.users).filter(user => 
                user.unit === currentUnit && user.username !== currentUser.username
            );
            
            teamGrid.innerHTML = teamMembers.map(member => {
                const stats = calculateUserStatsForUser(member, 'month');
                
                return `
                    <div class="team-member-card">
                        <div class="member-avatar">${member.name.charAt(0).toUpperCase()}</div>
                        <div class="member-name">${member.name}</div>
                        <div class="member-role">
                            <span class="role-badge role-${member.role}">${member.role}</span>
                        </div>
                        <div class="member-stats">
                            üìä ${stats.matriculas} matr√≠culas<br>
                            üë• ${stats.visitas} visitas<br>
                            ‚≠ê ${member.xp || 0} XP<br>
                            üìà ${(stats.conversao * 100).toFixed(1)}% convers√£o
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateTeamPerformance() {
            const performanceDiv = document.getElementById('teamPerformance');
            const teamMembers = Object.values(gameData.users).filter(user => user.unit === currentUnit);
            
            let totalMatriculas = 0;
            let totalVisitas = 0;
            let totalComissao = 0;
            
            teamMembers.forEach(member => {
                const stats = calculateUserStatsForUser(member, 'month');
                totalMatriculas += stats.matriculas;
                totalVisitas += stats.visitas;
                totalComissao += stats.comissao;
            });
            
            const teamConversion = totalVisitas > 0 ? (totalMatriculas / totalVisitas) * 100 : 0;
            const metaEquipe = gameData.metas[currentUnit]?.unidade || 50;
            const progressoMeta = (totalMatriculas / metaEquipe) * 100;
            
            performanceDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 28px; font-weight: bold; color: #38a169;">${totalMatriculas}</div>
                        <div style="font-size: 14px; color: #666;">Matr√≠culas da Equipe</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 28px; font-weight: bold; color: #3182ce;">${totalVisitas}</div>
                        <div style="font-size: 14px; color: #666;">Visitas da Equipe</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 28px; font-weight: bold; color: #ed8936;">${teamConversion.toFixed(1)}%</div>
                        <div style="font-size: 14px; color: #666;">Convers√£o da Equipe</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                        <div style="font-size: 28px; font-weight: bold; color: #667eea;">R$ ${totalComissao.toFixed(2)}</div>
                        <div style="font-size: 14px; color: #666;">Comiss√£o Total</div>
                    </div>
                </div>
                
                <div style="margin-top: 25px;">
                    <h4>üéØ Progresso da Meta Mensal</h4>
                    <div class="progress-bar" style="height: 20px; margin: 10px 0;">
                        <div class="progress-fill" style="width: ${Math.min(progressoMeta, 100)}%;"></div>
                    </div>
                    <div style="text-align: center; color: #666;">
                        ${totalMatriculas} de ${metaEquipe} matr√≠culas (${progressoMeta.toFixed(1)}%)
                    </div>
                </div>
            `;
        }

        function sendTeamMessage() {
            const message = document.getElementById('teamMessage').value.trim();
            
            if (!message) {
                showNotification('Digite uma mensagem', 'warning');
                return;
            }
            
            // Simular envio de mensagem para a equipe
            showNotification('Mensagem enviada para toda a equipe!', 'success');
            addActivity('team_message_sent', `${currentUser.name} enviou mensagem para a equipe`);
            
            document.getElementById('teamMessage').value = '';
        }

        function scheduleTeamMeeting() {
            // Simular agendamento de reuni√£o
            showNotification('Reuni√£o de equipe agendada para amanh√£ √†s 14h', 'success');
            addActivity('meeting_scheduled', `${currentUser.name} agendou reuni√£o de equipe`);
        }

        function updateRelatoriosTab() {
            // Configurar campos de relat√≥rio
            const now = new Date();
            const currentMonth = now.toISOString().slice(0, 7); // YYYY-MM
            
            document.getElementById('relatorioMes').value = currentMonth;
            
            // Populat selects
            const unidadeSelect = document.getElementById('relatorioUnidade');
            const colaboradorSelect = document.getElementById('relatorioColaborador');
            
            unidadeSelect.innerHTML = '<option value="">Todas</option>' +
                gameData.units.map(unit => `<option value="${unit}">${unit}</option>`).join('');
            
            const users = Object.values(gameData.users);
            colaboradorSelect.innerHTML = '<option value="">Todos</option>' +
                users.map(user => `<option value="${user.name}">${user.name} (${user.role})</option>`).join('');
        }

        // Carregamento da configura√ß√£o salva do tema
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                currentTheme = savedTheme;
                document.body.setAttribute('data-theme', currentTheme);
                
                const themeButton = document.querySelector('.theme-toggle');
                if (themeButton) {
                    themeButton.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è Modo Claro' : 'üåô Modo Escuro';
                }
            }
        }

        // Atualizar as fun√ß√µes de inicializa√ß√£o
        function initializeSystem() {
            loadGameData();
            initializeDefaultData();
            setupEventListeners();
            updateCurrentDateTime();
            checkAutoLogin();
            showDebugButtons();
            loadSavedTheme();
        }

        // Atualizar fun√ß√£o de carregamento das configura√ß√µes do sistema
        function saveSystemConfig() {
            const config = {
                autoSyncInterval: document.getElementById('autoSyncInterval')?.value || '600000',
                adminEmail: document.getElementById('adminEmail')?.value || '',
                companyUrl: document.getElementById('companyUrl')?.value || '',
                webhookUrl: document.getElementById('webhookUrl')?.value || ''
            };
            
            // Salvar configura√ß√µes do webhook no Google Sheets config
            if (config.webhookUrl) {
                googleSheetsConfig.webhookUrl = config.webhookUrl;
                saveGoogleSheetsConfig();
            }
            
            localStorage.setItem('systemConfig', JSON.stringify(config));
            showNotification('Configura√ß√µes salvas com sucesso!', 'success');
            addActivity('config_updated', `${currentUser.name} atualizou as configura√ß√µes do sistema`);
            
            // Reiniciar auto-sync se necess√°rio
            startAutoSync();
        }

        function loadSystemConfig() {
            const config = localStorage.getItem('systemConfig');
            if (config) {
                try {
                    systemConfig = JSON.parse(config);
                    
                    // Aplicar configura√ß√µes carregadas
                    if (document.getElementById('autoSyncInterval')) {
                        document.getElementById('autoSyncInterval').value = systemConfig.autoSyncInterval || '600000';
                    }
                    if (document.getElementById('adminEmail')) {
                        document.getElementById('adminEmail').value = systemConfig.adminEmail || '';
                    }
                    if (document.getElementById('companyUrl')) {
                        document.getElementById('companyUrl').value = systemConfig.companyUrl || '';
                    }
                    if (document.getElementById('webhookUrl')) {
                        document.getElementById('webhookUrl').value = systemConfig.webhookUrl || '';
                    }
                } catch (error) {
                    console.error('Erro ao carregar configura√ß√µes do sistema:', error);
                }
            }
        }

        // Fun√ß√£o para demonstrar integra√ß√£o completa
        function demonstrarIntegracao() {
            if (!googleSheetsConfig.connected) {
                showNotification('Configure a conex√£o com Google Sheets primeiro', 'warning');
                return;
            }

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3>üöÄ Demonstra√ß√£o da Integra√ß√£o</h3>
                        <button class="close-modal" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div style="line-height: 1.6;">
                        <div style="background: #e6fffa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <h4>üìä Status Atual da Integra√ß√£o:</h4>
                            <ul style="margin: 15px 0; padding-left: 20px;">
                                <li><strong>Conex√£o:</strong> ${googleSheetsConfig.connected ? '‚úÖ Conectado' : '‚ùå N√£o conectado'}</li>
                                <li><strong>Planilha ID:</strong> ${googleSheetsConfig.sheetId || 'N√£o configurado'}</li>
                                <li><strong>√öltima Sync:</strong> ${googleSheetsConfig.lastSync ? new Date(googleSheetsConfig.lastSync).toLocaleString() : 'Nunca'}</li>
                                <li><strong>Total Matr√≠culas:</strong> ${gameData.matriculas?.length || 0}</li>
                                <li><strong>Total Visitas:</strong> ${gameData.visitas?.length || 0}</li>
                            </ul>
                        </div>

                        <h4>üéØ Testes Dispon√≠veis:</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                            <button class="btn btn-primary" onclick="testarExportacao()">üì§ Testar Exporta√ß√£o</button>
                            <button class="btn btn-success" onclick="testarImportacao()">üì• Testar Importa√ß√£o</button>
                            <button class="btn btn-warning" onclick="testarSincronizacao()">üîÑ Testar Sync Completa</button>
                            <button class="btn btn-info" onclick="gerarDadosTeste()">üß™ Gerar Dados de Teste</button>
                        </div>

                        <div id="demonstracaoLog" style="background: #f8f9fa; padding: 15px; border-radius: 8px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                            <div style="color: #38a169;">[DEMO] Sistema pronto para demonstra√ß√£o...</div>
                        </div>

                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <strong>‚ö†Ô∏è Modo Demonstra√ß√£o:</strong><br>
                            Esta √© uma demonstra√ß√£o das funcionalidades. Em produ√ß√£o, os dados seriam realmente sincronizados com o Google Sheets configurado.
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function testarExportacao() {
            const log = document.getElementById('demonstracaoLog');
            log.innerHTML += '<div style="color: #3182ce;">[DEMO] Iniciando teste de exporta√ß√£o...</div>';
            log.innerHTML += '<div>[DEMO] Preparando dados de matr√≠culas...</div>';
            log.innerHTML += '<div>[DEMO] Conectando com Google Sheets API...</div>';
            log.innerHTML += '<div style="color: #38a169;">[DEMO] ‚úÖ Exporta√ß√£o simulada com sucesso!</div>';
            log.scrollTop = log.scrollHeight;
        }

        function testarImportacao() {
            const log = document.getElementById('demonstracaoLog');
            log.innerHTML += '<div style="color: #3182ce;">[DEMO] Iniciando teste de importa√ß√£o...</div>';
            log.innerHTML += '<div>[DEMO] Lendo dados da planilha...</div>';
            log.innerHTML += '<div>[DEMO] Processando registros...</div>';
            log.innerHTML += '<div style="color: #38a169;">[DEMO] ‚úÖ Importa√ß√£o simulada com sucesso!</div>';
            log.scrollTop = log.scrollHeight;
        }

        function testarSincronizacao() {
            const log = document.getElementById('demonstracaoLog');
            log.innerHTML += '<div style="color: #ed8936;">[DEMO] Iniciando sincroniza√ß√£o bidirecional...</div>';
            log.innerHTML += '<div>[DEMO] Comparando dados locais vs Google Sheets...</div>';
            log.innerHTML += '<div>[DEMO] Identificando diferen√ßas...</div>';
            log.innerHTML += '<div>[DEMO] Resolvendo conflitos...</div>';
            log.innerHTML += '<div style="color: #38a169;">[DEMO] ‚úÖ Sincroniza√ß√£o simulada com sucesso!</div>';
            log.scrollTop = log.scrollHeight;
        }

        function gerarDadosTeste() {
            const log = document.getElementById('demonstracaoLog');
            log.innerHTML += '<div style="color: #667eea;">[DEMO] Gerando dados de teste...</div>';
            
            // Gerar algumas matr√≠culas de teste
            for (let i = 0; i < 3; i++) {
                const matriculaTeste = {
                    id: generateId(),
                    data: new Date().toISOString().split('T')[0],
                    nome: `Cliente Teste ${i + 1}`,
                    telefone: `(11) 9999${i}${i}${i}${i}`,
                    curso: ['Creators 2D', 'Creators 3D', 'Design Gr√°fico'][i],
                    valorTotal: 2000 + (i * 500),
                    valorEntrada: 400 + (i * 100),
                    tipo: 'Convencional',
                    vendedor: currentUser.name,
                    gerente: currentUser.name,
                    assistente: currentUser.name,
                    unidade: currentUnit,
                    origem: 'teste_demonstracao',
                    createdAt: new Date().toISOString(),
                    createdBy: 'Demonstra√ß√£o'
                };
                
                const comissoes = calculateCommissions(matriculaTeste);
                matriculaTeste.comissaoVendedor = comissoes.vendedor;
                matriculaTeste.comissaoGerente = comissoes.gerente;
                matriculaTeste.comissaoAssistente = comissoes.assistente;
                
                gameData.matriculas.push(matriculaTeste);
            }
            
            saveGameData();
            log.innerHTML += '<div style="color: #38a169;">[DEMO] ‚úÖ 3 matr√≠culas de teste geradas!</div>';
            log.innerHTML += '<div>[DEMO] Dados prontos para exporta√ß√£o/sincroniza√ß√£o</div>';
            log.scrollTop = log.scrollHeight;
            
            updateDashboard();
            updateMatriculasList();
            showNotification('Dados de teste gerados! Verifique a aba de matr√≠culas.', 'success');
        }

        // Adicionar bot√£o de demonstra√ß√£o no painel de integra√ß√£o
        function adicionarBotaoDemonstracao() {
            setTimeout(() => {
                const statusDiv = document.getElementById('googleSheetsStatus');
                if (statusDiv && !document.getElementById('demoBotao')) {
                    const demoButton = document.createElement('button');
                    demoButton.id = 'demoBotao';
                    demoButton.className = 'btn btn-info btn-sm';
                    demoButton.onclick = demonstrarIntegracao;
                    demoButton.innerHTML = 'üöÄ Demonstrar Integra√ß√£o';
                    demoButton.style.marginTop = '10px';
                    statusDiv.appendChild(demoButton);
                }
            }, 2000);
        }

        function populateSelects() {
            populateVisitSelects();
            populateMatriculaSelects();
            populatePrivateMessageUsers();
            updateRankingUnits();
        }

        function updateRankingUnits() {
            const rankingUnitSelect = document.getElementById('rankingUnit');
            if (rankingUnitSelect) {
                rankingUnitSelect.innerHTML = '<option value="">Todas</option>' +
                    gameData.units.map(unit => `<option value="${unit}">${unit}</option>`).join('');
            }
        }

        // Adicionar fun√ß√µes que estavam faltando
        function populateSelects() {
            // Implementar quando necess√°rio
        }

        function setupUnitFilter() {
            // Implementar filtro de unidade para admins
            if (currentUser?.role === 'admin') {
                document.getElementById('unitFilter').classList.remove('hidden');
                // Adicionar seletores de unidade
            }
        }

        function updateTeamTab() {
            // Implementar aba de equipe
        }

        function updateAdminTab() {
            loadGoogleSheetsConfig();
            setupGoogleSheetsListeners();
            updateMetasConfig();
            updateUnitsList();
            updateUserManagement();
            updateAdvancedAnalytics();
            
            // Mostrar aba de configura√ß√£o por padr√£o
            setTimeout(() => {
                showScriptTab('setup');
            }, 100);
            
            // Adicionar bot√£o de demonstra√ß√£o
            adicionarBotaoDemonstracao();
        }

        function updateMetasConfig() {
            const metasDiv = document.getElementById('metasConfig');
            
            metasDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    ${gameData.units.map(unit => `
                        <div style="border: 2px solid #38a169; border-radius: 12px; padding: 20px;">
                            <h4 style="margin-bottom: 15px; color: #38a169;">üè¢ ${unit}</h4>
                            <div class="form-group">
                                <label>üë®‚Äçüíº Meta Vendedores:</label>
                                <input type="number" id="meta_vendedores_${unit.replace(/\s+/g, '_')}" 
                                       value="${gameData.metas[unit]?.vendedores || 15}" min="1">
                            </div>
                            <div class="form-group">
                                <label>üëî Meta Gerentes:</label>
                                <input type="number" id="meta_gerentes_${unit.replace(/\s+/g, '_')}" 
                                       value="${gameData.metas[unit]?.gerentes || 20}" min="1">
                            </div>
                            <div class="form-group">
                                <label>üë©‚Äçüíª Meta Assistentes:</label>
                                <input type="number" id="meta_assistentes_${unit.replace(/\s+/g, '_')}" 
                                       value="${gameData.metas[unit]?.assistentes || 10}" min="1">
                            </div>
                            <div class="form-group">
                                <label>üè¢ Meta Total Unidade:</label>
                                <input type="number" id="meta_unidade_${unit.replace(/\s+/g, '_')}" 
                                       value="${gameData.metas[unit]?.unidade || 50}" min="1">
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function salvarMetas() {
            gameData.units.forEach(unit => {
                const unitKey = unit.replace(/\s+/g, '_');
                
                if (!gameData.metas[unit]) gameData.metas[unit] = {};
                
                gameData.metas[unit].vendedores = parseInt(document.getElementById(`meta_vendedores_${unitKey}`).value) || 15;
                gameData.metas[unit].gerentes = parseInt(document.getElementById(`meta_gerentes_${unitKey}`).value) || 20;
                gameData.metas[unit].assistentes = parseInt(document.getElementById(`meta_assistentes_${unitKey}`).value) || 10;
                gameData.metas[unit].unidade = parseInt(document.getElementById(`meta_unidade_${unitKey}`).value) || 50;
            });
            
            saveGameData();
            showNotification('Metas salvas com sucesso!', 'success');
            document.getElementById('metasStatus').innerHTML = '<span style="color: #38a169;">‚úÖ Metas atualizadas com sucesso</span>';
            
            addActivity('metas_updated', `${currentUser.name} atualizou as metas mensais`);
        }

        function carregarMetas() {
            updateMetasConfig();
            showNotification('Metas recarregadas!', 'info');
            document.getElementById('metasStatus').innerHTML = '<span style="color: #3182ce;">üîÑ Metas recarregadas</span>';
        }

        function updateUnitsList() {
            const unitsDiv = document.getElementById('unitsList');
            
            unitsDiv.innerHTML = gameData.units.map(unit => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; margin: 5px 0;">
                    <span style="font-weight: 600;">${unit}</span>
                    <button class="btn btn-danger btn-sm" onclick="removeUnit('${unit}')">üóëÔ∏è Remover</button>
                </div>
            `).join('');
        }

        function addNewUnit() {
            const unitName = document.getElementById('newUnitName').value.trim();
            
            if (!unitName) {
                showNotification('Digite o nome da unidade', 'warning');
                return;
            }
            
            if (gameData.units.includes(unitName)) {
                showNotification('Esta unidade j√° existe', 'error');
                return;
            }
            
            gameData.units.push(unitName);
            
            // Inicializar metas para a nova unidade
            gameData.metas[unitName] = {
                vendedores: 15,
                gerentes: 20,
                assistentes: 10,
                unidade: 50
            };
            
            saveGameData();
            showNotification(`Unidade "${unitName}" adicionada com sucesso!`, 'success');
            addActivity('unit_added', `${currentUser.name} adicionou a unidade ${unitName}`);
            
            document.getElementById('newUnitName').value = '';
            updateUnitsList();
            updateMetasConfig();
            populateSelects();
        }

        function removeUnit(unitName) {
            if (confirm(`Tem certeza que deseja remover a unidade "${unitName}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
                gameData.units = gameData.units.filter(unit => unit !== unitName);
                delete gameData.metas[unitName];
                
                saveGameData();
                showNotification(`Unidade "${unitName}" removida`, 'info');
                addActivity('unit_removed', `${currentUser.name} removeu a unidade ${unitName}`);
                
                updateUnitsList();
                updateMetasConfig();
                populateSelects();
            }
        }

        function updateUserManagement() {
            const tbody = document.getElementById('userManagementBody');
            const users = Object.values(gameData.users);
            
            tbody.innerHTML = users.map(user => {
                const stats = calculateUserStatsForUser(user, 'month');
                
                return `
                    <tr>
                        <td>${user.name}</td>
                        <td>${user.username}</td>
                        <td>${user.unit}</td>
                        <td>
                            <span class="role-badge role-${user.role}">${user.role}</span>
                        </td>
                        <td>${stats.matriculas}</td>
                        <td>${stats.visitas}</td>
                        <td>
                            <span class="xp-badge">${user.xp || 0} XP</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-warning btn-sm" onclick="editUser('${user.username}')">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteUser('${user.username}')">üóëÔ∏è Remover</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Atualizar select de unidades para novos usu√°rios
            const newUserUnitSelect = document.getElementById('newUserUnit');
            if (newUserUnitSelect) {
                newUserUnitSelect.innerHTML = gameData.units.map(unit => 
                    `<option value="${unit}">${unit}</option>`
                ).join('');
            }
        }

        function addUser() {
            const userData = {
                name: document.getElementById('newUserName').value.trim(),
                username: document.getElementById('newUserUsername').value.trim(),
                password: document.getElementById('newUserPassword').value.trim(),
                role: document.getElementById('newUserRole').value,
                unit: document.getElementById('newUserUnit').value,
                xp: 0,
                level: 1,
                achievements: [],
                id: generateId(),
                createdAt: new Date().toISOString(),
                stats: {
                    matriculas: 0,
                    visitas: 0,
                    conversao: 0,
                    comissao: 0
                }
            };
            
            if (!userData.name || !userData.username || !userData.password || !userData.role || !userData.unit) {
                showNotification('Preencha todos os campos', 'warning');
                return;
            }
            
            if (gameData.users[userData.username]) {
                showNotification('Este usu√°rio j√° existe', 'error');
                return;
            }
            
            gameData.users[userData.username] = userData;
            saveGameData();
            
            showNotification(`Usu√°rio ${userData.name} criado com sucesso!`, 'success');
            addActivity('user_added', `${currentUser.name} adicionou o usu√°rio ${userData.name}`);
            
            // Limpar formul√°rio
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserUsername').value = '';
            document.getElementById('newUserPassword').value = '';
            
            updateUserManagement();
        }

        function editUser(username) {
            const user = gameData.users[username];
            if (!user) return;
            
            // Implementar modal de edi√ß√£o de usu√°rio
            showNotification('Funcionalidade de edi√ß√£o em desenvolvimento', 'info');
        }

        function deleteUser(username) {
            const user = gameData.users[username];
            if (!user) return;
            
            if (username === currentUser.username) {
                showNotification('Voc√™ n√£o pode remover sua pr√≥pria conta', 'error');
                return;
            }
            
            if (confirm(`Tem certeza que deseja remover o usu√°rio "${user.name}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
                delete gameData.users[username];
                saveGameData();
                
                showNotification(`Usu√°rio ${user.name} removido`, 'info');
                addActivity('user_removed', `${currentUser.name} removeu o usu√°rio ${user.name}`);
                
                updateUserManagement();
            }
        }

        function updateAdvancedAnalytics() {
            const totalRevenue = gameData.matriculas.reduce((sum, m) => sum + (m.valorTotal || 0), 0);
            const avgTicket = gameData.matriculas.length > 0 ? totalRevenue / gameData.matriculas.length : 0;
            
            // Calcular crescimento mensal (simulado)
            const currentMonth = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                const now = new Date();
                return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
            }).length;
            
            const lastMonth = gameData.matriculas.filter(m => {
                const date = new Date(m.data);
                const now = new Date();
                const lastMonthDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                return date.getMonth() === lastMonthDate.getMonth() && date.getFullYear() === lastMonthDate.getFullYear();
            }).length;
            
            const growthRate = lastMonth > 0 ? ((currentMonth - lastMonth) / lastMonth) * 100 : 0;
            
            document.getElementById('totalRevenue').textContent = `R$ ${totalRevenue.toLocaleString()}`;
            document.getElementById('avgTicket').textContent = `R$ ${avgTicket.toLocaleString()}`;
            document.getElementById('growthRate').textContent = `${growthRate.toFixed(1)}%`;
        }

        function createBackup() {
            const backupData = {
                gameData: gameData,
                googleSheetsConfig: googleSheetsConfig,
                timestamp: new Date().toISOString(),
                version: '2.0'
            };
            
            const backupJson = JSON.stringify(backupData, null, 2);
            localStorage.setItem('gameCreatorsBackup', backupJson);
            
            showNotification('Backup criado com sucesso!', 'success');
            document.getElementById('backupStatus').textContent = `‚úÖ Backup criado em ${new Date().toLocaleString()}`;
            addActivity('backup_created', `${currentUser.name} criou um backup do sistema`);
        }

        function downloadBackup() {
            const backupData = localStorage.getItem('gameCreatorsBackup');
            
            if (!backupData) {
                showNotification('Nenhum backup encontrado. Crie um backup primeiro.', 'warning');
                return;
            }
            
            const blob = new Blob([backupData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `game-creators-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Backup baixado com sucesso!', 'success');
        }

        function restoreBackup() {
            const fileInput = document.getElementById('backupFile');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso substituir√° todos os dados atuais. Continuar?')) {
                        gameData = backupData.gameData || backupData; // Compatibilidade com vers√µes antigas
                        
                        if (backupData.googleSheetsConfig) {
                            googleSheetsConfig = backupData.googleSheetsConfig;
                            localStorage.setItem('googleSheetsConfig', JSON.stringify(googleSheetsConfig));
                        }
                        
                        saveGameData();
                        showNotification('Backup restaurado com sucesso! Recarregando...', 'success');
                        
                        setTimeout(() => {
                            location.reload();
                        }, 2000);
                    }
                } catch (error) {
                    showNotification('Arquivo de backup inv√°lido', 'error');
                }
            };
            reader.readAsText(file);
        }

        function resetSystem() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso apagar√° TODOS os dados do sistema. Tem certeza?')) {
                if (confirm('üö® √öLTIMA CHANCE: Esta a√ß√£o √© IRREVERS√çVEL!')) {
                    localStorage.clear();
                    showNotification('Sistema resetado. Recarregando...', 'info');
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                }
            }
        }

        function saveSystemConfig() {
            const config = {
                autoSyncInterval: document.getElementById('autoSyncInterval').value,
                adminEmail: document.getElementById('adminEmail').value,
                companyUrl: document.getElementById('companyUrl').value
            };
            
            localStorage.setItem('systemConfig', JSON.stringify(config));
            showNotification('Configura√ß√µes salvas com sucesso!', 'success');
            addActivity('config_updated', `${currentUser.name} atualizou as configura√ß√µes do sistema`);
            
            // Reiniciar auto-sync se necess√°rio
            startAutoSync();
        }

        function updateRelatoriosTab() {
            // Implementar aba de relat√≥rios
        }

        function updateChatTab() {
            // Implementar sistema de chat
        }

        function toggleTheme() {
            // Implementar tema escuro
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme);
            localStorage.setItem('theme', currentTheme);
        }

        function showForgotPassword() {
            showNotification('Entre em contato com o administrador para recuperar sua senha', 'info');
        }

        function quickAddMatricula() {
            document.getElementById('quickMatriculaModal').style.display = 'flex';
        }

        function closeQuickMatriculaModal() {
            document.getElementById('quickMatriculaModal').style.display = 'none';
        }

        function addQuickMatricula() {
            const quickData = {
                nome: document.getElementById('quickNome').value,
                curso: document.getElementById('quickCurso').value,
                valor: parseFloat(document.getElementById('quickValor').value),
                vendedor: document.getElementById('quickVendedor').value
            };
            
            if (!quickData.nome || !quickData.curso || !quickData.valor || !quickData.vendedor) {
                showNotification('Preencha todos os campos', 'warning');
                return;
            }
            
            const matricula = {
                id: generateId(),
                data: new Date().toISOString().split('T')[0],
                nome: quickData.nome,
                telefone: '',
                curso: quickData.curso,
                valorTotal: quickData.valor,
                valorEntrada: quickData.valor * 0.2, // 20% de entrada
                tipo: 'Convencional',
                parcelas: 1,
                vendedor: quickData.vendedor,
                gerente: currentUser.name,
                assistente: currentUser.name,
                unidade: currentUnit,
                origem: 'matricula_rapida',
                createdAt: new Date().toISOString(),
                createdBy: currentUser.name
            };
            
            // Calcular comiss√µes
            const comissoes = calculateCommissions(matricula);
            matricula.comissaoVendedor = comissoes.vendedor;
            matricula.comissaoGerente = comissoes.gerente;
            matricula.comissaoAssistente = comissoes.assistente;
            
            gameData.matriculas.push(matricula);
            saveGameData();
            
            addXP(50, 'Matr√≠cula r√°pida adicionada');
            showNotification('Matr√≠cula r√°pida adicionada com sucesso! +50 XP', 'success');
            addActivity('quick_matricula_added', `${currentUser.name} adicionou matr√≠cula r√°pida de ${matricula.nome}`);
            
            closeQuickMatriculaModal();
            updateDashboard();
            
            // Limpar campos
            document.getElementById('quickNome').value = '';
            document.getElementById('quickValor').value = '';
        }

        // Populat vendedores no modal r√°pido
        function populateQuickVendedores() {
            const select = document.getElementById('quickVendedor');
            if (!select) return;
            
            const vendedores = Object.values(gameData.users).filter(user => 
                user.unit === currentUnit && user.role === 'vendedor'
            );
            
            select.innerHTML = vendedores.map(user => 
                `<option value="${user.name}" ${user.name === currentUser.name ? 'selected' : ''}>${user.name}</option>`
            ).join('');
        }

        // Atualizar modal r√°pido quando abrir
        function quickAddMatricula() {
            document.getElementById('quickMatriculaModal').style.display = 'flex';
            populateQuickVendedores();
        }

    </script>
</body>
</html>
